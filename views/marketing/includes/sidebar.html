<!-- Marketing Module Sidebar - Sticky -->
<aside id="sidebar" class="w-64 bg-white dark:bg-gray-800 flex flex-col transition-all duration-300 sticky top-0 h-screen overflow-y-auto">
  <a href="marketing_dashboard">
    <div class="p-4 border-b border-gray-200 dark:border-gray-700">
      <img src="/uploads/Logo2.png" alt="Logo" class="w-full h-auto"/>
    </div>
  </a>
  <div class="flex-1 p-4">
    <ul class="flex flex-col w-full space-y-1">
      <li>
        <a href="marketing_dashboard" class="flex items-center h-12 px-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition" data-page="marketing_dashboard">
          <i class="bi bi-graph-up-arrow text-xl text-indigo-600 dark:text-indigo-400"></i>
          <span class="ml-3">แดชบอร์ด</span>
        </a>
      </li>
      <li>
        <a href="campaigns" class="flex items-center h-12 px-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition" data-page="campaigns">
          <i class="bi bi-megaphone-fill text-xl text-orange-500 dark:text-orange-400"></i>
          <span class="ml-3">แคมเปญ</span>
        </a>
      </li>
      <li>
        <a href="analytics" class="flex items-center h-12 px-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition" data-page="analytics">
          <i class="bi bi-bar-chart-line text-xl text-blue-500 dark:text-blue-400"></i>
          <span class="ml-3">วิเคราะห์ข้อมูล</span>
        </a>
      </li>
      <li>
        <a href="content_management" class="flex items-center h-12 px-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition" data-page="content_management">
          <i class="bi bi-file-earmark-richtext text-xl text-teal-500 dark:text-teal-400"></i>
          <span class="ml-3">จัดการเนื้อหา</span>
        </a>
      </li>
      <li>
        <a href="social_media" class="flex items-center h-12 px-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition" data-page="social_media">
          <i class="bi bi-share-fill text-xl text-purple-500 dark:text-purple-400"></i>
          <span class="ml-3">สื่อสังคม</span>
        </a>
      </li>
      <li>
        <a href="popup_management" class="flex items-center h-12 px-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition" data-page="popup_management">
          <i class="bi bi-gift text-xl text-purple-500 dark:text-purple-400"></i>
          <span class="ml-3">Popup โปรโมชั่น</span>
        </a>
      </li>
      <li>
        <a href="customer_data" class="flex items-center px-4 h-12 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition" data-page="customer_data">
          <i class="bi bi-people text-xl text-pink-500 dark:text-pink-400 mr-3"></i>
          <span>ข้อมูลลูกค้า</span>
        </a>
      </li>
      <li>
        <a href="budget_reports" class="flex items-center px-4 h-12 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition" data-page="budget_reports">
          <i class="bi bi-cash-coin text-xl text-emerald-500 dark:text-emerald-400 mr-3"></i>
          <span>งบประมาณและรายงาน</span>
        </a>
      </li>
      <li class="mt-4">
        <a href="marketing_settings" class="flex items-center h-12 px-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition" data-page="marketing_settings">
          <i class="bi bi-gear text-xl text-gray-600 dark:text-gray-300"></i>
          <span class="ml-3">การตั้งค่า</span>
        </a>
      </li>
      <li class="mt-6">
        <button id="btnToggleDark" class="flex items-center h-12 px-4 rounded-lg w-full text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition">
          <i class="bi bi-moon text-xl text-slate-600 dark:text-slate-300"></i>
          <span class="ml-3" id="darkModeLabel">Dark Mode</span>
        </button>
      </li>
      <li>
        <button id="btnLogoutSidebar" class="flex items-center h-12 px-4 rounded-lg w-full text-left text-red-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
          <i class="bi bi-box-arrow-right text-xl"></i>
          <span class="ml-3">ออกจากระบบ</span>
        </button>
      </li>
      <li>
        <div id="profile" class="flex items-center h-12 px-4 rounded-lg bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700">
          <img id="employeePhoto" src="https://ui-avatars.com/api/?name=User&size=36" alt="Employee Photo" class="w-10 h-10 rounded-full mr-3"/>
          <span id="employeeName">Loading...</span>
        </div>
      </li>
    </ul>
  </div>
</aside>

<script>
// Sidebar functionality
function initializeSidebar() {
  // Set active menu item based on current page
  const currentPage = window.location.pathname.split('/').pop() || 'marketing_dashboard';
  const menuItems = document.querySelectorAll('aside a[data-page]');

  menuItems.forEach(item => {
    const pageName = item.getAttribute('data-page');
    if (pageName === currentPage ||
        (currentPage === '' && pageName === 'marketing_dashboard')) {
      item.classList.add('bg-gray-100', 'dark:bg-gray-700');
      item.classList.remove('hover:bg-gray-100', 'dark:hover:bg-gray-700');
    } else {
      item.classList.remove('bg-gray-100', 'dark:bg-gray-700');
      item.classList.add('hover:bg-gray-100', 'dark:hover:bg-gray-700');
    }
  });

  // Dark mode toggle
  const btnToggleDark = document.getElementById('btnToggleDark');
  const darkModeLabel = document.getElementById('darkModeLabel');

  if (btnToggleDark) {
    btnToggleDark.addEventListener('click', () => {
      const isDark = document.documentElement.classList.toggle('dark');
      localStorage.setItem('darkMode', isDark);
      darkModeLabel.textContent = isDark ? 'Light Mode' : 'Dark Mode';

      // Update icon
      const icon = btnToggleDark.querySelector('i');
      if (isDark) {
        icon.classList.remove('bi-moon');
        icon.classList.add('bi-sun');
      } else {
        icon.classList.remove('bi-sun');
        icon.classList.add('bi-moon');
      }
    });

    // Initialize dark mode from localStorage
    const savedDarkMode = localStorage.getItem('darkMode') === 'true';
    if (savedDarkMode) {
      document.documentElement.classList.add('dark');
      darkModeLabel.textContent = 'Light Mode';
      const icon = btnToggleDark.querySelector('i');
      icon.classList.remove('bi-moon');
      icon.classList.add('bi-sun');
    }
  }

  // Logout functionality
  const btnLogoutSidebar = document.getElementById('btnLogoutSidebar');
  if (btnLogoutSidebar) {
    btnLogoutSidebar.addEventListener('click', () => {
      if (confirm('คุณต้องการออกจากระบบหรือไม่?')) {
        localStorage.removeItem('authToken');
        localStorage.removeItem('token');
        localStorage.removeItem('userInfo');
        localStorage.removeItem('userProfile');
        window.location.href = '/login';
      }
    });
  }
}

// Initialize sidebar when DOM is loaded
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initializeSidebar);
} else {
  initializeSidebar();
}
</script>