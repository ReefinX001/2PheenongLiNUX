<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>จัดการเนื้อหา - ระบบการตลาด</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- User Profile Manager -->
  <script src="/views/marketing/js/user-profile.js"></script>
  <!-- Sidebar Manager -->
  <script src="/views/marketing/js/sidebar.js"></script>

  <!-- Favicon ต่างๆ -->
  <link rel="icon" href="/favicon/favicon.ico" type="image/x-icon" />
  
  <!-- Google Fonts - Prompt -->
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Tailwind + DaisyUI -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'Prompt', 'sans-serif'],
            prompt: ['Prompt', 'sans-serif'],
          },
          boxShadow: {
            'lux': '0 8px 32px 0 rgba(31, 38, 135, 0.18)'
          }
        },
      },
      daisyui: {
        themes: ['luxury', 'dark', 'corporate'],
      },
    };
  </script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@2.51.5/dist/full.css" rel="stylesheet" />
  
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />

  <!-- Animate.css for fade animations -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">

  <!-- Lottie for animations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
  
  <!-- Quill Editor -->
  <link href="https://cdn.jsdelivr.net/npm/quill@1.3.6/dist/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/quill@1.3.6/dist/quill.min.js"></script>
  
  <style>
    /* เพิ่ม CSS สำหรับความสวยงาม */
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .animate-fadeIn {
      animation: fadeIn 0.3s ease-in-out;
    }

    /* Card hover effects */
    .card {
      transition: all 0.2s ease-in-out;
    }

    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }

    .dark ::-webkit-scrollbar-track {
      background: #1e1e1e;
    }

    ::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }

    /* Status indicators */
    .status-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 5px;
    }

    .status-published {
      background-color: #10b981;
    }

    .status-scheduled {
      background-color: #f59e0b;
    }

    .status-draft {
      background-color: #6b7280;
    }
    
    /* Main content */
    .main-content {
      flex: 1;
      padding: 20px 30px;
      overflow-y: auto;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }
    
    .page-title h1 {
      font-size: 1.8rem;
      margin-bottom: 5px;
    }
    
    .page-title p {
      font-size: 0.9rem;
    }

    /* Content Tab Navigation */
    .content-tab-nav {
      display: flex;
      border-bottom: 2px solid #e5e7eb;
      margin-bottom: 20px;
      overflow-x: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .content-tab-nav::-webkit-scrollbar {
      display: none;
    }

    .dark .content-tab-nav {
      border-bottom-color: #374151;
    }

    .content-tab-btn {
      padding: 12px 24px;
      font-size: 1rem;
      font-weight: 500;
      color: #6b7280;
      border-bottom: 2px solid transparent;
      margin-bottom: -2px;
      white-space: nowrap;
      transition: all 0.2s ease;
    }

    .dark .content-tab-btn {
      color: #9ca3af;
    }

    .content-tab-btn:hover {
      color: #111827;
      border-bottom-color: #d1d5db;
    }

    .dark .content-tab-btn:hover {
      color: #f9fafb;
      border-bottom-color: #4b5563;
    }

    .content-tab-btn.active {
      color: #14b8a6;
      border-bottom-color: #14b8a6;
    }

    .dark .content-tab-btn.active {
      color: #2dd4bf;
      border-bottom-color: #2dd4bf;
    }

    /* Content Cards */
    .content-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .content-card {
      background-color: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: all 0.2s ease;
      position: relative;
    }

    .dark .content-card {
      background-color: #1f2937;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }

    .content-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    .content-card-image {
      height: 160px;
      background-size: cover;
      background-position: center;
      position: relative;
    }

    .content-card-status {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 500;
      color: white;
    }

    .status-published-badge {
      background-color: #10b981;
    }

    .status-scheduled-badge {
      background-color: #f59e0b;
    }

    .status-draft-badge {
      background-color: #6b7280;
    }

    .content-card-body {
      padding: 16px;
    }

    .content-card-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 6px;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .content-card-meta {
      display: flex;
      justify-content: space-between;
      color: #6b7280;
      font-size: 0.85rem;
      margin-bottom: 12px;
    }

    .dark .content-card-meta {
      color: #9ca3af;
    }

    .content-card-description {
      font-size: 0.9rem;
      color: #4b5563;
      margin-bottom: 16px;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
      line-height: 1.5;
    }

    .dark .content-card-description {
      color: #d1d5db;
    }

    .content-card-actions {
      display: flex;
      justify-content: space-between;
      border-top: 1px solid #e5e7eb;
      padding-top: 12px;
    }

    .dark .content-card-actions {
      border-top-color: #374151;
    }

    .content-card-actions button {
      background: none;
      border: none;
      padding: 6px;
      border-radius: 4px;
      color: #6b7280;
      transition: all 0.2s ease;
    }

    .dark .content-card-actions button {
      color: #9ca3af;
    }

    .content-card-actions button:hover {
      background-color: #f3f4f6;
      color: #111827;
    }

    .dark .content-card-actions button:hover {
      background-color: #374151;
      color: #f9fafb;
    }

    /* Modal Styles */
    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 50;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .modal-backdrop.show {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background-color: white;
      border-radius: 0.5rem;
      padding: 1.5rem;
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
      transform: translateY(-20px);
      transition: transform 0.3s ease;
    }

    .modal-backdrop.show .modal-content {
      transform: translateY(0);
    }

    .dark .modal-content {
      background-color: #1f2937;
    }

    /* Calendar Styles */
    .calendar-wrapper {
      background-color: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .dark .calendar-wrapper {
      background-color: #1f2937;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 24px;
      border-bottom: 1px solid #e5e7eb;
    }

    .dark .calendar-header {
      border-bottom-color: #374151;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      padding: 12px;
    }

    .calendar-day-header {
      text-align: center;
      font-weight: 500;
      color: #6b7280;
      padding: 12px;
    }

    .dark .calendar-day-header {
      color: #9ca3af;
    }

    .calendar-day {
      min-height: 100px;
      padding: 8px;
      border: 1px solid #e5e7eb;
      transition: background-color 0.2s ease;
    }

    .dark .calendar-day {
      border-color: #374151;
    }

    .calendar-day:hover {
      background-color: #f3f4f6;
    }

    .dark .calendar-day:hover {
      background-color: #374151;
    }

    .calendar-day-number {
      font-size: 0.9rem;
      font-weight: 500;
      margin-bottom: 6px;
    }

    .calendar-day.today {
      background-color: #ecfdf5;
      border-color: #10b981;
    }

    .dark .calendar-day.today {
      background-color: rgba(16, 185, 129, 0.1);
      border-color: #10b981;
    }

    .calendar-event {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.75rem;
      margin-bottom: 3px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      cursor: pointer;
    }

    .calendar-event.blog {
      background-color: #dbeafe;
      color: #1e40af;
    }

    .dark .calendar-event.blog {
      background-color: rgba(30, 64, 175, 0.2);
      color: #93c5fd;
    }

    .calendar-event.social {
      background-color: #fef3c7;
      color: #92400e;
    }

    .dark .calendar-event.social {
      background-color: rgba(146, 64, 14, 0.2);
      color: #fcd34d;
    }

    .calendar-event.video {
      background-color: #fce7f3;
      color: #9d174d;
    }

    .dark .calendar-event.video {
      background-color: rgba(157, 23, 77, 0.2);
      color: #fbcfe8;
    }

    /* Rich Text Editor Styling */
    .quill-editor {
      height: 300px;
      margin-bottom: 20px;
      border-radius: 4px;
    }
    
    .dark .ql-toolbar.ql-snow,
    .dark .ql-container.ql-snow {
      border-color: #4b5563;
    }
    
    .dark .ql-editor {
      color: #f3f4f6;
    }
    
    .dark .ql-snow .ql-stroke {
      stroke: #e5e7eb;
    }
    
    .dark .ql-snow .ql-fill {
      fill: #e5e7eb;
    }
    
    /* Tag Styles */
    .tag-container {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
    }
    
    .tag {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      background-color: #f3f4f6;
      border-radius: 16px;
      font-size: 0.85rem;
    }
    
    .dark .tag {
      background-color: #374151;
    }
    
    .tag .tag-remove {
      margin-left: 6px;
      cursor: pointer;
      opacity: 0.6;
      transition: opacity 0.2s;
    }
    
    .tag .tag-remove:hover {
      opacity: 1;
    }

    /* File Upload Styles */
    .file-upload-container {
      border: 2px dashed #d1d5db;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .dark .file-upload-container {
      border-color: #4b5563;
    }
    
    .file-upload-container:hover {
      border-color: #14b8a6;
      background-color: #f9fafb;
    }
    
    .dark .file-upload-container:hover {
      border-color: #2dd4bf;
      background-color: #111827;
    }
    
    .file-upload-icon {
      font-size: 2rem;
      color: #6b7280;
      margin-bottom: 10px;
    }
    
    .dark .file-upload-icon {
      color: #9ca3af;
    }
    
    .file-upload-text {
      font-size: 0.9rem;
      color: #6b7280;
    }
    
    .dark .file-upload-text {
      color: #9ca3af;
    }
    
    .file-upload-input {
      display: none;
    }
    .loading-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(255, 255, 255, 0.9);
      display: flex; justify-content: center; align-items: center;
      z-index: 9999;
      backdrop-filter: blur(12px);
    }
  </style>

  <script>
    let lottieAnimation = null;
  </script>
</head>

<body class="bg-white text-gray-700 dark:bg-gray-700 dark:text-gray-200">
  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="loading-overlay animate__animated animate__fadeOut" style="display: none;">
    <div class="text-center">
      <div id="lottieContainer" class="w-96 h-96 mx-auto flex items-center justify-center"></div>
    </div>
  </div>
  <!-- Toggle Sidebar Button -->
  <button id="btnToggleMenu" class="fixed left-0 top-1/2 bg-blue-600 text-white p-2 rounded-r-full shadow-lg z-50 hover:bg-blue-700">
    <i class="bi bi-chevron-left"></i>
  </button>

  <div class="min-h-screen flex">
    <!-- Sidebar Container -->
    <div id="sidebar-container">
      <!-- Sidebar content will be loaded here -->
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
      <!-- Header -->
      <div class="header">
        <div class="page-title">
          <h1 class="text-2xl font-semibold">จัดการเนื้อหา</h1>
          <p class="text-gray-500 dark:text-gray-400">สร้าง แก้ไข และจัดการเนื้อหาการตลาดทั้งหมด</p>
        </div>
        <div class="flex gap-3">
          <button id="btnCreateContent" class="bg-teal-500 hover:bg-teal-600 text-white py-2 px-4 rounded-md flex items-center">
            <i class="bi bi-plus-lg mr-2"></i> สร้างเนื้อหาใหม่
          </button>
          <div class="relative">
            <input 
              type="text" 
              id="searchContent" 
              placeholder="ค้นหาเนื้อหา..." 
              class="bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md py-2 px-4 pl-10"
            >
            <i class="bi bi-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500"></i>
          </div>
        </div>
      </div>

      <!-- Content Tabs -->
      <div class="content-tab-nav">
        <button class="content-tab-btn active" data-tab="all">ทั้งหมด</button>
        <button class="content-tab-btn" data-tab="blog">บทความ</button>
        <button class="content-tab-btn" data-tab="social">โซเชียลโพสต์</button>
        <button class="content-tab-btn" data-tab="email">อีเมลแคมเปญ</button>
        <button class="content-tab-btn" data-tab="video">วิดีโอ</button>
        <button class="content-tab-btn" data-tab="landing">หน้าแลนดิ้ง</button>
        <button class="content-tab-btn" data-tab="calendar">ปฏิทินคอนเทนต์</button>
      </div>

      <!-- Content Filter & Sort -->
      <div class="flex flex-wrap justify-between items-center mb-4">
        <div class="flex items-center space-x-2 mb-2 sm:mb-0">
          <span class="text-gray-600 dark:text-gray-400 text-sm">กรองโดย:</span>
          <select id="statusFilter" class="bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md text-sm">
            <option value="all">สถานะทั้งหมด</option>
            <option value="published">เผยแพร่แล้ว</option>
            <option value="scheduled">กำหนดเวลา</option>
            <option value="draft">แบบร่าง</option>
          </select>
          <select id="dateFilter" class="bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md text-sm">
            <option value="all">ช่วงเวลาทั้งหมด</option>
            <option value="this_week">สัปดาห์นี้</option>
            <option value="this_month">เดือนนี้</option>
            <option value="last_month">เดือนที่แล้ว</option>
            <option value="this_year">ปีนี้</option>
          </select>
        </div>
        <div class="flex items-center space-x-2">
          <span class="text-gray-600 dark:text-gray-400 text-sm">เรียงโดย:</span>
          <select id="sortBy" class="bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md text-sm">
            <option value="newest">ล่าสุด</option>
            <option value="oldest">เก่าสุด</option>
            <option value="title_az">ชื่อ A-Z</option>
            <option value="title_za">ชื่อ Z-A</option>
            <option value="most_views">ยอดเข้าชมสูงสุด</option>
          </select>
        </div>
      </div>

      <!-- Content Stats -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm">
          <div class="flex justify-between items-center">
            <div>
              <p class="text-sm text-gray-500 dark:text-gray-400">เนื้อหาทั้งหมด</p>
              <p class="text-2xl font-bold">42</p>
            </div>
            <div class="text-blue-500 bg-blue-100 dark:bg-blue-900 dark:text-blue-300 p-3 rounded-full">
              <i class="bi bi-file-earmark-text"></i>
            </div>
          </div>
        </div>
        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm">
          <div class="flex justify-between items-center">
            <div>
              <p class="text-sm text-gray-500 dark:text-gray-400">เผยแพร่แล้ว</p>
              <p class="text-2xl font-bold">28</p>
            </div>
            <div class="text-green-500 bg-green-100 dark:bg-green-900 dark:text-green-300 p-3 rounded-full">
              <i class="bi bi-check-circle"></i>
            </div>
          </div>
        </div>
        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm">
          <div class="flex justify-between items-center">
            <div>
              <p class="text-sm text-gray-500 dark:text-gray-400">กำหนดเวลา</p>
              <p class="text-2xl font-bold">7</p>
            </div>
            <div class="text-yellow-500 bg-yellow-100 dark:bg-yellow-900 dark:text-yellow-300 p-3 rounded-full">
              <i class="bi bi-calendar-event"></i>
            </div>
          </div>
        </div>
        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm">
          <div class="flex justify-between items-center">
            <div>
              <p class="text-sm text-gray-500 dark:text-gray-400">แบบร่าง</p>
              <p class="text-2xl font-bold">7</p>
            </div>
            <div class="text-gray-500 bg-gray-100 dark:bg-gray-900 dark:text-gray-300 p-3 rounded-full">
              <i class="bi bi-pencil-square"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Content Grid -->
      <div class="content-grid" id="contentGrid">
        <!-- Content will be loaded dynamically -->
        <div class="text-center py-12 col-span-full">
          <i class="bi bi-file-earmark-text text-6xl text-gray-400 dark:text-gray-500 mb-4"></i>
          <h3 class="text-lg font-semibold text-gray-600 dark:text-gray-400 mb-2">ยังไม่มีเนื้อหา</h3>
          <p class="text-gray-500 dark:text-gray-400">เริ่มสร้างเนื้อหาแรกของคุณหรือนำเข้าจากโซเชียลมีเดีย</p>
        </div>
      </div>

      <!-- Pagination -->
      <div class="flex justify-center mt-8">
        <nav class="flex items-center space-x-2">
          <button class="w-10 h-10 flex items-center justify-center rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800" disabled>
            <i class="bi bi-chevron-left"></i>
          </button>
          <button class="w-10 h-10 flex items-center justify-center rounded-md border border-transparent bg-teal-500 text-white">1</button>
          <button class="w-10 h-10 flex items-center justify-center rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700">2</button>
          <button class="w-10 h-10 flex items-center justify-center rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700">3</button>
          <span class="text-gray-500">...</span>
          <button class="w-10 h-10 flex items-center justify-center rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700">7</button>
          <button class="w-10 h-10 flex items-center justify-center rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700">
            <i class="bi bi-chevron-right"></i>
          </button>
        </nav>
      </div>
    </div>
  </div>

  <!-- Create Content Modal -->
  <div id="createContentModal" class="modal-backdrop">
    <div class="modal-content">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-lg font-semibold">สร้างเนื้อหาใหม่</h3>
        <button id="closeModal" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
      
      <form id="contentForm" class="space-y-4">
        <div>
          <label for="contentTitle" class="block mb-1 text-sm font-medium">หัวข้อเนื้อหา</label>
          <input type="text" id="contentTitle" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700" placeholder="ใส่หัวข้อเนื้อหาที่นี่">
        </div>
        
        <div>
          <label for="contentType" class="block mb-1 text-sm font-medium">ประเภทเนื้อหา</label>
          <select id="contentType" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
            <option value="" disabled selected>เลือกประเภทเนื้อหา</option>
            <option value="blog">บทความ</option>
            <option value="social">โซเชียลโพสต์</option>
            <option value="email">อีเมลแคมเปญ</option>
            <option value="video">วิดีโอ</option>
            <option value="landing">หน้าแลนดิ้ง</option>
          </select>
        </div>
        
        <div>
          <label class="block mb-1 text-sm font-medium">เนื้อหา</label>
          <div id="quillEditor" class="quill-editor"></div>
        </div>
        
        <div>
          <label for="contentTags" class="block mb-1 text-sm font-medium">แท็ก</label>
          <input type="text" id="contentTags" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700" placeholder="เพิ่มแท็ก (คั่นด้วยเครื่องหมายจุลภาค)">
          
          <div class="tag-container mt-2">
            <div class="tag">
              iPhone <span class="tag-remove">×</span>
            </div>
            <div class="tag">
              Smartphone <span class="tag-remove">×</span>
            </div>
            <div class="tag">
              Review <span class="tag-remove">×</span>
            </div>
          </div>
        </div>
        
        <div>
          <label class="block mb-1 text-sm font-medium">รูปภาพหน้าปก</label>
          <div class="file-upload-container">
            <input type="file" id="coverImage" class="file-upload-input" accept="image/*">
            <div class="file-upload-icon">
              <i class="bi bi-cloud-arrow-up"></i>
            </div>
            <p class="file-upload-text">ลากไฟล์มาวางที่นี่ หรือคลิกเพื่อเลือกไฟล์</p>
            <p class="file-upload-text text-xs mt-2">(สนับสนุนรูปแบบไฟล์ .jpg, .png, .webp ขนาดไม่เกิน 5MB)</p>
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block mb-1 text-sm font-medium">การเผยแพร่</label>
            <div class="flex space-x-4">
              <label class="flex items-center">
                <input type="radio" name="publishOption" value="now" class="mr-2" checked>
                <span>เผยแพร่ทันที</span>
              </label>
              <label class="flex items-center">
                <input type="radio" name="publishOption" value="later" class="mr-2">
                <span>กำหนดเวลา</span>
              </label>
            </div>
          </div>
          <div>
            <label for="scheduleDate" class="block mb-1 text-sm font-medium">วันและเวลาที่เผยแพร่</label>
            <input type="datetime-local" id="scheduleDate" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700" disabled>
          </div>
        </div>
        
        <div>
          <label for="campaignAssociation" class="block mb-1 text-sm font-medium">เชื่อมโยงกับแคมเปญ</label>
          <select id="campaignAssociation" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
            <option value="">ไม่เชื่อมโยงกับแคมเปญใด</option>
            <option value="1">โปรโมชั่นซัมเมอร์ 2025</option>
            <option value="2">แคมเปญกลับสู่โรงเรียน</option>
            <option value="3">โปรแกรมแลกเปลี่ยนมือถือ</option>
          </select>
        </div>
        
        <div class="flex justify-end space-x-3 mt-6">
          <button type="button" id="saveAsDraft" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700">บันทึกเป็นแบบร่าง</button>
          <button type="submit" class="px-4 py-2 bg-teal-500 text-white rounded-md hover:bg-teal-600">เผยแพร่เนื้อหา</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Facebook API Configuration
    const FACEBOOK_CONFIG = {
      accessToken: 'EAAb9WZC2D19YBPbzWtH3d2xGf6hSmHzZAXMXToOpCtlZC3GLR3ZAOxGLgJbnT3dzx35DPxzECYBYwOKmOJHZCDT2q5QIVoXCC4zZAxZBfhfQDoZBmNxZC2GzMWDtnRc2HZBCQamXpGpvDIZCcQ5KFroAD6yjh5pJZBJ43ieuVj7ZCQZB0HvFUHX9ngh8IaPBWzyt3d82goBgZDZD', // Facebook Page Access Token
      apiVersion: 'v19.0',
      baseUrl: 'https://graph.facebook.com',
      permissions: [
        'read_insights',
        'pages_show_list',
        'instagram_basic',
        'instagram_manage_comments',
        'instagram_manage_insights',
        'instagram_content_publish',
        'pages_read_engagement',
        'pages_manage_metadata',
        'pages_read_user_content',
        'pages_manage_ads',
        'pages_manage_posts'
      ]
    };

    // Configuration Status Check
    console.log('📋 Facebook Configuration Status:', {
      hasAccessToken: !!FACEBOOK_CONFIG.accessToken,
      apiVersion: FACEBOOK_CONFIG.apiVersion,
      permissionsCount: FACEBOOK_CONFIG.permissions.length
    });

    // Social Media Data Storage
    let socialMediaData = {
      metrics: {},
      posts: [],
      insights: {},
      pages: [],
      currentPage: null,
      pageDetails: null,
      facebookPosts: [],
      instagramPosts: [],
      instagramInsights: null
    };

    // Wait for the DOM to load
    // Show/Hide Loading Function
    function showLoading(show) {
      const loader = document.getElementById('loadingOverlay');
      if (show) {
        loader.style.display = 'flex';
        loader.classList.remove('animate__fadeOut');
        loader.classList.add('animate__fadeIn');

        // โหลดและเล่น Lottie animation
        if (!lottieAnimation) {
          console.log('🔄 Loading Lottie animation from /Loading/Loading.json');
          fetch('/Loading/Loading.json')
            .then(response => {
              if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
              }
              return response.json();
            })
            .then(animationData => {
              lottieAnimation = lottie.loadAnimation({
                container: document.getElementById('lottieContainer'),
                renderer: 'svg',
                loop: true,
                autoplay: true,
                animationData: animationData
              });

              console.log('✅ Lottie animation loaded successfully');
            })
            .catch(error => {
              console.error('❌ Error loading Lottie animation:', error);
              // No fallback spinner - just show empty container
              document.getElementById('lottieContainer').innerHTML = '';
            });
        } else {
          lottieAnimation.play();
        }
      } else {
        if (lottieAnimation) {
          lottieAnimation.pause();
        }
        loader.classList.remove('animate__fadeIn');
        loader.classList.add('animate__fadeOut');
        setTimeout(() => { loader.style.display = 'none'; }, 600);
      }
    }

    document.addEventListener('DOMContentLoaded', async function() {
      // Load sidebar first
      try {
        const response = await fetch('/views/marketing/includes/sidebar.html');
        const sidebarHtml = await response.text();
        const sidebarContainer = document.getElementById('sidebar-container');
        if (sidebarContainer) {
          sidebarContainer.innerHTML = sidebarHtml;
          // Initialize sidebar functionality
          if (typeof initializeSidebar === 'function') {
            initializeSidebar();
          }
        }
      } catch (error) {
        console.error('Error loading sidebar:', error);
        // Fallback: show basic sidebar structure
        const sidebarContainer = document.getElementById('sidebar-container');
        if (sidebarContainer) {
          sidebarContainer.innerHTML = '<aside class="w-64 bg-white dark:bg-gray-800 sticky top-0 h-screen"><div class="p-4">Sidebar Loading Error</div></aside>';
        }
      }
    
      // Initialize Toggle Menu
      initToggleMenu();
    
      // Initialize Dark Mode
      initDarkMode();
    
      // Initialize Rich Text Editor
      initializeQuillEditor();
    
      // Set up event listeners
      setupEventListeners();
    
      // Set profile name
      document.getElementById('employeeName').textContent = 'reefinX';

      // Load social media data for content management
      await loadSocialMediaData();
    });

    // Social Media Data Loading Functions
    async function loadSocialMediaData() {
      try {
        console.log('📱 Loading social media data for content management...');

        // Load Facebook pages first
        try {
          await loadFacebookPages();
        } catch (error) {
          console.warn('⚠️ Facebook pages failed, continuing with other data:', error);
        }

        // Then load posts and other data in parallel
        const results = await Promise.allSettled([
          loadFacebookPosts(),
          loadInstagramData()
        ]);

        // Log results
        results.forEach((result, index) => {
          const names = ['Facebook Posts', 'Instagram Data'];
          if (result.status === 'rejected') {
            console.warn(`⚠️ ${names[index]} failed:`, result.reason);
          } else {
            console.log(`✅ ${names[index]} loaded successfully`);
          }
        });

        console.log('✅ Social media data loading completed');
        console.log('📊 Final Results Summary:', {
          facebookPages: socialMediaData.pages.length,
          facebookPosts: socialMediaData.facebookPosts.length,
          instagramPosts: socialMediaData.instagramPosts.length,
          hasCurrentPage: !!socialMediaData.currentPage,
          configStatus: FACEBOOK_CONFIG.accessToken ? 'Configured' : 'Not Configured'
        });
        updateContentWithSocialData();
      } catch (error) {
        console.error('❌ Error loading social media data:', error);
      }
    }

    async function loadFacebookPages() {
      try {
        // Skip loading Facebook pages if no access token configured
        if (!FACEBOOK_CONFIG.accessToken) {
          console.log('⚠️ No Facebook access token configured, skipping Facebook pages');
          console.log('💡 To enable Facebook integration: configure FACEBOOK_CONFIG.accessToken in content_management.html');
          socialMediaData.pages = [];
          return;
        }

        const response = await fetch('/api/social-media/facebook/pages', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            accessToken: FACEBOOK_CONFIG.accessToken
          })
        });

        if (!response.ok) {
          console.warn(`⚠️ Facebook pages API failed: HTTP ${response.status}`);
          socialMediaData.pages = [];
          return;
        }

        const data = await response.json();

        if (data.error) {
          console.warn('⚠️ Facebook pages API error:', data.error);
          socialMediaData.pages = [];
          return;
        }

        socialMediaData.pages = data.data || [];
        console.log('📄 Facebook pages loaded:', socialMediaData.pages.length);

        // Get the first page for detailed data
        if (socialMediaData.pages.length > 0) {
          socialMediaData.currentPage = socialMediaData.pages[0];
          await loadPageDetails(socialMediaData.currentPage.id, socialMediaData.currentPage.access_token);
        }
      } catch (error) {
        console.warn('⚠️ Facebook pages failed:', error.message);
        socialMediaData.pages = [];
      }
    }

    async function loadPageDetails(pageId, pageAccessToken) {
      try {
        const response = await fetch('/api/social-media/facebook/page-details', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            pageId: pageId,
            accessToken: pageAccessToken
          })
        });

        if (!response.ok) {
          console.warn(`⚠️ Page details API failed: HTTP ${response.status}`);
          socialMediaData.pageDetails = null;
          return;
        }

        const data = await response.json();

        if (data.error) {
          console.warn('⚠️ Page details API error:', data.error);
          socialMediaData.pageDetails = null;
          return;
        }

        socialMediaData.pageDetails = data;
        console.log('📊 Page details loaded:', data);
      } catch (error) {
        console.warn('⚠️ Page details failed:', error.message);
        socialMediaData.pageDetails = null;
      }
    }

    async function loadFacebookPosts() {
      try {
        if (!socialMediaData.currentPage) {
          console.log('⚠️ No current Facebook page available, skipping posts');
          socialMediaData.facebookPosts = [];
          return;
        }

        const response = await fetch('/api/social-media/facebook/posts', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            pageId: socialMediaData.currentPage.id,
            accessToken: socialMediaData.currentPage.access_token
          })
        });

        if (!response.ok) {
          console.warn(`⚠️ Facebook posts API failed: HTTP ${response.status}`);
          socialMediaData.facebookPosts = [];
          return;
        }

        const data = await response.json();

        if (data.error) {
          console.warn('⚠️ Facebook posts API error:', data.error);
          socialMediaData.facebookPosts = [];
          return;
        }

        socialMediaData.facebookPosts = data.data || [];
        console.log('📝 Facebook posts loaded:', socialMediaData.facebookPosts.length);
      } catch (error) {
        console.warn('⚠️ Facebook posts failed:', error.message);
        socialMediaData.facebookPosts = [];
      }
    }

    async function loadInstagramData() {
      try {
        if (!socialMediaData.currentPage) {
          console.log('⚠️ No current Facebook page available, skipping Instagram');
          socialMediaData.instagramPosts = [];
          return;
        }

        // Get Instagram Business Account connected to this page
        const response = await fetch('/api/social-media/instagram/account', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            pageId: socialMediaData.currentPage.id,
            accessToken: socialMediaData.currentPage.access_token
          })
        });

        if (!response.ok) {
          console.warn(`⚠️ Instagram account API failed: HTTP ${response.status}`);
          socialMediaData.instagramPosts = [];
          return;
        }

        const data = await response.json();

        if (data.error || !data.instagram_business_account) {
          console.log('⚠️ No Instagram Business Account connected, skipping Instagram data');
          socialMediaData.instagramPosts = [];
          return;
        }

        const igAccountId = data.instagram_business_account.id;
        console.log('📸 Found Instagram Business Account:', igAccountId);

        // Load Instagram media
        await loadInstagramMedia(igAccountId, socialMediaData.currentPage.access_token);

        console.log('📸 Instagram data loading completed');

      } catch (error) {
        console.warn('⚠️ Instagram data failed:', error.message);
        socialMediaData.instagramPosts = [];
      }
    }

    async function loadInstagramMedia(igAccountId, accessToken) {
      try {
        const response = await fetch('/api/social-media/instagram/media', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            igAccountId: igAccountId,
            accessToken: accessToken
          })
        });

        if (!response.ok) {
          console.warn(`⚠️ Instagram media API failed: HTTP ${response.status}`);
          socialMediaData.instagramPosts = [];
          return;
        }

        const data = await response.json();

        if (data.error) {
          console.warn('⚠️ Instagram media API error:', data.error);
          socialMediaData.instagramPosts = [];
          return;
        }

        socialMediaData.instagramPosts = data.data || [];
        console.log('📸 Instagram media loaded:', socialMediaData.instagramPosts.length);
      } catch (error) {
        console.warn('⚠️ Instagram media failed:', error.message);
        socialMediaData.instagramPosts = [];
      }
    }

    function updateContentWithSocialData() {
      console.log('📱 Updating content management with social media data...');
      console.log('Facebook posts:', socialMediaData.facebookPosts.length);
      console.log('Instagram posts:', socialMediaData.instagramPosts.length);

      // Add social media import section if it doesn't exist
      addSocialMediaImportSection();

      // Show status message if no data available
      if (socialMediaData.facebookPosts.length === 0 && socialMediaData.instagramPosts.length === 0) {
        console.log('⚠️ No social media data available for import');

        // Show info message to user about social media configuration
        setTimeout(() => {
          showSocialMediaConfigInfo();
        }, 1000);
      } else {
        console.log('✅ Social media data available for import');
        // Hide any existing config info if data is now available
        hideSocialMediaConfigInfo();
        // Update content grid with social media posts
        updateContentGrid();
        // Show success message briefly
        showSuccessMessage();
      }
    }

    function updateContentGrid() {
      const contentGrid = document.getElementById('contentGrid');
      if (!contentGrid) {
        console.warn('⚠️ Content grid not found');
        return;
      }

      // Clear existing content
      contentGrid.innerHTML = '';

      // Combine and sort all posts by date
      const allPosts = [];

      // Add Facebook posts
      socialMediaData.facebookPosts.forEach(post => {
        allPosts.push({
          ...post,
          platform: 'facebook',
          type: 'โซเชียลโพสต์',
          created_time: new Date(post.created_time),
          content: post.message || '',
          image: post.full_picture || null
        });
      });

      // Add Instagram posts
      socialMediaData.instagramPosts.forEach(post => {
        allPosts.push({
          ...post,
          platform: 'instagram',
          type: 'โซเชียลโพสต์',
          created_time: new Date(post.timestamp),
          content: post.caption || '',
          image: post.media_url || null
        });
      });

      // Sort by date (newest first)
      allPosts.sort((a, b) => b.created_time - a.created_time);

      if (allPosts.length === 0) {
        // Show empty state
        contentGrid.innerHTML = `
          <div class="text-center py-12 col-span-full">
            <i class="bi bi-file-earmark-text text-6xl text-gray-400 dark:text-gray-500 mb-4"></i>
            <h3 class="text-lg font-semibold text-gray-600 dark:text-gray-400 mb-2">ยังไม่มีเนื้อหา</h3>
            <p class="text-gray-500 dark:text-gray-400">เริ่มสร้างเนื้อหาแรกของคุณหรือนำเข้าจากโซเชียลมีเดีย</p>
          </div>
        `;
        return;
      }

      // Create content cards
      allPosts.forEach(post => {
        const card = createContentCard(post);
        contentGrid.appendChild(card);
      });

      console.log(`✅ Content grid updated with ${allPosts.length} posts`);
    }

    function createContentCard(post) {
      const card = document.createElement('div');
      card.className = 'content-card';

      // Format date
      const dateStr = post.created_time.toLocaleDateString('th-TH', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });

      // Truncate content
      const maxLength = 150;
      const content = post.content.length > maxLength ?
        post.content.substring(0, maxLength) + '...' : post.content;

      // Platform icon
      const platformIcon = post.platform === 'facebook' ? 'bi-facebook' : 'bi-instagram';
      const platformColor = post.platform === 'facebook' ? 'text-blue-600' : 'text-pink-600';

      card.innerHTML = `
        <div class="content-card-image" style="${post.image ? `background-image: url('${post.image}')` : 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)'}">
          <span class="content-card-status status-published-badge">เผยแพร่แล้ว</span>
          <div class="absolute top-2 left-2">
            <i class="bi ${platformIcon} ${platformColor} bg-white rounded-full p-1 text-sm"></i>
          </div>
        </div>
        <div class="content-card-body">
          <h3 class="content-card-title">${content || 'โพสต์จาก ' + (post.platform === 'facebook' ? 'Facebook' : 'Instagram')}</h3>
          <div class="content-card-meta">
            <span>${post.type}</span>
            <span>${dateStr}</span>
          </div>
          <p class="content-card-description">
            ${content || 'ไม่มีข้อความในโพสต์นี้'}
          </p>
          <div class="content-card-actions">
            <div>
              <button title="นำเข้า" onclick="importPost('${post.platform}', '${post.id}')">
                <i class="bi bi-download"></i>
              </button>
              <button title="ดูตัวอย่าง" onclick="viewPost('${post.platform}', '${post.id}')">
                <i class="bi bi-eye"></i>
              </button>
            </div>
          </div>
        </div>
      `;

      return card;
    }

    function viewPost(platform, postId) {
      const posts = platform === 'facebook' ? socialMediaData.facebookPosts : socialMediaData.instagramPosts;
      const post = posts.find(p => p.id === postId);

      if (!post) {
        alert('ไม่พบโพสต์ที่ต้องการ');
        return;
      }

      // Show post details in modal
      const content = post.message || post.caption || 'ไม่มีข้อความ';
      const image = post.full_picture || post.media_url;

      alert(`โพสต์จาก ${platform === 'facebook' ? 'Facebook' : 'Instagram'}:\n\n${content}`);
    }

    function addSocialMediaImportSection() {
      // Find the content creation form
      const form = document.getElementById('contentForm');
      if (!form) {
        console.warn('⚠️ Content form not found, cannot add social media import section');
        return;
      }

      // Check if import section already exists
      if (document.getElementById('socialImportSection')) return;

      // Create social media import section
      const importSection = document.createElement('div');
      importSection.id = 'socialImportSection';
      importSection.className = 'mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800';

      // Determine status messages
      const facebookStatus = socialMediaData.facebookPosts.length > 0 ?
        `โพสต์ล่าสุด: ${socialMediaData.facebookPosts.length} รายการ` :
        'ต้องเชื่อมต่อ Facebook Page ก่อน';

      const instagramStatus = socialMediaData.instagramPosts.length > 0 ?
        `โพสต์ล่าสุด: ${socialMediaData.instagramPosts.length} รายการ` :
        'ต้องเชื่อมต่อ Instagram Business Account ก่อน';

      const facebookButtonDisabled = socialMediaData.facebookPosts.length === 0 ? 'disabled opacity-50 cursor-not-allowed' : '';
      const instagramButtonDisabled = socialMediaData.instagramPosts.length === 0 ? 'disabled opacity-50 cursor-not-allowed' : '';

      const facebookButtonText = socialMediaData.facebookPosts.length > 0 ? 'เลือกโพสต์ Facebook' : 'ยังไม่เชื่อมต่อ';
      const instagramButtonText = socialMediaData.instagramPosts.length > 0 ? 'เลือกโพสต์ Instagram' : 'ยังไม่เชื่อมต่อ';

      importSection.innerHTML = '<h3 class="text-lg font-semibold mb-3 text-blue-800 dark:text-blue-200">' +
        '<i class="bi bi-download mr-2"></i>นำเข้าจากโซเชียลมีเดีย' +
        '</h3>' +
        '<div class="grid grid-cols-1 md:grid-cols-2 gap-4">' +
          '<!-- Facebook Import -->' +
          '<div class="bg-white dark:bg-gray-800 p-4 rounded-lg border">' +
            '<h4 class="font-medium mb-2 text-blue-600 dark:text-blue-400">' +
              '<i class="bi bi-facebook mr-2"></i>Facebook Posts' +
            '</h4>' +
            '<p class="text-sm text-gray-600 dark:text-gray-400 mb-3">' +
              facebookStatus +
            '</p>' +
            '<button type="button" onclick="importFromFacebook()" ' +
              'class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-md text-sm ' + facebookButtonDisabled + '">' +
              facebookButtonText +
            '</button>' +
          '</div>' +

          '<!-- Instagram Import -->' +
          '<div class="bg-white dark:bg-gray-800 p-4 rounded-lg border">' +
            '<h4 class="font-medium mb-2 text-pink-600 dark:text-pink-400">' +
              '<i class="bi bi-instagram mr-2"></i>Instagram Posts' +
            '</h4>' +
            '<p class="text-sm text-gray-600 dark:text-gray-400 mb-3">' +
              instagramStatus +
            '</p>' +
            '<button type="button" onclick="importFromInstagram()" ' +
              'class="w-full bg-pink-600 hover:bg-pink-700 text-white py-2 px-4 rounded-md text-sm ' + instagramButtonDisabled + '">' +
              instagramButtonText +
            '</button>' +
          '</div>' +
        '</div>';

      // Insert before the form content
      const firstFormElement = form.firstElementChild;
      if (firstFormElement) {
        form.insertBefore(importSection, firstFormElement);
      } else {
        form.appendChild(importSection);
      }
    }

    function importFromFacebook() {
      if (socialMediaData.facebookPosts.length === 0) {
        alert('ไม่มีโพสต์ Facebook ให้นำเข้า กรุณาตรวจสอบการเชื่อมต่อ Facebook');
        return;
      }
      console.log('🔵 Opening Facebook import modal...');
      showSocialImportModal('facebook', socialMediaData.facebookPosts);
    }

    function importFromInstagram() {
      if (socialMediaData.instagramPosts.length === 0) {
        alert('ไม่มีโพสต์ Instagram ให้นำเข้า กรุณาตรวจสอบการเชื่อมต่อ Instagram Business Account');
        return;
      }
      console.log('🟣 Opening Instagram import modal...');
      showSocialImportModal('instagram', socialMediaData.instagramPosts);
    }

    function showSocialImportModal(platform, posts) {
      if (posts.length === 0) {
        alert('ไม่มีโพสต์จาก ' + platform.charAt(0).toUpperCase() + platform.slice(1) + ' ให้นำเข้า');
        return;
      }

      const platformName = platform === 'facebook' ? 'Facebook' : 'Instagram';
      const platformColor = platform === 'facebook' ? 'blue' : 'pink';
      const platformIcon = platform === 'facebook' ? 'bi-facebook' : 'bi-instagram';

      // Create modal HTML
      const modalHTML = '<div id="socialImportModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">' +
        '<div class="bg-white dark:bg-gray-800 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden">' +
          '<!-- Modal Header -->' +
          '<div class="p-6 border-b border-gray-200 dark:border-gray-700">' +
            '<div class="flex items-center justify-between">' +
              '<h2 class="text-xl font-semibold text-gray-900 dark:text-white">' +
                '<i class="' + platformIcon + ' text-' + platformColor + '-600 mr-2"></i>' +
                'นำเข้าโพสต์จาก ' + platformName +
              '</h2>' +
              '<button onclick="closeSocialImportModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">' +
                '<i class="bi bi-x-lg text-xl"></i>' +
              '</button>' +
            '</div>' +
          '</div>' +

          '<!-- Modal Content -->' +
          '<div class="p-6 overflow-y-auto max-h-[70vh]">' +
            '<div class="grid gap-4">' +
              posts.slice(0, 10).map(post => createPostImportCard(post, platform)).join('') +
            '</div>' +
          '</div>' +

          '<!-- Modal Footer -->' +
          '<div class="p-6 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-3">' +
            '<button onclick="closeSocialImportModal()"' +
              ' class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">' +
              'ยกเลิก' +
            '</button>' +
          '</div>' +
        '</div>' +
      '</div>';

      // Add modal to body
      document.body.insertAdjacentHTML('beforeend', modalHTML);
    }

    function createPostImportCard(post, platform) {
      const message = post.message || post.caption || 'โพสต์รูปภาพ';
      const imageUrl = post.full_picture || post.media_url || '/images/placeholder.jpg';
      const createdTime = post.created_time ? new Date(post.created_time).toLocaleDateString('th-TH') :
                         post.timestamp ? new Date(post.timestamp).toLocaleDateString('th-TH') : 'ไม่ระบุวันที่';

      const likes = platform === 'facebook' ?
        (post.likes?.summary?.total_count || 0) :
        (post.like_count || 0);
      const comments = platform === 'facebook' ?
        (post.comments?.summary?.total_count || 0) :
        (post.comments_count || 0);

      const displayMessage = message.substring(0, 150) + (message.length > 150 ? '...' : '');

      return '<div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">' +
        '<div class="flex gap-4">' +
          '<!-- Post Image -->' +
          '<div class="w-20 h-20 bg-gray-200 dark:bg-gray-600 rounded-lg overflow-hidden flex-shrink-0">' +
            '<img src="' + imageUrl + '" alt="Post" class="w-full h-full object-cover" onerror="this.src=\'/images/placeholder.jpg\'">' +
          '</div>' +
          '<!-- Post Content -->' +
          '<div class="flex-1 min-w-0">' +
            '<p class="text-sm text-gray-900 dark:text-white mb-2 line-clamp-3">' +
              displayMessage +
            '</p>' +
            '<div class="flex items-center gap-4 text-xs text-gray-500 dark:text-gray-400 mb-3">' +
              '<span>' + createdTime + '</span>' +
              '<span><i class="bi bi-heart mr-1"></i>' + likes + '</span>' +
              '<span><i class="bi bi-chat mr-1"></i>' + comments + '</span>' +
            '</div>' +
            '<button onclick="importPost(\'' + post.id + '\', \'' + platform + '\')" ' +
              'class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs">' +
              'นำเข้า' +
            '</button>' +
          '</div>' +
        '</div>' +
      '</div>';
    }

    function importPost(postId, platform) {
      try {
        const posts = platform === 'facebook' ? socialMediaData.facebookPosts : socialMediaData.instagramPosts;
        const post = posts.find(p => p.id === postId);

        if (!post) {
          alert('ไม่พบโพสต์ที่เลือก');
          return;
        }

        // Fill the content creation form
        const titleInput = document.getElementById('contentTitle');
        const typeSelect = document.getElementById('contentType');
        const contentEditor = window.quill; // Quill editor instance

        let importSuccess = false;

        if (titleInput) {
          const message = post.message || post.caption || '';
          const firstLine = message.split('\n')[0].substring(0, 100);
          titleInput.value = firstLine || 'โพสต์จาก ' + platform.charAt(0).toUpperCase() + platform.slice(1);
          importSuccess = true;
        }

        if (typeSelect) {
          typeSelect.value = 'social';
        }

        if (contentEditor) {
          try {
            const content = post.message || post.caption || '';
            contentEditor.setContents([{insert: content + '\n\n'}]);

            // Add image if available
            const imageUrl = post.full_picture || post.media_url;
            if (imageUrl) {
              setTimeout(() => {
                try {
                  contentEditor.insertEmbed(contentEditor.getLength(), 'image', imageUrl);
                } catch (imageError) {
                  console.warn('⚠️ Could not insert image:', imageError);
                }
              }, 100);
            }
            importSuccess = true;
          } catch (editorError) {
            console.warn('⚠️ Error updating editor content:', editorError);
          }
        } else {
          console.warn('⚠️ Quill editor not found');
        }

        closeSocialImportModal();

        // Show success message
        if (importSuccess) {
          alert('นำเข้าโพสต์จาก ' + platform.charAt(0).toUpperCase() + platform.slice(1) + ' สำเร็จ!');
        } else {
          alert('นำเข้าโพสต์บางส่วน โปรดตรวจสอบข้อมูลในฟอร์ม');
        }
      } catch (error) {
        console.error('Error importing post:', error);
        alert('เกิดข้อผิดพลาดในการนำเข้าโพสต์: ' + error.message);
      }
    }

    function closeSocialImportModal() {
      const modal = document.getElementById('socialImportModal');
      if (modal) {
        modal.remove();
      }
    }

    function showSocialMediaConfigInfo() {
      // Check if info message already exists
      if (document.getElementById('socialConfigInfo')) return;

      // Create info message
      const infoDiv = document.createElement('div');
      infoDiv.id = 'socialConfigInfo';
      infoDiv.className = 'mb-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800';
      infoDiv.innerHTML = `
        <div class="flex items-start">
          <i class="bi bi-info-circle text-yellow-600 dark:text-yellow-400 mr-3 mt-1 text-lg"></i>
          <div>
            <h4 class="font-medium text-yellow-800 dark:text-yellow-200 mb-2">
              การตั้งค่า Social Media Integration
            </h4>
            <p class="text-sm text-yellow-700 dark:text-yellow-300 mb-3">
              เพื่อใช้ฟีเจอร์นำเข้าโพสต์จาก Facebook และ Instagram โปรดทำการตั้งค่าการเชื่อมต่อก่อน:
            </p>
            <ul class="text-sm text-yellow-700 dark:text-yellow-300 mb-4 list-disc list-inside space-y-1">
              <li>ไปที่หน้า <a href="/views/marketing/social_media.html" class="underline hover:text-yellow-900 dark:hover:text-yellow-100">จัดการโซเชียลมีเดีย</a> เพื่อเชื่อมต่อบัญชี</li>
              <li>ตั้งค่า Facebook Access Token ในระบบ</li>
              <li>เชื่อมต่อ Facebook Page และ Instagram Business Account</li>
              <li>ตรวจสอบว่ามีโพสต์ในบัญชีที่เชื่อมต่อแล้ว</li>
            </ul>
            <div class="bg-yellow-100 dark:bg-yellow-800 p-3 rounded mb-4">
              <p class="text-xs text-yellow-800 dark:text-yellow-200">
                <strong>หมายเหตุ:</strong> ปัจจุบันยังไม่มีการตั้งค่า Facebook Access Token ในระบบ<br>
                กรุณาติดต่อผู้ดูแลระบบเพื่อเพิ่ม token หรือไปหน้าจัดการโซเชียลมีเดียเพื่อดูข้อมูลเพิ่มเติม
              </p>
            </div>
            <button onclick="hideSocialMediaConfigInfo()"
              class="text-xs bg-yellow-100 hover:bg-yellow-200 dark:bg-yellow-800 dark:hover:bg-yellow-700 text-yellow-800 dark:text-yellow-200 px-3 py-1 rounded">
              ซ่อนข้อความ
            </button>
          </div>
        </div>
      `;

      // Insert at the top of the main content area
      const contentContainer = document.querySelector('.main-content');
      if (contentContainer) {
        const firstChild = contentContainer.firstElementChild;
        contentContainer.insertBefore(infoDiv, firstChild);
      }
    }

    function hideSocialMediaConfigInfo() {
      const infoDiv = document.getElementById('socialConfigInfo');
      if (infoDiv) {
        infoDiv.remove();
      }
    }

    function showSuccessMessage() {
      // Check if success message already exists
      if (document.getElementById('socialSuccessMessage')) return;

      const totalPosts = socialMediaData.facebookPosts.length + socialMediaData.instagramPosts.length;

      // Create success message
      const successDiv = document.createElement('div');
      successDiv.id = 'socialSuccessMessage';
      successDiv.className = 'mb-6 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800';
      successDiv.innerHTML = `
        <div class="flex items-center">
          <i class="bi bi-check-circle text-green-600 dark:text-green-400 mr-3 text-lg"></i>
          <div>
            <h4 class="font-medium text-green-800 dark:text-green-200 mb-1">
              🎉 เชื่อมต่อโซเชียลมีเดียสำเร็จ!
            </h4>
            <p class="text-sm text-green-700 dark:text-green-300">
              พบโพสต์ทั้งหมด ${totalPosts} รายการ (Facebook: ${socialMediaData.facebookPosts.length}, Instagram: ${socialMediaData.instagramPosts.length})
            </p>
          </div>
        </div>
      `;

      // Insert at the top of the main content area
      const contentContainer = document.querySelector('.main-content');
      if (contentContainer) {
        const firstChild = contentContainer.firstElementChild;
        contentContainer.insertBefore(successDiv, firstChild);
      }

      // Auto-hide after 5 seconds
      setTimeout(() => {
        if (document.getElementById('socialSuccessMessage')) {
          successDiv.remove();
        }
      }, 5000);
    }

    // Initialize sidebar toggle
    function initToggleMenu() {
      const btnToggleMenu = document.getElementById('btnToggleMenu');
      const sidebar = document.getElementById('sidebar');
    
      btnToggleMenu.addEventListener('click', function() {
        if (sidebar.classList.contains('w-64')) {
          sidebar.classList.remove('w-64');
          sidebar.classList.add('w-0');
          this.innerHTML = '<i class="bi bi-chevron-right"></i>';
        } else {
          sidebar.classList.remove('w-0');
          sidebar.classList.add('w-64');
          this.innerHTML = '<i class="bi bi-chevron-left"></i>';
        }
      });
    }
    
    // Initialize dark mode toggle
    function initDarkMode() {
      const btnToggleDark = document.getElementById('btnToggleDark');
      const darkModeLabel = document.getElementById('darkModeLabel');
    
      // Check system preference
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.classList.add('dark');
        darkModeLabel.textContent = 'Light Mode';
        btnToggleDark.innerHTML = '<i class="bi bi-brightness-high text-xl text-yellow-500 dark:text-yellow-400"></i><span class="ml-3">Light Mode</span>';
      }
    
      btnToggleDark.addEventListener('click', function() {
        if (document.documentElement.classList.contains('dark')) {
          document.documentElement.classList.remove('dark');
          darkModeLabel.textContent = 'Dark Mode';
          btnToggleDark.innerHTML = '<i class="bi bi-moon text-xl text-slate-600"></i><span class="ml-3">Dark Mode</span>';
        } else {
          document.documentElement.classList.add('dark');
          darkModeLabel.textContent = 'Light Mode';
          btnToggleDark.innerHTML = '<i class="bi bi-brightness-high text-xl text-yellow-500"></i><span class="ml-3">Light Mode</span>';
        }
      });
    }
    
    // Initialize Quill Editor
    function initializeQuillEditor() {
      if (document.getElementById('quillEditor')) {
        const quill = new Quill('#quillEditor', {
          theme: 'snow',
          modules: {
            toolbar: [
              ['bold', 'italic', 'underline', 'strike'],
              ['blockquote', 'code-block'],
              [{ 'header': 1 }, { 'header': 2 }],
              [{ 'list': 'ordered'}, { 'list': 'bullet' }],
              [{ 'script': 'sub'}, { 'script': 'super' }],
              [{ 'indent': '-1'}, { 'indent': '+1' }],
              [{ 'direction': 'rtl' }],
              [{ 'size': ['small', false, 'large', 'huge'] }],
              [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
              [{ 'color': [] }, { 'background': [] }],
              [{ 'font': [] }],
              [{ 'align': [] }],
              ['clean'],
              ['link', 'image', 'video']
            ]
          },
          placeholder: 'เริ่มต้นสร้างเนื้อหาของคุณที่นี่...',
        });
      }
    }
    
    // Set up event listeners
    function setupEventListeners() {
      // Content tab navigation
      const tabButtons = document.querySelectorAll('.content-tab-btn');
      tabButtons.forEach(button => {
        button.addEventListener('click', function() {
          // Remove active class from all buttons
          tabButtons.forEach(btn => btn.classList.remove('active'));
          // Add active class to clicked button
          this.classList.add('active');
    
          // Here you would filter content based on the tab
          const tabType = this.getAttribute('data-tab');
          console.log('Selected tab:', tabType);
          // Implement filtering logic here
        });
      });
    
      // Modal controls
      const createContentBtn = document.getElementById('btnCreateContent');
      const createContentModal = document.getElementById('createContentModal');
      const closeModalBtn = document.getElementById('closeModal');
    
      if (createContentBtn && createContentModal && closeModalBtn) {
        createContentBtn.addEventListener('click', function() {
          createContentModal.classList.add('show');
        });
    
        closeModalBtn.addEventListener('click', function() {
          createContentModal.classList.remove('show');
        });
    
        // Close modal when clicking outside
        createContentModal.addEventListener('click', function(e) {
          if (e.target === createContentModal) {
            createContentModal.classList.remove('show');
          }
        });
      }
    
      // Publish option toggle
      const publishOptions = document.querySelectorAll('input[name="publishOption"]');
      const scheduleDate = document.getElementById('scheduleDate');
    
      if (publishOptions.length && scheduleDate) {
        publishOptions.forEach(option => {
          option.addEventListener('change', function() {
            scheduleDate.disabled = this.value !== 'later';
          });
        });
      }
    
      // File upload interaction
      const fileUploadContainer = document.querySelector('.file-upload-container');
      const fileInput = document.getElementById('coverImage');
    
      if (fileUploadContainer && fileInput) {
        fileUploadContainer.addEventListener('click', function() {
          fileInput.click();
        });
    
        fileInput.addEventListener('change', function() {
          if (this.files.length > 0) {
            const fileName = this.files[0].name;
            fileUploadContainer.innerHTML = `
              <div class="file-upload-icon text-teal-500">
                <i class="bi bi-file-earmark-image"></i>
              </div>
              <p class="file-upload-text">${fileName}</p>
              <p class="file-upload-text text-xs mt-2">คลิกเพื่อเลือกไฟล์อื่น</p>
            `;
          }
        });
      }
    
      // Handle form submission
      const contentForm = document.getElementById('contentForm');
      const saveAsDraftBtn = document.getElementById('saveAsDraft');
    
      if (contentForm) {
        contentForm.addEventListener('submit', function(e) {
          e.preventDefault();
    
          // Here you would handle the form submission
          alert('เนื้อหาได้รับการเผยแพร่เรียบร้อย!');
          createContentModal.classList.remove('show');
        });
      }
    
      if (saveAsDraftBtn) {
        saveAsDraftBtn.addEventListener('click', function() {
          // Here you would save the content as draft
          alert('บันทึกเนื้อหาเป็นแบบร่างเรียบร้อยแล้ว!');
          createContentModal.classList.remove('show');
        });
      }
    
      // Handle tag remove
      const tagRemoveBtns = document.querySelectorAll('.tag-remove');
    
      tagRemoveBtns.forEach(btn => {
        btn.addEventListener('click', function() {
          this.parentElement.remove();
        });
      });
    }
  </script>
</body>
</html>