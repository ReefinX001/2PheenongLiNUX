<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>ระบบ HR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Favicon ต่างๆ -->
  <link rel="icon" href="/favicon/favicon.ico" type="image/x-icon" />
  <!-- Tailwind + DaisyUI -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class'
      theme: { 
        extend: { 
          fontFamily: { sans: ['Prompt','sans-serif'] } '
        } 
      },
      daisyui: { themes: ['light','dark','corporate'] },'
    }
  </script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@2.51.5/dist/full.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
  <!-- Google Fonts - Prompt -->
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    /* เพิ่ม CSS สำหรับความสวยงาม */
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .animate-fadeIn {
      animation: fadeIn 0.3s ease-in-out;
    }

    /* Calendar Day Styling */
    .calendar-day {
      width: 60px;
      height: 60px;
      border-radius: 10px;
      background-color: #f3f4f6;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .dark .calendar-day {
      background-color: #374151;
    }

    .calendar-day-holiday {
      background-color: #fee2e2;
      color: #ef4444;
    }

    .dark .calendar-day-holiday {
      background-color: #7f1d1d;
      color: #fca5a5;
    }

    /* Card hover effects */
    .card {
      transition: all 0.2s ease-in-out;
    }

    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    /* Notification badge animation */
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    #notificationBtn span.badge-notification { /* More specific selector for the badge */
      animation: pulse 2s infinite;
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }

    .dark ::-webkit-scrollbar-track {
      background: #1e1e1e;
    }

    ::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }

    /* Status indicators */
    .status-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 5px;
    }

    .status-active {
      background-color: #10b981;
    }

    .status-away {
      background-color: #f59e0b;
    }

    .status-offline {
      background-color: #6b7280;
    }
  </style>
</head>

<body class="bg-white text-gray-700 dark:bg-gray-700 dark:text-gray-200">
  <!-- Toggle Sidebar Button -->
  <button id="btnToggleMenu" class="fixed left-0 top-1/2 bg-blue-600 text-white p-2 rounded-r-full shadow-lg z-50 hover:bg-blue-700">
    <i class="bi bi-chevron-left"></i>
  </button>

  <div class="min-h-screen flex">
    <!-- Sidebar -->
    <aside id="sidebar" class="w-64 bg-white dark:bg-gray-800 flex flex-col transition-all duration-300">
      <a href="hr_dashboard">
        <div class="p-4 border-b border-gray-200 dark:border-gray-700">
          <img src="/uploads/Logo2.png" alt="Logo" class="w-full h-auto"/>
        </div>
      </a>
      <div class="flex-1 p-4 overflow-y-auto">
        <ul class="flex flex-col w-full space-y-1">
          <li>
            <a href="hr_dashboard" class="flex items-center h-12 px-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <i class="bi bi-speedometer2 text-xl text-indigo-600 dark:text-indigo-400"></i>
              <span class="ml-3">แดชบอร์ด</span>
            </a>
          </li>
          <li>
            <a href="employee_directory" class="flex items-center h-12 px-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <i class="bi bi-people-fill text-xl text-blue-500 dark:text-blue-400"></i>
              <span class="ml-3">พนักงาน</span>
            </a>
          </li>
          <li>
            <a href="attendance" class="flex items-center h-12 px-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <i class="bi bi-clock text-xl text-green-500 dark:text-green-400"></i>
              <span class="ml-3">บันทึกเวลาเข้า-ออก</span>
            </a>
          </li>
          <li>
            <a href="leave_requests" class="flex items-center h-12 px-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <i class="bi bi-file-earmark-text text-xl text-yellow-500 dark:text-yellow-300"></i>
              <span class="ml-3">การลา</span>
            </a>
          </li>
          <li>
            <a href="payroll" class="flex items-center h-12 px-4 rounded-lg bg-gray-100 dark:bg-gray-700">
              <i class="bi bi-cash-stack text-xl text-emerald-500 dark:text-emerald-400"></i>
              <span class="ml-3">เงินเดือน</span>
            </a>
          </li>
          <li>
            <a href="performance_reviews" class="flex items-center h-12 px-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <i class="bi bi-award text-xl text-purple-500 dark:text-purple-400"></i>
              <span class="ml-3">ประเมินผลงาน</span>
            </a>
          </li>
          <li>
            <a href="bonus_list" class="flex items-center px-4 h-12 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <i class="bi bi-gift text-xl text-pink-500 dark:text-pink-400 mr-3"></i>
              <span>รายการโบนัส</span>
            </a>
          </li>
          <li>
       
          <li class="mt-4">
            <a href="role_management" class="flex items-center h-12 px-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <i class="bi bi-gear text-xl text-gray-600 dark:text-gray-300"></i>
              <span class="ml-3">การตั้งค่า</span>
            </a>
          </li>
          <li class="mt-6">
            <button id="btnToggleDark" class="flex items-center h-12 px-4 rounded-lg w-full text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <i id="darkModeIcon" class="bi bi-moon text-xl text-slate-600 dark:text-slate-300"></i>
              <span class="ml-3" id="darkModeLabel">Dark Mode</span>
            </button>
          </li>
          <li>
            <button id="btnLogoutSidebar" class="flex items-center h-12 px-4 rounded-lg w-full text-left text-red-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <i class="bi bi-box-arrow-right text-xl"></i>
              <span class="ml-3">ออกจากระบบ</span>
            </button>
          </li>
          <li>
            <div id="profile" class="flex items-center h-12 px-4 rounded-lg bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700">
              <img id="employeePhoto" src="/api/placeholder/36/36" alt="Employee Photo" class="w-10 h-10 rounded-full mr-3"/>
              <span id="employeeName">Loading...</span>
            </div>
          </li>
        </ul>
      </div>
    </aside>
  
    <!-- Main Content -->
    <main class="flex-1 transition-all duration-300 lg:ml-0 animate-fade-in">
      <div class="container mx-auto p-4 md:p-6">
        <!-- Header Card -->
        <header class="bg-white dark:bg-gray-800 p-5 rounded-2xl shadow-soft mb-6 animate-slideUp">
          <h1 class="text-2xl md:text-3xl font-semibold text-gray-800 dark:text-white mb-3 flex items-center">
            <i class="bi bi-cash-stack text-blue-500 mr-3"></i>
            ระบบรายการเงินเดือนพนักงาน
          </h1>
          <div class="divider-gradient my-3"></div>
          <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4 mt-4">
            <div class="text-sm text-gray-500 dark:text-gray-400 flex items-center" id="currentDateTime">
              <i class="bi bi-calendar3 mr-2 text-blue-500"></i>
              กำลังโหลดวันที่และเวลา...
            </div>
            <div class="flex flex-col sm:flex-row gap-3">
              <button id="addEmployeeBtn" class="btn btn-primary gap-2 hover:shadow-lg transition-all">
                <i class="bi bi-plus-lg"></i> เพิ่มพนักงานใหม่
              </button>
              <div class="relative">
                <input type="text" id="searchInput" placeholder="ค้นหาพนักงาน..." 
                      class="input input-bordered w-full pr-10 focus:ring-2 focus:ring-blue-300 dark:focus:ring-blue-700 transition" />
                <div class="absolute right-2 top-1/2 -translate-y-1/2 btn btn-ghost btn-circle">
                  <i class="bi bi-search"></i>
                </div>
              </div>
            </div>
          </div>
        </header>
        
        <!-- Employee Salary Table Card -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-soft overflow-hidden animate-slideUp" style="animation-delay: 0.1s">
          <!-- Filter/Sort Controls -->
          <div class="p-4 border-b border-gray-100 dark:border-gray-700 flex flex-wrap gap-3 justify-between items-center">
            <div class="flex flex-wrap gap-2">
              <div class="dropdown">
                <label tabindex="0" class="btn btn-sm btn-outline gap-1">
                  <i class="bi bi-funnel"></i> กรอง
                </label>
                <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 dark:bg-gray-700 rounded-box w-52 z-50">
                  <li><a onclick="filterByDepartment('')">แผนก: ทั้งหมด</a></li>'
                  <li><a onclick="filterByDepartment('บัญชี')">แผนก: บัญชี</a></li>'
                  <li><a onclick="filterByDepartment('การตลาด')">แผนก: การตลาด</a></li>'
                  <li><a onclick="filterByDepartment('ไอที')">แผนก: ไอที</a></li>'
                  <li><a onclick="filterByDepartment('ทรัพยากรบุคคล')">แผนก: ทรัพยากรบุคคล</a></li>'
                  <li><a onclick="filterByDepartment('ขาย')">แผนก: ขาย</a></li>'
                </ul>
              </div>
              <div class="dropdown">
                <label tabindex="0" class="btn btn-sm btn-outline gap-1">
                  <i class="bi bi-sort-alpha-down"></i> เรียงลำดับ
                </label>
                <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 dark:bg-gray-700 rounded-box w-52 z-50">
                  <li><a onclick="sortEmployees('name', 'asc')">ชื่อ: A-Z</a></li>'
                  <li><a onclick="sortEmployees('name', 'desc')">ชื่อ: Z-A</a></li>'
                  <li><a onclick="sortEmployees('salary', 'desc')">เงินเดือน: สูง-ต่ำ</a></li>'
                  <li><a onclick="sortEmployees('salary', 'asc')">เงินเดือน: ต่ำ-สูง</a></li>'
                </ul>
              </div>
              <button class="btn btn-sm btn-outline gap-1" onclick="exportToExcel()">
                <i class="bi bi-file-earmark-excel"></i> ส่งออก Excel
              </button>
            </div>
            <div>
              <span class="text-sm text-gray-500 dark:text-gray-400" id="employeeCount">พนักงานทั้งหมด: 5 คน</span>
            </div>
          </div>

          <!-- Table -->
          <div class="overflow-x-auto">
            <table class="table table-zebra w-full table-improved">
              <thead>
                <tr>
                  <th class="bg-gray-100 dark:bg-gray-700">รหัส</th>
                  <th class="bg-gray-100 dark:bg-gray-700">ชื่อ</th>
                  <th class="bg-gray-100 dark:bg-gray-700">ตำแหน่ง</th>
                  <th class="bg-gray-100 dark:bg-gray-700">แผนก</th>
                  <th class="bg-gray-100 dark:bg-gray-700 text-right">เงินเดือนพื้นฐาน</th>
                  <th class="bg-gray-100 dark:bg-gray-700 text-right">โอที</th>
                  <th class="bg-gray-100 dark:bg-gray-700 text-right">ค่าคอม</th>
                  <th class="bg-gray-100 dark:bg-gray-700 text-right">เงินเดือนรวม</th>
                  <th class="bg-gray-100 dark:bg-gray-700 text-center">การดำเนินการ</th>
                </tr>
              </thead>
              <tbody id="salaryTableBody">
                <!-- ข้อมูลจะถูกเพิ่มที่นี่จาก JavaScript -->
                <tr>
                  <td colspan="9" class="text-center py-8">
                    <div class="loading-spinner mx-auto mb-2"></div>
                    <span>กำลังโหลดข้อมูล...</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Pagination -->
          <div class="flex justify-between items-center p-4 border-t border-gray-100 dark:border-gray-700">
            <div class="text-sm text-gray-500 dark:text-gray-400" id="paginationInfo">
              แสดง 1-5 จาก 5 รายการ
            </div>
            <div class="btn-group" id="paginationControls">
              <button class="btn btn-sm btn-outline" disabled>«</button>
              <button class="btn btn-sm btn-active">1</button>
              <button class="btn btn-sm btn-outline" disabled>»</button>
            </div>
          </div>
        </div>

        <!-- Footer -->
        <footer class="mt-8 text-center text-gray-500 dark:text-gray-400 text-sm p-4 border-t border-gray-200 dark:border-gray-700">
          <p>&copy; 2025 ระบบรายการเงินเดือนพนักงาน | พัฒนาโดย บริษัท 2พี่น้อง โมบาย จำกัด</p>
        </footer>
      </div>
    </main>
  </div>

  <!-- สำหรับแปะข้อความ Toast -->
  <div id="toastContainer" class="fixed top-5 right-5 space-y-2 z-50"></div>

  <!-- Employee Modal (using DaisyUI modal) -->
  <div id="employeeModal" class="modal">
    <div class="modal-box max-w-2xl">
      <div class="flex justify-between items-center mb-4 pb-2 border-b border-gray-200 dark:border-gray-700">
        <h3 id="modalTitle" class="font-bold text-xl text-blue-600 dark:text-blue-400">เพิ่มพนักงานใหม่</h3>
        <button onclick="closeModal()" class="btn btn-sm btn-circle btn-ghost">✕</button>
      </div>
      
      <form id="employeeForm">
        <input type="hidden" id="employeeId">
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- First Column -->
          <div>
            <div class="form-control mb-3">
              <label class="label" for="empCode">
                <span class="label-text font-medium flex items-center">
                  <i class="bi bi-hash mr-2 text-blue-500"></i>รหัสพนักงาน
                </span>
              </label>
              <input type="text" id="empCode" required class="input input-bordered w-full focus:ring-2 focus:ring-blue-300 dark:focus:ring-blue-700 transition" />
              <div class="text-xs text-red-500 hidden" id="empCodeError">กรุณากรอกรหัสพนักงาน</div>
            </div>
            
            <div class="form-control mb-3">
              <label class="label" for="empName">
                <span class="label-text font-medium flex items-center">
                  <i class="bi bi-person mr-2 text-blue-500"></i>ชื่อพนักงาน
                </span>
              </label>
              <input type="text" id="empName" required class="input input-bordered w-full focus:ring-2 focus:ring-blue-300 dark:focus:ring-blue-700 transition" />
              <div class="text-xs text-red-500 hidden" id="empNameError">กรุณากรอกชื่อพนักงาน</div>
            </div>
            
            <div class="form-control mb-3">
              <label class="label" for="position">
                <span class="label-text font-medium flex items-center">
                  <i class="bi bi-briefcase mr-2 text-blue-500"></i>ตำแหน่ง
                </span>
              </label>
              <input type="text" id="position" required class="input input-bordered w-full focus:ring-2 focus:ring-blue-300 dark:focus:ring-blue-700 transition" />
              <div class="text-xs text-red-500 hidden" id="positionError">กรุณากรอกตำแหน่ง</div>
            </div>
            
            <div class="form-control mb-3">
              <label class="label" for="department">
                <span class="label-text font-medium flex items-center">
                  <i class="bi bi-diagram-3 mr-2 text-blue-500"></i>แผนก
                </span>
              </label>
              <select id="department" required class="select select-bordered w-full focus:ring-2 focus:ring-blue-300 dark:focus:ring-blue-700 transition">
                <option value="">เลือกแผนก</option>
                <option value="บัญชี">บัญชี</option>
                <option value="การตลาด">การตลาด</option>
                <option value="ไอที">ไอที</option>
                <option value="ทรัพยากรบุคคล">ทรัพยากรบุคคล</option>
                <option value="ขาย">ขาย</option>
              </select>
              <div class="text-xs text-red-500 hidden" id="departmentError">กรุณาเลือกแผนก</div>
            </div>
          </div>
          
          <!-- Second Column -->
          <div>
            <div class="form-control mb-3">
              <label class="label" for="baseSalary">
                <span class="label-text font-medium flex items-center">
                  <i class="bi bi-cash mr-2 text-blue-500"></i>เงินเดือนพื้นฐาน
                </span>
              </label>
              <div class="relative">
                <input type="number" id="baseSalary" required class="input input-bordered w-full pl-10 focus:ring-2 focus:ring-blue-300 dark:focus:ring-blue-700 transition" min="0" step="100" />
                <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">฿</span>
              </div>
              <div class="text-xs text-red-500 hidden" id="baseSalaryError">กรุณากรอกเงินเดือนพื้นฐาน</div>
            </div>
            
            <div class="form-control mb-3">
              <label class="label" for="overtime">
                <span class="label-text font-medium flex items-center">
                  <i class="bi bi-clock-history mr-2 text-blue-500"></i>โอที
                </span>
              </label>
              <div class="relative">
                <input type="number" id="overtime" value="0" class="input input-bordered w-full pl-10 focus:ring-2 focus:ring-blue-300 dark:focus:ring-blue-700 transition" min="0" step="100" />
                <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">฿</span>
              </div>
            </div>
            
            <div class="form-control mb-3">
              <label class="label" for="commission">
                <span class="label-text font-medium flex items-center">
                  <i class="bi bi-percent mr-2 text-blue-500"></i>ค่าคอม
                </span>
              </label>
              <div class="relative">
                <input type="number" id="commission" value="0" class="input input-bordered w-full pl-10 focus:ring-2 focus:ring-blue-300 dark:focus:ring-blue-700 transition" min="0" step="100" />
                <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">฿</span>
              </div>
            </div>
            
            <div class="form-control mb-3">
              <label class="label" for="totalSalary">
                <span class="label-text font-medium flex items-center">
                  <i class="bi bi-calculator mr-2 text-green-500"></i>เงินเดือนรวม
                </span>
              </label>
              <div class="relative">
                <input type="text" id="totalSalary" disabled class="input input-bordered w-full pl-10 bg-gray-50 dark:bg-gray-700 text-green-600 dark:text-green-400 font-medium" />
                <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">฿</span>
              </div>
              <div class="text-xs text-gray-500 mt-1">*คำนวณอัตโนมัติจากยอดรวมของเงินเดือน, โอที และค่าคอมมิชชั่น</div>
            </div>
          </div>
        </div>

        <div class="divider-gradient my-4"></div>
        
        <div class="modal-action">
          <button type="button" class="btn btn-outline gap-2" onclick="closeModal()">
            <i class="bi bi-x-lg"></i> ยกเลิก
          </button>
          <button type="submit" class="btn btn-primary gap-2">
            <i class="bi bi-save"></i> บันทึก
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Confirm Delete Modal -->
  <div id="confirmDeleteModal" class="modal">
    <div class="modal-box">
      <h3 class="font-bold text-lg text-red-600"><i class="bi bi-exclamation-triangle mr-2"></i>ยืนยันการลบ</h3>
      <p class="py-4">คุณต้องการลบข้อมูลพนักงาน <span id="deleteEmployeeName" class="font-medium"></span> ใช่หรือไม่?</p>
      <p class="text-gray-500 text-sm">การกระทำนี้ไม่สามารถย้อนกลับได้</p>
      <div class="modal-action">
        <button onclick="hideConfirmDeleteModal()" class="btn btn-outline">ยกเลิก</button>
        <button onclick="confirmDelete()" class="btn btn-error gap-2">
          <i class="bi bi-trash"></i> ลบข้อมูล
        </button>
      </div>
    </div>
  </div>

  <script>
    // Global Variables
    let isDarkMode = false;
    let isSidebarVisible = true;
    let currentEmployeeId = null;
    let currentPage = 1;
    let itemsPerPage = 5;
    let filteredEmployees = [];
    let currentFilter = "";
    let currentSort = { field: "", order: "" };

    // ข้อมูลจำลอง (สามารถใช้ API จริงได้ในภายหลัง)
    let employees = [
      { id: 1, code: 'EMP001', name: 'สมชาย ใจดี', position: 'พนักงานขาย', department: 'ขาย', baseSalary: 20000, overtime: 2000, commission: 5000, totalSalary: 27000 },'
      { id: 2, code: 'EMP002', name: 'สมหญิง รักเรียน', position: 'นักบัญชี', department: 'บัญชี', baseSalary: 25000, overtime: 0, commission: 0, totalSalary: 25000 },'
      { id: 3, code: 'EMP003', name: 'มานี มีทรัพย์', position: 'ผู้จัดการ', department: 'การตลาด', baseSalary: 35000, overtime: 0, commission: 10000, totalSalary: 45000 },'
      { id: 4, code: 'EMP004', name: 'สมศักดิ์ ศักดิ์ศรี', position: 'โปรแกรมเมอร์', department: 'ไอที', baseSalary: 30000, overtime: 3000, commission: 0, totalSalary: 33000 },'
      { id: 5, code: 'EMP005', name: 'วิชัย ใจกล้า', position: 'พนักงาน HR', department: 'ทรัพยากรบุคคล', baseSalary: 22000, overtime: 1500, commission: 0, totalSalary: 23500 },'
      { id: 6, code: 'EMP006', name: 'ประภา มีนา', position: 'นักการตลาด', department: 'การตลาด', baseSalary: 28000, overtime: 0, commission: 3000, totalSalary: 31000 },'
      { id: 7, code: 'EMP007', name: 'วิชัย เก่งกาจ', position: 'ผู้จัดการฝ่ายขาย', department: 'ขาย', baseSalary: 32000, overtime: 0, commission: 15000, totalSalary: 47000 },'
      { id: 8, code: 'EMP008', name: 'นงนุช สะอาด', position: 'นักบัญชีอาวุโส', department: 'บัญชี', baseSalary: 29000, overtime: 2000, commission: 0, totalSalary: 31000 }'
    ];

    // DOM Elements
    const salaryTableBody = document.getElementById('salaryTableBody');'
    const modal = document.getElementById('employeeModal');'
    const confirmModal = document.getElementById('confirmDeleteModal');'
    const deleteEmployeeName = document.getElementById('deleteEmployeeName');'
    const modalTitle = document.getElementById('modalTitle');'
    const form = document.getElementById('employeeForm');'
    const searchInput = document.getElementById('searchInput');'
    const addEmployeeBtn = document.getElementById('addEmployeeBtn');'
    const currentDateTimeEl = document.getElementById('currentDateTime');'
    const employeeCountEl = document.getElementById('employeeCount');'
    const paginationInfo = document.getElementById('paginationInfo');'
    const paginationControls = document.getElementById('paginationControls');'
    const sidebar = document.getElementById('sidebar');'
    const btnToggleMenu = document.getElementById('btnToggleMenu');'
    const btnToggleDark = document.getElementById('btnToggleDark');'
    const darkModeLabel = document.getElementById('darkModeLabel');'
    const darkModeIcon = document.getElementById('darkModeIcon');'
    const htmlElement = document.documentElement;
    const baseSalaryInput = document.getElementById('baseSalary');'
    const overtimeInput = document.getElementById('overtime');'
    const commissionInput = document.getElementById('commission');'
    const totalSalaryDisplay = document.getElementById('totalSalary');'
    const toastContainer = document.getElementById('toastContainer');'

    // แสดงข้อความแจ้งเตือนแบบ Toast
    function showToast(message, type = 'success') {'
      const toast = document.createElement('div');'
      toast.classList.add('toast', `toast-${type}`);'
      
      let icon = '';'
      switch (type) {
        case 'success': icon = '<i class="bi bi-check-circle mr-2"></i>'; break;'
        case 'error': icon = '<i class="bi bi-x-circle mr-2"></i>'; break;'
        case 'info': icon = '<i class="bi bi-info-circle mr-2"></i>'; break;'
      }
      
      toast.innerHTML = `${icon} ${message}`;
      toastContainer.appendChild(toast);
      
      setTimeout(() => {
        toast.classList.add('show');'
      }, 10);
      
      setTimeout(() => {
        toast.classList.remove('show');'
        setTimeout(() => {
          toastContainer.removeChild(toast);
        }, 300);
      }, 3000);
    }

    // Toggle Sidebar แบบโค้ดที่ 1
    btnToggleMenu.addEventListener('click', function() {'
      // สลับคลาสเลื่อน sidebar เข้า-ออก
      sidebar.classList.toggle('-ml-64');'
      
      // สลับไอคอนของปุ่ม
      const icon = btnToggleMenu.querySelector('i');'
      icon.classList.toggle('bi-chevron-left');'
      icon.classList.toggle('bi-chevron-right');'
    });

    // Toggle Dark Mode
    btnToggleDark.addEventListener('click', () => {'
      isDarkMode = !isDarkMode;
      htmlElement.classList.toggle('dark', isDarkMode);'
      htmlElement.setAttribute('data-theme', isDarkMode ? 'dark' : 'light');'
      darkModeLabel.textContent = isDarkMode ? 'โหมดกลางวัน' : 'โหมดกลางคืน';'
      const icon = document.getElementById('darkModeIcon');'
      icon.className = isDarkMode ? 'bi bi-sun text-xl' : 'bi bi-moon text-xl';'
      localStorage.setItem('darkMode', isDarkMode);'
    });

    // Logout functionality
    document.getElementById('btnLogoutSidebar').addEventListener('click', () => {'
      showToast('กำลังออกจากระบบ...', 'info');'
      setTimeout(() => {
        window.location.href = '/login';'
      }, 1000);
    });

    // แสดงวันที่และเวลาปัจจุบัน
    function updateDateTime() {
      const now = new Date();
      const options = { 
        year: 'numeric', '
        month: 'long', '
        day: 'numeric','
        hour: '2-digit','
        minute: '2-digit''
      };
      currentDateTimeEl.innerHTML = `
        <i class="bi bi-calendar3 mr-2 text-blue-500"></i>
        วันที่: ${now.toLocaleDateString('th-TH', options)}'
      `;
    }

    // Format เงินเป็นรูปแบบสกุลเงินบาทไทย
    function formatCurrency(amount) {
      return new Intl.NumberFormat('th-TH', {'
        style: 'currency','
        currency: 'THB','
        minimumFractionDigits: 2
      }).format(amount);
    }

    // อัพเดทแสดงจำนวนพนักงาน
    function updateEmployeeCount(count) {
      employeeCountEl.textContent = `พนักงานทั้งหมด: ${count} คน`;
    }

    // แสดงข้อมูลทั้งหมดในตาราง
    function renderEmployees(employeesList) {
      // Filter employees if needed
      if (currentFilter) {
        employeesList = employeesList.filter(emp => emp.department === currentFilter);
      }
      
      // Apply search filter
      const searchTerm = searchInput.value.toLowerCase();
      if (searchTerm) {
        employeesList = employeesList.filter(emp => 
          emp.code.toLowerCase().includes(searchTerm) || 
          emp.name.toLowerCase().includes(searchTerm) || 
          emp.position.toLowerCase().includes(searchTerm) ||
          emp.department.toLowerCase().includes(searchTerm)
        );
      }
      
      // Apply sorting if needed
      if (currentSort.field && currentSort.order) {
        employeesList = [...employeesList].sort((a, b) => {
          if (currentSort.field === 'salary') {'
            return currentSort.order === 'asc' '
              ? a.totalSalary - b.totalSalary 
              : b.totalSalary - a.totalSalary;
          } else {
            return currentSort.order === 'asc' '
              ? a.name.localeCompare(b.name) 
              : b.name.localeCompare(a.name);
          }
        });
      }
      
      // Save filtered employees for pagination
      filteredEmployees = [...employeesList];
      
      // Calculate pagination
      const totalPages = Math.ceil(employeesList.length / itemsPerPage);
      if (currentPage > totalPages && totalPages > 0) {
        currentPage = totalPages;
      }
      
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;
      const currentPageEmployees = employeesList.slice(startIndex, endIndex);
      
      // Update pagination info
      updatePaginationInfo(startIndex, endIndex, employeesList.length);
      
      // Render pagination controls
      renderPaginationControls(totalPages);
      
      salaryTableBody.innerHTML = '';'
      
      if (currentPageEmployees.length === 0) {
        const emptyRow = document.createElement('tr');'
        emptyRow.innerHTML = `
          <td colspan="9" class="text-center py-8 text-gray-500 dark:text-gray-400">
            <i class="bi bi-search text-4xl mb-2 block"></i>
            ไม่พบข้อมูลพนักงาน
          </td>
        `;
        salaryTableBody.appendChild(emptyRow);
        updateEmployeeCount(0);
        return;
      }
      
      currentPageEmployees.forEach((emp, index) => {
        const tr = document.createElement('tr');'
        tr.className = 'hover:bg-blue-50 dark:hover:bg-blue-900 dark:hover:bg-opacity-20 transition-colors';'
        tr.innerHTML = `
          <td class="font-mono">${emp.code}</td>
          <td>
            <div class="flex items-center space-x-3">
              <div class="avatar placeholder">
                <div class="bg-blue-100 text-blue-600 dark:bg-blue-900 dark:text-blue-300 w-8 mask mask-squircle">
                  <span>${emp.name.charAt(0)}</span>
                </div>
              </div>
              <div>
                <div class="font-medium">${emp.name}</div>
              </div>
            </div>
          </td>
          <td>${emp.position}</td>
          <td>
            <div class="badge ${getBadgeColorForDepartment(emp.department)}">${emp.department}</div>
          </td>
          <td class="text-right">${formatCurrency(emp.baseSalary)}</td>
          <td class="text-right">${formatCurrency(emp.overtime)}</td>
          <td class="text-right">${formatCurrency(emp.commission)}</td>
          <td class="text-right font-medium text-blue-700 dark:text-blue-400">${formatCurrency(emp.totalSalary)}</td>
          <td>
            <div class="flex gap-1 justify-center">
              <button class="btn btn-sm btn-info btn-circle tooltip tooltip-info tooltip-left" data-tip="แก้ไข" onclick="editEmployee(${emp.id})">
                <i class="bi bi-pencil-square"></i>
              </button>
              <button class="btn btn-sm btn-error btn-circle tooltip tooltip-error tooltip-left" data-tip="ลบ" onclick="showDeleteConfirmation(${emp.id})">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </td>
        `;
        salaryTableBody.appendChild(tr);

        // Adding animation delay for staggered appearance
        tr.style.animation = `slideUp 0.3s ease-out ${index * 0.05}s forwards`;
        tr.style.opacity = "0";
      });

      updateEmployeeCount(employeesList.length);
    }

    // Update pagination info text
    function updatePaginationInfo(start, end, total) {
      if (total === 0) {
        paginationInfo.textContent = 'ไม่มีข้อมูลพนักงาน';'
        return;
      }
      
      paginationInfo.textContent = `แสดง ${start + 1}-${Math.min(end, total)} จาก ${total} รายการ`;
    }

    // Render pagination controls
    function renderPaginationControls(totalPages) {
      paginationControls.innerHTML = '';'
      
      // Add previous button
      const prevBtn = document.createElement('button');'
      prevBtn.className = 'btn btn-sm btn-outline';'
      prevBtn.innerHTML = '«';'
      prevBtn.disabled = currentPage === 1;
      prevBtn.addEventListener('click', () => {'
        if (currentPage > 1) {
          currentPage--;
          renderEmployees(filteredEmployees);
        }
      });
      paginationControls.appendChild(prevBtn);
      
      // Add page number buttons
      const maxButtons = 5;
      let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
      let endPage = Math.min(totalPages, startPage + maxButtons - 1);
      
      if (endPage - startPage + 1 < maxButtons) {
        startPage = Math.max(1, endPage - maxButtons + 1);
      }
      
      for (let i = startPage; i <= endPage; i++) {
        const pageBtn = document.createElement('button');'
        pageBtn.className = `btn btn-sm ${i === currentPage ? 'btn-active' : 'btn-outline'}`;'
        pageBtn.textContent = i;
        pageBtn.addEventListener('click', () => {'
          currentPage = i;
          renderEmployees(filteredEmployees);
        });
        paginationControls.appendChild(pageBtn);
      }
      
      // Add next button
      const nextBtn = document.createElement('button');'
      nextBtn.className = 'btn btn-sm btn-outline';'
      nextBtn.innerHTML = '»';'
      nextBtn.disabled = currentPage === totalPages || totalPages === 0;
      nextBtn.addEventListener('click', () => {'
        if (currentPage < totalPages) {
          currentPage++;
          renderEmployees(filteredEmployees);
        }
      });
      paginationControls.appendChild(nextBtn);
    }

    // Return badge color based on department
    function getBadgeColorForDepartment(department) {
      switch(department) {
        case 'บัญชี': return 'badge-warning badge-outline';'
        case 'การตลาด': return 'badge-info badge-outline';'
        case 'ไอที': return 'badge-success badge-outline';'
        case 'ทรัพยากรบุคคล': return 'badge-secondary badge-outline';'
        case 'ขาย': return 'badge-primary badge-outline';'
        default: return 'badge-outline';'
      }
    }

    // คำนวณเงินเดือนรวมและแสดงในช่องแสดงผลรวม
    function updateTotalSalaryPreview() {
      const baseSalary = Number(baseSalaryInput.value) || 0;
      const overtime = Number(overtimeInput.value) || 0;
      const commission = Number(commissionInput.value) || 0;
      const total = calculateTotalSalary(baseSalary, overtime, commission);
      
      totalSalaryDisplay.value = formatCurrency(total);
    }

    // คำนวณเงินเดือนรวม
    function calculateTotalSalary(baseSalary, overtime, commission) {
      return Number(baseSalary) + Number(overtime) + Number(commission);
    }

    // เปิด Modal
    function openModal() {
      modal.classList.add('modal-open');'
    }

    // ปิด Modal
    function closeModal() {
      modal.classList.remove('modal-open');'
      resetFormValidation();
    }

    // เพิ่มพนักงานใหม่
    function addEmployee() {
      modalTitle.innerHTML = '<i class="bi bi-person-plus mr-2"></i>เพิ่มพนักงานใหม่';'
      form.reset();
      form.employeeId.value = '';'
      updateTotalSalaryPreview();
      openModal();
    }

    // แก้ไขข้อมูลพนักงาน
    function editEmployee(id) {
      modalTitle.innerHTML = '<i class="bi bi-pencil-square mr-2"></i>แก้ไขข้อมูลพนักงาน';'
      const employee = employees.find(emp => emp.id === id);
      
      if (employee) {
        form.employeeId.value = employee.id;
        form.empCode.value = employee.code;
        form.empName.value = employee.name;
        form.position.value = employee.position;
        form.department.value = employee.department;
        form.baseSalary.value = employee.baseSalary;
        form.overtime.value = employee.overtime;
        form.commission.value = employee.commission;
        
        updateTotalSalaryPreview();
        openModal();
      }
    }
    
    // แสดง modal ยืนยันการลบ
    function showDeleteConfirmation(id) {
      const employee = employees.find(emp => emp.id === id);
      if (employee) {
        currentEmployeeId = id;
        deleteEmployeeName.textContent = employee.name;
        confirmModal.classList.add('modal-open');'
      }
    }
    
    // ซ่อน modal ยืนยันการลบ
    function hideConfirmDeleteModal() {
      confirmModal.classList.remove('modal-open');'
      currentEmployeeId = null;
    }
    
    // ยืนยันการลบพนักงาน
    function confirmDelete() {
      if (currentEmployeeId) {
        const employee = employees.find(emp => emp.id === currentEmployeeId);
        employees = employees.filter(emp => emp.id !== currentEmployeeId);
        hideConfirmDeleteModal();
        
        renderEmployees(employees);
        showToast(`ลบข้อมูลพนักงาน ${employee.name} เรียบร้อยแล้ว`, 'success');'
      }
    }

    // ตรวจสอบข้อมูลในฟอร์ม
    function validateForm() {
      let isValid = true;
      
      // Check required fields
      const requiredFields = [
        { field: 'empCode', errorEl: document.getElementById('empCodeError') },'
        { field: 'empName', errorEl: document.getElementById('empNameError') },'
        { field: 'position', errorEl: document.getElementById('positionError') },'
        { field: 'department', errorEl: document.getElementById('departmentError') },'
        { field: 'baseSalary', errorEl: document.getElementById('baseSalaryError') }'
      ];
      
      requiredFields.forEach(({ field, errorEl }) => {
        const inputEl = document.getElementById(field);
        if (!inputEl.value.trim()) {
          errorEl.classList.remove('hidden');'
          isValid = false;
          inputEl.classList.add('border-red-500');'
        } else {
          errorEl.classList.add('hidden');'
          inputEl.classList.remove('border-red-500');'
        }
      });
      
      return isValid;
    }
    
    // Reset form validation visual state
    function resetFormValidation() {
      const errorElements = document.querySelectorAll('[id$="Error"]');'
      errorElements.forEach(el => {
        el.classList.add('hidden');'
      });
      
      const inputElements = form.querySelectorAll('input, select');'
      inputElements.forEach(el => {
        el.classList.remove('border-red-500');'
      });
    }
    
    // กรองข้อมูลตามแผนก
    function filterByDepartment(department) {
      currentFilter = department;
      currentPage = 1;
      renderEmployees(employees);
    }
    
    // เรียงลำดับข้อมูล
    function sortEmployees(field, order) {
      currentSort = { field, order };
      renderEmployees(employees);
    }
    
    // ส่งออกเป็นไฟล์ Excel
    function exportToExcel() {
      showToast('กำลังส่งออกข้อมูล... (ฟีเจอร์นี้จะทำงานเมื่อเชื่อมต่อกับ API จริง)', 'info');'
    }

    // Event Listeners
    // เปิด Modal เพื่อเพิ่มพนักงานใหม่
    addEmployeeBtn.addEventListener('click', addEmployee);'

    // Update total salary display as user types
    baseSalaryInput.addEventListener('input', updateTotalSalaryPreview);'
    overtimeInput.addEventListener('input', updateTotalSalaryPreview);'
    commissionInput.addEventListener('input', updateTotalSalaryPreview);'

    // Submit form
    form.addEventListener('submit', (e) => {'
      e.preventDefault();
      
      if (!validateForm()) {
        showToast('กรุณากรอกข้อมูลให้ครบถ้วน', 'error');'
        return;
      }
      
      const id = form.employeeId.value ? Number(form.employeeId.value) : Date.now();
      const code = form.empCode.value;
      const name = form.empName.value;
      const position = form.position.value;
      const department = form.department.value;
      const baseSalary = Number(form.baseSalary.value);
      const overtime = Number(form.overtime.value);
      const commission = Number(form.commission.value);
      const totalSalary = calculateTotalSalary(baseSalary, overtime, commission);
      
      if (form.employeeId.value) {
        // แก้ไขข้อมูล
        const index = employees.findIndex(emp => emp.id === Number(id));
        if (index !== -1) {
          const oldName = employees[index].name;
          employees[index] = { id, code, name, position, department, baseSalary, overtime, commission, totalSalary };
          showToast(`อัปเดตข้อมูลพนักงาน ${name} เรียบร้อยแล้ว`, 'success');'
        }
      } else {
        // ตรวจสอบรหัสซ้ำ
        if (employees.some(emp => emp.code === code)) {
          showToast(`รหัสพนักงาน ${code} ซ้ำกับที่มีอยู่แล้ว`, 'error');'
          return;
        }
        
        // เพิ่มข้อมูลใหม่
        employees.push({ id, code, name, position, department, baseSalary, overtime, commission, totalSalary });
        showToast(`เพิ่มพนักงาน ${name} เรียบร้อยแล้ว`, 'success');'
      }
      
      renderEmployees(employees);
      closeModal();
    });

    // ค้นหาพนักงาน
    searchInput.addEventListener('input', () => {'
      currentPage = 1;
      renderEmployees(employees);
    });

    // Check for preferred color scheme and saved settings
    function initializeTheme() {
      // Check local storage first
      const savedDarkMode = localStorage.getItem('darkMode');'
      
      if (savedDarkMode !== null) {
        isDarkMode = savedDarkMode === 'true';'
      } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {'
        // If no saved preference, check system preference
        isDarkMode = true;
      }
      
      // Apply theme
      htmlElement.classList.toggle('dark', isDarkMode);'
      htmlElement.setAttribute('data-theme', isDarkMode ? 'dark' : 'light');'
      darkModeLabel.textContent = isDarkMode ? 'โหมดกลางวัน' : 'โหมดกลางคืน';'
      darkModeIcon.className = isDarkMode ? 'bi bi-sun text-xl' : 'bi bi-moon text-xl';'
    }

    // Responsive sidebar handling
    function handleResponsiveness() {
      if (window.innerWidth < 1024) {
        isSidebarVisible = false;
        sidebar.classList.add('-translate-x-full');'
        btnToggleMenu.innerHTML = '<i class="bi bi-chevron-right text-xl"></i>';'
      } else {
        isSidebarVisible = true;
        sidebar.classList.remove('-translate-x-full');'
        btnToggleMenu.innerHTML = '<i class="bi bi-chevron-left text-xl"></i>';'
      }
    }

    window.addEventListener('resize', handleResponsiveness);'

    // แสดงข้อมูลเมื่อโหลดหน้าเว็บ
    document.addEventListener('DOMContentLoaded', () => {'
      initializeTheme();
      handleResponsiveness();
      updateDateTime();
      setInterval(updateDateTime, 60000); // อัพเดทเวลาทุกๆ 1 นาที
      
      // Simulate loading
      setTimeout(() => {
        renderEmployees(employees);
        showToast('โหลดข้อมูลเรียบร้อย', 'success');'
      }, 500);
    });
  </script>
</body>
</html>