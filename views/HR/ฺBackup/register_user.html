<!DOCTYPE html>
<html lang="th" data-theme="light">
<head>
  <meta charset="UTF-8"/>
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- Tailwind + DaisyUI -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class'
      theme: { 
        extend: { 
          fontFamily: { sans: ['Prompt','sans-serif'] },'
          colors: {
            primary: '#5a23c8','
          }
        } 
      },
      daisyui: { themes: ['light'] },'
    }
  </script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@2.51.5/dist/full.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    body {
      font-family: 'Prompt', sans-serif;'
    }
    .stats-card {
      background: white;
      border-radius: 0.5rem;
      padding: 1.5rem;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    .checkbox-group {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 0.75rem;
    }
    .checkbox-container {
      display: flex;
      align-items: center;
      padding: 0.5rem;
      border-radius: 0.375rem;
      background-color: #f9fafb;
    }
    .checkbox-container:hover {
      background-color: #f3f4f6;
    }
    .checkbox-container input {
      margin-right: 0.5rem;
    }
    /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Modal */
    .modal-box {
      max-width: 800px;
    }
    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö toggle switch */
    .toggle-status {
      opacity: 1;
      transition: opacity 0.3s;
      display: flex;
      align-items: center;
    }
    .toggle-status.loading {
      opacity: 0.6;
      pointer-events: none;
    }
    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô */
    #notification-container {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 50;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .notification {
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      color: white;
      display: flex;
      align-items: center;
      transform: translateX(0);
      opacity: 1;
      transition: all 0.3s ease;
    }
    .notification.hide {
      transform: translateX(100%);
      opacity: 0;
    }
  </style>

  <!-- Loading System -->
  <link rel="stylesheet" href="/css/loading-components.css">
  <script src="/js/loading-system.js"></script>

</head>
<body class="bg-gray-100">
  <!-- Header -->
  <header class="bg-white shadow-sm py-3 px-4 flex justify-between items-center">
    <div class="flex items-center">
      <div class="text-primary font-semibold text-xl">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
   
    </div>
    <div class="flex items-center">
      <div class="relative mr-4">
        <input type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." class="input input-bordered w-64 pl-10 h-10" />
        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
      </div>
      <div class="relative mr-4">
        <i class="fas fa-bell text-gray-600"></i>
        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">3</span>
      </div>
      <div class="avatar">
        <div class="w-10 rounded-full">
          
        </div>
      </div>
    </div>
  </header>

  <div class="flex">
    <!-- Main Content (now with no sidebar) -->
    <main class="flex-1 p-6">
      <!-- Page Header -->
      <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold flex items-center">
          <i class="fas fa-users text-primary mr-2"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
        </h1>
        <div class="flex gap-2">
          <button class="btn btn-outline">
            <i class="fas fa-file-export mr-1"></i> ‡∏ô‡∏≥‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
          </button>
          
            
          </button>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
        <div class="stats-card flex items-center">
          <div class="flex-1">
            <h3 class="text-3xl font-bold">2</h3>
            <p class="text-gray-600">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
            <p class="text-green-500 text-sm mt-1"><i class="fas fa-arrow-up mr-1"></i>0% ‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)</p>
          </div>
          <div class="bg-indigo-100 p-3 rounded-lg">
            <i class="fas fa-users text-indigo-500 text-2xl"></i>
          </div>
        </div>
        
        <div class="stats-card flex items-center">
          <div class="flex-1">
            <h3 class="text-3xl font-bold">10</h3>
            <p class="text-gray-600">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
            <p class="text-gray-500 text-sm mt-1"><i class="fas fa-minus mr-1"></i>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á</p>
          </div>
          <div class="bg-pink-100 p-3 rounded-lg">
            <i class="fas fa-user-tag text-pink-500 text-2xl"></i>
          </div>
        </div>
        
        <div class="stats-card flex items-center">
          <div class="flex-1">
            <h3 class="text-3xl font-bold">6</h3>
            <p class="text-gray-600">‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
            <p class="text-blue-500 text-sm mt-1"><i class="fas fa-plus mr-1"></i>0 ‡∏™‡∏≤‡∏Ç‡∏≤ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)</p>
          </div>
          <div class="bg-blue-100 p-3 rounded-lg">
            <i class="fas fa-building text-blue-500 text-2xl"></i>
          </div>
        </div>
        
        <div class="stats-card flex items-center">
          <div class="flex-1">
            <h3 class="text-3xl font-bold">0</h3>
            <p class="text-gray-600">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤</p>
            <p class="text-red-500 text-sm mt-1"><i class="fas fa-arrow-down mr-1"></i>0 ‡∏£‡∏≤‡∏¢ ‡∏•‡∏î‡∏•‡∏á (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)</p>
          </div>
          <div class="bg-red-100 p-3 rounded-lg">
            <i class="fas fa-exclamation-circle text-red-500 text-2xl"></i>
          </div>
        </div>
      </div>

      <!-- Information Alert -->
      <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6">
        <div class="flex">
          <div class="flex-shrink-0">
            <i class="fas fa-info-circle text-blue-400"></i>
          </div>
          <div class="ml-3">
            <p class="text-sm text-blue-700">
              <strong>‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö CEO/Admin:</strong> ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡πä‡∏Å‡∏ä‡πà‡∏≠‡∏á "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô
            </p>
          </div>
        </div>
      </div>

      <!-- Registration Form Card -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold mb-6 flex items-center">
          <i class="fas fa-user-plus text-primary mr-2"></i>
          ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
        </h2>
        
        <form id="registerForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
          
          <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏° Checkbox ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Virtual Employee -->
          <div class="form-control w-full md:col-span-2">
            <div class="flex items-center gap-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
              <label class="label cursor-pointer flex items-center gap-2">
                <input type="checkbox" id="isVirtualEmployee" class="checkbox checkbox-warning" />
                <span class="label-text font-medium text-yellow-800">
                  <i class="fas fa-crown mr-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© (CEO/Admin) - ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
                </span>
              </label>
            </div>
          </div>

          <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô -->
          <div class="form-control w-full" id="employeeSelectDiv">
            <label class="label"><span class="label-text font-medium">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</span></label>
            <select id="employeeSelect" name="employee" required class="select select-bordered w-full">
              <option value="">-- ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• --</option>
            </select>
          </div>

          <!-- ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Virtual Employee -->
          <div id="virtualEmployeeFields" class="form-control w-full md:col-span-2 hidden">
            <div class="bg-gray-50 p-4 rounded-lg border">
              <h3 class="text-lg font-medium mb-4 text-gray-700">
                <i class="fas fa-user-tie mr-2"></i>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©
              </h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="form-control">
                  <label class="label"><span class="label-text font-medium">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span class="text-red-500">*</span></span></label>
                  <input type="text" id="virtualName" name="virtualName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏≤‡∏¢ ‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ" 
                         class="input input-bordered w-full"/>
                </div>
                <div class="form-control">
                  <label class="label"><span class="label-text font-medium">‡∏≠‡∏µ‡πÄ‡∏°‡∏• <span class="text-red-500">*</span></span></label>
                  <input type="email" id="virtualEmail" name="virtualEmail" placeholder="‡πÄ‡∏ä‡πà‡∏ô ceo@company.com" 
                         class="input input-bordered w-full"/>
                </div>
                <div class="form-control">
                  <label class="label"><span class="label-text font-medium">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</span></label>
                  <input type="text" id="virtualPosition" name="virtualPosition" placeholder="‡πÄ‡∏ä‡πà‡∏ô CEO, ‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£" 
                         class="input input-bordered w-full" value="CEO"/>
                </div>
                <div class="form-control">
                  <label class="label"><span class="label-text font-medium">‡πÅ‡∏ú‡∏ô‡∏Å</span></label>
                  <input type="text" id="virtualDepartment" name="virtualDepartment" placeholder="‡πÄ‡∏ä‡πà‡∏ô Management" 
                         class="input input-bordered w-full" value="Management"/>
                </div>
                <div class="form-control">
                  <label class="label"><span class="label-text font-medium">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</span></label>
                  <input type="tel" id="virtualPhone" name="virtualPhone" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0812345678" 
                         class="input input-bordered w-full"/>
                </div>
              </div>
              
              <!-- Image Upload Section -->
              <div class="mt-6 border-t pt-4">
                <h4 class="text-md font-medium mb-4 text-gray-700">
                  <i class="fas fa-camera mr-2"></i>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
                </h4>
                <div class="flex justify-center">
                  <!-- Profile Image -->
                  <div class="form-control">
                    <label class="label"><span class="label-text font-medium">‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</span></label>
                    <div class="flex flex-col items-center">
                      <div class="avatar mb-3">
                        <div class="w-24 h-24 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2">
                          <img id="virtualProfilePreview" src="https://via.placeholder.com/150/e2e8f0/64748b?text=Profile" 
                               alt="Profile Preview" class="object-cover"/>
                        </div>
                      </div>
                      <input type="file" id="virtualProfileImage" name="virtualProfileImage" 
                             accept="image/*" class="file-input file-input-bordered file-input-sm w-full max-w-xs"
                             onchange="previewVirtualImage(this, 'virtualProfilePreview')"/>'
                      <span class="text-xs text-gray-500 mt-1">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå JPG, PNG (‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB)</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Username -->
          <div class="form-control w-full">
            <label class="label"><span class="label-text font-medium">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Username)</span></label>
            <input type="text" name="username" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" required
                 class="input input-bordered w-full"/>
          </div>
          
          <!-- Password -->
          <div class="form-control w-full">
            <label class="label"><span class="label-text font-medium">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (Password)</span></label>
            <input type="password" name="password" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required
                 class="input input-bordered w-full"/>
          </div>
          
          <!-- Role (Changed to Checkboxes) -->
          <div class="form-control w-full md:col-span-2">
            <label class="label"><span class="label-text font-medium">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó (Role)</span></label>
            <div id="roleCheckboxes" class="checkbox-group bg-gray-50 p-3 rounded-md border">
              <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡πÇ‡∏î‡∏¢ JavaScript -->
              <p class="text-gray-400 text-center p-2 col-span-full">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
            </div>
          </div>
          
          <!-- Allowed Pages (Changed to Checkboxes) -->
          <div id="pagesDiv" class="form-control w-full md:col-span-2">
            <label class="label"><span class="label-text font-medium">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á</span></label>
            <div id="pagesCheckboxes" class="checkbox-group bg-gray-50 p-3 rounded-md border">
              <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡πÇ‡∏î‡∏¢ JavaScript -->
            </div>
          </div>
          
          <!-- Check-in Branches (‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô) -->
          <div id="checkinBranchesDiv" class="form-control w-full md:col-span-2">
            <label class="label">
              <span class="label-text font-medium">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÑ‡∏î‡πâ <span class="text-red-500">*</span></span>
            </label>
            <div id="checkinBranchCheckboxes" class="checkbox-group bg-gray-50 p-3 rounded-md border">
              <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡πÇ‡∏î‡∏¢ JavaScript -->
            </div>
            <p class="text-xs text-gray-500 mt-1">‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô-‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ï‡πå‡πÑ‡∏î‡πâ (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏™‡∏≤‡∏Ç‡∏≤)</p>
          </div>
          

          
          <div class="md:col-span-2 flex justify-end mt-4">
            <button type="button" class="btn btn-outline mr-2">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button type="submit" class="btn btn-primary px-6">
              <i class="fas fa-save mr-1"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            </button>
          </div>
        </form>
      </div>

      <!-- Example User Table (Just for UI demonstration) -->
      <div class="bg-white rounded-lg shadow-md p-6 mt-6">
        <h2 class="text-xl font-semibold mb-4">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h2>
        
        <div class="flex flex-wrap gap-3 mb-4">
          <div class="dropdown">
            <label tabindex="0" class="btn btn-outline btn-sm m-1">
              ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <i class="fas fa-chevron-down ml-2"></i>
            </label>
          </div>
          
          <div class="dropdown">
            <label tabindex="0" class="btn btn-outline btn-sm m-1">
              ‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤ <i class="fas fa-chevron-down ml-2"></i>
            </label>
          </div>
          
          <div class="dropdown">
            <label tabindex="0" class="btn btn-outline btn-sm m-1">
              ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <i class="fas fa-chevron-down ml-2"></i>
            </label>
          </div>
          
          <button class="btn btn-sm">
            <i class="fas fa-filter mr-1"></i> ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
          </button>
        </div>
        
        <div class="overflow-x-auto">
          <table id="usersTable" class="table w-full">
            <thead>
              <tr>
                <th>
                  <label>
                    <input type="checkbox" class="checkbox" />
                  </label>
                </th>
                <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th>
                <th>‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</th>
                <th>‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</th>
                <th>‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ</th>
                <th>‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÑ‡∏î‡πâ</th>
                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
              </tr>
            </thead>
            <tbody>
              <!-- Cleared sample rows -->
            </tbody>
          </table>
          <div class="py-4 flex justify-between items-center">
            <p class="text-sm text-gray-500">‡πÅ‡∏™‡∏î‡∏á 1 ‡∏ñ‡∏∂‡∏á 2 ‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 2 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
            <div class="btn-group">
              <button class="btn btn-sm btn-disabled">¬´</button>
              <button class="btn btn-sm btn-active">1</button>
              <button class="btn btn-sm btn-disabled">¬ª</button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
  
  <!-- Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô -->
  <input type="checkbox" id="edit-user-modal" class="modal-toggle" />
  <div class="modal">
    <div class="modal-box">
      <h3 class="font-bold text-lg mb-4 flex items-center">
        <i class="fas fa-user-edit text-primary mr-2"></i>
        ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
      </h3>
      

      <form id="editUserForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <input type="hidden" id="editUserId" name="userId" />
        
        <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô -->
        <div class="form-control w-full">
          <label class="label"><span class="label-text font-medium">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</span></label>
          <select id="editEmployeeSelect" name="employee" required class="select select-bordered w-full" disabled>
            <option value="">-- ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• --</option>
          </select>
          <div class="label">
            <span class="label-text-alt text-gray-500">
              <i class="fas fa-lock mr-1"></i>
              ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
            </span>
          </div>
        </div>
        
        <!-- Username -->
        <div class="form-control w-full">
          <label class="label"><span class="label-text font-medium">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Username)</span></label>
          <input type="text" id="editUsername" name="username" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" required
                class="input input-bordered w-full"/>
        </div>
        
        <!-- Password - optional for edit -->
        <div class="form-control w-full">
          <label class="label">
            <span class="label-text font-medium">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)</span>
          </label>
          <input type="password" id="editPassword" name="password" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô"
                class="input input-bordered w-full"/>
          <div class="label">
            <span class="label-text-alt text-gray-500">
              <i class="fas fa-info-circle mr-1"></i>
              ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
            </span>
          </div>
        </div>
        
        <!-- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô -->
        <div class="form-control">
          <label class="label"><span class="label-text font-medium">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span></label>
          <div class="flex gap-4">
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="status" value="active" class="radio radio-primary" checked />
              <span>‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="status" value="inactive" class="radio" />
              <span>‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
            </label>
          </div>
        </div>
        
        <!-- Role (Changed to Checkboxes) -->
        <div class="form-control w-full md:col-span-2">
          <label class="label">
            <span class="label-text font-medium">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó (Role)</span>
          </label>
          <div id="editRoleCheckboxes" class="checkbox-group bg-gray-50 p-3 rounded-md border">
            <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡πÇ‡∏î‡∏¢ JavaScript -->
            <p class="text-gray-400 text-center p-2 col-span-full">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
          </div>
        </div>
        
        <!-- Allowed Pages -->
        <div id="editPagesDiv" class="form-control w-full md:col-span-2">
          <label class="label">
            <span class="label-text font-medium">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á</span>
          </label>
          <div id="editPagesCheckboxes" class="checkbox-group bg-gray-50 p-3 rounded-md border">
            <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡πÇ‡∏î‡∏¢ JavaScript -->
          </div>
        </div>
        
        <!-- Check-in Branches (‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô) -->
        <div id="editCheckinBranchesDiv" class="form-control w-full md:col-span-2">
          <label class="label">
            <span class="label-text font-medium">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÑ‡∏î‡πâ</span>
          </label>
          <div id="editCheckinBranchCheckboxes" class="checkbox-group bg-gray-50 p-3 rounded-md border">
            <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡πÇ‡∏î‡∏¢ JavaScript -->
            <p class="text-gray-400 text-center p-2 col-span-full">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
          </div>
        </div>
        

      </form>
      
      <div class="modal-action">
        <button type="button" class="btn btn-outline" onclick="closeEditModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button type="button" class="btn btn-primary" onclick="saveUserEdit()">
          <i class="fas fa-save mr-1"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        </button>
      </div>
    </div>
  </div>



  <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô -->
  <div id="notification-container"></div>

  <script>
    // API Endpoints
    const API_ENDPOINTS = {
      employees: '/api/employees','
      roles: '/api/roles','
      userRegister: '/api/users/register','
      userGet: '/api/users','
      branches: '/api/branch''
    };

    // Cache and State Management
    const appCache = {
      roles: null,
      branches: null,
      employees: null,
      lastUpdate: {}
    };

    const token = localStorage.getItem('authToken');'
    let selectedRole = null;

    // Modules Configuration (‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö home.html)
    const modules = [
      { id: 'accounting', name: '‡∏á‡∏≤‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ' },'
      { id: 'hr', name: '‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•' },'
      { id: 'stock', name: '‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤' },'
      { id: 'marketing', name: '‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î' },'
      { id: 'loan', name: '‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠' },'
      { id: 'pos', name: 'POS - ‡∏Ç‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô' },'
      { id: 'gifts', name: '‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏°' },'
      { id: 'none', name: '‡πÑ‡∏°‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î (‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ Login ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ)' }'
    ];

    // Utility Functions
    const debounce = (func, wait) => {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    };

    const showLoading = (element, show = true) => {
      if (show) {
        element.classList.add('loading', 'loading-spinner');'
      } else {
        element.classList.remove('loading', 'loading-spinner');'
      }
    };

    // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Virtual Employee Toggle
    document.addEventListener('DOMContentLoaded', function() {'
      const pageLoaderId = LoadingSystem.show({
        message: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö...','
        showProgress: true,
        autoProgress: true,
        spinnerType: 'default''
      
      } catch (error) {
        console.error('Page loading error:', error);
      } finally {
        LoadingSystem.completeProgress();
      }});
      
      try {
      const virtualCheckbox = document.getElementById('isVirtualEmployee');'
      if (virtualCheckbox) {
        virtualCheckbox.addEventListener('change', function() {'
          const isChecked = this.checked;
          const employeeSelectDiv = document.getElementById('employeeSelectDiv');'
          const virtualFields = document.getElementById('virtualEmployeeFields');'
          const employeeSelect = document.getElementById('employeeSelect');'
          
          if (isChecked) {
            // ‡∏ã‡πà‡∏≠‡∏ô dropdown ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ü‡∏¥‡∏•‡∏î‡πå virtual
            employeeSelectDiv.classList.add('hidden');'
            virtualFields.classList.remove('hidden');'
            employeeSelect.removeAttribute('required');'
            
            // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ü‡∏¥‡∏•‡∏î‡πå virtual ‡πÄ‡∏õ‡πá‡∏ô required
            document.getElementById('virtualName').setAttribute('required', 'required');'
            document.getElementById('virtualEmail').setAttribute('required', 'required');'
          } else {
            // ‡πÅ‡∏™‡∏î‡∏á dropdown ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏ô‡∏ü‡∏¥‡∏•‡∏î‡πå virtual
            employeeSelectDiv.classList.remove('hidden');'
            virtualFields.classList.add('hidden');'
            employeeSelect.setAttribute('required', 'required');'
            
            // ‡∏•‡∏ö required ‡∏à‡∏≤‡∏Å‡∏ü‡∏¥‡∏•‡∏î‡πå virtual
            document.getElementById('virtualName').removeAttribute('required');'
            document.getElementById('virtualEmail').removeAttribute('required');'
          }
        });
      }
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Preview ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Virtual Employee
    function previewVirtualImage(input, previewId) {
      const file = input.files[0];
      const preview = document.getElementById(previewId);
      
      if (file) {
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå (5MB = 5 * 1024 * 1024 bytes)
        if (file.size > 5 * 1024 * 1024) {
          showNotification('‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB', 'warning');'
          input.value = '';'
          return;
        }
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ü‡∏•‡πå
        if (!file.type.startsWith('image/')) {'
          showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô', 'warning');'
          input.value = '';'
          return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
          preview.src = e.target.result;
        };
        reader.readAsDataURL(file);
      } else {
        // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô placeholder
        preview.src = 'https://via.placeholder.com/150/e2e8f0/64748b?text=Profile';'
      }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå (‡πÉ‡∏ä‡πâ‡πÅ‡∏Ñ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö debug - ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏° FormData)
    async function uploadVirtualEmployeeFiles(profileFile) {
      // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏¢‡∏Å ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏à‡∏∞‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏ô createVirtualEmployee
      console.log('‚ö†Ô∏è uploadVirtualEmployeeFiles called but skipped - using direct file upload');'
      return { profileImagePath: null };
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á Virtual Employee
    async function createVirtualEmployee(virtualData, profileFile = null) {
      try {
        console.log('üîÑ Creating Virtual Employee with data:', virtualData);'
        
        // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏¢‡∏Å ‡∏à‡∏∞‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
        if (profileFile) {
          console.log('üì∏ Profile image file ready:', profileFile.name, profileFile.size, 'bytes');'
        }
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
        if (!virtualData.name || !virtualData.email) {
          throw new Error('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å');'
        }
        
        // ‡πÉ‡∏ä‡πâ FormData ‡πÅ‡∏ó‡∏ô JSON ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö API ‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á multipart/form-data
        const formData = new FormData();
        
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á employeeId ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥
        const timestamp = Date.now();
        const employeeId = `VE${timestamp.toString().slice(-8)}`;
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
        formData.append('employeeId', employeeId);'
        formData.append('name', virtualData.name.trim());'
        formData.append('email', virtualData.email.trim());'
        formData.append('position', virtualData.position?.trim() || 'CEO');'
        formData.append('department', virtualData.department?.trim() || 'Management');'
        formData.append('citizenId', '0000000000000');'
        formData.append('birthDate', '1990-01-01');'
        formData.append('phone', virtualData.phone?.replace(/\D/g, '') || '0000000000');'
        formData.append('address', 'Head Office');'
        formData.append('startDate', new Date().toISOString().split('T')[0]);'
        formData.append('salary', '0');'
        formData.append('branch', 'HEAD_OFFICE');'
        formData.append('emergencyContactName', 'N/A');'
        formData.append('emergencyContactRelationship', 'N/A');'
        formData.append('emergencyContactPhone', '0000000000');'
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        if (profileFile) {
          formData.append('image', profileFile);'
        }
        
        // Debug log ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö FormData
        console.log('üì§ FormData contents:');'
        for (let [key, value] of formData.entries()) {
          console.log(`  ${key}:`, value);
        }
        
        const response = await fetch('/api/employees', {'
          method: 'POST','
          headers: {
            'Authorization': 'Bearer ' + token'
            // ‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà Content-Type ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ browser set multipart/form-data ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
          },
          body: formData
        });
        
        console.log('üì° Response status:', response.status);'
        
        if (!response.ok) {
          let errorData;
          let errorMessage = `‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå (HTTP ${response.status})`;
          
          try {
            // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏° parse response ‡πÄ‡∏õ‡πá‡∏ô JSON
            const responseText = await response.text();
            console.error('‚ùå Raw API Response:', responseText);'
            
            if (responseText.trim()) {
              try {
                errorData = JSON.parse(responseText);
                console.error('‚ùå Parsed API Error:', errorData);'
                
                if (errorData.message) {
                  errorMessage = errorData.message;
                } else if (errorData.error) {
                  if (Array.isArray(errorData.error)) {
                    errorMessage = errorData.error.map(e => e.message || e).join(', ');'
                  } else {
                    errorMessage = errorData.error;
                  }
                } else if (errorData.errors && Array.isArray(errorData.errors)) {
                  errorMessage = errorData.errors.map(e => e.message || e).join(', ');'
                }
              } catch (parseError) {
                console.error('‚ùå Cannot parse JSON, using raw text');'
                // ‡∏ñ‡πâ‡∏≤ parse ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏ä‡πâ response text ‡∏ï‡∏£‡∏á‡πÜ (‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô HTML error page)
                if (responseText.includes('<!DOCTYPE html>')) {'
                  errorMessage = `‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ HTML Error Page (HTTP ${response.status})`;
                } else {
                  errorMessage = responseText.substring(0, 200); // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß
                }
              }
            }
          } catch (readError) {
            console.error('‚ùå Cannot read response:', readError);'
          }
          
          throw new Error(errorMessage);
        }
        
        const result = await response.json();
        console.log('‚úÖ API Success Response:', result);'
        
        if (!result.success) {
          throw new Error(result.message || '‡∏™‡∏£‡πâ‡∏≤‡∏á Virtual Employee ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');'
        }
        
        console.log('‚úÖ Virtual Employee created with ID:', result.data._id);'
        return result.data._id;
        
      } catch (error) {
        console.error('‚ùå Error creating virtual employee:', error);'
        throw error;
      }
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡∏î‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    function loadModules() {
      const container = document.getElementById('pagesCheckboxes');'
      container.innerHTML = '';'
      
      modules.forEach(m => {
        const div = document.createElement('div');'
        div.className = 'checkbox-container';'
        
        const checkbox = document.createElement('input');'
        checkbox.type = 'checkbox';'
        checkbox.name = 'allowedPages';'
        checkbox.value = m.id;
        checkbox.id = `page_${m.id}`;
        checkbox.className = 'checkbox checkbox-sm';'
        
        const label = document.createElement('label');'
        label.htmlFor = `page_${m.id}`;
        label.textContent = m.name;
        
        div.appendChild(checkbox);
        div.appendChild(label);
        container.appendChild(div);
      });
      
      // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏°‡∏î‡∏π‡∏•‡πÉ‡∏ô Modal ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
      const editContainer = document.getElementById('editPagesCheckboxes');'
      editContainer.innerHTML = '';'
      
      modules.forEach(m => {
        const div = document.createElement('div');'
        div.className = 'checkbox-container';'
        
        const checkbox = document.createElement('input');'
        checkbox.type = 'checkbox';'
        checkbox.name = 'editAllowedPages';'
        checkbox.value = m.id;
        checkbox.id = `edit_page_${m.id}`;
        checkbox.className = 'checkbox checkbox-sm';'
        
        const label = document.createElement('label');'
        label.htmlFor = `edit_page_${m.id}`;
        label.textContent = m.name;
        
        div.appendChild(checkbox);
        div.appendChild(label);
        editContainer.appendChild(div);
      });
    }

    // ‡∏î‡∏∂‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏î‡πâ‡∏ß‡∏¢ Cache
    async function loadEmployees(forceRefresh = false) {
      const sel = document.getElementById('employeeSelect');'
      const editSel = document.getElementById('editEmployeeSelect');'
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Cache ‡∏Å‡πà‡∏≠‡∏ô
      if (!forceRefresh && appCache.employees && Date.now() - appCache.lastUpdate.employees < 300000) {
        populateEmployeeSelects(appCache.employees);
        return;
      }
      
      try {
        showLoading(sel.parentElement);
        showLoading(editSel.parentElement);
        
        const res = await fetch(API_ENDPOINTS.employees, { 
          headers: { 'Authorization': 'Bearer ' + token }'
        });
        const json = await res.json();
        
        if (!res.ok || !json.success) {
          throw new Error(json.error || json.message || '‡πÇ‡∏´‡∏•‡∏î‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');'
        }
        
        // ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô Cache
        appCache.employees = json.data;
        appCache.lastUpdate.employees = Date.now();
        
        populateEmployeeSelects(json.data);
        
      } catch (err) {
        console.error('Error loading employees:', err);'
        sel.innerHTML = '<option value="">! ‡πÇ‡∏´‡∏•‡∏î‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</option>';'
        editSel.innerHTML = '<option value="">! ‡πÇ‡∏´‡∏•‡∏î‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</option>';'
        showNotification('‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + err.message, 'error');'
      } finally {
        showLoading(sel.parentElement, false);
        showLoading(editSel.parentElement, false);
      }
    }

    function populateEmployeeSelects(employees) {
      const sel = document.getElementById('employeeSelect');'
      const editSel = document.getElementById('editEmployeeSelect');'
      
      // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      sel.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô --</option>';'
      
      // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
      editSel.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô --</option>';'
      
      employees.forEach(emp => {
        const o = document.createElement('option');'
        o.value = emp._id; 
        o.textContent = `${emp.name} (${emp.employeeId || 'N/A'})`;'
        sel.appendChild(o);
        
        const editOpt = o.cloneNode(true);
        editSel.appendChild(editOpt);
      });
    }

    // ‡∏î‡∏∂‡∏á‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏î‡πâ‡∏ß‡∏¢ Cache
    async function loadRoles(forceRefresh = false) {
      const container = document.getElementById('roleCheckboxes');'
      const editContainer = document.getElementById('editRoleCheckboxes');'
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Cache ‡∏Å‡πà‡∏≠‡∏ô
      if (!forceRefresh && appCache.roles && Date.now() - appCache.lastUpdate.roles < 300000) {
        populateRoleContainers(appCache.roles);
        return;
      }
      
      try {
        showLoading(container);
        showLoading(editContainer);
        
        const res = await fetch(API_ENDPOINTS.roles, { 
          headers: { 'Authorization': 'Bearer ' + token }'
        });
        const json = await res.json();
        
        if (!res.ok || !json.success) {
          throw new Error(json.error || json.message || '‡πÇ‡∏´‡∏•‡∏î‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');'
        }
        
        // ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô Cache
        appCache.roles = json.data;
        appCache.lastUpdate.roles = Date.now();
        
        populateRoleContainers(json.data);
        
      } catch (err) {
        console.error('Error loading roles:', err);'
        container.innerHTML = '<p class="text-red-600 p-2">! ‡πÇ‡∏´‡∏•‡∏î‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</p>';'
        editContainer.innerHTML = '<p class="text-red-600 p-2">! ‡πÇ‡∏´‡∏•‡∏î‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</p>';'
        showNotification('‡πÇ‡∏´‡∏•‡∏î‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + err.message, 'error');'
      } finally {
        showLoading(container, false);
        showLoading(editContainer, false);
      }
    }

    function populateRoleContainers(roles) {
      const container = document.getElementById('roleCheckboxes');'
      const editContainer = document.getElementById('editRoleCheckboxes');'
      
      container.innerHTML = '';'
      editContainer.innerHTML = '';'
      
      roles.forEach(role => {
        // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
        const div = document.createElement('div');'
        div.className = 'checkbox-container';'
        
        const checkbox = document.createElement('input');'
        checkbox.type = 'radio';'
        checkbox.name = 'role';'
        checkbox.value = role._id;
        checkbox.id = `role_${role._id}`;
        checkbox.className = 'radio radio-primary radio-sm';'
        checkbox.addEventListener('change', debounce(function() {'
          if (this.checked) {
            onRoleChange(role._id);
          }
        }, 300));
        
        const label = document.createElement('label');'
        label.htmlFor = `role_${role._id}`;
        label.textContent = role.name;
        
        div.appendChild(checkbox);
        div.appendChild(label);
        container.appendChild(div);
        
        // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
        const editDiv = document.createElement('div');'
        editDiv.className = 'checkbox-container';'
        
        const editCheckbox = document.createElement('input');'
        editCheckbox.type = 'radio';'
        editCheckbox.name = 'editRole';'
        editCheckbox.value = role._id;
        editCheckbox.id = `edit_role_${role._id}`;
        editCheckbox.className = 'radio radio-primary radio-sm';'
        editCheckbox.addEventListener('change', debounce(function() {'
          if (this.checked) {
            onEditRoleChange(role._id);
          }
        }, 300));
        
        const editLabel = document.createElement('label');'
        editLabel.htmlFor = `edit_role_${role._id}`;
        editLabel.textContent = role.name;
        
        editDiv.appendChild(editCheckbox);
        editDiv.appendChild(editLabel);
        editContainer.appendChild(editDiv);
      });
    }

    // ‡∏î‡∏∂‡∏á‡∏™‡∏≤‡∏Ç‡∏≤ - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏î‡πâ‡∏ß‡∏¢ Cache ‡πÅ‡∏•‡∏∞‡∏£‡∏ß‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô
    async function loadBranches(forceRefresh = false) {
      console.log('üîÑ loadBranches called, forceRefresh:', forceRefresh);'
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Cache ‡∏Å‡πà‡∏≠‡∏ô
      if (!forceRefresh && appCache.branches && Date.now() - appCache.lastUpdate.branches < 300000) {
        console.log('üìã Using cached branches:', appCache.branches.length);'
        return appCache.branches;
      }
      
      try {
        console.log('üåê Fetching branches from API:', API_ENDPOINTS.branches);'
        const res = await fetch(API_ENDPOINTS.branches, {
          headers: { 'Authorization': 'Bearer ' + token }'
        });
        
        console.log('üì° API Response status:', res.status);'
        
        if (!res.ok) {
          throw new Error(`HTTP ${res.status}: ${res.statusText}`);
        }
        
        const json = await res.json();
        console.log('üìÑ API Response data:', json);'
        
        if (!json.success || !Array.isArray(json.data)) {
          throw new Error(json.message || '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');'
        }

        // ‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤
        console.log('üîÑ Processing branch data...');'
        const branches = json.data.map((b, index) => {
          console.log(`Branch ${index}:`, b);
          return {
            id: b._id, 
            code: b.branch_code || b.code || 'N/A', '
            name: b.name || 'Unknown Branch''
          };
        });

        // ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô Cache
        appCache.branches = branches;
        appCache.lastUpdate.branches = Date.now();
        
        console.log('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏Ç‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', branches.length, '‡∏™‡∏≤‡∏Ç‡∏≤');'
        console.log('üìÑ Raw API Response:', json);'
        console.log('üè¢ Processed branches:', branches);'
        return branches;
        
      } catch (err) {
        console.error('‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏Ç‡∏≤‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:', err);'
        console.error('‚ùå Error details:', err.message, err.stack);'
        showNotification('‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏Ç‡∏≤‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + err.message, 'error');'
        appCache.branches = [];
        return [];
      }
    }

    // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û
    async function onRoleChange(roleId) {
      selectedRole = roleId;
      console.log('üîÑ onRoleChange called with roleId:', roleId);'
      
      // ‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏à‡∏≤‡∏Å Cache
      const role = appCache.roles?.find(r => r._id === roleId);
      if (!role) {
        console.error('‚ùå Role not found in cache:', roleId);'
        return;
      }
      
      console.log('‚úÖ Found role:', role.name);'

      const pagesDiv = document.getElementById('pagesDiv');'
      const checkinBranchesDiv = document.getElementById('checkinBranchesDiv');'
      const defaultDiv = document.getElementById('defaultBranchDiv');'
      const checkinBranchContainer = document.getElementById('checkinBranchCheckboxes');'
      const defaultContainer = document.getElementById('defaultBranchCheckboxes');'

      console.log('üìã Elements found:', {'
        pagesDiv: !!pagesDiv,
        checkinBranchesDiv: !!checkinBranchesDiv,
        defaultDiv: !!defaultDiv,
        checkinBranchContainer: !!checkinBranchContainer,
        defaultContainer: !!defaultContainer
      });
      
      // Debug: ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ class ‡∏Ç‡∏≠‡∏á elements
      if (checkinBranchesDiv) {
        console.log('üîç checkinBranchesDiv classes:', checkinBranchesDiv.className);'
        console.log('üîç checkinBranchesDiv has hidden class:', checkinBranchesDiv.classList.contains('hidden'));'
      }
      if (defaultDiv) {
        console.log('üîç defaultDiv classes:', defaultDiv.className);'
        console.log('üîç defaultDiv has hidden class:', defaultDiv.classList.contains('hidden'));'
      }

      // reset & show all
      pagesDiv?.classList.remove('hidden');'
      checkinBranchesDiv?.classList.remove('hidden');'
      defaultDiv?.classList.remove('hidden');'
      
      // Debug: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å remove hidden
      console.log('üîÑ After removing hidden class:');'
      if (checkinBranchesDiv) {
        console.log('üîç checkinBranchesDiv classes after:', checkinBranchesDiv.className);'
        console.log('üîç checkinBranchesDiv visible:', !checkinBranchesDiv.classList.contains('hidden'));'
      }
      
      if (checkinBranchContainer) checkinBranchContainer.innerHTML = '';'
      if (defaultContainer) defaultContainer.innerHTML = '';'

      // admin hides all branch selections
      const isAdmin = role.name.toLowerCase() === 'admin';'
      console.log('üë§ Role name:', role.name);'
      console.log('üë§ Role name lowercase:', role.name.toLowerCase());'
      console.log('üë§ Is Admin:', isAdmin);'
      
      if (isAdmin) {
        pagesDiv?.classList.add('hidden');'
        checkinBranchesDiv?.classList.add('hidden');'
        defaultDiv?.classList.add('hidden');'
        console.log('üîí Hidden all sections for Admin');'
        return;
      }
      
      console.log('üìã Not admin, showing branch sections...');'

      // ‡πÅ‡∏™‡∏î‡∏á loading ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏Ç‡∏≤
      if (checkinBranchContainer) checkinBranchContainer.innerHTML = '<p class="text-gray-400 p-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏Ç‡∏≤...</p>';'
      if (defaultContainer) defaultContainer.innerHTML = '<p class="text-gray-400 p-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏Ç‡∏≤...</p>';'

      try {
        console.log('üîÑ Loading branches...');'
        // ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        const branches = await loadBranches();
        console.log('‚úÖ Loaded branches:', branches.length, 'branches');'
        
        if (checkinBranchContainer) checkinBranchContainer.innerHTML = '';'
        if (defaultContainer) defaultContainer.innerHTML = '';'

        if (branches.length === 0) {
          console.log('‚ö†Ô∏è No branches found, creating test data...');'
          // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö
          const testBranches = [
            { id: 'test1', name: '‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà', code: 'HQ' },'
            { id: 'test2', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà', code: 'HDY' },'
            { id: 'test3', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ', code: 'PTN' }'
          ];
          
          if (checkinBranchContainer) {
            checkinBranchContainer.innerHTML = '<p class="text-yellow-600 p-2 mb-2">‚ö†Ô∏è ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö (API ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤)</p>';'
            testBranches.forEach(b => {
              const div = document.createElement('div');'
              div.className = 'checkbox-container';'
              const cb = document.createElement('input');'
              cb.type = 'checkbox';'
              cb.name = 'checkinBranches';'
              cb.value = b.id;
              cb.id = `checkin_branch_${b.id}`;
              cb.className = 'checkbox checkbox-sm';'
              const lbl = document.createElement('label');'
              lbl.htmlFor = cb.id;
              lbl.textContent = b.name;
              div.append(cb, lbl);
              checkinBranchContainer.append(div);
            });
          }
          
          if (defaultContainer) {
            defaultContainer.innerHTML = '<p class="text-yellow-600 p-2 mb-2">‚ö†Ô∏è ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö</p>';'
            testBranches.forEach(b => {
              const div = document.createElement('div');'
              div.className = 'checkbox-container';'
              const cb = document.createElement('input');'
              cb.type = 'checkbox';'
              cb.name = 'defaultBranches';'
              cb.value = b.id;
              cb.id = `def_branch_${b.id}`;
              cb.className = 'checkbox checkbox-sm';'
              const lbl = document.createElement('label');'
              lbl.htmlFor = cb.id;
              lbl.textContent = b.name;
              div.append(cb, lbl);
              defaultContainer.append(div);
            });
          }
          return;
        }

        branches.forEach(b => {
          // checkinBranches checkbox (‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô)
          const div1 = document.createElement('div');'
          div1.className = 'checkbox-container';'
          const cb1 = document.createElement('input');'
          cb1.type = 'checkbox';'
          cb1.name = 'checkinBranches';'
          cb1.value = b.id;
          cb1.id = `checkin_branch_${b.id}`;
          cb1.className = 'checkbox checkbox-sm';'
          const lbl1 = document.createElement('label');'
          lbl1.htmlFor = cb1.id;
          lbl1.textContent = b.name;
          div1.append(cb1, lbl1);
          if (checkinBranchContainer) checkinBranchContainer.append(div1);

          // defaultBranch checkbox
          const div2 = document.createElement('div');'
          div2.className = 'checkbox-container';'
          const cb2 = document.createElement('input');'
          cb2.type = 'checkbox';'
          cb2.name = 'defaultBranches';'
          cb2.value = b.id;
          cb2.id = `def_branch_${b.id}`;
          cb2.className = 'checkbox checkbox-sm';'
          const lbl2 = document.createElement('label');'
          lbl2.htmlFor = cb2.id;
          lbl2.textContent = b.name;
          div2.append(cb2, lbl2);
          if (defaultContainer) defaultContainer.append(div2);
        });
        
        console.log('‚úÖ Successfully populated branch checkboxes');'
      } catch (error) {
        console.error('‚ùå Error in onRoleChange:', error);'
        if (checkinBranchContainer) checkinBranchContainer.innerHTML = '<p class="text-red-600 p-2">‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏Ç‡∏≤‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</p>';'
        if (defaultContainer) defaultContainer.innerHTML = '<p class="text-red-600 p-2">‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏Ç‡∏≤‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</p>';'
      }
    }
    
    // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û
    async function onEditRoleChange(roleId) {
      selectedRole = roleId;
      
      // ‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏à‡∏≤‡∏Å Cache
      const role = appCache.roles?.find(r => r._id === roleId);
      if (!role) {
        console.error('Role not found in cache:', roleId);'
        return;
      }

      const pagesDiv = document.getElementById('editPagesDiv');'
      const checkinBranchesDiv = document.getElementById('editCheckinBranchesDiv');'
      const checkinBranchContainer = document.getElementById('editCheckinBranchCheckboxes');'

      // reset & show all (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö element ‡∏Å‡πà‡∏≠‡∏ô)
      if (pagesDiv) pagesDiv.classList.remove('hidden');'
      if (checkinBranchesDiv) checkinBranchesDiv.classList.remove('hidden');'
      if (checkinBranchContainer) checkinBranchContainer.innerHTML = '';'

      // admin hides all branch selections
      const isAdmin = role.name.toLowerCase() === 'admin';'
      if (isAdmin) {
        if (pagesDiv) pagesDiv.classList.add('hidden');'
        if (checkinBranchesDiv) checkinBranchesDiv.classList.add('hidden');'
        return;
      }

      // ‡πÅ‡∏™‡∏î‡∏á loading ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏Ç‡∏≤
      if (checkinBranchContainer) checkinBranchContainer.innerHTML = '<p class="text-gray-400 p-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏Ç‡∏≤...</p>';'

      try {
        // ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        const branches = await loadBranches();
        
        if (checkinBranchContainer) checkinBranchContainer.innerHTML = '';'

        branches.forEach(b => {
          // editCheckinBranches (‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô)
          if (checkinBranchContainer) {
            const div1 = document.createElement('div');'
            div1.className = 'checkbox-container';'
            const cb1 = document.createElement('input');'
            cb1.type = 'checkbox';'
            cb1.name = 'editCheckinBranches';'
            cb1.value = b.id;
            cb1.id = `edit_checkin_branch_${b.id}`;
            cb1.className = 'checkbox checkbox-sm';'
            const lbl1 = document.createElement('label');'
            lbl1.htmlFor = cb1.id;
            lbl1.textContent = b.name;
            div1.append(cb1, lbl1);
            checkinBranchContainer.append(div1);
          }
        });
      } catch (error) {
        if (checkinBranchContainer) checkinBranchContainer.innerHTML = '<p class="text-red-600 p-2">‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏Ç‡∏≤‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</p>';'
      }
    }

    // ‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏° - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
    document.getElementById('registerForm').addEventListener('submit', async ev => {'
      ev.preventDefault();
      
      const submitBtn = ev.target.querySelector('button[type="submit"]');'
      const originalBtnText = submitBtn.innerHTML;
      
      try {
        // Disable submit button ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á loading
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...';'
        
        const isVirtual = document.getElementById('isVirtualEmployee').checked;'
        let employeeId = null;
        
        if (isVirtual) {
          // ‡∏™‡∏£‡πâ‡∏≤‡∏á Virtual Employee ‡∏Å‡πà‡∏≠‡∏ô
          const virtualData = {
            name: document.getElementById('virtualName').value.trim(),'
            email: document.getElementById('virtualEmail').value.trim(),'
            position: document.getElementById('virtualPosition').value.trim() || 'CEO','
            department: document.getElementById('virtualDepartment').value.trim() || 'Management','
            phone: document.getElementById('virtualPhone').value.trim()'
          };
          
          // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
          if (!virtualData.name || !virtualData.email) {
            throw new Error('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©');'
          }
          
          // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailRegex.test(virtualData.email)) {
            throw new Error('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');'
          }
          
          // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
          const profileFile = document.getElementById('virtualProfileImage').files[0];'
          
          showNotification('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©...', 'info');'
          employeeId = await createVirtualEmployee(virtualData, profileFile);
          
        } else {
          // ‡πÉ‡∏ä‡πâ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
          const formData = new FormData(ev.target);
          employeeId = formData.get('employee');'
          
          if (!employeeId) {
            throw new Error('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô');'
          }
        }
        
        // Get selected role
        const selectedRoleInput = document.querySelector('input[name="role"]:checked');'
        if (!selectedRoleInput) {
          throw new Error('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó');'
        }
        
        const rid = selectedRoleInput.value;
        const role = appCache.roles?.find(r => r._id === rid);
        if (!role) {
          throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å');'
        }

        let allowedPages = [], allowedBranches = [], checkinBranches = [];

        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Admin ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤
        const isAdmin = role.name.toLowerCase() === 'admin';'
        if (isAdmin) {
          allowedPages = ['*'];'
          const branches = await loadBranches();
          allowedBranches = branches.map(b => b.id);
          // Admin ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤
          checkinBranches = branches.map(b => b.id);
        } else {
          // user ‡∏õ‡∏Å‡∏ï‡∏¥
          document.querySelectorAll('input[name="allowedPages"]:checked')'
            .forEach(cb => allowedPages.push(cb.value));
          document.querySelectorAll('input[name="checkinBranches"]:checked')'
            .forEach(cb => {
              checkinBranches.push(cb.value);
              allowedBranches.push(cb.value); // ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
            });
          
          // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
          if (checkinBranches.length === 0) {
            throw new Error('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏™‡∏≤‡∏Ç‡∏≤');'
          }
        }

        // checkinBranches ‡∏ñ‡∏π‡∏Å‡πÄ‡∏ã‡πá‡∏ï‡πÅ‡∏•‡πâ‡∏ß‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô
        // ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏Ç‡∏≤‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô defaultBranch
        const defaultBranch = checkinBranches[0] || null;

        const formData = new FormData(ev.target);
        const payload = {
          employee: employeeId,
          username: formData.get('username').trim(),'
          password: formData.get('password'),'
          role: rid,
          allowedPages,
          allowedBranches,
          checkinBranches,
          defaultBranch
        };

        // Debug log ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á
        console.log('üìù Payload to send:', {'
          employee: employeeId,
          username: payload.username,
          role: rid,
          roleName: role.name,
          isAdmin: isAdmin,
          allowedPages: allowedPages.length,
          allowedPagesData: allowedPages,
          allowedBranches: allowedBranches.length,
          allowedBranchesIds: allowedBranches,
          checkinBranches: checkinBranches.length,
          checkinBranchesIds: checkinBranches,
          defaultBranch: defaultBranch
        });

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
        if (!payload.username) {
          throw new Error('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ');'
        }
        if (!payload.password) {
          throw new Error('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô');'
        }

        showNotification('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ...', 'info');'

        const res = await fetch(API_ENDPOINTS.userRegister, {
          method: 'POST','
          headers: {
            'Content-Type': 'application/json','
            'Authorization': 'Bearer ' + token'
          },
          body: JSON.stringify(payload)
        });

        // ‡∏ñ‡πâ‡∏≤ status ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà 2xx ‡πÉ‡∏´‡πâ‡∏î‡∏π error page ‡∏Å‡πà‡∏≠‡∏ô
        if (!res.ok) {
          const errData = await res.text();
          console.error('Register API error:', errData);'
          throw new Error(`‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (HTTP ${res.status})`);
        }

        // ‡πÅ‡∏Ñ‡πà status OK ‡∏à‡∏∂‡∏á parse JSON
        const result = await res.json();
        if (!result.success) {
          throw new Error(result.error || result.message || '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');'
        }

        // ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
        showNotification('‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');'
        resetForm();
        
        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà
        await loadUsers();
        
      } catch (err) {
        console.error('Registration error:', err);'
        showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message, 'error');'
      } finally {
        // Enable submit button
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalBtnText;
      }
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Reset Form
    function resetForm() {
      const form = document.getElementById('registerForm');'
      form.reset();
      
      // Reset UI states
      document.getElementById('isVirtualEmployee').checked = false;'
      document.getElementById('employeeSelectDiv').classList.remove('hidden');'
      document.getElementById('virtualEmployeeFields').classList.add('hidden');'
      document.getElementById('employeeSelect').setAttribute('required', 'required');'
      document.getElementById('virtualName').removeAttribute('required');'
      document.getElementById('virtualEmail').removeAttribute('required');'
      
      // Reset ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û Virtual Employee
      document.getElementById('virtualProfileImage').value = '';'
      document.getElementById('virtualProfilePreview').src = 'https://via.placeholder.com/150/e2e8f0/64748b?text=Profile';'
      
      // Reset sections - ‡πÑ‡∏°‡πà‡∏ã‡πà‡∏≠‡∏ô UI ‡∏™‡∏≤‡∏Ç‡∏≤ ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÅ‡∏Ñ‡πà‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
      document.getElementById('pagesDiv').classList.add('hidden');'
      
      // Uncheck all checkboxes and radios
      document.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach(input => {'
        input.checked = false;
      });
      
      selectedRole = null;
    }
    
    // ‡πÄ‡∏õ‡∏¥‡∏î Modal ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    async function openEditModal(userId) {
      document.getElementById('editUserId').value = userId;'
      
      // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      try {
        const res = await fetch(`${API_ENDPOINTS.userGet}/${userId}`, { // ‡πÉ‡∏ä‡πâ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
          headers: { 'Authorization': 'Bearer ' + token }'
        });
        
        if (!res.ok) throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ');'
        
        const userData = await res.json();
        
        if (!userData.success) throw new Error(userData.message || '‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');'
        
        const user = userData.data;
        
        // Debug log ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤
        console.log('üîç Edit Modal - User data:', {'
          username: user.username,
          checkinBranches: user.checkinBranches,
          allowedBranches: user.allowedBranches,
          defaultBranches: user.defaultBranches,
          role: user.role
        });
        
        // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
        document.getElementById('editUsername').value = user.username;'
        
        // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        if (user.employee && user.employee._id) {
          document.getElementById('editEmployeeSelect').value = user.employee._id;'
        } else if (user.employee) {
          document.getElementById('editEmployeeSelect').value = user.employee;'
        }
        
        // ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏™‡∏°‡∏≠ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)
        document.getElementById('editPassword').value = '';'
        
        // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ user.role._id)
        if (user.role && user.role._id) {
          const roleRadio = document.querySelector(`input[name="editRole"][value="${user.role._id}"]`);
          if (roleRadio) {
            roleRadio.checked = true;
            onEditRoleChange(user.role._id);
          }
        }
        
        // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        const statusActive = document.querySelector('input[name="status"][value="active"]');'
        const statusInactive = document.querySelector('input[name="status"][value="inactive"]');'
        
        if (!user.isBlocked) {
          statusActive.checked = true;
        } else {
          statusInactive.checked = true;
        }
        
        // ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏Ç‡∏≤‡∏•‡∏á‡πÉ‡∏ô Edit Modal ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à
        await loadBranchesIntoEditModal();
        
        // ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏°‡∏î‡∏π‡∏•‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô
        setTimeout(() => {
          // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á (‡∏à‡∏≤‡∏Å role.allowedPages)
          if (user.role?.allowedPages) {
            user.role.allowedPages.forEach(page => {
              const pageCheckbox = document.querySelector(`input[name="editAllowedPages"][value="${page}"]`);
              if (pageCheckbox) pageCheckbox.checked = true;
            });
          }
          
          // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô (‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô)
          if (user.checkinBranches && user.checkinBranches.length > 0) {
            user.checkinBranches.forEach(branch => {
              const branchId = branch._id || branch;
              const checkinBranchCheckbox = document.querySelector(`input[name="editCheckinBranches"][value="${branchId}"]`);
              if (checkinBranchCheckbox) {
                checkinBranchCheckbox.checked = true;
                console.log('‚úÖ Selected checkinBranch:', branchId);'
              }
            });
          } else if (user.allowedBranches && user.allowedBranches.length > 0) {
            // fallback ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ checkinBranches ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ allowedBranches
            user.allowedBranches.forEach(branch => {
              const branchId = branch._id || branch;
              const checkinBranchCheckbox = document.querySelector(`input[name="editCheckinBranches"][value="${branchId}"]`);
              if (checkinBranchCheckbox) {
                checkinBranchCheckbox.checked = true;
                console.log('‚úÖ Selected allowedBranch (fallback):', branchId);'
              }
            });
          } else {
            console.log('‚ö†Ô∏è No branches found for user');'
          }
          

        }, 500);
        
      } catch (err) {
        console.error(err);
        showNotification('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: ' + err.message, 'error');'
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        const currentEmployeeName = document.getElementById('currentEmployeeName');'
        const currentUsername = document.getElementById('currentUsername');'
        const currentRole = document.getElementById('currentRole');'
        const currentPages = document.getElementById('currentPages');'
        const currentBranches = document.getElementById('currentBranches');'
        
        const errorText = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ';'
        if (currentEmployeeName) currentEmployeeName.textContent = errorText;
        if (currentUsername) currentUsername.textContent = errorText;
        if (currentRole) currentRole.textContent = errorText;
        if (currentPages) currentPages.textContent = errorText;
        if (currentBranches) currentBranches.textContent = errorText;
      }
      
      // ‡πÄ‡∏õ‡∏¥‡∏î Modal
      document.getElementById('edit-user-modal').checked = true;'
    }
    
    // ‡∏õ‡∏¥‡∏î Modal ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    function closeEditModal() {
      document.getElementById('edit-user-modal').checked = false;'
      
      // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
      document.getElementById('editUserForm').reset();'
      document.getElementById('editPassword').value = '';'
      
      // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ï‡πà‡∏≤‡∏á‡πÜ
      const currentEmployeeName = document.getElementById('currentEmployeeName');'
      const currentUsername = document.getElementById('currentUsername');'
      const currentRole = document.getElementById('currentRole');'
      const currentPages = document.getElementById('currentPages');'
      const currentBranches = document.getElementById('currentBranches');'
      
      if (currentEmployeeName) currentEmployeeName.textContent = '-';'
      if (currentUsername) currentUsername.textContent = '-';'
      if (currentRole) currentRole.textContent = '-';'
      if (currentPages) currentPages.textContent = '-';'
      if (currentBranches) currentBranches.textContent = '-';'
      
      // ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å checkbox ‡πÅ‡∏•‡∏∞ radio
      document.querySelectorAll('#editUserForm input[type="checkbox"], #editUserForm input[type="radio"]').forEach(input => {'
        input.checked = false;
      });
    }
    
    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    async function saveUserEdit() {
      const userId = document.getElementById('editUserId').value;'
      
      // Get selected role
      const selectedRoleInput = document.querySelector('input[name="editRole"]:checked');'
      if (!selectedRoleInput) {
        showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó', 'warning');'
        return;
      }
      
      const rid = selectedRoleInput.value;
      const role = appCache.roles?.find(r => r._id === rid);
      const isAdmin = role?.name.toLowerCase() === 'admin';'
      let allowedBranches = [], defaultBranches = [];

      if (isAdmin) {
        const branches = await loadBranches();
        allowedBranches = branches.map(b => b.id);
        defaultBranches = branches.map(b => b.id);
      } else {
        // Get selected checkin branches (‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô)
        document.querySelectorAll('input[name="editCheckinBranches"]:checked').forEach(cb => {'
          allowedBranches.push(cb.value);
          defaultBranches.push(cb.value); // ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
        });
        

      }
      
      const username = document.getElementById('editUsername').value.trim();'
      const password = document.getElementById('editPassword').value.trim();'
      const active = document.querySelector('input[name="status"]:checked').value === 'active';'
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
      if (!username) {
        showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', 'warning');'
        return;
      }
      
      // ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (allowedPages)
      const allowedPages = [];
      document.querySelectorAll('input[name="editAllowedPages"]:checked').forEach(cb => {'
        allowedPages.push(cb.value);
      });
      
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á payload ‡∏ï‡∏≤‡∏° validation schema ‡∏Ç‡∏≠‡∏á API
      const payload = {
        username,
        role: rid,
        allowedPages,
        isBlocked: !active // ‡∏™‡πà‡∏á isBlocked ‡πÅ‡∏ó‡∏ô active (‡∏Å‡∏•‡∏±‡∏ö‡∏Ñ‡πà‡∏≤)
      };
      
      // ‡πÄ‡∏û‡∏¥‡πà‡∏° allowedBranches ‡πÅ‡∏•‡∏∞ defaultBranches ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      if (allowedBranches.length > 0) {
        payload.allowedBranches = allowedBranches;
        payload.defaultBranches = defaultBranches;
      }
      
              // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏Å
        if (password && password.length > 0) {
          payload.password = password;
          console.log('üîê Password will be updated');'
        } else {
          console.log('üîê Password will remain unchanged');'
        }
      
      console.log('üîÑ Updating user:', userId);'
      console.log('üì¶ Payload:', payload);'
      console.log('üìã Selected allowedPages:', allowedPages);'
      console.log('üè¢ Selected branches:', allowedBranches);'
      console.log('üåê API URL:', `${API_ENDPOINTS.userGet}/${userId}`);'
      
      try {
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡πà‡∏≠‡∏ô
        const res = await fetch(`${API_ENDPOINTS.userGet}/${userId}`, {
          method: 'PATCH','
          headers: {
            'Content-Type': 'application/json','
            'Authorization': 'Bearer ' + token'
          },
          body: JSON.stringify(payload)
        });
        
        if (!res.ok) {
          const errorText = await res.text();
          console.error('‚ùå Update User API Error:', errorText);'
          let errorMessage = `HTTP ${res.status}: ${res.statusText}`;
          
          // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏° parse JSON ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô JSON error response
          try {
            const errorData = JSON.parse(errorText);
            errorMessage = errorData.message || errorData.error || errorMessage;
          } catch (e) {
            // ‡∏ñ‡πâ‡∏≤ parse ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô HTML error page
            if (errorText.includes('<!DOCTYPE html>')) {'
              errorMessage = `‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ HTML Error Page (HTTP ${res.status})`;
            }
          }
          
          throw new Error(errorMessage);
        }

        const data = await res.json();
        
        if (!data.success) {
          throw new Error(data.message || data.error || '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');'
        }
        
        showNotification('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');'
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß
        if (password && password.length > 0) {
          showNotification('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß', 'info');'
        }
        
        closeEditModal();
        
        // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
        await loadUsers();
        
      } catch (err) {
        console.error(err);
        showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message, 'error');'
      }
    }
    
    // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    document.addEventListener('click', function(e) {'
      if (e.target.closest('.edit-user-btn')) {'
        const btn = e.target.closest('.edit-user-btn');'
        const userId = btn.getAttribute('data-user-id');'
        openEditModal(userId);
      }
    });
    
    // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (toggle switch)
    document.addEventListener('change', async function(e) {'
      if (e.target.classList.contains('status-toggle')) {'
        const toggle = e.target;
        const userId = toggle.getAttribute('data-user-id');'
        const isActive = toggle.checked;
        const toggleContainer = toggle.closest('.toggle-status');'
        const statusLabel = toggleContainer.querySelector('.status-label');'
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏° class loading ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
        toggleContainer.classList.add('loading');'
        
        try {
          console.log('üîÑ Updating user status:', { userId, isActive });'
          console.log('üì° API endpoint:', `${API_ENDPOINTS.userGet}/${userId}`);'
          
          // ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠ API ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (‡πÉ‡∏ä‡πâ PATCH ‡πÅ‡∏ó‡∏ô PUT)
          const res = await fetch(`${API_ENDPOINTS.userGet}/${userId}`, {
            method: 'PATCH','
            headers: {
              'Content-Type': 'application/json','
              'Authorization': 'Bearer ' + token'
            },
            body: JSON.stringify({
              isBlocked: !isActive // ‡∏™‡πà‡∏á isBlocked ‡πÅ‡∏ó‡∏ô active (‡∏Å‡∏•‡∏±‡∏ö‡∏Ñ‡πà‡∏≤)
            })
          });
          
          console.log('üì° Response status:', res.status);'
          
          if (!res.ok) {
            const errorText = await res.text();
            console.error('‚ùå API Error Response:', errorText);'
            throw new Error(`HTTP ${res.status}: ${res.statusText}`);
          }
          
          const data = await res.json();
          console.log('‚úÖ API Success Response:', data);'
          
          if (!data.success) {
            throw new Error(data.message || data.error || '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');'
          }
          
          // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
          if (isActive) {
            statusLabel.textContent = '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';'
            statusLabel.className = 'status-label ml-2 text-xs text-green-600';'
          } else {
            statusLabel.textContent = '‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';'
            statusLabel.className = 'status-label ml-2 text-xs text-gray-500';'
          }
          
          // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
          showNotification(
            `‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô "${isActive ? '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô'}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, '
            'success''
          );
          
        } catch (err) {
          console.error(err);
          
          // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏î‡∏¥‡∏°
          toggle.checked = !isActive;
          
          // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ toggle
          if (!isActive) {
            statusLabel.textContent = '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';'
            statusLabel.className = 'status-label ml-2 text-xs text-green-600';'
          } else {
            statusLabel.textContent = '‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';'
            statusLabel.className = 'status-label ml-2 text-xs text-gray-500';'
          }
          
          // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
          showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message, 'error');'
        } finally {
          // ‡∏•‡∏ö class loading ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
          toggleContainer.classList.remove('loading');'
        }
      }
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
    function showNotification(message, type = 'info') {'
      const container = document.getElementById('notification-container');'
      
      const notification = document.createElement('div');'
      
      // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
      let bgColor = 'bg-blue-500';'
      if (type === 'success') bgColor = 'bg-green-500';'
      if (type === 'error') bgColor = 'bg-red-500';'
      if (type === 'warning') bgColor = 'bg-yellow-500';'
      
      notification.className = `notification ${bgColor} px-4 py-2 rounded-lg shadow-lg`;
      
      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
      let icon = 'info-circle';'
      if (type === 'success') icon = 'check-circle';'
      if (type === 'error') icon = 'exclamation-circle';'
      if (type === 'warning') icon = 'exclamation-triangle';'
      
      notification.innerHTML = `
        <i class="fas fa-${icon} mr-2"></i>
        <span>${message}</span>
      `;
      
      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏•‡∏á‡πÉ‡∏ô container
      container.appendChild(notification);
      
      // ‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
      setTimeout(() => {
        notification.classList.add('hide');'
        
        // ‡∏•‡∏ö element ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ transition ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
        setTimeout(() => {
          notification.remove();
        }, 300);
      }, 3000);
    }

    // Fetch and populate the user table - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û
    async function loadUsers(forceRefresh = false) {
      const tbody = document.querySelector('#usersTable tbody');'
      
      try {
        // ‡πÅ‡∏™‡∏î‡∏á loading state
        tbody.innerHTML = '<tr><td colspan="8" class="text-center p-4"><i class="fas fa-spinner fa-spin mr-2"></i>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>';'
        
        const res = await fetch(API_ENDPOINTS.userGet, {
          headers: { 
            'Authorization': 'Bearer ' + token,'
            'Content-Type': 'application/json''
          }
        });
        
        if (!res.ok) {
          throw new Error(`HTTP ${res.status}: ${res.statusText}`);
        }
        
        const json = await res.json();
        if (!json.success) {
          throw new Error(json.error || json.message || '‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');'
        }

        // Debug log ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö API response
        console.log('üì° Users API Response:', json);'
        console.log('üìä Number of users:', json.data?.length || 0);'

        // Clear existing rows in the table
        tbody.innerHTML = '';'

        if (!json.data || json.data.length === 0) {
          tbody.innerHTML = '<tr><td colspan="8" class="text-center p-4 text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</td></tr>';'
          return;
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ñ‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û
        const fragment = document.createDocumentFragment();
        
        json.data.forEach(user => {
          // Debug log ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö
          console.log('üîç User data:', {'
            username: user.username,
            role: user.role?.name,
            roleAllowedPages: user.role?.allowedPages,
            checkinBranches: user.checkinBranches,
            allowedBranches: user.allowedBranches,
            defaultBranches: user.defaultBranches,
            checkinBranchesType: typeof user.checkinBranches,
            checkinBranchesLength: user.checkinBranches?.length,
            firstCheckinBranch: user.checkinBranches?.[0]
          });
          
          // ‡πÉ‡∏ä‡πâ checkinBranches ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ fallback ‡πÄ‡∏õ‡πá‡∏ô allowedBranches
          let branches = '-';'
          
          if (user.checkinBranches?.length) {
            branches = user.checkinBranches.map(b => {
              if (typeof b === 'string') {'
                return 'ID: ' + b; // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô string ID'
              }
              return b?.name || b?.branch_code || 'Unknown Branch';'
            }).join(', ');'
          } else if (user.allowedBranches?.length) {
            branches = user.allowedBranches.map(b => {
              if (typeof b === 'string') {'
                return 'ID: ' + b; // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô string ID'
              }
              return b?.name || b?.branch_code || 'Unknown Branch';'
            }).join(', ');'
                     } else if (user.defaultBranches?.length) {
             branches = user.defaultBranches.map(b => {
               if (typeof b === 'string') {'
                 return 'ID: ' + b; // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô string ID'
               }
               return b?.name || b?.branch_code || 'Unknown Branch';'
             }).join(', ');'
           }
           
           // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Admin ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏©
           if (user.role?.name?.toLowerCase() === 'admin') {'
             branches = 'üîë Admin (‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤)';'
           } else if (branches === '-') {'
             branches = '‚ö†Ô∏è ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏≤‡∏Ç‡∏≤';'
           }

          // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ (‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å role.allowedPages)
          let allowedSystems = '-';'
          const roleAllowedPages = user.role?.allowedPages || [];
          
          if (roleAllowedPages.length > 0) {
            const systemNames = roleAllowedPages.map(pageId => {
              const module = modules.find(m => m.id === pageId);
              return module ? module.name : pageId;
            });
            allowedSystems = systemNames.join(', ');'
          } else if (user.role?.name?.toLowerCase().includes('admin') || '
                     user.role?.name?.toLowerCase().includes('ceo') ||'
                     user.role?.name?.toLowerCase().includes('super') ||'
                     user.role?.name?.toLowerCase().includes('‡∏ô‡∏±‡∏Å‡∏û‡∏±‡∏í‡∏ô‡∏≤')) {'
            allowedSystems = 'üîë ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏ö‡∏ö';'
          } else {
            allowedSystems = '‚ö†Ô∏è ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏∞‡∏ö‡∏ö';'
          }

          const tr = document.createElement('tr');'
          tr.innerHTML = `
            <th>
              <label>
                <input type="checkbox" class="checkbox" data-user-id="${user._id}"/></label>
            </th>
            <td class="font-medium">${user.username || '-'}</td>'
            <td>${user.employee?.name || '-'}</td>'
            <td>
              <span class="badge badge-sm bg-primary text-white border-0 px-2">
                ${user.role?.name || 'No Role'}'
              </span>
            </td>
            <td class="text-sm">
              <div class="max-w-xs overflow-hidden">
                <div class="text-sm text-gray-800 dark:text-gray-200" title="${allowedSystems}">
                  ${allowedSystems}
                </div>
                ${roleAllowedPages.length ? 
                  `<div class="text-xs text-gray-500 mt-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${roleAllowedPages.length} ‡∏£‡∏∞‡∏ö‡∏ö</div>` : 
                  '''
                }
              </div>
            </td>
            <td class="text-sm">
              <div class="max-w-xs overflow-hidden">
                <div class="text-sm text-gray-800 dark:text-gray-200" title="${branches}">
                  ${branches}
                </div>
                ${user.checkinBranches?.length ? 
                  `<div class="text-xs text-gray-500 mt-1">‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô: ${user.checkinBranches.length} ‡∏™‡∏≤‡∏Ç‡∏≤</div>` : 
                  '''
                }
              </div>
            </td>
            <td>
              <div class="toggle-status">
                <input type="checkbox" class="toggle toggle-success toggle-sm status-toggle"
                       data-user-id="${user._id}" ${!user.isBlocked ? 'checked' : ''} />'
                <span class="status-label ml-2 text-xs ${!user.isBlocked ? 'text-green-600' : 'text-gray-500'}">'
                  ${!user.isBlocked ? '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‡∏£‡∏∞‡∏á‡∏±‡∏ö'}'
                </span>
              </div>
            </td>
            <td>
              <div class="flex gap-1">
                <button class="btn btn-ghost btn-xs text-blue-600 edit-user-btn hover:bg-blue-50" 
                        data-user-id="${user._id}" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-ghost btn-xs text-red-600 delete-user-btn hover:bg-red-50" 
                        data-user-id="${user._id}" title="‡∏•‡∏ö">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          `;
          fragment.appendChild(tr);
        });
        
        tbody.appendChild(fragment);

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
        updateUserStats(json.data.length);

      } catch (err) {
        console.error('Error loading users:', err);'
        tbody.innerHTML = '<tr><td colspan="8" class="text-center p-4 text-red-500"><i class="fas fa-exclamation-triangle mr-2"></i>‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</td></tr>';'
        showNotification('‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + err.message, 'error');'
      }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
    function updateUserStats(userCount) {
      const statsElement = document.querySelector('.stats-card h3');'
      if (statsElement) {
        statsElement.textContent = userCount.toString();
      }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏Ç‡∏≤‡∏•‡∏á‡πÉ‡∏ô Edit Modal
    async function loadBranchesIntoEditModal() {
      console.log('üîÑ Loading branches into Edit Modal...');'
      
      const editCheckinBranchContainer = document.getElementById('editCheckinBranchCheckboxes');'
      
      if (!editCheckinBranchContainer) {
        console.error('‚ùå Edit Branch container not found');'
        return;
      }
      
      // ‡πÅ‡∏™‡∏î‡∏á loading
      editCheckinBranchContainer.innerHTML = '<p class="text-gray-400 p-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏Ç‡∏≤...</p>';'
      
      try {
        const branches = await loadBranches();
        console.log('‚úÖ Branches loaded for Edit Modal:', branches.length);'
        
        // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå loading
        editCheckinBranchContainer.innerHTML = '';'
        
        // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏≠‡∏≠‡∏Å
        const uniqueBranches = branches.filter((branch, index, self) => 
          index === self.findIndex(b => b.id === branch.id)
        );
        
        if (uniqueBranches.length === 0) {
          // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö
          const testBranches = [
            { id: 'test1', name: '‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà', code: 'HQ' },'
            { id: 'test2', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà', code: 'HDY' },'
            { id: 'test3', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ', code: 'PTN' }'
          ];
          
          populateBranchUI(testBranches, editCheckinBranchContainer, true, true);
          return;
        }
        
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á UI ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏≤‡∏Ç‡∏≤‡∏à‡∏£‡∏¥‡∏á (edit mode)
        populateBranchUI(uniqueBranches, editCheckinBranchContainer, false, true);
        
        console.log('‚úÖ Successfully populated Edit Modal branch UI');'
        
      } catch (error) {
        console.error('‚ùå Error loading branches into Edit Modal:', error);'
        editCheckinBranchContainer.innerHTML = '<p class="text-red-600 p-2">‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏Ç‡∏≤‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</p>';'
      }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏Ç‡∏≤‡∏•‡∏á‡πÉ‡∏ô UI ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    async function loadBranchesIntoUI() {
      console.log('üîÑ Loading branches into UI...');'
      
      const checkinBranchContainer = document.getElementById('checkinBranchCheckboxes');'
      
      if (!checkinBranchContainer) {
        console.error('‚ùå Branch container not found');'
        return;
      }
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏ã‡πâ‡∏≥)
      if (checkinBranchContainer.children.length > 0 && 
          !checkinBranchContainer.innerHTML.includes('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î')) {'
        console.log('‚úÖ Branches already loaded, skipping...');'
        return;
      }
      
      // ‡πÅ‡∏™‡∏î‡∏á loading
      checkinBranchContainer.innerHTML = '<p class="text-gray-400 p-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏Ç‡∏≤...</p>';'
      
      try {
        const branches = await loadBranches();
        console.log('‚úÖ Branches loaded for UI:', branches.length);'
        console.log('üìÑ Branch data:', branches);'
        
        // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå loading
        checkinBranchContainer.innerHTML = '';'
        
        // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏≠‡∏≠‡∏Å (‡πÉ‡∏ä‡πâ id ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á)
        const uniqueBranches = branches.filter((branch, index, self) => 
          index === self.findIndex(b => b.id === branch.id)
        );
        
        console.log('üîç Unique branches:', uniqueBranches.length, 'from', branches.length);'
        
        if (uniqueBranches.length === 0) {
          console.log('‚ö†Ô∏è No branches found, creating test data...');'
          // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö
          const testBranches = [
            { id: 'test1', name: '‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà', code: 'HQ' },'
            { id: 'test2', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà', code: 'HDY' },'
            { id: 'test3', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ', code: 'PTN' }'
          ];
          
          populateBranchUI(testBranches, checkinBranchContainer, true);
          return;
        }
        
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á UI ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏≤‡∏Ç‡∏≤‡∏à‡∏£‡∏¥‡∏á
        populateBranchUI(uniqueBranches, checkinBranchContainer, false);
        
        console.log('‚úÖ Successfully populated branch UI');'
        
      } catch (error) {
        console.error('‚ùå Error loading branches into UI:', error);'
        checkinBranchContainer.innerHTML = '<p class="text-red-600 p-2">‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏Ç‡∏≤‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</p>';'
      }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á UI ‡∏™‡∏≤‡∏Ç‡∏≤ (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á register ‡πÅ‡∏•‡∏∞ edit)
    function populateBranchUI(branches, checkinContainer, isTestData = false, isEditMode = false) {
      if (isTestData) {
        checkinContainer.innerHTML = '<p class="text-yellow-600 p-2 mb-2">‚ö†Ô∏è ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö (API ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤)</p>';'
      }
      
      branches.forEach(b => {
        // checkinBranches checkbox
        const div = document.createElement('div');'
        div.className = 'checkbox-container';'
        const cb = document.createElement('input');'
        cb.type = 'checkbox';'
        cb.name = isEditMode ? 'editCheckinBranches' : 'checkinBranches';'
        cb.value = b.id;
        cb.id = isEditMode ? `edit_checkin_branch_${b.id}` : `checkin_branch_${b.id}`;
        cb.className = 'checkbox checkbox-sm';'
        const lbl = document.createElement('label');'
        lbl.htmlFor = cb.id;
        lbl.textContent = `${b.name}${b.code ? ` (${b.code})` : ''}`;'
        div.append(cb, lbl);
        checkinContainer.append(div);
      });
    }

     // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û
    async function deleteUser(userId) {
      // ‡πÉ‡∏ä‡πâ Sweet Alert ‡∏´‡∏£‡∏∑‡∏≠ Modal ‡πÅ‡∏ó‡∏ô confirm
      if (!confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ?\n\n‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ!')) {'
        return;
      }

      // ‡∏´‡∏≤‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á loading
      const deleteBtn = document.querySelector(`[data-user-id="${userId}"].delete-user-btn`);
      const originalBtnContent = deleteBtn?.innerHTML;

      try {
        // ‡πÅ‡∏™‡∏î‡∏á loading ‡∏ö‡∏ô‡∏õ‡∏∏‡πà‡∏°
        if (deleteBtn) {
          deleteBtn.disabled = true;
          deleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';'
        }

        const res = await fetch(`${API_ENDPOINTS.userGet}/${userId}`, {
          method: 'DELETE','
          headers: {
            'Authorization': 'Bearer ' + token,'
            'Content-Type': 'application/json''
          }
        });

        // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà 2xx ‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô text ‡πÄ‡∏û‡∏∑‡πà‡∏≠ debug HTML error page
        if (!res.ok) {
          const errData = await res.text();
          console.error('Delete API error:', errData);'
          throw new Error(`‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (HTTP ${res.status})`);
        }

        // ‡∏ñ‡πâ‡∏≤ OK ‡∏Ñ‡πà‡∏≠‡∏¢‡∏≠‡πà‡∏≤‡∏ô JSON
        const data = await res.json();
        if (!data.success) {
          throw new Error(data.message || '‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');'
        }

        showNotification('‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');'
        
        // ‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å DOM ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û)
        const userRow = deleteBtn?.closest('tr');'
        if (userRow) {
          userRow.style.transition = 'all 0.3s ease';'
          userRow.style.opacity = '0';'
          userRow.style.transform = 'translateX(-100%)';'
          
          setTimeout(() => {
            userRow.remove();
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
            const remainingRows = document.querySelectorAll('#usersTable tbody tr').length;'
            updateUserStats(remainingRows);
          }, 300);
        } else {
          // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÅ‡∏ñ‡∏ß ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà
          await loadUsers();
        }
        
      } catch (err) {
        console.error('Delete user error:', err);'
        showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message, 'error');'
      } finally {
        // ‡∏Ñ‡∏∑‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏∏‡πà‡∏°
        if (deleteBtn && originalBtnContent) {
          deleteBtn.disabled = false;
          deleteBtn.innerHTML = originalBtnContent;
        }
      }
    }

// ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö
document.addEventListener('click', function (e) {'
  if (e.target.closest('.delete-user-btn')) {'
    const btn = e.target.closest('.delete-user-btn');'
    const userId = btn.getAttribute('data-user-id');'
    deleteUser(userId);
  }
});



    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏¥‡∏î Modal ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    function closeEditModal() {
      // ‡∏õ‡∏¥‡∏î modal
      document.getElementById('edit-user-modal').checked = false;'
      
      // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
      document.getElementById('editUserForm').reset();'
      
      // ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å checkboxes ‡πÅ‡∏•‡∏∞ radios
      document.querySelectorAll('#editUserForm input[type="checkbox"], #editUserForm input[type="radio"]').forEach(input => {'
        input.checked = false;
      });
      
      // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô
      document.getElementById('editUserId').value = '';'
      document.getElementById('editPassword').value = '';'
    }

    // Initialize application
    document.addEventListener('DOMContentLoaded', async () => {'
      const pageLoaderId = LoadingSystem.show({
        message: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö...','
        showProgress: true,
        autoProgress: true,
        spinnerType: 'default''
      
      } catch (error) {
        console.error('Page loading error:', error);
      } finally {
        LoadingSystem.completeProgress();
      }});
      
      try {
  if (!token) {
    showNotification('‡πÑ‡∏°‡πà‡∏û‡∏ö Token ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà', 'error');'
    return;
  }
  
  try {
    showNotification('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö...', 'info');'
    
    // Load ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö parallel
    const loadPromises = [
      loadModules(),
      loadEmployees(),
      loadRoles(),
      loadBranches(),
      loadUsers()
    ];
    
    await Promise.all(loadPromises);
    
    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤‡∏•‡∏á‡πÉ‡∏ô UI ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    await loadBranchesIntoUI();
    
    showNotification('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô', 'success');'
    
  } catch (error) {
    console.error('Error during initialization:', error);'
    showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message, 'error');'
  }
});

  
}}</script>
</body>
</html>