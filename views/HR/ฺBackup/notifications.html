<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>ใบแจ้งเตือนของพนักงาน</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Favicon ต่างๆ -->
  <link rel="icon" href="/favicon/favicon.ico" type="image/x-icon" />
  <!-- Tailwind + DaisyUI -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class'
      theme: { extend: { fontFamily: { sans: ['Prompt','sans-serif'] } } },'
      daisyui: { themes: ['light','dark','corporate'] },'
    }
  </script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@2.51.5/dist/full.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />

  <style>
    .table th, .table td { white-space: nowrap; }
    .animate-fade-in {
        animation: fadeIn 0.5s ease-in-out;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body class="bg-white text-gray-700 dark:bg-gray-700 dark:text-gray-200">
  <!-- Toggle Sidebar Button -->
  <button id="btnToggleMenu" class="fixed left-0 top-1/2 bg-blue-600 text-white p-2 rounded-r-full shadow-lg z-50 hover:bg-blue-700">
    <i class="bi bi-chevron-left"></i>
  </button>

  <div class="min-h-screen flex">
    <!-- Sidebar -->
    <aside id="sidebar" class="w-64 bg-white dark:bg-gray-800 flex flex-col transition-all duration-300">
      <a href="hr_dashboard.html">
        <div class="p-4 border-b border-gray-200 dark:border-gray-700">
          <img src="/uploads/Logo2.png" alt="Logo" class="w-full h-auto"/>
        </div>
      </a>
      <div class="flex-1 p-4 overflow-y-auto">
        <ul class="flex flex-col w-full space-y-1">
          <li>
            <a href="HR_Dashboard" class="flex items-center h-12 px-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <i class="bi bi-speedometer2 text-xl text-indigo-600 dark:text-indigo-400"></i>
              <span class="ml-3">แดชบอร์ด</span>
            </a>
          </li>
          <li>
            <a href="employee_directory" class="flex items-center h-12 px-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <i class="bi bi-people-fill text-xl text-blue-500 dark:text-blue-400"></i>
              <span class="ml-3">พนักงาน</span>
            </a>
          </li>
          <li>
            <a href="attendance" class="flex items-center h-12 px-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <i class="bi bi-clock text-xl text-green-500 dark:text-green-400"></i>
              <span class="ml-3">บันทึกเวลาเข้า-ออก</span>
            </a>
          </li>
          <li>
            <a href="leave_requests" class="flex items-center h-12 px-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <i class="bi bi-file-earmark-text text-xl text-yellow-500 dark:text-yellow-300"></i>
              <span class="ml-3">การลา</span>
            </a>
          </li>
          <li>
            <a href="payroll" class="flex items-center h-12 px-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <i class="bi bi-cash-stack text-xl text-emerald-500 dark:text-emerald-400"></i>
              <span class="ml-3">เงินเดือน</span>
            </a>
          </li>
          <li>
            <a href="performance_reviews.html" class="flex items-center px-4 h-12 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <i class="bi bi-award text-xl text-purple-500 dark:text-purple-400"></i>
              <span class="ml-3">ประเมินผลงาน</span>
            </a>
          </li>
          <li>
            <a href="bonus_list" class="flex items-center px-4 h-12 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <i class="bi bi-gift text-xl text-pink-500 dark:text-pink-400 mr-3"></i>
              <span>รายการโบนัส</span>
            </a>
          </li>
          <!-- ทำหน้า notifications นี้เป็น active -->
          <li>
            <a href="notifications.html" class="flex items-center px-4 h-12 rounded-lg bg-gray-100 dark:bg-gray-700">
              <i class="bi bi-bell text-xl text-orange-500 dark:text-orange-400 mr-3"></i>
              <span>ใบแจ้งเตือน</span>
            </a>
          </li>
          <li class="mt-4">
            <a href="role_management" class="flex items-center h-12 px-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <i class="bi bi-gear text-xl text-gray-600 dark:text-gray-300"></i>
              <span class="ml-3">การตั้งค่า</span>
            </a>
          </li>
          <li class="mt-6">
            <button id="btnToggleDark" class="flex items-center h-12 px-4 rounded-lg w-full text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <i class="bi bi-moon text-xl text-slate-600 dark:text-slate-300"></i>
              <span class="ml-3" id="darkModeLabel">Dark Mode</span>
            </button>
          </li>
          <li>
            <button id="btnLogout" class="flex items-center h-12 px-4 rounded-lg w-full text-left text-red-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <i class="bi bi-box-arrow-right text-xl"></i>
              <span class="ml-3">ออกจากระบบ</span>
            </button>
          </li>
          <li>
            <div id="profile" class="flex items-center h-12 px-4 rounded-lg bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700">
              <img id="employeePhoto" src="/api/placeholder/36/36" alt="Employee Photo" class="w-10 h-10 rounded-full mr-3"/>
              <span id="employeeName">Loading...</span>
            </div>
          </li>
        </ul>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-6 bg-gray-50 dark:bg-gray-800 overflow-y-auto">
      <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
        <h1 class="text-2xl font-bold text-gray-800 dark:text-white">ใบแจ้งเตือนของพนักงาน</h1>
        <!-- ปุ่มเพิ่มใบแจ้งเตือน -->
        <button id="btnAddNotification" class="btn btn-secondary">
          <i class="bi bi-bell-fill mr-2"></i> เพิ่มใบแจ้งเตือน
        </button>
      </div>

      <!-- Notifications Table -->
      <div class="bg-white dark:bg-gray-900 shadow rounded-lg overflow-x-auto">
        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
          <h2 class="text-xl font-semibold text-gray-800 dark:text-gray-100">ใบแจ้งเตือน</h2>
        </div>
        <table class="table w-full">
          <thead class="bg-gray-100 dark:bg-gray-800">
            <tr>
              <th class="px-4 py-3 bg-white dark:bg-gray-900 ">วันที่</th>
              <th class="px-4 py-3 bg-white dark:bg-gray-900 ">พนักงาน</th>
              <th class="px-4 py-3 bg-white dark:bg-gray-900 ">ประเภท</th>
              <th class="px-4 py-3 bg-white dark:bg-gray-900 ">หัวข้อ</th>
              <th class="px-4 py-3 bg-white dark:bg-gray-900 ">รายละเอียด</th>
              <th class="px-4 py-3 bg-white dark:bg-gray-900 ">ค่าปรับ</th>
              <th class="px-4 py-3 bg-white dark:bg-gray-900 text-center">จัดการ</th>
            </tr>
          </thead>
          <tbody id="notificationTableBody">
            <tr><td colspan="7" class="text-center p-4">กำลังโหลดข้อมูลใบแจ้งเตือน...</td></tr>
          </tbody>
        </table>
        <div id="notificationEmptyState" class="hidden p-8 text-center">
          <i class="bi bi-bell-slash text-5xl text-gray-400 mb-4"></i>
          <h3 class="text-lg font-medium">ไม่พบข้อมูลใบแจ้งเตือน</h3>
        </div>
      </div>
    </main>
  </div>

  <!-- Modal for Adding/Viewing Notification -->
  <div id="notificationModal" class="modal">
    <div class="modal-box bg-white dark:bg-gray-800">
      <h3 class="font-bold text-lg mb-4 text-gray-800 dark:text-gray-100" id="notificationModalTitle">เพิ่มใบแจ้งเตือน</h3>
      <button class="btn btn-sm btn-circle absolute right-2 top-2" id="closeNotificationModal">✕</button>
      
      <form id="notificationForm" class="mt-4">
        <input type="hidden" id="notificationId" value="">
        
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1 text-gray-800 dark:text-gray-100" for="notificationEmployeeSelect">
            พนักงาน <span class="text-red-500">*</span>
          </label>
          <select id="notificationEmployeeSelect" class="select select-bordered w-full bg-white dark:bg-gray-900" required>
            <option value="">เลือกพนักงาน</option>
            <!-- Options will be filled by JS -->
          </select>
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1 text-gray-800 dark:text-gray-100" for="notificationType">
            ประเภทการแจ้งเตือน <span class="text-red-500">*</span>
          </label>
          <select id="notificationType" class="select select-bordered w-full bg-white dark:bg-gray-900" required>
            <option value="">เลือกประเภท</option>
            <option value="เตือนการลา">เตือนการลา</option>
            <option value="เตือนการมาสาย">เตือนการมาสาย</option>
            <option value="เตือนพฤติกรรม">เตือนพฤติกรรม</option>
            <option value="เตือนผลงาน">เตือนผลงาน</option>
            <option value="อื่นๆ">อื่นๆ</option>
          </select>
        </div>

        <div class="mb-4">
          <label for="notificationTitle" class="block text-sm font-medium mb-1">
            หัวข้อ <span class="text-red-500">*</span>
          </label>
          <input id="notificationTitle" type="text" class="input input-bordered w-full" required>
        </div>

        <div class="mb-4">
          <label for="notificationDate" class="block text-sm font-medium mb-1">
            วันที่แจ้งเตือน <span class="text-red-500">*</span>
          </label>
          <input id="notificationDate" type="date" class="input input-bordered w-full" required>
        </div>

        <div class="mb-4">
          <label for="notificationDetail" class="block text-sm font-medium mb-1">
            รายละเอียด <span class="text-red-500">*</span>
          </label>
          <textarea id="notificationDetail" rows="4" class="textarea textarea-bordered w-full" required></textarea>
        </div>

        <!-- แสดง/ซ่อนเมื่อเลือกประเภทเป็น "เตือนพฤติกรรม" -->
        <div class="mb-4" id="levelGroup" style="display:none">
          <label for="notificationLevel">ระดับเตือน</label>
          <input id="notificationLevel" type="number" min="1" max="3" class="input input-bordered w-full">
        </div>

        <div class="mb-4">
          <label for="notificationFine">ค่าปรับ (ถ้ามี)</label>
          <input id="notificationFine" type="number" min="0" class="input input-bordered w-full" value="0">
        </div>

        <div class="mb-4">
          <label for="notificationActionNeeded">การดำเนินการ</label>
          <input id="notificationActionNeeded" type="text" class="input input-bordered w-full">
        </div>

        <div class="mb-4">
          <label for="notificationDepartment">ฝ่าย</label>
          <input id="notificationDepartment" type="text" class="input input-bordered w-full" value="HR">
        </div>
        
        <div class="flex justify-end space-x-3">
          <button type="button" class="btn btn-outline" id="btnCancelNotification">ยกเลิก</button>
          <button type="submit" class="btn btn-primary">บันทึกใบแจ้งเตือน</button>
        </div>
      </form>
    </div>
  </div>

<script>
  const API_BASE = '/api';'
  const token    = localStorage.getItem('authToken');'
  let currentUser, allEmployees = [], allEmployeeNotifications = [];

  // ช่วยแปลง URL รูปพนักงาน
  function resolvePhotoUrl(raw) {
    if (!raw) return '/api/placeholder/36/36';'
    if (/^https?:\/\//.test(raw)) return raw;
    if (raw.startsWith('/uploads/employees/')) return raw;'
    if (raw.startsWith('/uploads/')) return raw.replace(/^\/uploads\//, '/uploads/employees/');'
    return `/uploads/employees/${raw}`;
  }

  // ดึงข้อมูลโปรไฟล์ผู้ใช้ → อัปเดต sidebar
  async function fetchUserProfile() {
    const res  = await fetch(`${API_BASE}/users/me`, {
      headers: { 'Authorization': `Bearer ${token}` }'
    });
    const json = await res.json();
    if (!res.ok || !json.success) throw new Error(json.message||res.status);
    currentUser = json.data;
    document.getElementById('employeeName').textContent = currentUser.name;'
    document.getElementById('employeePhoto').src      = resolvePhotoUrl(currentUser.photoUrl);'
    localStorage.setItem('userInfo', JSON.stringify({'
      name: currentUser.name,
      photoUrl: currentUser.photoUrl
    }));
  }

  document.addEventListener('DOMContentLoaded', async () => {'
    if (!token) return window.location.href = '/login';'
    checkDarkMode();
    setupEventListeners();
    await fetchUserProfile();             // ← โหลดโปรไฟล์ก่อน
    await fetchEmployees();               // ← หลังมี currentUser
    await fetchEmployeeNotifications();
  });

  function setupEventListeners() {
    document.getElementById('btnToggleMenu')?.addEventListener('click', toggleSidebar);'
    document.getElementById('btnToggleDark')?.addEventListener('click', toggleDarkMode);'
    document.getElementById('btnLogout')?.addEventListener('click', () => logoutUser());'

    document.getElementById('btnAddNotification')?.addEventListener('click', openAddNotificationModal);'
    document.getElementById('closeNotificationModal')?.addEventListener('click', closeNotificationModal);'
    document.getElementById('btnCancelNotification')?.addEventListener('click', closeNotificationModal);'
    document.getElementById('notificationForm')?.addEventListener('submit', handleNotificationFormSubmit);'

    document.getElementById('notificationType')?.addEventListener('change', e => {'
      const show = (e.target.value === 'เตือนพฤติกรรม');'
      document.getElementById('levelGroup').style.display = show ? 'block' : 'none';'
    });

    // Action ในตาราง
    document.getElementById('notificationTableBody').addEventListener('click', event => {'
      const btn = event.target.closest('button[data-action]');'
      if (!btn) return;
      const action = btn.dataset.action;
      const id = btn.dataset.id;
      if (action === 'view-notification') {'
        openViewNotificationModal(id);
      } else if (action === 'delete-notification') {'
        deleteNotification(id);
      }
    });
  }

  async function fetchEmployees() {
    try {
      const res = await fetch(`${API_BASE}/users`, {
        headers: {
          'Content-Type': 'application/json','
          'Authorization': `Bearer ${token}`'
        }
      });
      const json = await res.json();
      if (!json.success) throw new Error(json.error || 'Failed to load users');'
      allEmployees = json.data.map(u => ({
        id: u._id,
        name: u.employee?.name || u.name || 'N/A','
        position: u.employee?.position || '''
      }));
      populateEmployeeSelect();
    } catch (err) {
      console.error('fetchEmployees error:', err);'
    }
  }

  function populateEmployeeSelect() {
    const select = document.getElementById('notificationEmployeeSelect');'
    if (!select) return;

    while (select.options.length > 1) {
      select.remove(1);
    }
    allEmployees.forEach(emp => {
      const option = document.createElement('option');'
      option.value = emp.id;
      option.textContent = `${emp.name} (${emp.position})`;
      select.appendChild(option);
    });
  }

  async function fetchEmployeeNotifications() {
    try {
      const res = await fetch(`${API_BASE}/notifications`, {
        headers: {
          'Content-Type': 'application/json','
          'Authorization': `Bearer ${token}`'
        }
      });
      const result = await res.json();
      if (!result.success) throw new Error(result.error);
      
      // จัดรูปแบบข้อมูล
      allEmployeeNotifications = result.data.map(n => {
        // หาชื่อพนักงาน (เผื่อ populated)
        const rawUser = n.user;
        const userId = (typeof rawUser === 'object' && (rawUser._id || rawUser.id))'
                       ? (rawUser._id || rawUser.id)
                       : rawUser;
        const emp = allEmployees.find(e => e.id === userId);
        return {
          ...n,
          employeeName: emp ? emp.name : 'N/A''
        };
      });
      renderEmployeeNotifications(allEmployeeNotifications);
    } catch (err) {
      console.error('Fetch notifications error:', err);'
    }
  }

  function renderEmployeeNotifications(data) {
    const tbody = document.getElementById('notificationTableBody');'
    const emptyState = document.getElementById('notificationEmptyState');'
    tbody.innerHTML = '';'
    if (!data || !data.length) {
      emptyState.classList.remove('hidden');'
      return;
    }
    emptyState.classList.add('hidden');'
    data.forEach(n => {
      const tr = document.createElement('tr');'
      tr.className = "hover:bg-gray-50 dark:hover:bg-gray-700 animate-fade-in";
      tr.innerHTML = `
        <td class="px-4 py-3 bg-white dark:bg-gray-900">${formatDate(n.date)}</td>
        <td class="px-4 py-3 bg-white dark:bg-gray-900">${n.employeeName}</td>
        <td class="px-4 py-3 bg-white dark:bg-gray-900">${n.type}</td>
        <td class="px-4 py-3 bg-white dark:bg-gray-900">${n.title || '-'}</td>'
        <td class="px-4 py-3 bg-white dark:bg-gray-900 truncate max-w-xs" title="${n.message}">
          ${n.message}
        </td>
        <td class="px-4 py-3 bg-white dark:bg-gray-900 text-center">
          ${n.fine ? '฿' + n.fine : '-'}'
        </td>
        <td class="px-4 py-3 bg-white dark:bg-gray-900 text-center">
          <button data-action="view-notification" data-id="${n._id}" class="btn btn-ghost btn-xs text-info">
            <i class="bi bi-eye"></i>
          </button>
          <button data-action="delete-notification" data-id="${n._id}" class="btn btn-ghost btn-xs text-error">
            <i class="bi bi-trash"></i>
          </button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  function formatDate(dateStr) {
    if (!dateStr) return 'N/A';'
    try {
      return new Date(dateStr).toLocaleDateString('th-TH', {'
        day: '2-digit', month: '2-digit', year: 'numeric''
      });
    } catch {
      return 'N/A';'
    }
  }

  function openAddNotificationModal() {
    document.getElementById('notificationModalTitle').textContent = 'เพิ่มใบแจ้งเตือน';'
    document.getElementById('notificationId').value = '';'
    document.getElementById('notificationEmployeeSelect').value = '';'
    document.getElementById('notificationType').value = '';'
    document.getElementById('notificationDate').value = new Date().toISOString().split('T')[0];'
    document.getElementById('notificationDetail').value = '';'
    document.getElementById('notificationTitle').value = '';'
    document.getElementById('notificationLevel').value = '';'
    document.getElementById('notificationFine').value = '0';'
    document.getElementById('notificationActionNeeded').value = '';'
    document.getElementById('notificationDepartment').value = 'HR';'
    document.getElementById('levelGroup').style.display = 'none';'

    // เปิด modal
    document.getElementById('notificationModal').classList.add('modal-open');'
  }

   async function openViewNotificationModal(notificationId) {
    try {
      const res = await fetch(`${API_BASE}/notifications/${notificationId}`, {
        headers: { 'Authorization': `Bearer ${token}` }'
      });
      const json = await res.json();
      if (!json.success) throw new Error(json.error);
      const n = json.data;

      // สกัดเอา userId ให้ตรงกับค่าใน <option>
      const rawUser = n.user;
      const userId = (typeof rawUser === 'object' && (rawUser._id || rawUser.id))'
                     ? (rawUser._id || rawUser.id)
                     : rawUser;

      document.getElementById('notificationModalTitle').textContent = 'รายละเอียดใบแจ้งเตือน';'
      document.getElementById('notificationId').value = notificationId;'
      // ใส่ userId ลงไป
      document.getElementById('notificationEmployeeSelect').value = userId;'
      document.getElementById('notificationType').value = n.type;'
      document.getElementById('notificationDate').value = (n.date || '').split('T')[0];'
      document.getElementById('notificationDetail').value = n.message;'
      document.getElementById('notificationTitle').value = n.title || '';'
      document.getElementById('notificationLevel').value = n.level || '';'
      document.getElementById('notificationFine').value = n.fine || '0';'
      document.getElementById('notificationActionNeeded').value = n.actionNeeded || '';'
      document.getElementById('notificationDepartment').value = n.department || 'HR';'
      document.getElementById('levelGroup').style.display = (n.type === 'เตือนพฤติกรรม') ? 'block' : 'none';'

      // โหมดอ่านอย่างเดียว
      disableNotificationForm(true);

      document.getElementById('notificationModal').classList.add('modal-open');'
    } catch (err) {
      console.error('openViewNotificationModal error:', err);'
      alert('ไม่สามารถโหลดข้อมูลได้: ' + err.message);'
    }
  }


  function disableNotificationForm(disabled) {
    [
      'notificationEmployeeSelect','notificationType','notificationDate','
      'notificationDetail','notificationTitle','notificationLevel','
      'notificationFine','notificationActionNeeded','notificationDepartment''
    ].forEach(id => {
      document.getElementById(id).disabled = disabled;
    });
    document.getElementById('notificationForm').querySelector('button[type="submit"]').style.display = disabled ? 'none' : 'block';'
  }

  function closeNotificationModal() {
    // กลับสู่โหมดแก้ไขได้
    disableNotificationForm(false);
    document.getElementById('notificationModal').classList.remove('modal-open');'
  }

  async function handleNotificationFormSubmit(e) {
    e.preventDefault();
    const payload = {
      user: document.getElementById('notificationEmployeeSelect').value,'
      type: document.getElementById('notificationType').value,'
      title: document.getElementById('notificationTitle').value,'
      message: document.getElementById('notificationDetail').value,'
      date: document.getElementById('notificationDate').value,'
      level: parseInt(document.getElementById('notificationLevel').value) || 0,'
      fine: parseInt(document.getElementById('notificationFine').value) || 0,'
      actionNeeded: document.getElementById('notificationActionNeeded').value,'
      department: document.getElementById('notificationDepartment').value'
    };
    const id = document.getElementById('notificationId').value;'
    const url = id ? `${API_BASE}/notifications/${id}` : `${API_BASE}/notifications`;
    const method = id ? 'PATCH' : 'POST';'

    try {
      const res = await fetch(url, {
        method,
        headers: {
          'Content-Type': 'application/json','
          'Authorization': `Bearer ${token}`'
        },
        body: JSON.stringify(payload)
      });
      const json = await res.json();
      if (!json.success) throw new Error(json.error);
      alert(id ? 'อัปเดตใบแจ้งเตือนเรียบร้อย' : 'เพิ่มใบแจ้งเตือนเรียบร้อย');'
      closeNotificationModal();
      await fetchEmployeeNotifications();
    } catch (err) {
      console.error('notification submit error:', err);'
      alert('เกิดข้อผิดพลาด: ' + err.message);'
    }
  }

  async function deleteNotification(notificationId) {
    if (!confirm(`คุณต้องการลบใบแจ้งเตือน ID: ${notificationId} หรือไม่?`))
      return;
    try {
      const res = await fetch(`${API_BASE}/notifications/${notificationId}`, {
        method: 'DELETE','
        headers: { 'Authorization': `Bearer ${token}` }'
      });
      const json = await res.json();
      if (!json.success) throw new Error(json.error);
      alert('ลบใบแจ้งเตือนเรียบร้อยแล้ว');'
      await fetchEmployeeNotifications();
    } catch (err) {
      console.error('delete notification error:', err);'
      alert('ไม่สามารถลบได้: ' + err.message);'
    }
  }

  // --- ฟังก์ชัน Layout ทั่วไป ---
  function toggleSidebar() {
    document.getElementById('sidebar')?.classList.toggle('-ml-64');'
    const icon = document.querySelector('#btnToggleMenu i');'
    icon?.classList.toggle('bi-chevron-left');'
    icon?.classList.toggle('bi-chevron-right');'
  }

  function toggleDarkMode() {
    const isDark = document.documentElement.classList.toggle('dark');'
    localStorage.setItem('darkMode', isDark);'
    document.getElementById('darkModeLabel').textContent = isDark ? 'Light Mode' : 'Dark Mode';'
  }

  function checkDarkMode() {
    const isDark = localStorage.getItem('darkMode') === 'true';'
    document.documentElement.classList.toggle('dark', isDark);'
    const label = document.getElementById('darkModeLabel');'
    if (label) label.textContent = isDark ? 'Light Mode' : 'Dark Mode';'
  }

  function logoutUser() {
    localStorage.removeItem('authToken');'
    localStorage.removeItem('userId');'
    alert('ออกจากระบบแล้ว');'
    window.location.href = '/login';'
  }
</script>
</body>
</html>
