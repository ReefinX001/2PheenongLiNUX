<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</title>

  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.gstatic.com" />
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet" />

  <!-- Bootstrap CSS 5.3.2 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Prompt', 'sans-serif'],
          },
          colors: {
            primary: {
              50: '#f0f9ff',
              100: '#e0f2fe',
              500: '#0ea5e9',
              600: '#0284c7',
            }
          }
        },
      }
    }
  </script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow-x: hidden;
    }
    body {
      display: flex;
      flex-direction: column;
    }
    #mainContent {
      flex: 1;
    }
    
    body {
      font-family: 'Prompt', sans-serif;
      font-size: 0.875rem;
      background-color: #f8f9fa;
    }
    
    .breadcrumb-item {
      color: #6c757d;
    }
    
    .breadcrumb-item a {
      color: #0ea5e9;
      text-decoration: none;
    }
    
    .breadcrumb-item a:hover {
      text-decoration: underline;
    }
    
    .card {
      background-color: white;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }


    .form-control {
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 8px 12px;
      width: 100%;
    }


    .btn {
      border-radius: 4px;
      padding: 8px 16px;
      transition: all 0.2s;
    }

    .btn-rounded {
      border-radius: 30px;
    }

    .btn-outline-primary {
      border: 1px solid #0ea5e9;
      color: #0ea5e9;
      background-color: white;
    }

    .btn-outline-primary:hover {
      background-color: #f0f9ff;
    }



    .table {
      width: 100%;
      border-collapse: collapse;
    }

    .table th {
      background-color: #f8f9fa;
      text-align: left;
      padding: 10px;
      color: #6c757d;
      font-weight: 500;
      border-bottom: 1px solid #eee;
    }


    .table td {
      padding: 10px;
      border-bottom: 1px solid #eee;
      color: #333;
    }


    .text-right {
      text-align: right;
    }

    .page-link {
      min-width: 36px;
      height: 36px;
      border: 1px solid #ddd;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #555;
      text-decoration: none;
      margin: 0 2px;
    }


    .page-link:hover {
      background-color: #f9f9fb;
    }


    .page-link.active {
      background-color: #0ea5e9;
      color: white;
      border-color: #0ea5e9;
    }
    
    .account-list li {
      padding: 10px 15px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
    }
    }
    
    .account-list li:hover {
      background-color: #f9f9fb;
    }
    
    .account-list li.active {
      background-color: #f0f9ff;
      font-weight: 500;
    }
    }
    
    .date-range {
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      background-color: white;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .date-range:focus {
      border-color: #0ea5e9;
    }
    
    .negative-value {
      color: #ef4444;
    }
    }
    }
    
    .flex-1 {
      flex: 1;
    }
    
    .flex-none {
      flex: none;
    }
    
      transition: transform 0.5s, opacity 1s;
      transition: 0s;
    }
    
      padding: 0.5rem; /* From Tailwind: p-2 */
    
    
    
    
    /* User badge */
      border: 3px solid #f3f3f3;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      display: inline-block;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      margin-left: 20px;
      content: '';
      position: absolute;
      left: -15px;
    }
    
    /* Income Statement specific styles */
    .fin-statement-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
    }
    
    .fin-statement-table td {
      padding: 10px 16px;
      vertical-align: middle;
      border-bottom: 1px solid #e5e7eb;
    }
    
    .fin-statement-table .item-title {
      font-weight: 500;
    }
    
    .fin-statement-table .bold {
      font-weight: 600;
    }
    
    .fin-statement-table .section-header {
      font-weight: 600;
      font-size: 1.05rem;
    }
    
    .fin-statement-table .section-total {
      font-weight: 600;
      color: #1e40af;
    }
    
    .fin-statement-table .grand-total {
      font-weight: 700;
      color: #0284c7;
      background-color: #e0f2fe;
    }
    
    .fin-statement-table .indent-1 {
      padding-left: 2rem;
    }
    
    .fin-statement-table .indent-2 {
      padding-left: 3.5rem;
    }
    
    .overview-card {
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      background-color: white;
    }
    
    .overview-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    
    .metric-label {
      font-size: 0.875rem;
      font-weight: 500;
      color: #6b7280;
    }
    
    .metric-value {
      font-size: 1.5rem;
      font-weight: 600;
    }
    
    .trend-up {
      color: #10b981;
    }
    
    .trend-down {
      color: #f87171;
    }
    
    .chart-container {
      height: 300px;
      position: relative;
    }
    
    .view-switcher {
      display: flex;
      padding: 0.25rem;
      background-color: #f3f4f6;
      border-radius: 0.5rem;
    }
    
    .view-option {
      flex: 1;
      text-align: center;
      padding: 0.5rem 1rem;
      cursor: pointer;
      border-radius: 0.375rem;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .view-option.active {
      background-color: white;
      color: #0ea5e9;
    }
    
    .action-button {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 500;
      border-radius: 0.375rem;
      border: 1px solid #e5e7eb;
      background-color: white;
      color: #374151;
      transition: all 0.2s;
    }
    
    .action-button:hover {
      background-color: #f9fafb;
      border-color: #d1d5db;
    }
    
    .period-selector {
      background-color: white;
      font-size: 0.875rem;
      color: #374151;
      outline: none;
    }
    
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .dashboard-card {
      background-color: white;
      border-radius: 0.75rem;
      padding: 1.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }
    
      background-color: #1e293b;
    .dashboard-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    
    .card-title {
      color: #6b7280;
    
      color: #9ca3af;
    }
    
    .card-value {
      font-size: 1.5rem;
      font-weight: 600;
      color: #111827;
      margin-bottom: 0.5rem;
    }
    
      color: #f9fafb;
    }
    
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    
    .comparison-up {
      color: #10b981;
    .comparison-down {
      color: #ef4444;
    }
    
      color: #34d399;
    }
    
      color: #f87171;
    }
    
    /* Menu bar styles */
    .5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 1.5rem;
      overflow-x: auto;
    }
    
      display: flex;
      align-items: center;
      gap: 0.5rem;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }
    
      font-weight: 500;
    }
    
    .month-selector {
      border: 1px solid #e5e7eb;
      border-radius: 0.375rem;
      padding: 0.25rem 0.5rem;
      background-color: white;
      font-size: 0.875rem;
      outline: none;
    }
    
      background-color: #1f2937;
      border-color: #4b5563;
      color: #e5e7eb;
    }
    
      display: flex;
      background-color: #f3f4f6;
      border-radius: 0.5rem;
      margin-bottom: 1.5rem;
      padding: 0.25rem;
    }
    
    
    .toggle-btn {
      flex: 1;
      text-align: center;
      padding: 0.5rem 1rem;
      cursor: pointer;
      border-radius: 0.375rem;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    
    .toggle-btn.active {
      background-color: white;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    /* Financial table */
    .view-container {
      background-color: white;
      border-radius: 0.5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
      background-color: #1e293b;
    }
    
    .hidden {
      display: none;
    }
    
    .financial-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
    }
    
    .financial-table th {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid #e5e7eb;
    }
    
      background-color: #1f2937;
      color: #d1d5db;
      border-bottom-color: #4b5563;
    .financial-table td {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid #e5e7eb;
    }
    
      border-bottom-color: #4b5563;
    }
    
    .financial-table .section-header {
      font-weight: 600;
      background-color: #f3f4f6;
      color: #111827;
      padding: 0.75rem 1rem;
    }
    
      background-color: #374151;
      color: #f3f4f6;
    }
    
    .financial-table .subsection-header {
      font-weight: 500;
      color: #4b5563;
      padding: 0.75rem 1rem;
      background-color: #f9fafb;
    }
    
      background-color: #1f2937;
      color: #e5e7eb;
    }
    
    .financial-table .amount {
      text-align: right;
      position: relative;
    }
    
    .financial-table .indent-1 {
      padding-left: 2rem;
    }
    
    .financial-table .indent-2 {
      padding-left: 3.5rem;
    }
    
    .financial-table .total-row {
      background-color: #e0f2fe;
      font-weight: 600;
    }
    
      background-color: #0c4a6e;
    }
    
    .comparison-value {
      display: inline-block;
      margin-left: 0.5rem;
      font-size: 0.75rem;
      font-weight: normal;
    }

    @media (max-width: 768px) {
      .dashboard-cards {
        grid-template-columns: 1fr;
      }
      
      .financial-table {
        font-size: 0.875rem;
      }
      
      .card-value {
        font-size: 1.25rem;
      }
      
      .view-container {
        padding: 1rem;
      }
    }
    
    @media print {
      .display-toggle, .dashboard-cards {
        display: none;
      }
      
      .view-container {
        box-shadow: none;
        padding: 0;
      }
      
      body {
        font-size: 12pt;
      }
    }
    
    /* Thai Calendar Styles */
    .date-picker-container {
      position: relative;
      display: inline-block;
    }
    
    .date-picker-input {
      padding: 8px 12px;
      border: 1px solid #e5e7eb;
      border-radius: 4px;
      background-color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 220px;
    }
    
      background-color: #1f2937;
      border-color: #4b5563;
      color: #e5e7eb;
    }
    
    .thai-calendar {
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 4px;
      padding: 12px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 50;
      width: 280px;
      display: none;
    }
    
      background-color: #1e293b;
      border-color: #4b5563;
    }
    
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .month-year {
      font-weight: 500;
      font-size: 1.05rem;
    }
    
    .nav-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 16px;
      color: #6b7280;
      padding: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
    }
    
      color: #9ca3af;
    }
    
    .calendar-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      margin-bottom: 8px;
    }
    
    .day-name {
      text-align: center;
      font-weight: 500;
      color: #6b7280;
      font-size: 0.85rem;
      padding: 4px 0;
    }
    
      color: #9ca3af;
    }
    
    .calendar-dates {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
    }
    
    .date-cell {
      height: 36px;
      width: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s;
      margin: 1px;
    }
    
    .date-cell:hover:not(.disabled) {
      background-color: #f3f4f6;
      border-radius: 50%;
    }
    
      background-color: #374151;
    }
    
    .date-cell.disabled {
      color: #d1d5db;
      cursor: default;
      opacity: 0.4;
    }
    
      color: #6b7280;
    }
    
    .date-cell.selected {
      background-color: #0ea5e9;
      color: white;
      border-radius: 50%;
    }
    
    .date-cell.today {
      border: 2px solid #0ea5e9;
      border-radius: 50%;
      font-weight: 500;
    }
    
      border-color: #38bdf8;
    }

    /* Sales Dashboard Specific Styles - Moved from second head */
    /* Ensure no conflicts with existing styles, adjust as needed */
    /* body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); /* This might conflict with main body bg */
        /* min-height: 100vh; */ /* Already handled */
    /* } */

    .sales-dashboard-container { /* Renamed .container to avoid conflict */
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }

    .sales-dashboard-header { /* Renamed .header to avoid conflict */
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        text-align: center;
    }

        color: #f8f9fa;
    }

    .sales-dashboard-header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        font-weight: 700;
    }
        color: #e0f2fe;
    }

    .sales-dashboard-header p {
        font-size: 1.1rem;
    }
        color: #9ca3af;
    }

    .sales-dashboard-grid { /* Renamed .dashboard-grid to avoid conflict */
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
        margin-bottom: 30px;
    }

    .sales-dashboard-card { /* Renamed .card to avoid conflict with general .card */
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
    }
        border: 1px solid rgba(74, 85, 104, 0.2);
    }

    .sales-dashboard-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 30px 60px rgba(0, 0, 0, 0.15);
    }
        box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
    }

    .sales-dashboard-card h3 {
        /* color: #2d3748; */ /* Will inherit */
        margin-bottom: 20px;
        font-size: 1.3rem;
        font-weight: 600;
    }
        color: #e0f2fe;
    }

    .sales-metric-card { /* Renamed .metric-card to avoid conflict */
        text-align: center;
        padding: 20px; /* This is a sub-style of sales-dashboard-card */
    }

    .sales-metric-value { /* Renamed .metric-value to avoid conflict */
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 10px;
    }

    .sales-metric-label { /* Renamed .metric-label to avoid conflict */
        /* color: #718096; */ /* Will inherit */
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
        color: #9ca3af;
    }

    .growth-positive { color: #48bb78; }
    .growth-negative { color: #f56565; }
    .growth-neutral { color: #ed8936; }

    .sales-chart-container { /* Renamed .chart-container to avoid conflict */
        position: relative;
        height: 300px;
        margin-top: 15px;
    }

    .large-chart { height: 400px; }

    .sales-progress-bar { /* Renamed .progress-bar */
        background: #e2e8f0;
        border-radius: 10px;
        height: 12px;
        margin: 15px 0;
        overflow: hidden;
    }
        background: #4a5568;
    }

    .sales-progress-fill { /* Renamed .progress-fill */
        height: 100%;
        border-radius: 10px;
        transition: width 0.8s ease;
    }

    .target-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }

    .target-item {
        background: #f7fafc;
        padding: 20px;
        border-radius: 15px;
        border-left: 4px solid #4299e1;
    }
        background: #2d3748;
        border-left-color: #38bdf8;
    }

    .target-name {
        font-weight: 600;
        /* color: #2d3748; */ /* Will inherit */
        margin-bottom: 10px;
    }
        color: #e0f2fe;
    }

    .target-stats {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .target-value {
        font-size: 1.2rem;
        font-weight: 700;
    }

    .target-percentage {
        font-size: 0.9rem;
        padding: 4px 8px;
        border-radius: 20px;
        color: white;
    }

    .status-achieved { background: #48bb78; }
    .status-near { background: #ed8936; }
    .status-behind { background: #f56565; }

    .comparison-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    .comparison-table th,
    .comparison-table td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid #e2e8f0;
    }
        border-bottom-color: #4a5568;
    }

    .comparison-table th {
        background: #f7fafc;
        font-weight: 600;
        /* color: #2d3748; */ /* Will inherit */
    }
        background: #2d3748;
        color: #d1d5db;
    }

    .comparison-table tr:hover {
        background: #f7fafc;
    }
        background: #374151;
    }

    .branch-rank {
        display: inline-block;
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background: #4299e1;
        color: white;
        text-align: center;
        line-height: 25px;
        font-size: 0.8rem;
        font-weight: 600;
    }
        background: #38bdf8;
    }

    .rank-1 { background: #ffd700; color: #333; }
    .rank-2 { background: #c0c0c0; color: #333; }
    .rank-3 { background: #cd7f32; color: white; }

    .time-filter {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }

    .filter-btn {
        padding: 10px 20px;
        border: none;
        border-radius: 25px;
        background: rgba(255, 255, 255, 0.2);
        /* color: #2d3748; */ /* Will inherit */
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
    }
        background: rgba(45, 55, 72, 0.5);
        color: #d1d5db;
    }

    .filter-btn.active,
    .filter-btn:hover {
        background: #4299e1;
        color: white;
        transform: translateY(-2px);
    }
        background: #38bdf8;
        color: #1a202c;
    }

    .sales-summary-grid { /* Renamed .summary-grid to avoid conflict */
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    @media (max-width: 768px) {
        .sales-dashboard-header h1 {
            font-size: 2rem;
        }
        
        .sales-dashboard-grid { /* Adjusted for renamed class */
            grid-template-columns: 1fr;
        }
        
        .sales-dashboard-container { /* Adjusted for renamed class */
            padding: 15px;
        }
    }
    
    .loading-animation {
        opacity: 0;
        animation: fadeInUp 0.6s ease forwards;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

  </style>

  <!-- Template ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π -->

  <!-- Loading System -->
  <link rel="stylesheet" href="/css/loading-components.css">
  <script src="/js/loading-system.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <!-- Animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

  <!-- Lottie Animation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>

  <style>
    /* Loading Overlay Styles - Minimal CSS, use inline styles in HTML */
    .loading-overlay {
      transition: opacity 0.5s ease-out, visibility 0.5s ease-out !important;
    }

    .loading-overlay.animate__fadeOut {
      opacity: 0 !important;
      visibility: hidden !important;
      pointer-events: none !important;
    }

    .loading-overlay.hidden,
    .loading-overlay[style*="display: none"] {
      display: none !important;
      pointer-events: none !important;
      visibility: hidden !important;
    }
  </style>

  <!-- Account Menu Styles -->
  <link rel="stylesheet" href="/css/account-menu.css?v=light-v3">
</head>

<body class="bg-gray-50 w-full h-screen">
  <script>
    // Force remove dark mode
    document.documentElement.classList.remove('dark');
    document.body.classList.remove('dark');
    localStorage.removeItem('darkMode');
    localStorage.setItem('theme', 'light');
  </script>

  <!-- Loading Overlay with Lottie Animation -->
  <div id="loadingOverlay" class="loading-overlay"
       style="position: fixed; top: 0; left: 0; right: 0; bottom: 0;
              width: 100vw; height: 100vh;
              display: flex; justify-content: center; align-items: center;
              z-index: 999999; background: rgba(255, 255, 255, 0.98);
              backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);">
    <div style="display: flex; justify-content: center; align-items: center; flex-direction: column;">
      <div id="lottieContainer" style="width: 300px; height: 300px; margin: 0 auto;"></div>
    </div>
  </div>

  <div id="mainContent" class="container mx-auto px-4 py-6">
    <!-- Navbar -->
    <!-- Account System Navbar Template -->
<div class="navbar bg-white shadow-md sticky top-0">
  <div class="flex-1 flex items-center space-x-6">
    <img src="/uploads/Logo2.png"
         alt="Logo"
         class="rounded-full shadow-lg"
         style="width: 40px; height: 40px;" />
    <span class="text-lg font-semibold" id="pageTitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</span>
    <!-- Menu Container -->
    <div id="mainMenuContainer" class="ml-auto"></div>
  </div>
  <div class="flex-none flex items-center space-x-2">
    <!-- User Profile Section -->
    <div class="flex items-center space-x-3 mr-4">
      <img id="employeePhoto"
           alt="Profile"
           class="w-10 h-10 rounded-full border-2 border-gray-300"
           src="/img/default-avatar.svg">
      <span id="employeeName" class="text-sm font-medium text-gray-700">Loading...</span>
    </div>


    <!-- Logout Button -->
    <button id="btnLogout" class="btn btn-outline btn-primary btn-sm btn-rounded btn-fancy">
      <i class="bi bi-box-arrow-right mr-1"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
    </button>
  </div>
</div>


    <!-- Breadcrumb -->
    <div class="text-sm breadcrumbs py-4">
      <ul class="flex items-center space-x-2">
        <li><a href="/dashboard" class="text-primary-600 hover:underline">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a></li>
        <li class="flex items-center"><i class="bi bi-chevron-right text-gray-400 mx-1"></i> ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</li>
        <li class="flex items-center"><i class="bi bi-chevron-right text-gray-400 mx-1"></i> ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</li>
      </ul>
    </div>

    <!-- Sales Summary Report Section with Card -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4">
        <h2 class="text-2xl font-semibold text-gray-800">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</h2>

        <!-- Export Buttons -->
        <div class="flex flex-wrap gap-3">
          <button class="flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-200 shadow-sm">
            <i class="bi bi-file-earmark-excel text-green-600"></i> ‡∏ô‡∏≥‡∏≠‡∏≠‡∏Å Excel
          </button>
          <button class="flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-200 shadow-sm">
            <i class="bi bi-file-earmark-pdf text-red-600"></i> ‡∏ô‡∏≥‡∏≠‡∏≠‡∏Å PDF
          </button>
          <button class="flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-200 shadow-sm">
            <i class="bi bi-printer text-blue-600"></i> ‡∏û‡∏¥‡∏°‡∏û‡πå
          </button>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
        <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg p-4 text-white shadow-md">
          <div class="flex justify-between items-start">
            <div>
              <p class="text-sm opacity-80 font-medium">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>
              <p id="totalSales" class="text-2xl font-bold mt-1">‡∏ø0.00</p>
              <p class="text-sm mt-1 opacity-90">
                <span id="totalSalesTrend" class="text-white">-</span>
              </p>
            </div>
            <div class="bg-white bg-opacity-30 p-2 rounded-lg">
              <i class="bi bi-cash-stack text-xl"></i>
            </div>
          </div>
        </div>

        <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-lg p-4 text-white shadow-md">
          <div class="flex justify-between items-start">
            <div>
              <p class="text-sm opacity-80 font-medium">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏¥‡∏•‡∏Ç‡∏≤‡∏¢</p>
              <p id="totalInvoices" class="text-2xl font-bold mt-1">0 ‡∏ö‡∏¥‡∏•</p>
              <p class="text-sm mt-1 opacity-90">
                <span id="totalInvoicesTrend" class="text-white">-</span>
              </p>
            </div>
            <div class="bg-white bg-opacity-30 p-2 rounded-lg">
              <i class="bi bi-receipt text-xl"></i>
            </div>
          </div>
        </div>

        <div class="bg-gradient-to-r from-amber-500 to-amber-600 rounded-lg p-4 text-white shadow-md">
          <div class="flex justify-between items-start">
            <div>
              <p class="text-sm opacity-80 font-medium">‡∏¢‡∏≠‡∏î‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏ö‡∏¥‡∏•</p>
              <p id="avgPerInvoice" class="text-2xl font-bold mt-1">‡∏ø0.00</p>
              <p class="text-sm mt-1 opacity-90">
                <span id="avgPerInvoiceTrend" class="text-white">-</span>
              </p>
            </div>
            <div class="bg-white bg-opacity-30 p-2 rounded-lg">
              <i class="bi bi-calculator text-xl"></i>
            </div>
          </div>
        </div>

        <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg p-4 text-white shadow-md">
          <div class="flex justify-between items-start">
            <div>
              <p class="text-sm opacity-80 font-medium">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</p>
              <p id="totalItemsSold" class="text-2xl font-bold mt-1">0 ‡∏ä‡∏¥‡πâ‡∏ô</p>
              <p class="text-sm mt-1 opacity-90">
                <span id="totalItemsSoldTrend" class="text-white">-</span>
              </p>
            </div>
            <div class="bg-white bg-opacity-30 p-2 rounded-lg">
              <i class="bi bi-bullseye text-xl"></i>
            </div>
          </div>
        </div>
      </div>

        <!-- Time Filter -->
        <div class="sales-dashboard-card loading-animation" style="animation-delay: 0.2s;">
            <div class="time-filter">
                <button class="filter-btn active" onclick="updateChart('daily', this)">‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</button>
                <button class="filter-btn" onclick="updateChart('monthly', this)">‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
                <button class="filter-btn" onclick="updateChart('quarterly', this)">‡∏£‡∏≤‡∏¢‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™</button>
                <button class="filter-btn" onclick="updateChart('yearly', this)">‡∏£‡∏≤‡∏¢‡∏õ‡∏µ</button>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="sales-dashboard-grid loading-animation" style="animation-delay: 0.3s;">
            <!-- Sales Trend Chart -->
            <div class="sales-dashboard-card" style="grid-column: span 2;">
                <h3>üìà ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</h3>
                <div class="sales-chart-container large-chart">
                    <canvas id="salesTrendChart"></canvas>
                </div>
            </div>

            <!-- Product Sales Chart -->
            <div class="sales-dashboard-card">
                <h3>üõçÔ∏è ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                <div class="sales-chart-container">
                    <canvas id="productChart"></canvas>
                </div>
            </div>

            <!-- Branch Performance Chart -->
            <div class="sales-dashboard-card">
                <h3>üè™ ‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏™‡∏≤‡∏Ç‡∏≤</h3>
                <div class="sales-chart-container">
                    <canvas id="branchChart"></canvas>
                </div>
            </div>

            <!-- Goals Progress -->
            <div class="sales-dashboard-card" style="grid-column: span 2;">
                <h3>üéØ ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡∏™‡∏≤‡∏Ç‡∏≤</h3>
                <div id="branchTargetSection" class="target-section">
                    <!-- Data will be loaded from API -->
                    <p class="text-center text-gray-500 py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
                </div>
            </div>
        </div>

        <!-- Comparison Table -->
        <div class="sales-dashboard-card loading-animation" style="animation-delay: 0.4s;">
            <h3>üìã ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏™‡∏≤‡∏Ç‡∏≤</h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
                        <th>‡∏™‡∏≤‡∏Ç‡∏≤</th>
                        <th>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</th>
                        <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏¥‡∏•</th>
                        <th>‡∏¢‡∏≠‡∏î‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏ö‡∏¥‡∏•</th>
                        <th>‡∏†‡∏≤‡∏©‡∏µ</th>
                        <th>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</th>
                        <th>% ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</th>
                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                    </tr>
                </thead>
                <tbody id="branchComparisonTableBody">
                    <!-- Data will be loaded from API -->
                    <tr>
                        <td colspan="9" class="text-center text-gray-500 py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Tax and Discount Summary -->
        <div class="sales-dashboard-grid loading-animation" style="animation-delay: 0.5s;">
            <div class="sales-dashboard-card">
                <h3>üí∞ ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏©‡∏µ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</h3>
                <div class="sales-chart-container">
                    <canvas id="taxDiscountChart"></canvas>
                </div>
            </div>
            <div class="sales-dashboard-card">
                <h3>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</h3>
                <div id="salesSummarySection" style="padding: 20px 0;">
                    <!-- Data will be loaded from API -->
                    <p class="text-center text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
                </div>
            </div>
        </div>
      </div>
    </div>

    <script>
        // Initialize charts when page loads
        document.addEventListener('DOMContentLoaded', function() {
          try {
            const pageLoaderId = LoadingSystem.show({
              message: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö...',
              showProgress: true,
              autoProgress: true,
              spinnerType: 'default'
            });

            // Inject Main Menu
            const mainMenuTemplate = document.getElementById('mainMenuTemplate');
            const mainMenuContainer = document.getElementById('mainMenuContainer');
            if (mainMenuTemplate && mainMenuContainer) {
                const menuContent = mainMenuTemplate.content.cloneNode(true);
                mainMenuContainer.appendChild(menuContent);
            }

            createSalesTrendChart();
            createProductChart();
            createBranchChart();
            createTaxDiscountChart();
            animateProgressBars();
          } catch (error) {
            console.error('Page loading error:', error);
          } finally {
            LoadingSystem.completeProgress();
          }
        });

        function animateProgressBars() {
            const progressBars = document.querySelectorAll('.sales-progress-fill');
            progressBars.forEach((bar, index) => {
                setTimeout(() => {
                    const width = bar.style.width;
                    bar.style.width = '0%';
                    setTimeout(() => {
                        bar.style.width = width;
                    }, 100);
                }, index * 200);
            });
        }

        // Sample data for charts
        const salesData = {
            daily: {
                labels: ['‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏û‡∏∏‡∏ò', '‡∏û‡∏§‡∏´‡∏±‡∏™', '‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡πÄ‡∏™‡∏≤‡∏£‡πå', '‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå'],
                data: [320000, 285000, 350000, 420000, 380000, 450000, 390000]
            },
            monthly: {
                labels: ['‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.'],
                data: [2100000, 1950000, 2300000, 2450000, 2200000, 2450000]
            },
            quarterly: {
                labels: ['Q1 2024', 'Q2 2024', 'Q3 2024', 'Q4 2024'],
                data: [6350000, 7100000, 6800000, 7450000]
            },
            yearly: {
                labels: ['2021', '2022', '2023', '2024'],
                data: [18500000, 21200000, 24800000, 27700000]
            }
        };

        let salesTrendChart;

        function createSalesTrendChart() {
            const ctx = document.getElementById('salesTrendChart').getContext('2d');
            
            salesTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: salesData.monthly.labels,
                    datasets: [{
                        label: '‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)',
                        data: salesData.monthly.data,
                        borderColor: '#4299e1',
                        backgroundColor: 'rgba(66, 153, 225, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#4299e1',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '‡∏ø' + value.toLocaleString();
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    elements: {
                        point: {
                            hoverRadius: 8
                        }
                    }
                }
            });
        }

        function createProductChart() {
            const ctx = document.getElementById('productChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ A', '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ B', '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ C', '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ D', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'],
                    datasets: [{
                        data: [850000, 650000, 520000, 320000, 110000],
                        backgroundColor: [
                            '#4299e1',
                            '#48bb78',
                            '#ed8936',
                            '#9f7aea',
                            '#f56565'
                        ],
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        function createBranchChart() {
            const ctx = document.getElementById('branchChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û', '‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà', '‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà', '‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï'],
                    datasets: [{
                        label: '‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢',
                        data: [850000, 720000, 680000, 540000],
                        backgroundColor: [
                            '#48bb78',
                            '#ed8936',
                            '#ed8936',
                            '#f56565'
                        ],
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '‡∏ø' + value.toLocaleString();
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        function createTaxDiscountChart() {
            const ctx = document.getElementById('taxDiscountChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û', '‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà', '‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà', '‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï'],
                    datasets: [{
                        label: '‡∏†‡∏≤‡∏©‡∏µ',
                        data: [59500, 50400, 47600, 37800],
                        backgroundColor: '#4299e1',
                        borderRadius: 4
                    }, {
                        label: '‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î',
                        data: [42500, 36000, 34000, 27000],
                        backgroundColor: '#48bb78',
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '‡∏ø' + value.toLocaleString();
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        function updateChart(period, buttonElement) {
            // Update active button
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            if (buttonElement) {
                buttonElement.classList.add('active');
            }

            // Update chart data
            const newData = salesData[period];
            if (salesTrendChart && newData) {
                salesTrendChart.data.labels = newData.labels;
                salesTrendChart.data.datasets[0].data = newData.data;
                salesTrendChart.update('active');
            }
        }

        // ==================== Sales Summary Report API Integration ====================

        let allSalesData = [];
        let filteredSalesData = [];

        // Format currency
        function formatCurrency(num) {
            return new Intl.NumberFormat('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(num || 0);
        }

        // Format date to Thai format
        function formatDateTH(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = (date.getFullYear() + 543).toString().slice(-2);
            return `${day}/${month}/${year}`;
        }

        // Load sales data from API
        async function loadSalesData() {
            try {
                showLoadingSpinner();

                // Get current month range
                const today = new Date();
                const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
                const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);

                const startDate = firstDay.toISOString().split('T')[0];
                const endDate = lastDay.toISOString().split('T')[0];

                // Fetch cash sales data
                const response = await fetch(`/api/cash-sales?startDate=${startDate}&endDate=${endDate}&limit=1000`);
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
                }

                allSalesData = result.data || [];
                filteredSalesData = [...allSalesData];

                updateSummaryCards();
                updateBranchStats();
                hideLoadingSpinner();

            } catch (error) {
                console.error('Error loading sales data:', error);
                hideLoadingSpinner();
                showErrorMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message);
            }
        }

        // Update summary cards with real data
        function updateSummaryCards() {
            // Calculate totals
            const totalSales = filteredSalesData.reduce((sum, sale) => sum + (sale.totalAmount || 0), 0);
            const totalInvoices = filteredSalesData.length;
            const totalItems = filteredSalesData.reduce((sum, sale) => {
                return sum + (sale.items ? sale.items.reduce((itemSum, item) => itemSum + (item.quantity || 0), 0) : 0);
            }, 0);
            const avgPerInvoice = totalInvoices > 0 ? totalSales / totalInvoices : 0;

            // Update cards
            document.getElementById('totalSales').textContent = `‡∏ø${formatCurrency(totalSales)}`;
            document.getElementById('totalInvoices').textContent = `${totalInvoices.toLocaleString('th-TH')} ‡∏ö‡∏¥‡∏•`;
            document.getElementById('avgPerInvoice').textContent = `‡∏ø${formatCurrency(avgPerInvoice)}`;
            document.getElementById('totalItemsSold').textContent = `${totalItems.toLocaleString('th-TH')} ‡∏ä‡∏¥‡πâ‡∏ô`;
        }

        // Update branch stats and charts with real data
        function updateBranchStats() {
            // Group sales by branch
            const branchStats = {};

            filteredSalesData.forEach(sale => {
                const branchCode = sale.branchCode || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';

                if (!branchStats[branchCode]) {
                    branchStats[branchCode] = {
                        branchCode: branchCode,
                        totalSales: 0,
                        totalInvoices: 0,
                        totalItems: 0,
                        totalTax: 0,
                        totalDiscount: 0
                    };
                }

                branchStats[branchCode].totalSales += sale.totalAmount || 0;
                branchStats[branchCode].totalInvoices += 1;
                branchStats[branchCode].totalItems += sale.items ? sale.items.reduce((sum, item) => sum + (item.quantity || 0), 0) : 0;
                branchStats[branchCode].totalTax += sale.vatAmount || 0;
                branchStats[branchCode].totalDiscount += sale.discountAmount || 0;
            });

            // Convert to array and sort by totalSales
            const branchArray = Object.values(branchStats).sort((a, b) => b.totalSales - a.totalSales);

            // Update branch target section
            updateBranchTargetSection(branchArray);

            // Update comparison table
            updateBranchComparisonTable(branchArray);

            // Update branch chart
            updateBranchChartData(branchArray);

            // Update product chart
            updateProductChartData();

            // Update tax discount chart
            updateTaxDiscountChart();

            // Update sales summary section
            updateSalesSummarySection();
        }

        // Update branch target section
        function updateBranchTargetSection(branchArray) {
            const section = document.getElementById('branchTargetSection');

            if (branchArray.length === 0) {
                section.innerHTML = '<p class="text-center text-gray-500 py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤</p>';
                return;
            }

            const targetGoal = 800000; // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô

            section.innerHTML = branchArray.slice(0, 4).map(branch => {
                const percentage = (branch.totalSales / targetGoal * 100).toFixed(1);
                const isAchieved = percentage >= 100;
                const isNear = percentage >= 80 && percentage < 100;
                const statusClass = isAchieved ? 'status-achieved' : (isNear ? 'status-near' : 'status-behind');
                const statusText = isAchieved ? '‚úÖ ‡∏ö‡∏£‡∏£‡∏•‡∏∏‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢' : (isNear ? '‚ö†Ô∏è ‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢' : '‚ùå ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢');
                const progressWidth = Math.min(percentage, 100);
                const progressColor = isAchieved ? '#48bb78' : (isNear ? '#ed8936' : '#f56565');

                return `
                    <div class="target-item">
                        <div class="target-name">‡∏™‡∏≤‡∏Ç‡∏≤ ${branch.branchCode}</div>
                        <div class="target-stats">
                            <span class="target-value">‡∏ø${formatCurrency(branch.totalSales)}</span>
                            <span class="target-percentage ${statusClass}">${percentage}%</span>
                        </div>
                        <div class="sales-progress-bar">
                            <div class="sales-progress-fill" style="width: ${progressWidth}%; background: ${progressColor};"></div>
                        </div>
                        <small>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡∏ø${formatCurrency(targetGoal)} ‚Ä¢ ${statusText}</small>
                    </div>
                `;
            }).join('');
        }

        // Update branch comparison table
        function updateBranchComparisonTable(branchArray) {
            const tbody = document.getElementById('branchComparisonTableBody');

            if (branchArray.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" class="text-center text-gray-500 py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤</td></tr>';
                return;
            }

            const targetGoal = 800000;

            tbody.innerHTML = branchArray.map((branch, index) => {
                const avgPerInvoice = branch.totalInvoices > 0 ? branch.totalSales / branch.totalInvoices : 0;
                const percentage = (branch.totalSales / targetGoal * 100).toFixed(1);
                const isAchieved = percentage >= 100;
                const isNear = percentage >= 80 && percentage < 100;
                const statusClass = isAchieved ? 'status-achieved' : (isNear ? 'status-near' : 'status-behind');
                const statusText = isAchieved ? '‚úÖ ‡∏ö‡∏£‡∏£‡∏•‡∏∏‡πÄ‡∏õ‡πâ‡∏≤' : (isNear ? '‚ö†Ô∏è ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏õ‡πâ‡∏≤' : '‚ùå ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤');
                const rankClass = index < 3 ? `rank-${index + 1}` : '';

                return `
                    <tr>
                        <td><span class="branch-rank ${rankClass}">${index + 1}</span></td>
                        <td><strong>${branch.branchCode}</strong></td>
                        <td>‡∏ø${formatCurrency(branch.totalSales)}</td>
                        <td>${branch.totalInvoices.toLocaleString('th-TH')}</td>
                        <td>‡∏ø${formatCurrency(avgPerInvoice)}</td>
                        <td>‡∏ø${formatCurrency(branch.totalTax)}</td>
                        <td>‡∏ø${formatCurrency(branch.totalDiscount)}</td>
                        <td><span class="target-percentage ${statusClass}">${percentage}%</span></td>
                        <td>${statusText}</td>
                    </tr>
                `;
            }).join('');
        }

        // Update branch chart data
        function updateBranchChartData(branchArray) {
            const chart = Chart.getChart('branchChart');
            if (chart) {
                chart.data.labels = branchArray.slice(0, 5).map(b => b.branchCode);
                chart.data.datasets[0].data = branchArray.slice(0, 5).map(b => b.totalSales);
                chart.update();
            }
        }

        // Update product chart data
        function updateProductChartData() {
            // Group sales by product
            const productStats = {};

            filteredSalesData.forEach(sale => {
                if (sale.items) {
                    sale.items.forEach(item => {
                        const productName = item.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';

                        if (!productStats[productName]) {
                            productStats[productName] = {
                                name: productName,
                                quantity: 0,
                                totalAmount: 0
                            };
                        }

                        productStats[productName].quantity += item.quantity || 0;
                        productStats[productName].totalAmount += (item.price || 0) * (item.quantity || 0);
                    });
                }
            });

            // Convert to array and sort by totalAmount
            const productArray = Object.values(productStats).sort((a, b) => b.totalAmount - a.totalAmount);

            const chart = Chart.getChart('productChart');
            if (chart && productArray.length > 0) {
                chart.data.labels = productArray.slice(0, 5).map(p => p.name);
                chart.data.datasets[0].data = productArray.slice(0, 5).map(p => p.quantity);
                chart.update();
            }
        }

        // Update tax discount chart
        function updateTaxDiscountChart() {
            const branchStats = {};

            filteredSalesData.forEach(sale => {
                const branchCode = sale.branchCode || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';

                if (!branchStats[branchCode]) {
                    branchStats[branchCode] = {
                        branchCode: branchCode,
                        totalTax: 0,
                        totalDiscount: 0
                    };
                }

                branchStats[branchCode].totalTax += sale.vatAmount || 0;
                branchStats[branchCode].totalDiscount += sale.discountAmount || 0;
            });

            const branchArray = Object.values(branchStats).sort((a, b) => b.totalTax - a.totalTax);

            const chart = Chart.getChart('taxDiscountChart');
            if (chart && branchArray.length > 0) {
                chart.data.labels = branchArray.slice(0, 4).map(b => `‡∏™‡∏≤‡∏Ç‡∏≤ ${b.branchCode}`);
                chart.data.datasets[0].data = branchArray.slice(0, 4).map(b => b.totalTax);
                chart.data.datasets[1].data = branchArray.slice(0, 4).map(b => b.totalDiscount);
                chart.update();
            }
        }

        // Update sales summary section
        function updateSalesSummarySection() {
            const totalSales = filteredSalesData.reduce((sum, sale) => sum + (sale.totalAmount || 0), 0);
            const totalInvoices = filteredSalesData.length;

            const section = document.getElementById('salesSummarySection');

            section.innerHTML = `
                <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                    <span>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                    <span style="font-weight: 600;">‡∏ø${formatCurrency(totalSales)}</span>
                </div>
                <div class="sales-progress-bar">
                    <div class="sales-progress-fill" style="width: 100%; background: #4299e1;"></div>
                </div>

                <div style="display: flex; justify-content: space-between; margin-bottom: 15px; margin-top: 20px;">
                    <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏¥‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                    <span style="font-weight: 600;">${totalInvoices.toLocaleString('th-TH')} ‡∏ö‡∏¥‡∏•</span>
                </div>
                <div class="sales-progress-bar">
                    <div class="sales-progress-fill" style="width: 100%; background: #48bb78;"></div>
                </div>
            `;
        }

        // Show loading spinner
        function showLoadingSpinner() {
            const spinner = document.getElementById('loadingSpinner');
            if (spinner) spinner.classList.remove('hidden');
        }

        // Hide loading spinner
        function hideLoadingSpinner() {
            const spinner = document.getElementById('loadingSpinner');
            if (spinner) spinner.classList.add('hidden');
        }

        // Show error message
        function showErrorMessage(message) {
            alert(message);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Load sales data
            loadSalesData();

            // Initialize Lottie Animation for Page Loading
            const lottieContainer = document.getElementById('lottieContainer');
            const loadingOverlay = document.getElementById('loadingOverlay');
            let lottieAnimation;

            // Function to show page loading overlay
            window.showPageLoading = function() {
              if (loadingOverlay) {
                loadingOverlay.style.display = 'flex';
                loadingOverlay.style.opacity = '1';
                loadingOverlay.style.visibility = 'visible';
              }
            };

            // Function to hide page loading overlay
            window.hidePageLoading = function() {
              if (loadingOverlay) {
                loadingOverlay.style.opacity = '0';
                setTimeout(function() {
                  loadingOverlay.style.display = 'none';
                  loadingOverlay.style.visibility = 'hidden';
                }, 500);
              }
            };

            if (lottieContainer && typeof lottie !== 'undefined') {
              try {
                // Load Lottie animation
                lottieAnimation = lottie.loadAnimation({
                  container: lottieContainer,
                  renderer: 'svg',
                  loop: true,
                  autoplay: true,
                  path: '/Loading/Loading.json'
                });

                // Hide loading overlay after page loads
                window.addEventListener('load', function() {
                  setTimeout(hidePageLoading, 800);
                });
              } catch (error) {
                console.error('Error loading Lottie animation:', error);
                loadingOverlay.style.display = 'none';
              }
            } else {
              if (loadingOverlay) loadingOverlay.style.display = 'none';
            }

            // Show loading before page navigation
            window.addEventListener('beforeunload', function() {
              showPageLoading();
            });
        });
    </script>

    <!-- Bootstrap JS 5.3.2 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <!-- Account Menu Script -->
  <script src="/js/account-menu.js?v=light-v2"></script>
</body>
</html>