<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>รายงานงบการเงิน</title>

  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.gstatic.com" />
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet" />

  <!-- Bootstrap CSS 5.3.2 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />

  <!-- Required Libraries for Export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- Add Thai calendar locale -->
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.10.7/dayjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.10.7/locale/th.js"></script>

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Prompt', 'sans-serif'],
          },
          colors: {
            primary: {
              50: '#f0f9ff',
              100: '#e0f2fe',
              500: '#0ea5e9',
              600: '#0284c7',
            }
          }
        },
      }
    }
  </script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow-x: hidden;
    }
    body {
      display: flex;
      flex-direction: column;
    }
    #mainContent {
      flex: 1;
    }
    
    body {
      font-family: 'Prompt', sans-serif;
      font-size: 0.875rem;
      background-color: #f8f9fa;
    }

    .breadcrumb-item {
      color: #6c757d;
    }
    
    .breadcrumb-item a {
      color: #0ea5e9;
      text-decoration: none;
    }
    
    .breadcrumb-item a:hover {
      text-decoration: underline;
    }
    
    .card {
      background-color: white;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }


    .form-control {
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 8px 12px;
      width: 100%;
    }
    
      background-color: #2d3748;
      border-color: #4a5568;
      color: #f8f9fa;
    }
    
    .btn {
      border-radius: 4px;
      padding: 8px 16px;
      transition: all 0.2s;
    }
    
    .btn-rounded {
      border-radius: 30px;
    }
    
    .btn-outline-primary {
      border: 1px solid #0ea5e9;
      color: #0ea5e9;
      background-color: white;
    }
    
    .btn-outline-primary:hover {
      background-color: #f0f9ff;
    }
    
      color: #38bdf8;
      border-color: #38bdf8;
      background-color: transparent;
    }
    
      background-color: rgba(56, 189, 248, 0.1);
    }
    
    .table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .table th {
      background-color: #f8f9fa;
      text-align: left;
      padding: 10px;
      color: #6c757d;
      font-weight: 500;
      border-bottom: 1px solid #eee;
    }
    
      background-color: #2d3748;
      color: #d1d5db;
      border-bottom-color: #4a5568;
    }
    
    .table td {
      padding: 10px;
      border-bottom: 1px solid #eee;
      color: #333;
    }
    
      border-bottom-color: #4a5568;
      color: #f8f9fa;
    }
    
    .text-right {
      text-align: right;
    }
    
    .page-link {
      min-width: 36px;
      height: 36px;
      border: 1px solid #ddd;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #555;
      text-decoration: none;
      margin: 0 2px;
    }
    
      border-color: #4a5568;
      color: #d1d5db;
    }
    
    .page-link:hover {
      background-color: #f9f9fb;
    }
    
      background-color: #374151;
    }
    
    .page-link.active {
      background-color: #0ea5e9;
      color: white;
      border-color: #0ea5e9;
    }
    
      list-style: none;
      padding: 0;
      margin: 0;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .account-list li {
      padding: 10px 15px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
    }
    
      border-bottom-color: #4a5568;
    }
    
    .account-list li:hover {
      background-color: #f9f9fb;
    }
    
      background-color: #374151;
    }
    
    .account-list li.active {
      background-color: #f0f9ff;
      color: #0ea5e9;
      font-weight: 500;
    }
    
      background-color: #1a4971;
      color: #38bdf8;
    }
    
    .date-range {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
      background-color: white;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
      background-color: #2d3748;
      border-color: #4a5568;
      color: #f8f9fa;
    }
    
    .date-range:focus {
      border-color: #0ea5e9;
      outline: none;
    }
    
    .negative-value {
      color: #ef4444;
    }
    
      color: #f87171;
    }
    
    .5rem 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 30; /* Lowered z-index for navbar if menu dropdowns need to be higher */
    }
    
    }
    
    .flex-1 {
      flex: 1;
    }
    
    .flex-none {
      flex: none;
    }
    
    .01%);
      background-repeat: no-repeat;
      background-position: 50%;
      transform: scale(10, 10);
      opacity: 0;
      transition: transform 0.5s, opacity 1s;
    }
    
    .3;
      transition: 0s;
    }
    
    /* Dropdown menu styling */
    .5rem 1rem; /* Adjust as needed */
      cursor: pointer;
      align-items: center; /* Vertically align icon and text */
    }
    
    /* First Level Dropdown Panel */
    .1); /* From Tailwind: shadow-lg */
      border-radius: 0.375rem; /* From Tailwind: rounded-lg */
      min-width: 220px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(10px);
      transition: opacity 0.2s ease-out, visibility 0.2s ease-out, transform 0.2s ease-out;
      z-index: 40; /* Ensure dropdown is above other content but below higher-level modals if any */
      padding: 0.5rem; /* From Tailwind: p-2 */
    }
    
      left: 100%;
      /* Inherit background, shadow, radius, min-width, padding from first-level or define specifically */
      background: white; 
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      border-radius: 0.375rem;
      min-width: 220px; /* Or adjust as needed */
      opacity: 0;
      visibility: hidden;
      transform: translateX(10px); /* Fly-out from right */
      transition: opacity 0.2s ease-out, visibility 0.2s ease-out, transform 0.2s ease-out;
      z-index: 45; /* Higher than first-level dropdown */
      padding: 0.5rem;
    }
    
      color: #374151; /* Tailwind: text-gray-700 */
      text-decoration: none;
      border-radius: 0.25rem; /* Tailwind: rounded-md */
      white-space: nowrap; /* Prevent text wrapping in menu items */
    }
    
      border-left: 3px solid transparent;
      margin-bottom: 2px; /* Spacing between items */
    }
    
    .25rem; */ /* Original style, can be kept or removed */
    }
    
    /* User badge */
    .1);
      border-radius: 30px;
    }
    
      border: 3px solid #f3f3f3;
      border-top: 3px solid #0ea5e9;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      display: inline-block;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .expense-voucher {
      margin-left: 20px;
      position: relative;
    }
    
    .expense-voucher::before {
      content: '';
      position: absolute;
      left: -15px;
      top: 50%;
      width: 10px;
      height: 1px;
      background-color: #cbd5e0;
    }
    
      background-color: #4a5568;
    }
    
    /* Income Statement specific styles */
    .fin-statement-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
    }
    
    .fin-statement-table td {
      padding: 10px 16px;
      vertical-align: middle;
      border-bottom: 1px solid #e5e7eb;
    }
    
      border-bottom-color: #374151;
    }
    
    .fin-statement-table .item-title {
      font-weight: 500;
    }
    
    .fin-statement-table .bold {
      font-weight: 600;
    }
    
    .fin-statement-table .section-header {
      font-weight: 600;
      font-size: 1.05rem;
      color: #111827;
    }
    
      color: #f9fafb;
    }
    
    .fin-statement-table .section-total {
      font-weight: 600;
      color: #1e40af;
      background-color: #f0f9ff;
    }
    
      color: #93c5fd;
      background-color: #1e3a8a;
    }
    
    .fin-statement-table .grand-total {
      font-weight: 700;
      color: #0284c7;
      background-color: #e0f2fe;
      font-size: 1.05rem;
    }
    
      color: #38bdf8;
      background-color: #075985;
    }
    
    .fin-statement-table .indent-1 {
      padding-left: 2rem;
    }
    
    .fin-statement-table .indent-2 {
      padding-left: 3.5rem;
    }
    
    .overview-card {
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      background-color: white;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
      background-color: #1e293b;
    }
    
    .overview-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    
    .metric-label {
      font-size: 0.875rem;
      font-weight: 500;
      color: #6b7280;
      margin-bottom: 0.5rem;
    }
    
      color: #9ca3af;
    }
    
    .metric-value {
      font-size: 1.5rem;
      font-weight: 600;
      color: #111827;
    }
    
      color: #f9fafb;
    }
    
    .trend-up {
      color: #10b981;
    }
    
    .trend-down {
      color: #ef4444;
    }
    
      color: #34d399;
    }
    
      color: #f87171;
    }
    
    .chart-container {
      height: 300px;
      position: relative;
    }
    
    .view-switcher {
      display: flex;
      padding: 0.25rem;
      background-color: #f3f4f6;
      border-radius: 0.5rem;
      margin-bottom: 1.5rem;
    }
    
      background-color: #374151;
    }
    
    .view-option {
      flex: 1;
      text-align: center;
      padding: 0.5rem 1rem;
      cursor: pointer;
      border-radius: 0.375rem;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .view-option.active {
      background-color: white;
      color: #0ea5e9;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
      background-color: #1f2937;
      color: #38bdf8;
    }
    
    .action-button {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 500;
      border-radius: 0.375rem;
      border: 1px solid #e5e7eb;
      background-color: white;
      color: #374151;
      transition: all 0.2s;
    }
    
      background-color: #1f2937;
      border-color: #4b5563;
      color: #e5e7eb;
    }
    
    .action-button:hover {
      background-color: #f9fafb;
      border-color: #d1d5db;
    }
    
      background-color: #374151;
      border-color: #6b7280;
    }
    
    .period-selector {
      padding: 0.5rem;
      border: 1px solid #e5e7eb;
      border-radius: 0.375rem;
      background-color: white;
      font-size: 0.875rem;
      color: #374151;
      outline: none;
    }
    
      background-color: #1f2937;
      border-color: #4b5563;
      color: #e5e7eb;
    }
    
    /* Dashboard Card Styles */
    .dashboard-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .dashboard-card {
      background-color: white;
      border-radius: 0.75rem;
      padding: 1.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }
    
      background-color: #1e293b;
    }
    
    .dashboard-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    
    .card-title {
      color: #6b7280;
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
    }
    
      color: #9ca3af;
    }
    
    .card-value {
      font-size: 1.5rem;
      font-weight: 600;
      color: #111827;
      margin-bottom: 0.5rem;
    }
    
      color: #f9fafb;
    }
    
    .comparison-value {
      font-size: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    
    .comparison-up {
      color: #10b981;
    }
    
    .comparison-down {
      color: #ef4444;
    }
    
      color: #34d399;
    }
    
      color: #f87171;
    }
    
    /* Menu bar styles */
    .5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 1.5rem;
      overflow-x: auto;
    }
    
      white-space: nowrap;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }
    
      border-bottom-color: #0ea5e9;
      color: #0ea5e9;
      font-weight: 500;
    }
    
    .month-selector {
      border: 1px solid #e5e7eb;
      border-radius: 0.375rem;
      padding: 0.25rem 0.5rem;
      background-color: white;
      font-size: 0.875rem;
      outline: none;
    }
    
      background-color: #1f2937;
      border-color: #4b5563;
      color: #e5e7eb;
    }
    
    /* Display toggle */
    .display-toggle {
      display: flex;
      background-color: #f3f4f6;
      border-radius: 0.5rem;
      margin-bottom: 1.5rem;
      padding: 0.25rem;
    }
    
      background-color: #334155;
    }
    
    .toggle-btn {
      flex: 1;
      text-align: center;
      padding: 0.5rem 1rem;
      cursor: pointer;
      border-radius: 0.375rem;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    
    .toggle-btn.active {
      background-color: white;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      color: #0ea5e9;
    }
    
      background-color: #1f2937;
    }
    
    /* Financial table */
    .view-container {
      background-color: white;
      border-radius: 0.5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
      background-color: #1e293b;
    }
    
    .hidden {
      display: none;
    }
    
    .financial-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
    }
    
    .financial-table th {
      background-color: #f8f9fa;
      color: #6b7280;
      font-weight: 500;
      text-align: left;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid #e5e7eb;
    }
    
      background-color: #1f2937;
      color: #d1d5db;
      border-bottom-color: #4b5563;
    }
    
    .financial-table td {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid #e5e7eb;
    }
    
      border-bottom-color: #4b5563;
    }
    
    .financial-table .section-header {
      font-weight: 600;
      background-color: #f3f4f6;
      color: #111827;
      padding: 0.75rem 1rem;
    }
    
      background-color: #374151;
      color: #f3f4f6;
    }
    
    .financial-table .subsection-header {
      font-weight: 500;
      color: #4b5563;
      padding: 0.75rem 1rem;
      background-color: #f9fafb;
    }
    
      background-color: #1f2937;
      color: #e5e7eb;
    }
    
    .financial-table .amount {
      text-align: right;
      position: relative;
    }
    
    .financial-table .indent-1 {
      padding-left: 2rem;
    }
    
    .financial-table .indent-2 {
      padding-left: 3.5rem;
    }
    
    .financial-table .total-row {
      background-color: #e0f2fe;
      font-weight: 600;
    }
    
      background-color: #0c4a6e;
    }
    
    .comparison-value {
      display: inline-block;
      margin-left: 0.5rem;
      font-size: 0.75rem;
      font-weight: normal;
    }

    /* Enhanced Menu Styles */
    .2s ease;
      border-radius: 0.375rem;
    }
    
    .1);
    }
    
    .8);
      animation: fadeIn 0.2s ease;
    }
    
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Improved Stats Card */
    .stats-card {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    
    .stat-box {
      background-color: white;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(229, 231, 235, 0.5);
    }
    
      background-color: #1e293b;
      border-color: rgba(75, 85, 99, 0.5);
    }
    
    .stat-box::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 6px;
      height: 100%;
      background-color: #0ea5e9;
      opacity: 0.7;
    }
    
    .stat-box:nth-child(2)::before {
      background-color: #10b981;
    }
    
    .stat-box:nth-child(3)::before {
      background-color: #f59e0b;
    }
    
    .stat-box:nth-child(4)::before {
      background-color: #ef4444;
    }
    
    .stat-box:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    .stat-label {
      font-size: 0.875rem;
      color: #6b7280;
      margin-bottom: 0.75rem;
      font-weight: 500;
      padding-left: 0.5rem;
    }
    
      color: #9ca3af;
    }
    
    .stat-value {
      font-size: 1.75rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      padding-left: 0.5rem;
    }
    
    .stat-trend {
      font-size: 0.875rem;
      display: flex;
      align-items: center;
      gap: 0.35rem;
      padding-left: 0.5rem;
    }
    
    /* Enhanced Card Style */
    .card {
      background-color: white;
      border-radius: 1rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      border: 1px solid rgba(229, 231, 235, 0.5);
      padding: 1.5rem;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
      background-color: #1e293b;
      border-color: rgba(75, 85, 99, 0.5);
    }
    
    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    /* Financial Report Tabs */
    .report-tabs {
      display: flex;
      background-color: white;
      border-radius: 0.75rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      border: 1px solid rgba(229, 231, 235, 0.5);
      padding: 0.5rem;
      margin-bottom: 1.5rem;
      overflow-x: auto;
    }
    
      background-color: #1e293b;
      border-color: rgba(75, 85, 99, 0.5);
    }
    
    .report-tab {
      padding: 0.75rem 1.5rem;
      font-weight: 500;
      cursor: pointer;
      white-space: nowrap;
      border-radius: 0.5rem;
      transition: all 0.2s ease;
    }
    
    .report-tab:hover {
      background-color: rgba(14, 165, 233, 0.1);
    }
    
    .report-tab.active {
      background-color: #0ea5e9;
      color: white;
    }
    
      background-color: #0284c7;
    }
    
    /* Chart container enhancements */
    .chart-container {
      position: relative;
      height: 350px;
      margin-top: 1rem;
    }

    /* Table enhancements */
    table {
      border-collapse: separate;
      border-spacing: 0;
      width: 100%;
      border-radius: 0.5rem;
      overflow: hidden;
    }
    
    table thead th {
      background-color: #f3f4f6;
      font-weight: 500;
      text-transform: uppercase;
      font-size: 0.75rem;
      letter-spacing: 0.05em;
      padding: 0.75rem 1.5rem;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
    }
    
      background-color: #1f2937;
      border-color: #374151;
    }
    
    table tbody tr:hover td {
      background-color: #f9fafb;
    }
    
      background-color: #273346;
    }
    
    table tbody td {
      padding: 1rem 1.5rem;
      border-bottom: 1px solid #e5e7eb;
    }
    
      border-color: #374151;
    }
    
    table tfoot {
      font-weight: 600;
    }
    
    table tfoot td {
      padding: 1rem 1.5rem;
      background-color: #f3f4f6;
      border-top: 2px solid #e5e7eb;
    }
    
      background-color: #1f2937;
      border-color: #374151;
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    
      background: #1f2937;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 10px;
    }
    
      background: #4b5563;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #a0a0a0;
    }
    
      background: #6b7280;
    }

    /* Thai Calendar Styles */
    .date-picker-container {
      position: relative;
      display: inline-block;
    }
    
    .date-picker-input {
      padding: 8px 12px;
      border: 1px solid #e5e7eb;
      border-radius: 4px;
      background-color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 220px;
    }
    
      background-color: #1f2937;
      border-color: #4b5563;
      color: #e5e7eb;
    }
    
    .thai-calendar {
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 4px;
      padding: 12px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 50;
      width: 280px;
      display: none;
    }
    
      background-color: #1e293b;
      border-color: #4b5563;
    }
    
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .month-year {
      font-weight: 500;
      font-size: 1.05rem;
    }
    
    .nav-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 16px;
      color: #6b7280;
      padding: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
    }
    
      color: #9ca3af;
    }
    
    .calendar-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      margin-bottom: 8px;
    }
    
    .day-name {
      text-align: center;
      font-weight: 500;
      color: #6b7280;
      font-size: 0.85rem;
      padding: 4px 0;
    }
    
      color: #9ca3af;
    }
    
    .calendar-dates {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
    }
    
    .date-cell {
      height: 36px;
      width: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s;
      margin: 1px;
    }
    
    .date-cell:hover:not(.disabled) {
      background-color: #f3f4f6;
      border-radius: 50%;
    }
    
      background-color: #374151;
    }
    
    .date-cell.disabled {
      color: #d1d5db;
      cursor: default;
      opacity: 0.4;
    }
    
      color: #6b7280;
    }
    
    .date-cell.selected {
      background-color: #0ea5e9;
      color: white;
      border-radius: 50%;
    }
    
    .date-cell.today {
      border: 2px solid #0ea5e9;
      border-radius: 50%;
      font-weight: 500;
    }
    
      border-color: #38bdf8;
    }
  </style>
  
 <!-- Template สำหรับเมนู -->

  <!-- Loading System -->
  <link rel="stylesheet" href="/css/loading-components.css">
  <script src="/js/loading-system.js"></script>

  <!-- Animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

  <!-- Lottie Animation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>

  <style>
    /* Loading Overlay Styles - Minimal CSS, use inline styles in HTML */
    .loading-overlay {
      transition: opacity 0.5s ease-out, visibility 0.5s ease-out !important;
    }

    .loading-overlay.animate__fadeOut {
      opacity: 0 !important;
      visibility: hidden !important;
      pointer-events: none !important;
    }

    .loading-overlay.hidden,
    .loading-overlay[style*="display: none"] {
      display: none !important;
      pointer-events: none !important;
      visibility: hidden !important;
    }
  </style>

  <!-- Account Menu Styles -->
  <link rel="stylesheet" href="/css/account-menu.css?v=light-v3">
</head>

<body class="bg-gray-50 w-full h-screen">
  <script>
    // Force remove dark mode
    document.documentElement.classList.remove('dark');
    document.body.classList.remove('dark');
    localStorage.removeItem('darkMode');
    localStorage.setItem('theme', 'light');
  </script>

  <!-- Loading Overlay with Lottie Animation -->
  <div id="loadingOverlay" class="loading-overlay"
       style="position: fixed; top: 0; left: 0; right: 0; bottom: 0;
              width: 100vw; height: 100vh;
              display: flex; justify-content: center; align-items: center;
              z-index: 999999; background: rgba(255, 255, 255, 0.98);
              backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);">
    <div style="display: flex; justify-content: center; align-items: center; flex-direction: column;">
      <div id="lottieContainer" style="width: 300px; height: 300px; margin: 0 auto;"></div>
    </div>
  </div>

  <div id="mainContent" class="container mx-auto px-4 py-6">
    <!-- Navbar -->
    <!-- Account System Navbar Template -->
<div class="navbar bg-white shadow-md sticky top-0">
  <div class="flex-1 flex items-center space-x-6">
    <img src="/uploads/Logo2.png"
         alt="Logo"
         class="rounded-full shadow-lg"
         style="width: 40px; height: 40px;" />
    <span class="text-lg font-semibold" id="pageTitle">ระบบบัญชี</span>
    <!-- Menu Container -->
    <div id="mainMenuContainer" class="ml-auto"></div>
  </div>
  <div class="flex-none flex items-center space-x-2">
    <!-- User Profile Section -->
    <div class="flex items-center space-x-3 mr-4">
      <img id="employeePhoto"
           alt="Profile"
           class="w-10 h-10 rounded-full border-2 border-gray-300"
           src="/img/default-avatar.svg">
      <span id="employeeName" class="text-sm font-medium text-gray-700">Loading...</span>
    </div>


    <!-- Logout Button -->
    <button id="btnLogout" class="btn btn-outline btn-primary btn-sm btn-rounded btn-fancy">
      <i class="bi bi-box-arrow-right mr-1"></i> ออกจากระบบ
    </button>
  </div>
</div>


    <!-- Breadcrumb -->
    <div class="text-sm breadcrumbs py-4">
      <ul class="flex items-center space-x-2">
        <li><a href="/dashboard" class="text-primary-600 hover:underline">หน้าหลัก</a></li>
        <li class="flex items-center"><i class="bi bi-chevron-right text-gray-400 mx-1"></i> รายงาน</li>
        <li class="flex items-center"><i class="bi bi-chevron-right text-gray-400 mx-1"></i> รายงานงบการเงิน</li>
      </ul>
    </div>

    <!-- Financial Statement Section with Card -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4">
        <h2 class="text-2xl font-semibold text-gray-800">รายงานงบการเงิน</h2>
        <!-- Export Buttons -->
        <div class="flex flex-wrap gap-3">
          <button class="flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-200 shadow-sm">
            <i class="bi bi-file-earmark-excel text-green-600"></i> นำออก Excel
          </button>
          <button id="exportPDF" class="flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-200 shadow-sm">
            <i class="bi bi-file-earmark-pdf text-red-600"></i> นำออก PDF
          </button>
          <button id="printReport" class="flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-200 shadow-sm">
            <i class="bi bi-printer text-blue-600"></i> พิมพ์
          </button>
        </div>
      </div>

      <!-- Filter Section -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <div>
          <label for="branchFilter" class="block text-sm font-medium text-gray-700 mb-1">สาขา</label>
          <select id="branchFilter" class="form-control">
            <option value="all">ทั้งหมด</option>
            <option value="bkk">กรุงเทพฯ</option>
            <option value="cnx">เชียงใหม่</option>
            <option value="phuket">ภูเก็ต</option>
            <option value="khonkaen">ขอนแก่น</option>
            <option value="hadyai">หาดใหญ่</option>
          </select>
        </div>

        <div>
          <label for="periodFilter" class="block text-sm font-medium text-gray-700 mb-1">ระยะเวลา</label>
          <select id="periodFilter" class="form-control">
            <option value="month">รายเดือน</option>
            <option value="quarter">รายไตรมาส</option>
            <option value="year" selected>รายปี</option>
          </select>
        </div>

        <div>
          <label for="dateRangeBtn" class="block text-sm font-medium text-gray-700 mb-1">ช่วงวันที่</label>
          <button id="dateRangeBtn" class="form-control flex items-center justify-between">
            <span>1 ม.ค. - 31 ธ.ค. 2566</span>
            <i class="bi bi-calendar-range"></i>
          </button>
        </div>
      </div>
    
    <!-- Report Type Tabs -->
    <div class="report-tabs">
      <div class="report-tab active" data-report="summary">ภาพรวม</div>
      <div class="report-tab" data-report="balance">งบแสดงฐานะการเงิน</div>
      <div class="report-tab" data-report="income">งบกำไรขาดทุน</div>
      <div class="report-tab" data-report="cashflow">งบกระแสเงินสด</div>
      <div class="report-tab" data-report="change-equity">งบแสดงการเปลี่ยนแปลงส่วนของเจ้าของ</div>
    </div>

    <!-- Summary Report (Default View) -->
    <div id="summary-content" class="report-content">
      <!-- Financial Summary Stats -->
      <div class="stats-card">
        <div class="stat-box">
          <span class="stat-label">สินทรัพย์รวม</span>
          <span class="stat-value" id="totalAssets">฿0</span>
          <span class="stat-trend text-gray-500" id="assetsTrend">
            <i class="bi bi-dash"></i> -
          </span>
        </div>
        <div class="stat-box">
          <span class="stat-label">หนี้สินรวม</span>
          <span class="stat-value" id="totalLiabilities">฿0</span>
          <span class="stat-trend text-gray-500" id="liabilitiesTrend">
            <i class="bi bi-dash"></i> -
          </span>
        </div>
        <div class="stat-box">
          <span class="stat-label">ส่วนของผู้ถือหุ้น</span>
          <span class="stat-value" id="totalEquity">฿0</span>
          <span class="stat-trend text-gray-500" id="equityTrend">
            <i class="bi bi-dash"></i> -
          </span>
        </div>
        <div class="stat-box">
          <span class="stat-label">รายได้รวม</span>
          <span class="stat-value" id="totalRevenue">฿0</span>
          <span class="stat-trend text-gray-500" id="revenueTrend">
            <i class="bi bi-dash"></i> -
          </span>
        </div>
      </div>

      <!-- Chart Sections -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <!-- Sales and Growth Chart -->
        <div class="card">
          <h3 class="text-lg font-medium mb-4">ยอดขายและอัตราการเติบโตเฉลี่ย</h3>
          <div class="chart-container" style="position: relative; height: 350px;">
            <canvas id="salesGrowthChart"></canvas>
          </div>
        </div>
        
        <!-- Expenses Chart -->
        <div class="card">
          <h3 class="text-lg font-medium mb-4">ค่าใช้จ่ายและกำไร</h3>
          <div class="chart-container" style="position: relative; height: 350px;">
            <canvas id="expensesProfitChart"></canvas>
          </div>
        </div>
      </div>
      
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <!-- Average Sales Chart - MOVED UP -->
        <div class="card">
          <h3 class="text-lg font-medium mb-4">ยอดขายเฉลี่ยและอัตราการเติบโต</h3>
          <div class="flex flex-wrap gap-4 mb-4">
            <div class="bg-blue-50 px-4 py-2 rounded-lg">
              <div class="text-sm text-gray-500">ยอดขายเฉลี่ยต่อวัน</div>
              <div class="text-xl font-semibold" id="avgSalesValue">฿13,300</div>
            </div>
            <div class="bg-green-50 px-4 py-2 rounded-lg">
              <div class="text-sm text-gray-500">อัตราการเติบโตเฉลี่ย</div>
              <div class="text-xl font-semibold text-green-600" id="avgGrowthValue">+8.5%</div>
            </div>
            <div class="bg-amber-50 px-4 py-2 rounded-lg">
              <div class="text-sm text-gray-500">เทียบกับปีที่แล้ว</div>
              <div class="text-xl font-semibold text-amber-600">+23.8%</div>
            </div>
          </div>
          
          <div class="flex justify-end mb-2 space-x-2">
            <div class="text-xs text-gray-500 flex items-center">
              <span class="inline-block h-3 w-3 bg-purple-500 rounded-sm mr-1"></span>
              ยอดขายเฉลี่ย (บาท/วัน)
            </div>
            <div class="text-xs text-gray-500 flex items-center">
              <span class="inline-block h-3 w-3 bg-green-500 rounded-sm mr-1"></span>
              อัตราการเติบโต (%)
            </div>
          </div>
          
          <div class="chart-container" style="position: relative; height: 300px;">
            <canvas id="averageSalesChart"></canvas>
          </div>
        </div>

        <!-- Cash Flow Chart -->
        <div class="card">
          <h3 class="text-lg font-medium mb-4">สภาพคล่องเงินสด</h3>
          <div class="chart-container" style="position: relative; height: 300px;">
            <canvas id="cashFlowChart"></canvas>
          </div>
        </div>
      </div>
      
      <div class="grid grid-cols-1 gap-6 mb-6">
        <!-- Payables Chart - MOVED DOWN AND TAKES FULL WIDTH -->
        <div class="card">
          <h3 class="text-lg font-medium mb-4">เจ้าหนี้เลยกำหนดชำระ</h3>
          <div class="chart-container" style="position: relative; height: 300px;">
            <canvas id="payablesChart"></canvas>
          </div>
        </div>
      </div>
      
      <!-- Detailed Financial Metrics -->
      <div class="card mb-6">
        <h3 class="text-lg font-medium mb-4">อัตราส่วนทางการเงิน</h3>
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead>
              <tr>
                <th>อัตราส่วน</th>
                <th>ม.ค.</th>
                <th>ก.พ.</th>
                <th>มี.ค.</th>
                <th>เม.ย.</th>
                <th>พ.ค.</th>
                <th>มิ.ย.</th>
                <th>ก.ค.</th>
                <th>ส.ค.</th>
                <th>ก.ย.</th>
                <th>ต.ค.</th>
                <th>พ.ย.</th>
                <th>ธ.ค.</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>อัตราส่วนสภาพคล่อง</td>
                <td>1.56</td>
                <td>1.58</td>
                <td>1.62</td>
                <td>1.64</td>
                <td>1.67</td>
                <td>1.70</td>
                <td>1.72</td>
                <td>1.74</td>
                <td>1.76</td>
                <td>1.75</td>
                <td>1.73</td>
                <td>1.74</td>
              </tr>
              <tr>
               
                <td>อัตรากำไรสุทธิ (%)</td>
                <td>18.2</td>
                <td>19.6</td>
                <td>21.5</td>
                <td>22.4</td>
                <td>23.8</td>
                <td>25.7</td>
                <td>27.1</td>
                <td>26.8</td>
                <td>26.5</td>
                <td>26.9</td>
                <td>27.6</td>
                <td>28.3</td>
              </tr>
              <tr>
                <td>อัตราหมุนเวียนสินทรัพย์</td>
                <td>0.67</td>
                <td>0.69</td>
                <td>0.72</td>
                <td>0.75</td>
                <td>0.78</td>
                <td>0.81</td>
                <td>0.83</td>
                <td>0.85</td>
                <td>0.87</td>
                <td>0.89</td>
                <td>0.92</td>
                <td>0.94</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Branch Overview Card - MOVED TO END -->
      <div class="card mb-6">
        <h3 class="text-lg font-medium mb-4">สรุปผลการดำเนินงานตามสาขา</h3>
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead>
              <tr>
                <th>สาขา</th>
                <th>ยอดขาย (บาท)</th>
                <th>กำไรขั้นต้น</th>
                <th>กำไรสุทธิ</th>
                <th>ลูกหนี้คงค้าง</th>
                <th>อัตราการเติบโต</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>กรุงเทพฯ</td>
                <td>1,245,780</td>
                <td>485,820</td>
                <td>325,450</td>
                <td>98,540</td>
                <td><span class="text-green-600">+14.5%</span></td>
              </tr>
              <tr>
                <td>เชียงใหม่</td>
                <td>785,320</td>
                <td>305,720</td>
                <td>195,640</td>
                <td>65,230</td>
                <td><span class="text-green-600">+8.7%</span></td>
              </tr>
              <tr>
                <td>ภูเก็ต</td>
                <td>635,450</td>
                <td>250,780</td>
                <td>158,420</td>
                <td>42,780</td>
                <td><span class="text-green-600">+16.2%</span></td>
              </tr>
              <tr>
                <td>ขอนแก่น</td>
                <td>320,150</td>
                <td>125,820</td>
                <td>85,240</td>
                <td>23,750</td>
                <td><span class="text-yellow-600">+5.2%</span></td>
              </tr>
              <tr>
                <td>หาดใหญ่</td>
                <td>259,080</td>
                <td>102,580</td>
                <td>62,700</td>
                <td>15,000</td>
                <td><span class="text-red-600">-2.3%</span></td>
              </tr>
            </tbody>
            <tfoot class="font-semibold">
              <tr>
                <td>รวมทั้งหมด</td>
                <td>3,245,780</td>
                <td>1,270,720</td>
                <td>827,450</td>
                <td>245,300</td>
                <td><span class="text-green-600">+12.4%</span></td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
    </div>

    <!-- Balance Sheet View (Financial Position Statement) -->
    <div id="balance-content" class="report-content hidden">
      <div class="card mb-6">
        <h3 class="text-xl font-medium mb-6 flex items-center">
          <i class="bi bi-bar-chart-line mr-2 text-blue-600"></i>
          งบแสดงฐานะการเงิน
          <span class="ml-2 text-sm font-normal text-gray-500">ณ วันที่ 31 ธันวาคม 2566</span>
        </h3>
        
        <div class="overflow-x-auto">
          <table class="fin-statement-table w-full">
            <tbody id="balanceSheetTable">
              <!-- Balance sheet data will be loaded dynamically -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- Income Statement View -->
    <div id="income-content" class="report-content hidden">
      <div class="card mb-6">
        <h3 class="text-xl font-medium mb-6 flex items-center">
          <i class="bi bi-graph-up-arrow mr-2 text-green-600"></i>
          งบกำไรขาดทุน
          <span class="ml-2 text-sm font-normal text-gray-500">สำหรับปีสิ้นสุด วันที่ 31 ธันวาคม 2566</span>
        </h3>
        
        <div class="overflow-x-auto">
          <table class="fin-statement-table w-full">
            <tbody id="incomeStatementTable">
              <!-- Income statement data will be loaded dynamically -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- Cash Flow Statement View -->
    <div id="cashflow-content" class="report-content hidden">
      <div class="card mb-6">
        <h3 class="text-xl font-medium mb-6 flex items-center">
          <i class="bi bi-cash-stack mr-2 text-teal-600"></i>
          งบกระแสเงินสด
          <span class="ml-2 text-sm font-normal text-gray-500">สำหรับปีสิ้นสุด วันที่ 31 ธันวาคม 2566</span>
        </h3>
        
        <div class="overflow-x-auto">
          <table class="fin-statement-table w-full">
            <tbody>
              <!-- Operating Activities -->
              <tr>
                <td colspan="2" class="section-header">กระแสเงินสดจากกิจกรรมดำเนินงาน</td>
              </tr>
              <tr>
                <td class="indent-1">กำไรสุทธิ</td>
                <td class="text-right">679,592</td>
              </tr>
              <tr>
                <td colspan="2" class="indent-1">รายการปรับกระทบกำไรสุทธิ:</td>
              </tr>
              <tr>
                <td class="indent-2">ค่าเสื่อมราคาและค่าตัดจำหน่าย</td>
                <td class="text-right">245,780</td>
              </tr>
              <tr>
                <td class="indent-2">ค่าใช้จ่ายผลประโยชน์พนักงาน</td>
                <td class="text-right">32,450</td>
              </tr>
              <tr>
                <td class="indent-2">ค่าใช้จ่ายดอกเบี้ย</td>
                <td class="text-right">42,800</td>
              </tr>
              <tr>
                <td class="indent-2">ลูกหนี้การค้าและลูกหนี้อื่น (เพิ่มขึ้น) ลดลง</td>
                <td class="text-right">-125,340</td>
              </tr>
              <tr>
                <td class="indent-2">สินค้าคงเหลือ (เพิ่มขึ้น) ลดลง</td>
                <td class="text-right">-85,620</td>
              </tr>
              <tr>
                <td class="indent-2">เจ้าหนี้การค้าและเจ้าหนี้อื่น เพิ่มขึ้น (ลดลง)</td>
                <td class="text-right">98,520</td>
              </tr>
              <tr>
                <td class="indent-2">ภาษีเงินได้จ่าย</td>
                <td class="text-right">-169,898</td>
              </tr>
              <tr class="section-total">
                <td class="indent-1">เงินสดสุทธิได้มาจากกิจกรรมดำเนินงาน</td>
                <td class="text-right">718,284</td>
              </tr>
              
              <!-- Investing Activities -->
              <tr>
                <td colspan="2" class="section-header">กระแสเงินสดจากกิจกรรมลงทุน</td>
              </tr>
              <tr>
                <td class="indent-1">เงินสดจ่ายเพื่อซื้อสินทรัพย์ถาวร</td>
                <td class="text-right">-385,750</td>
              </tr>
              <tr>
                <td class="indent-1">เงินสดจ่ายเพื่อซื้อสินทรัพย์ไม่มีตัวตน</td>
                <td class="text-right">-45,230</td>
              </tr>
              <tr>
                <td class="indent-1">เงินสดรับจากการขายสินทรัพย์ถาวร</td>
                <td class="text-right">12,540</td>
              </tr>
              <tr class="section-total">
                <td class="indent-1">เงินสดสุทธิใช้ไปในกิจกรรมลงทุน</td>
                <td class="text-right">-418,440</td>
              </tr>
              
              <!-- Financing Activities -->
              <tr>
                <td colspan="2" class="section-header">กระแสเงินสดจากกิจกรรมจัดหาเงิน</td>
              </tr>
              <tr>
                <td class="indent-1">เงินสดรับจากเงินกู้ยืม</td>
                <td class="text-right">250,000</td>
              </tr>
              <tr>
                <td class="indent-1">เงินสดจ่ายชำระคืนเงินกู้ยืม</td>
                <td class="text-right">-180,000</td>
              </tr>
              <tr>
                <td class="indent-1">ดอกเบี้ยจ่าย</td>
                <td class="text-right">-42,800</td>
              </tr>
              <tr>
                <td class="indent-1">เงินปันผลจ่าย</td>
                <td class="text-right">-120,000</td>
              </tr>
              <tr class="section-total">
                <td class="indent-1">เงินสดสุทธิใช้ไปในกิจกรรมจัดหาเงิน</td>
                <td class="text-right">-92,800</td>
              </tr>
              
              <!-- Net Increase/Decrease -->
              <tr class="grand-total">
                <td>เงินสดและรายการเทียบเท่าเงินสดเพิ่มขึ้น(ลดลง)สุทธิ</td>
                <td class="text-right">207,044</td>
              </tr>
              <tr>
                <td>เงินสดและรายการเทียบเท่าเงินสด ณ วันต้นปี</td>
                <td class="text-right">1,038,336</td>
              </tr>
              <tr class="grand-total">
                <td>เงินสดและรายการเทียบเท่าเงินสด ณ วันสิ้นปี</td>
                <td class="text-right">1,245,380</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- Change in Equity Statement View -->
    <div id="change-equity-content" class="report-content hidden">
      <div class="card mb-6">
        <h3 class="text-xl font-medium mb-6 flex items-center">
          <i class="bi bi-pie-chart-fill mr-2 text-purple-600"></i>
          งบแสดงการเปลี่ยนแปลงส่วนของเจ้าของ
          <span class="ml-2 text-sm font-normal text-gray-500">สำหรับปีสิ้นสุด วันที่ 31 ธันวาคม 2566</span>
        </h3>
        
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead>
              <tr>
                <th>รายการ</th>
                <th class="text-right">ทุนจดทะเบียน<br>ชำระแล้ว</th>
                <th class="text-right">ส่วนเกินมูลค่า<br>หุ้นสามัญ</th>
                <th class="text-right">กำไรสะสม</th>
                <th class="text-right">องค์ประกอบอื่นของ<br>ส่วนของเจ้าของ</th>
                <th class="text-right">รวม</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>ยอดคงเหลือ ณ วันที่ 1 มกราคม 2566</td>
                <td class="text-right">2,000,000</td>
                <td class="text-right">500,000</td>
                <td class="text-right">2,576,778</td>
                <td class="text-right">0</td>
                <td class="text-right">5,076,778</td>
              </tr>
              <tr>
                <td>กำไรสำหรับปี</td>
                <td class="text-right">0</td>
                <td class="text-right">0</td>
                <td class="text-right">679,592</td>
                <td class="text-right">0</td>
                <td class="text-right">679,592</td>
              </tr>
              <tr>
                <td>เงินปันผลจ่าย</td>
                <td class="text-right">0</td>
                <td class="text-right">0</td>
                <td class="text-right">-120,000</td>
                <td class="text-right">0</td>
                <td class="text-right">-120,000</td>
              </tr>
              <tr>
                <td>ผลขาดทุนจากการวัดมูลค่าใหม่ของผลประโยชน์พนักงาน</td>
                <td class="text-right">0</td>
                <td class="text-right">0</td>
                <td class="text-right">0</td>
                <td class="text-right">0</td>
                <td class="text-right">0</td>
              </tr>
              <tr class="font-semibold bg-gray-100">
                <td>ยอดคงเหลือ ณ วันที่ 31 ธันวาคม 2566</td>
                <td class="text-right">2,000,000</td>
                <td class="text-right">500,000</td>
                <td class="text-right">3,136,370</td>
                <td class="text-right">0</td>
                <td class="text-right">5,636,370</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="p-4 text-center text-gray-500 text-sm mt-6">
    © 2023 ระบบบัญชีออนไลน์ - เวอร์ชัน 3.5.2
  </footer>

  <!-- Chart.js Library -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      try {
        const pageLoaderId = LoadingSystem.show({
          message: 'กำลังโหลดหน้าเว็บ...',
          showProgress: true,
          autoProgress: true,
          spinnerType: 'default'
        });
      
      const mainMenuTemplate = document.getElementById('mainMenuTemplate');
      const mainMenuContainer = document.getElementById('mainMenuContainer');
      
      if (mainMenuTemplate && mainMenuContainer) {
        mainMenuContainer.innerHTML = mainMenuTemplate.innerHTML;
        
        // Add a slight delay to ensure DOM is fully processed
        setTimeout(fixMenuDisplay, 100);
      }
      
      
      // Initialize dark mode from localStorage
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        document.documentElement.classList.add('dark');
      }

      // Load financial data from API
      loadFinancialData();

      // Initialize charts
      initializeCharts();
      
      // Handle period filter change
      document.getElementById('periodFilter').addEventListener('change', function() {
        updateChartsData(this.value, document.getElementById('branchFilter').value);
      });
      
      // Handle branch filter change
      document.getElementById('branchFilter').addEventListener('change', function() {
        updateChartsData(document.getElementById('periodFilter').value, this.value);
      });
      
      // Initialize report tabs
      const reportTabs = document.querySelectorAll('.report-tab');
      const reportContents = document.querySelectorAll('.report-content');
      
      reportTabs.forEach(tab => {
        tab.addEventListener('click', function() {
          // Remove active class from all tabs
          reportTabs.forEach(t => t.classList.remove('active'));
          
          // Add active class to clicked tab
          this.classList.add('active');
          
          // Hide all content sections
          reportContents.forEach(content => {
            content.classList.add('hidden');
          });
          
          // Show the selected content section
          const reportType = this.getAttribute('data-report');
          document.getElementById(reportType + '-content').classList.remove('hidden');
          
          // Update filters visibility based on the active tab
          const filtersContainer = document.getElementById('filters-container');
          if (reportType === 'summary') {
            filtersContainer.classList.remove('hidden');
          } else {
            filtersContainer.classList.add('hidden');
          }
        });
      });
      
      // Date range button functionality
      document.getElementById('dateRangeBtn').addEventListener('click', function() {
        // Date range picker would be implemented here
        alert('Date range picker would appear here');
        // For a real implementation, use a library like Litepicker or Flatpickr
      });
      
      // Make sure the branch overview is inside the summary content
      const branchOverview = document.querySelector('.card.mb-6:last-child');
      const summaryContent = document.getElementById('summary-content');
      if (branchOverview && summaryContent) {
        summaryContent.appendChild(branchOverview);
      }
      
      } catch (error) {
        console.error('Page loading error:', error);
      } finally {
        LoadingSystem.completeProgress();
      }
    });
    
    // Global variables for financial data
    let financialData = null;
    let accountsData = [];

    // Load financial data from API
    async function loadFinancialData() {
      try {
        const response = await fetch('/api/accounting/trial-balance');
        const result = await response.json();

        if (result.success) {
          accountsData = result.data || [];
          financialData = result;

          // Process and update all financial statements
          updateSummaryCards();
          updateBalanceSheet();
          updateIncomeStatement();
        } else {
          console.error('Failed to load financial data:', result.error);
        }
      } catch (error) {
        console.error('Error loading financial data:', error);
      }
    }

    // Format currency
    function formatCurrency(amount) {
      return new Intl.NumberFormat('th-TH', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      }).format(Math.abs(amount));
    }

    // Update summary cards with financial totals
    function updateSummaryCards() {
      const assets = accountsData
        .filter(acc => acc.accountType === 'asset')
        .reduce((sum, acc) => sum + Math.abs(acc.balance), 0);

      const liabilities = accountsData
        .filter(acc => acc.accountType === 'liability')
        .reduce((sum, acc) => sum + Math.abs(acc.balance), 0);

      const equity = accountsData
        .filter(acc => acc.accountType === 'equity')
        .reduce((sum, acc) => sum + Math.abs(acc.balance), 0);

      const revenue = accountsData
        .filter(acc => acc.accountType === 'revenue')
        .reduce((sum, acc) => sum + Math.abs(acc.balance), 0);

      document.getElementById('totalAssets').textContent = '฿' + formatCurrency(assets);
      document.getElementById('totalLiabilities').textContent = '฿' + formatCurrency(liabilities);
      document.getElementById('totalEquity').textContent = '฿' + formatCurrency(equity);
      document.getElementById('totalRevenue').textContent = '฿' + formatCurrency(revenue);
    }

    // Update Balance Sheet table
    function updateBalanceSheet() {
      const tbody = document.getElementById('balanceSheetTable');
      if (!tbody) return;

      const assets = accountsData.filter(acc => acc.accountType === 'asset');
      const liabilities = accountsData.filter(acc => acc.accountType === 'liability');
      const equities = accountsData.filter(acc => acc.accountType === 'equity');

      let html = '';

      // Assets section
      html += '<tr><td colspan="2" class="section-header">สินทรัพย์</td></tr>';

      let totalAssets = 0;
      assets.forEach(account => {
        const balance = Math.abs(account.balance);
        totalAssets += balance;
        html += `
          <tr>
            <td class="indent-1">${account.accountName}</td>
            <td class="text-right">${formatCurrency(balance)}</td>
          </tr>
        `;
      });

      html += `
        <tr>
          <td class="font-medium">รวมสินทรัพย์</td>
          <td class="text-right font-medium">${formatCurrency(totalAssets)}</td>
        </tr>
      `;

      // Liabilities section
      html += '<tr><td colspan="2" class="section-header">หนี้สินและส่วนของผู้ถือหุ้น</td></tr>';
      html += '<tr><td colspan="2" class="font-medium">หนี้สิน</td></tr>';

      let totalLiabilities = 0;
      liabilities.forEach(account => {
        const balance = Math.abs(account.balance);
        totalLiabilities += balance;
        html += `
          <tr>
            <td class="indent-1">${account.accountName}</td>
            <td class="text-right">${formatCurrency(balance)}</td>
          </tr>
        `;
      });

      html += `
        <tr>
          <td class="font-medium">รวมหนี้สิน</td>
          <td class="text-right font-medium">${formatCurrency(totalLiabilities)}</td>
        </tr>
      `;

      // Equity section
      html += '<tr><td colspan="2" class="font-medium">ส่วนของผู้ถือหุ้น</td></tr>';

      let totalEquity = 0;
      equities.forEach(account => {
        const balance = Math.abs(account.balance);
        totalEquity += balance;
        html += `
          <tr>
            <td class="indent-1">${account.accountName}</td>
            <td class="text-right">${formatCurrency(balance)}</td>
          </tr>
        `;
      });

      html += `
        <tr>
          <td class="indent-1 font-medium">รวมส่วนของผู้ถือหุ้น</td>
          <td class="text-right font-medium">${formatCurrency(totalEquity)}</td>
        </tr>
      `;

      html += `
        <tr class="grand-total">
          <td class="font-medium">รวมหนี้สินและส่วนของผู้ถือหุ้น</td>
          <td class="text-right font-medium">${formatCurrency(totalLiabilities + totalEquity)}</td>
        </tr>
      `;

      tbody.innerHTML = html;
    }

    // Update Income Statement table
    function updateIncomeStatement() {
      const tbody = document.getElementById('incomeStatementTable');
      if (!tbody) return;

      const revenues = accountsData.filter(acc => acc.accountType === 'revenue');
      const expenses = accountsData.filter(acc => acc.accountType === 'expense');

      let html = '';

      // Revenue section
      let totalRevenue = 0;
      revenues.forEach(account => {
        const balance = Math.abs(account.balance);
        totalRevenue += balance;
        html += `
          <tr>
            <td>${account.accountName}</td>
            <td class="text-right">${formatCurrency(balance)}</td>
          </tr>
        `;
      });

      html += `
        <tr class="section-total">
          <td>รวมรายได้</td>
          <td class="text-right">${formatCurrency(totalRevenue)}</td>
        </tr>
      `;

      // Expense section
      let totalExpense = 0;
      expenses.forEach(account => {
        const balance = Math.abs(account.balance);
        totalExpense += balance;
        html += `
          <tr>
            <td>${account.accountName}</td>
            <td class="text-right">(${formatCurrency(balance)})</td>
          </tr>
        `;
      });

      html += `
        <tr class="section-total">
          <td>รวมค่าใช้จ่าย</td>
          <td class="text-right">(${formatCurrency(totalExpense)})</td>
        </tr>
      `;

      // Net profit/loss
      const netProfit = totalRevenue - totalExpense;
      html += `
        <tr class="grand-total">
          <td>กำไร(ขาดทุน)สุทธิ</td>
          <td class="text-right ${netProfit < 0 ? 'negative-value' : ''}">${netProfit < 0 ? '(' : ''}${formatCurrency(netProfit)}${netProfit < 0 ? ')' : ''}</td>
        </tr>
      `;

      tbody.innerHTML = html;
    }

    function getChartOptions(title = '') {
      const isDark = document.documentElement.classList.contains('dark');
      return {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'top',
            labels: {
              color: isDark ? '#f8f9fa' : '#333'
            }
          },
          title: {
            display: !!title,
            text: title,
            color: isDark ? '#f8f9fa' : '#333'
          }
        },
        scales: {
          x: {
            ticks: {
              color: isDark ? '#f8f9fa' : '#333'
            },
            grid: {
              color: isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
            }
          },
          y: {
            ticks: {
              color: isDark ? '#f8f9fa' : '#333'
            },
            grid: {
              color: isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
            }
          }
        }
      };
    }
    
    let charts = {};
    
    function initializeCharts() {
      // Sample data (monthly)
      const months = ['ม.ค.', 'ก.พ.', 'มี.ค.', 'เม.ย.', 'พ.ค.', 'มิ.ย.', 'ก.ค.', 'ส.ค.', 'ก.ย.', 'ต.ค.', 'พ.ย.', 'ธ.ค.'];
      
      // 1. Sales and Growth Chart (Combination of bar and line)
      const salesGrowthCtx = document.getElementById('salesGrowthChart').getContext('2d');
      charts.salesGrowth = new Chart(salesGrowthCtx, {
        type: 'bar',
        data: {
          labels: months,
          datasets: [
            {
              label: 'ยอดขาย (พันบาท)',
              data: [240, 268, 295, 315, 342, 368, 386, 412, 438, 456, 475, 495],
              backgroundColor: 'rgba(59, 130, 246, 0.7)',
              borderColor: 'rgb(59, 130, 246)',
              borderWidth: 1
            },
            {
              label: 'อัตราการเติบโต (%)',
              data: [5.2, 5.6, 6.1, 7.3, 8.5, 9.7, 10.8, 11.5, 11.9, 12.2, 12.4, 12.8],
              type: 'line',
              borderColor: 'rgb(16, 185, 129)',
              backgroundColor: 'rgba(16, 185, 129, 0.2)',
              borderWidth: 2,
              fill: false,
              tension: 0.2,
              yAxisID: 'percentage'
            }
          ]
        },
        options: {
          ...getChartOptions(),
          scales: {
            x: {
              ticks: {
              },
              grid: {
                display: false
              }
            },
            y: {
              ticks: {
              },
              grid: {
              },
              beginAtZero: true
            },
            percentage: {
              position: 'right',
              ticks: {
              },
              grid: {
                display: false
              },
              beginAtZero: true,
              max: 15,
              min: 0
            }
          }
        }
      });
      
      // 2. Expenses and Profit Chart
      const expensesProfitCtx = document.getElementById('expensesProfitChart').getContext('2d');
      charts.expensesProfit = new Chart(expensesProfitCtx, {
        type: 'bar',
        data: {
          labels: months,
          datasets: [
            {
              label: 'ค่าใช้จ่าย (พันบาท)',
              data: [150, 157, 165, 172, 180, 192, 201, 212, 225, 238, 250, 263],
              backgroundColor: 'rgba(239, 68, 68, 0.7)',
              borderColor: 'rgb(239, 68, 68)',
              borderWidth: 1,
            },
            {
              label: 'กำไร (พันบาท)',
              data: [90, 111, 130, 143, 162, 176, 185, 200, 213, 218, 225, 232],
              backgroundColor: 'rgba(16, 185, 129, 0.7)',
              borderColor: 'rgb(16, 185, 129)',
              borderWidth: 1,
            }
          ]
        },
        options: {
          ...getChartOptions(),
          scales: {
            x: {
              ticks: {
              },
              grid: {
                display: false
              }
            },
            y: {
              ticks: {
              },
              grid: {
              },
              beginAtZero: true
            },
            percentage: {
              position: 'right',
              ticks: {
              },
              grid: {
                display: false
              },
              beginAtZero: true,
              max: 15,
              min: 0
            }
          },
          plugins: {
            legend: {
              position: 'top',
              labels: {
                padding: 20,
                boxWidth: 30
              }
            },
            tooltip: {
              callbacks: {
                title: function(context) {
                  return months[context[0].dataIndex];
                },
                label: function(context) {
                  let label = context.dataset.label || '';
                  if (label) {
                    label += ': ';
                  }
                  if (context.parsed.y !== null) {
                    label += new Intl.NumberFormat('th-TH').format(context.parsed.y) + ' พันบาท';
                  }
                  return label;
                }
              }
            }
          }
        }
      });
      
      // 3. Receivables Chart - REMOVED
      // Check if element exists before initializing
      const receivablesChartElement = document.getElementById('receivablesChart');
      if (receivablesChartElement) {
        const receivablesCtx = receivablesChartElement.getContext('2d');
        charts.receivables = new Chart(receivablesCtx, {
          type: 'pie',
          data: {
            labels: ['ไม่เกินกำหนด', 'เกินกำหนด 1-30 วัน', 'เกินกำหนด 31-60 วัน', 'เกินกำหนด 61-90 วัน', 'เกินกำหนด >90 วัน'],
            datasets: [{
              data: [65, 15, 10, 6, 4],
              backgroundColor: [
                'rgba(16, 185, 129, 0.7)',
                'rgba(245, 158, 11, 0.7)',
                'rgba(249, 115, 22, 0.7)',
                'rgba(239, 68, 68, 0.7)',
                'rgba(153, 27, 27, 0.7)'
              ],
              borderColor: [
                'rgb(16, 185, 129)',
                'rgb(245, 158, 11)',
                'rgb(249, 115, 22)',
                'rgb(239, 68, 68)',
                'rgb(153, 27, 27)'
              ],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'right',
                labels: {
                  boxWidth: 15,
                  padding: 15
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return `${context.label}: ${context.raw}%`;
                  }
                }
              }
            }
          }
        });
      }
      
      // 4. Payables Chart
      const payablesCtx = document.getElementById('payablesChart').getContext('2d');
      charts.payables = new Chart(payablesCtx, {
        type: 'pie',
        data: {
          labels: ['ไม่เกินกำหนด', 'เกินกำหนด 1-30 วัน', 'เกินกำหนด 31-60 วัน', 'เกินกำหนด 61-90 วัน', 'เกินกำหนด >90 วัน'],
          datasets: [{
            data: [78, 12, 6, 3, 1],
            backgroundColor: [
              'rgba(16, 185, 129, 0.7)',
              'rgba(245, 158, 11, 0.7)',
              'rgba(249, 115, 22, 0.7)',
              'rgba(239, 68, 68, 0.7)',
              'rgba(153, 27, 27, 0.7)'
            ],
            borderColor: [
              'rgb(16, 185, 129)',
              'rgb(245, 158, 11)',
              'rgb(249, 115, 22)',
              'rgb(239, 68, 68)',
              'rgb(153, 27, 27)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right',
              labels: {
                boxWidth: 15,
                padding: 15
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `${context.label}: ${context.raw}%`;
                }
              }
            }
          }
        }
      });
      
      // 5. Cash Flow Chart
      const cashFlowCtx = document.getElementById('cashFlowChart').getContext('2d');
      charts.cashFlow = new Chart(cashFlowCtx, {
        type: 'line',
        data: {
          labels: months,
          datasets: [
            {
              label: 'สภาพคล่องเงินสด',
              data: [1.56, 1.58, 1.62, 1.64, 1.67, 1.70, 1.72, 1.74, 1.76, 1.75, 1.73, 1.74],
              borderColor: 'rgb(59, 130, 246)',
              backgroundColor: 'rgba(59, 130, 246, 0.1)',
              borderWidth: 2,
              fill: true,
              tension: 0.3
            },
            {
              label: 'เกณฑ์มาตรฐาน',
              data: [1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5],
              borderColor: 'rgba(239, 68, 68, 0.5)',
              borderDash: [5, 5],
              borderWidth: 1,
              fill: false
            }
          ]
        },
        options: {
          ...getChartOptions(),
          scales: {
            y: {
              beginAtZero: false,
              min: 1.4,
              max: 1.9,
              ticks: {
              },
              grid: {
              }
            },
            x: {
              ticks: {
              },
              grid: {
                display: false
              }
            }
          }
        }
      });
      
      // 6. Average Sales Chart
      const averageSalesCtx = document.getElementById('averageSalesChart').getContext('2d');
      charts.averageSales = new Chart(averageSalesCtx, {
        type: 'bar',
        data: {
          labels: months,
          datasets: [
            {
              label: 'ยอดขายเฉลี่ย (บาท/วัน)',
              data: [7850, 8200, 9500, 10200, 11050, 12250, 12450, 13300, 14600, 14700, 15800, 16000],
              backgroundColor: 'rgba(139, 92, 246, 0.7)',
              borderColor: 'rgb(139, 92, 246)',
              borderWidth: 1,
              order: 2,
              yAxisID: 'y'
            },
            {
              label: 'อัตราการเติบโต (%)',
              data: [4.2, 4.5, 5.8, 7.4, 8.2, 7.9, 8.5, 9.2, 10.5, 11.2, 12.3, 13.4],
              type: 'line',
              borderColor: 'rgb(16, 185, 129)',
              backgroundColor: 'rgba(16, 185, 129, 0.2)',
              borderWidth: 3,
              fill: false,
              tension: 0.4,
              pointRadius: 5,
              pointBackgroundColor: 'rgb(16, 185, 129)',
              order: 1,
              yAxisID: 'percentage'
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            mode: 'index',
            intersect: false
          },
          plugins: {
            legend: {
              display: false // Hide legend as we have custom legend above
            },
            tooltip: {
              callbacks: {
                title: function(context) {
                  return months[context[0].dataIndex];
                },
                label: function(context) {
                  if (context.datasetIndex === 0) {
                    return `ยอดขายเฉลี่ย: ฿${new Intl.NumberFormat('th-TH').format(context.raw)} ต่อวัน`;
                  } else {
                    return `อัตราการเติบโต: ${context.raw}%`;
                  }
                }
              },
              backgroundColor: 'rgba(255, 255, 255, 0.9)',
              titleColor: '#111',
              bodyColor: '#333',
              titleFont: {
                weight: 'bold',
                size: 14
              },
              bodyFont: {
                size: 13
              },
              borderColor: 'rgba(200, 200, 200, 0.8)',
              borderWidth: 1,
              padding: 12,
              boxPadding: 6,
              usePointStyle: true,
              boxWidth: 8
            }
          },
          scales: {
            x: {
              grid: {
                display: false
              },
              ticks: {
              }
            },
            y: {
              position: 'left',
              title: {
                display: true,
                text: 'ยอดขายเฉลี่ย (บาท/วัน)',
              },
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return '฿' + value.toLocaleString('th-TH');
                }
              },
              grid: {
              }
            },
            percentage: {
              position: 'right',
              title: {
                display: true,
                text: 'อัตราการเติบโต (%)',
              },
              beginAtZero: true,
              max: 15,
              ticks: {
                callback: function(value) {
                  return value + '%';
                }
              },
              grid: {
                display: false
              }
            }
          }
        }
      });

      // ...existing code...
    }

    // ...existing code...

    function updateChartsData(period, branch = 'all') {
      // ...existing code...

      // In the switch(period) block, where averageSalesData is defined, add growth data:
      switch (period) {
        case 'month':
          // ...existing month data...
          
          // Add average sales growth data for monthly view
          const avgSalesGrowthDataMonthly = [3.1, 3.3, 3.5, 3.8, 4.2, 4.5, 4.8, 5.1, 5.4, 5.6, 5.9, 
                                   6.2, 6.5, 6.7, 7.0, 7.3, 7.6, 7.9, 8.2, 8.4, 8.7, 9.0, 
                                   9.3, 9.6, 9.9, 10.2, 10.5, 10.8, 11.2, 11.5];
          
          // ...existing code...
          break;
          
        case 'quarter':
          // ...existing quarter data...
          
          // Add growth data for quarterly view
          const avgSalesGrowthDataQuarterly = [4.2, 4.5, 5.8, 7.4, 8.2, 7.9, 8.5, 9.2, 10.5, 11.2, 12.3, 13.4];
          
          // Apply multiplier to average sales data for branches
          if (branch !== 'all') {
            averageSalesData = averageSalesData.map(value => Math.round(value * multiplier));
          }
          
          break;
          
        case 'year':
          // ...existing year data...
          
          // Add growth data for yearly view
          const avgSalesGrowthDataYearly = [3.2, 4.7, 6.5, 7.8, 8.5];
          
          // Apply multiplier to average sales data
          if (branch !== 'all') {
            averageSalesData = averageSalesData.map(value => Math.round(value * multiplier));
          }
          
          break;
      }

      // ...existing code...

      // Update Average Sales Chart with growth data
      if (charts.averageSales) {
        charts.averageSales.data.labels = labels;
        charts.averageSales.data.datasets[0].data = averageSalesData;
        
        // Add growth data depending on the period
        let growthData;
        if (period === 'month') {
          growthData = avgSalesGrowthDataMonthly;
        } else if (period === 'quarter') {
          growthData = avgSalesGrowthDataQuarterly;
        } else {
          growthData = avgSalesGrowthDataYearly;
        }
        
        // Apply branch-specific adjustments to growth data
        if (branch !== 'all') {
          const growthMultipliers = {
            'bkk': 1.2,
            'cnx': 0.95,
            'phuket': 1.5,
            'khonkaen': 0.8,
            'hadyai': 0.5
          };
          
          growthData = growthData.map(value => 
            parseFloat((value * growthMultipliers[branch]).toFixed(1))
          );
        }
        
        charts.averageSales.data.datasets[1].data = growthData;
        
        // Update the summary metrics above the chart
        const latestMonth = charts.averageSales.data.datasets[0].data.length - 1;
        document.getElementById('avgSalesValue').textContent = '฿' +
          new Intl.NumberFormat('th-TH').format(charts.averageSales.data.datasets[0].data[latestMonth]);
        
        document.getElementById('avgGrowthValue').textContent =
          '+' + charts.averageSales.data.datasets[1].data[latestMonth] + '%';
        
        charts.averageSales.update();
      }
      
      // ...existing code...
    }

    // Add this function to help troubleshoot menu issues
    function fixMenuDisplay() {
      // Apply specific CSS fixes for problematic menu items
      const nestedDropdowns = document.querySelectorAll('.submenu-item.dropdown');
      
      nestedDropdowns.forEach(dropdown => {
        // Ensure dropdown items have proper event handling
        dropdown.addEventListener('mouseenter', function() {
          const submenu = this.querySelector('ul');
          if (submenu) {
            // Position adjustment to ensure visibility
            const rect = dropdown.getBoundingClientRect();
            const windowWidth = window.innerWidth;
            
            // If dropdown would go off-screen to the right, position it to the left
            if (rect.right + 200 > windowWidth) {
              submenu.style.left = 'auto';
              submenu.style.right = '100%';
            }
          }
        });
      });
    }

    // Initialize Lottie Animation for Page Loading
    const lottieContainer = document.getElementById('lottieContainer');
    const loadingOverlay = document.getElementById('loadingOverlay');
    let lottieAnimation;

    // Function to show page loading overlay
    window.showPageLoading = function() {
      if (loadingOverlay) {
        loadingOverlay.style.display = 'flex';
        loadingOverlay.style.opacity = '1';
        loadingOverlay.style.visibility = 'visible';
      }
    };

    // Function to hide page loading overlay
    window.hidePageLoading = function() {
      if (loadingOverlay) {
        loadingOverlay.style.opacity = '0';
        setTimeout(function() {
          loadingOverlay.style.display = 'none';
          loadingOverlay.style.visibility = 'hidden';
        }, 500);
      }
    };

    if (lottieContainer && typeof lottie !== 'undefined') {
      try {
        // Load Lottie animation
        lottieAnimation = lottie.loadAnimation({
          container: lottieContainer,
          renderer: 'svg',
          loop: true,
          autoplay: true,
          path: '/Loading/Loading.json'
        });

        // Hide loading overlay after page loads
        window.addEventListener('load', function() {
          setTimeout(hidePageLoading, 800);
        });
      } catch (error) {
        console.error('Error loading Lottie animation:', error);
        loadingOverlay.style.display = 'none';
      }
    } else {
      if (loadingOverlay) loadingOverlay.style.display = 'none';
    }

    // Show loading before page navigation
    window.addEventListener('beforeunload', function() {
      showPageLoading();
    });

</script>

  <!-- Bootstrap JS 5.3.2 -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

  <!-- Account Menu Script -->
  <script src="/js/account-menu.js?v=light-v2"></script>
</body>
</html>

