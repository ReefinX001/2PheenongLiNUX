<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="ระบบจัดการซื้อสินทรัพย์ - จัดการทรัพย์สินและอุปกรณ์ของบริษัท" />
  <meta name="keywords" content="asset, ซื้อสินทรัพย์, จัดการทรัพย์สิน, fixed assets" />
  <meta name="author" content="2 พี่น้อง โมบาย" />
  <meta name="robots" content="noindex, nofollow" />
  <meta name="theme-color" content="#0ea5e9" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>ซื้อสินทรัพย์ - Purchase Asset Management</title>

  <!-- Google Font with performance optimization -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet" /></noscript>

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" crossorigin />

  <!-- Bootstrap CSS 5.3.2 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

  <!-- Lottie Animation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>

  <!-- Animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Tailwind Configuration -->
  <script>
    (function() {
      function configureTailwind() {
        try {
          if (typeof tailwind !== 'undefined') {
            tailwind.config = {
              theme: {
                extend: {
                  fontFamily: {
                    sans: ['Prompt', 'sans-serif'],
                  },
                  colors: {
                    primary: {
                      50: '#f0f9ff',
                      100: '#e0f2fe',
                      500: '#0ea5e9',
                      600: '#0284c7',
                    }
                  },
                },
              }
            };
          } else {
            setTimeout(configureTailwind, 100);
          }
        } catch (error) {
          console.error('Error configuring Tailwind:', error);
        }
      }
      configureTailwind();
    })();
  </script>

  <!-- Enhanced API and User Management -->
  <script>
    // Global configuration
    const API_BASE = '/api';

    // Safe token retrieval
    function getAuthToken() {
      try {
        return localStorage.getItem('authToken');
      } catch (error) {
        console.error('Error getting auth token:', error);
        return null;
      }
    }

    // Enhanced photo URL resolver
    function resolvePhotoUrl(raw) {
      try {
        const defaultAvatar = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCI+CiAgPGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iNTAiIGZpbGw9IiNlNWU3ZWIiLz4KICA8Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSIxOCIgZmlsbD0iIzljYTNhZiIvPgogIDxlbGxpcHNlIGN4PSI1MCIgY3k9Ijc1IiByeD0iMzAiIHJ5PSIyMCIgZmlsbD0iIzljYTNhZiIvPgo8L3N2Zz4=';

        if (!raw || typeof raw !== 'string' || raw.trim() === '') {
          return defaultAvatar;
        }

        const sanitizedRaw = raw.trim();

        if (/^https?:\/\//.test(sanitizedRaw)) return sanitizedRaw;
        if (sanitizedRaw.startsWith('data:')) return sanitizedRaw;
        if (sanitizedRaw.startsWith('/uploads/employees/')) return sanitizedRaw;
        if (sanitizedRaw.startsWith('/uploads/')) {
          return sanitizedRaw.replace(/^\/uploads\//, '/uploads/employees/');
        }

        return '/uploads/employees/' + encodeURIComponent(sanitizedRaw);
      } catch (error) {
        console.error('Error resolving photo URL:', error);
        return 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCI+CiAgPGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iNTAiIGZpbGw9IiNlNWU3ZWIiLz4KICA8Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSIxOCIgZmlsbD0iIzljYTNhZiIvPgogIDxlbGxpcHNlIGN4PSI1MCIgY3k9Ijc1IiByeD0iMzAiIHJ5PSIyMCIgZmlsbD0iIzljYTNhZiIvPgo8L3N2Zz4=';
      }
    }

    // Enhanced user profile fetching
    async function fetchUserProfile() {
      try {
        const token = getAuthToken();
        if (!token) {
          console.warn('No authentication token found');
          loadFallbackUserData();
          return;
        }

        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 10000);

        const response = await fetch(`${API_BASE}/users/me`, {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          signal: controller.signal
        });

        clearTimeout(timeoutId);

        if (!response.ok) {
          if (response.status === 401) {
            handleAuthError();
            return;
          }
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const result = await response.json();
        if (!result.success) {
          throw new Error(result.message || 'Failed to load profile');
        }

        const userData = result.data || {};
        const userName = (userData.name || userData.username || 'ผู้ใช้').trim();
        const photoUrl = userData.photoUrl || userData.employee?.imageUrl || null;

        updateUserInterface(userName, photoUrl);

        // Store for offline use
        localStorage.setItem('userName', userName);
        if (photoUrl) localStorage.setItem('userPhoto', photoUrl);

      } catch (error) {
        console.error('Error fetching user profile:', error);

        if (error.name === 'AbortError') {
          console.warn('Profile fetch timeout');
        } else if (error.message && error.message.includes('401')) {
          handleAuthError();
          return;
        }

        loadFallbackUserData();
      }
    }

    // Helper functions
    function updateUserInterface(userName, photoUrl) {
      try {
        const nameElement = document.getElementById('employeeName');
        const photoElement = document.getElementById('employeePhoto');

        if (nameElement) nameElement.textContent = userName;
        if (photoElement) {
          photoElement.src = resolvePhotoUrl(photoUrl);
          photoElement.alt = `รูปโปรไฟล์ของ ${userName}`;
          photoElement.onerror = function() {
            this.src = resolvePhotoUrl(null);
          };
        }
      } catch (error) {
        console.error('Error updating user interface:', error);
      }
    }

    function loadFallbackUserData() {
      try {
        const fallbackName = localStorage.getItem('userName') || 'ผู้ใช้';
        const fallbackPhoto = localStorage.getItem('userPhoto');
        updateUserInterface(fallbackName, fallbackPhoto);
      } catch (error) {
        console.error('Error loading fallback data:', error);
      }
    }

    // Helper to show loading before redirect
    function showLoadingAndRedirect(url) {
      const overlay = document.getElementById('loadingOverlay');
      if (overlay) {
        overlay.style.display = 'flex';
        overlay.classList.remove('animate__fadeOut');
        overlay.classList.add('animate__fadeIn');
      }
      setTimeout(() => { window.location.href = url; }, 300);
    }

    function handleAuthError() {
      try {
        console.warn('Authentication error - session expired');
        localStorage.removeItem('authToken');
        localStorage.removeItem('userName');
        localStorage.removeItem('userPhoto');

        if (confirm('เซสชันหมดอายุ ต้องการเข้าสู่ระบบใหม่หรือไม่?')) {
          showLoadingAndRedirect('/login.html');
        }
      } catch (error) {
        console.error('Error handling auth error:', error);
        showLoadingAndRedirect('/login.html');
      }
    }
  </script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow-x: hidden;
    }

    body {
      display: flex;
      flex-direction: column;
      font-family: 'Prompt', sans-serif;
      font-size: 0.875rem;
      background-color: #f8f9fa;
    }

    #mainContent {
      flex: 1;
    }

    /* Loading Overlay Styles - Enhanced with backdrop blur */
    .loading-overlay {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      background: rgba(255, 255, 255, 0.95) !important;
      display: flex !important;
      justify-content: center !important;
      align-items: center !important;
      z-index: 999999 !important;
      backdrop-filter: blur(12px) !important;
      -webkit-backdrop-filter: blur(12px) !important;
      transition: opacity 0.5s ease-out !important;
      pointer-events: auto !important;
    }

    .loading-overlay.animate__fadeOut {
      opacity: 0;
      pointer-events: none !important;
    }

    .loading-overlay.hidden,
    .loading-overlay[style*="display: none"] {
      display: none !important;
      pointer-events: none !important;
    }

    .card {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      padding: 1.5rem;
    }

    .btn {
      border-radius: 6px;
      padding: 8px 16px;
      transition: all 0.2s;
      cursor: pointer;
      border: none;
      font-weight: 500;
    }

    .btn-primary {
      background-color: #0ea5e9;
      color: white;
    }

    .btn-primary:hover {
      background-color: #0284c7;
    }

    .btn-outline {
      border: 1px solid;
      background-color: transparent;
    }

    .btn-sm {
      padding: 4px 12px;
      font-size: 0.813rem;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
    }

    .table th {
      background-color: #f8f9fa;
      text-align: left;
      padding: 12px;
      color: #6c757d;
      font-weight: 500;
      border-bottom: 2px solid #dee2e6;
      font-size: 0.813rem;
    }

    .table td {
      padding: 12px;
      border-bottom: 1px solid #eee;
      color: #333;
      font-size: 0.813rem;
    }

    .table tbody tr:hover {
      background-color: #f8f9fa;
    }

    /* Toast Notification Styles */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-width: 400px;
    }

    .toast {
      padding: 16px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 300px;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .toast.success {
      background-color: #10b981;
      color: white;
    }

    .toast.error {
      background-color: #ef4444;
      color: white;
    }

    .toast.warning {
      background-color: #f59e0b;
      color: white;
    }

    .toast.info {
      background-color: #3b82f6;
      color: white;
    }

    .toast-icon {
      font-size: 1.5rem;
      flex-shrink: 0;
    }

    .toast-content {
      flex: 1;
    }

    .toast-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .toast-message {
      font-size: 0.875rem;
      opacity: 0.95;
    }

    .toast-close {
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.2s;
      font-size: 1.25rem;
      background: none;
      border: none;
      color: inherit;
      padding: 0;
      margin-left: 8px;
    }

    .toast-close:hover {
      opacity: 1;
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .modal-content {
      background-color: white;
      border-radius: 12px;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }

    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: #111827;
    }

    .modal-body {
      padding: 24px;
    }

    .modal-footer {
      padding: 16px 24px;
      border-top: 1px solid #e5e7eb;
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    .close-modal {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #6b7280;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
    }

    .close-modal:hover {
      background-color: #f3f4f6;
      color: #111827;
    }

    .form-group {
      margin-bottom: 1.25rem;
    }

    .form-label {
      display: block;
      font-weight: 500;
      color: #374151;
      margin-bottom: 0.5rem;
      font-size: 0.875rem;
    }

    .form-control {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 0.875rem;
      transition: border-color 0.2s;
    }

    .form-control:focus {
      outline: none;
      border-color: #0ea5e9;
      box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
    }

    .form-control:read-only {
      background-color: #f9fafb;
      cursor: not-allowed;
    }

    /* Badge Styles */
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .badge-active {
      background-color: #d1fae5;
      color: #065f46;
    }

    .badge-inactive {
      background-color: #fee2e2;
      color: #991b1b;
    }

    .badge-disposed {
      background-color: #fef3c7;
      color: #92400e;
    }

    .badge-sold {
      background-color: #dbeafe;
      color: #1e40af;
    }

    /* Pagination */
    .pagination {
      display: flex;
      gap: 4px;
      align-items: center;
      justify-content: center;
      margin-top: 20px;
    }

    .page-btn {
      min-width: 36px;
      height: 36px;
      border: 1px solid #d1d5db;
      background-color: white;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.875rem;
      color: #374151;
    }

    .page-btn:hover:not(:disabled) {
      background-color: #f3f4f6;
      border-color: #9ca3af;
    }

    .page-btn.active {
      background-color: #0ea5e9;
      border-color: #0ea5e9;
      color: white;
    }

    .page-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Search and Filter */
    .search-filter-bar {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .search-box {
      flex: 1;
      min-width: 250px;
      position: relative;
    }

    .search-box input {
      width: 100%;
      padding: 8px 12px 8px 36px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 0.875rem;
    }

    .search-box i {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #9ca3af;
    }

    .hidden {
      display: none;
    }

    .navbar {
      display: flex;
      align-items: center;
      padding: 0.75rem 1rem;
      background: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 24px;
    }

    .flex-1 {
      flex: 1;
    }

    .text-right {
      text-align: right;
    }
  </style>

  <!-- Account Menu Styles -->
  <link rel="stylesheet" href="/css/account-menu.css?v=light-v3">
</head>

<body>
  <!-- Loading Overlay with Lottie Animation -->
  <div id="loadingOverlay" class="loading-overlay animate__animated animate__fadeIn" style="display: flex;">
    <div class="text-center">
      <div id="lottieContainer" style="width: 300px; height: 300px;"></div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container"></div>

  <div id="mainContent" class="container-fluid px-4 py-6">
    <!-- Navbar -->
    <div class="navbar bg-white shadow-md sticky top-0">
      <div class="flex-1 flex items-center space-x-6">
        <img src="/uploads/Logo2.png" alt="Logo" class="rounded-full shadow-lg"
             style="width: 40px; height: 40px;" loading="lazy" />
        <span class="text-lg font-semibold">ระบบบัญชี - ซื้อสินทรัพย์</span>
        <div id="mainMenuContainer" class="ml-auto"></div>
      </div>
      <div class="flex items-center space-x-3">
        <img id="employeePhoto" alt="Profile" class="w-10 h-10 rounded-full border-2 border-gray-300" loading="lazy" />
        <span id="employeeName" class="text-sm font-medium text-gray-700">ผู้ใช้</span>
        <button id="btnLogout" class="btn btn-primary btn-sm">
          <i class="bi bi-box-arrow-right mr-1"></i> ออกจากระบบ
        </button>
      </div>
    </div>

    <!-- Page Header -->
    <div class="flex justify-between items-center mb-6">
      <div>
        <h1 class="text-2xl font-semibold text-gray-800">รายการซื้อสินทรัพย์</h1>
        <p class="text-sm text-gray-600 mt-1">จัดการข้อมูลการซื้อสินทรัพย์ทั้งหมด</p>
      </div>
      <button onclick="openCreateAssetModal()" class="btn btn-primary">
        <i class="bi bi-plus-circle mr-2"></i>เพิ่มสินทรัพย์ใหม่
      </button>
    </div>

    <!-- Search and Filter -->
    <div class="card mb-4">
      <div class="search-filter-bar">
        <div class="search-box">
          <i class="bi bi-search"></i>
          <input type="text" id="searchInput" placeholder="ค้นหาเลขที่เอกสาร, ชื่อสินทรัพย์, ผู้จำหน่าย..." onkeyup="handleSearch()">
        </div>
        <select id="categoryFilter" class="form-control" style="width: 200px;" onchange="handleFilterChange()">
          <option value="">ทุกหมวดหมู่</option>
          <option value="อุปกรณ์คอมพิวเตอร์">อุปกรณ์คอมพิวเตอร์</option>
          <option value="เฟอร์นิเจอร์">เฟอร์นิเจอร์</option>
          <option value="อาคาร">อาคาร</option>
          <option value="ยานพาหนะ">ยานพาหนะ</option>
          <option value="เครื่องจักร">เครื่องจักร</option>
        </select>
        <select id="statusFilter" class="form-control" style="width: 150px;" onchange="handleFilterChange()">
          <option value="">ทุกสถานะ</option>
          <option value="active">ใช้งาน</option>
          <option value="inactive">ไม่ใช้งาน</option>
          <option value="disposed">จำหน่าย</option>
          <option value="sold">ขาย</option>
        </select>
        <select id="pageSizeSelect" class="form-control" style="width: 120px;" onchange="changePageSize()">
          <option value="10">10 รายการ</option>
          <option value="25">25 รายการ</option>
          <option value="50">50 รายการ</option>
          <option value="100">100 รายการ</option>
        </select>
      </div>
    </div>

    <!-- Assets Table -->
    <div class="card">
      <div style="overflow-x: auto;">
        <table class="table">
          <thead>
            <tr>
              <th style="width: 40px;"><input type="checkbox" id="selectAll" onchange="toggleSelectAll()"></th>
              <th>เลขที่เอกสาร</th>
              <th>ชื่อสินทรัพย์</th>
              <th>หมวดหมู่</th>
              <th>วันที่ซื้อ</th>
              <th>ผู้จำหน่าย</th>
              <th class="text-right">จำนวน</th>
              <th class="text-right">มูลค่า</th>
              <th style="text-align: center;">สถานะ</th>
              <th style="text-align: center; width: 140px;">จัดการ</th>
            </tr>
          </thead>
          <tbody id="assetTableBody">
            <!-- Data will be populated by JavaScript -->
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="pagination" id="paginationContainer">
        <!-- Pagination will be populated by JavaScript -->
      </div>

      <div class="text-center text-sm text-gray-600 mt-4">
        แสดง <span id="recordCount">0</span> รายการ
      </div>
    </div>
  </div>

  <!-- View Asset Modal -->
  <div id="viewAssetModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">รายละเอียดสินทรัพย์</h3>
        <button class="close-modal" onclick="closeViewModal()">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
      <div class="modal-body">
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
          <div class="form-group">
            <label class="form-label">เลขที่เอกสาร</label>
            <input type="text" id="viewDocumentNumber" class="form-control" readonly>
          </div>
          <div class="form-group">
            <label class="form-label">วันที่ซื้อ</label>
            <input type="text" id="viewPurchaseDate" class="form-control" readonly>
          </div>
          <div class="form-group">
            <label class="form-label">ชื่อสินทรัพย์</label>
            <input type="text" id="viewAssetName" class="form-control" readonly>
          </div>
          <div class="form-group">
            <label class="form-label">หมวดหมู่</label>
            <input type="text" id="viewCategory" class="form-control" readonly>
          </div>
          <div class="form-group">
            <label class="form-label">ผู้จำหน่าย</label>
            <input type="text" id="viewSupplier" class="form-control" readonly>
          </div>
          <div class="form-group">
            <label class="form-label">จำนวน</label>
            <input type="text" id="viewQuantity" class="form-control" readonly>
          </div>
          <div class="form-group">
            <label class="form-label">ราคาต่อหน่วย</label>
            <input type="text" id="viewUnitPrice" class="form-control" readonly>
          </div>
          <div class="form-group">
            <label class="form-label">มูลค่ารวม</label>
            <input type="text" id="viewTotalValue" class="form-control" readonly>
          </div>
          <div class="form-group">
            <label class="form-label">สถานะ</label>
            <input type="text" id="viewStatus" class="form-control" readonly>
          </div>
          <div class="form-group">
            <label class="form-label">เอกสารอ้างอิง</label>
            <input type="text" id="viewReference" class="form-control" readonly>
          </div>
          <div class="form-group" style="grid-column: 1 / -1;">
            <label class="form-label">หมายเหตุ</label>
            <textarea id="viewNotes" class="form-control" rows="3" readonly></textarea>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeViewModal()">ปิด</button>
      </div>
    </div>
  </div>

  <!-- Create Asset Modal -->
  <div id="createAssetModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">เพิ่มสินทรัพย์ใหม่</h3>
        <button class="close-modal" onclick="closeCreateModal()">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
      <div class="modal-body">
        <form id="createAssetForm" onsubmit="event.preventDefault(); createAsset();">
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
            <div class="form-group">
              <label class="form-label">เลขที่เอกสาร</label>
              <input type="text" id="createDocumentNumber" class="form-control" readonly>
            </div>
            <div class="form-group">
              <label class="form-label">วันที่ซื้อ <span class="text-danger">*</span></label>
              <input type="date" id="createPurchaseDate" class="form-control" required>
            </div>
            <div class="form-group">
              <label class="form-label">ชื่อสินทรัพย์ <span class="text-danger">*</span></label>
              <input type="text" id="createAssetName" class="form-control" placeholder="เช่น คอมพิวเตอร์ Dell" required>
            </div>
            <div class="form-group">
              <label class="form-label">หมวดหมู่</label>
              <select id="createCategory" class="form-control">
                <option value="">เลือกหมวดหมู่</option>
                <option value="อุปกรณ์คอมพิวเตอร์">อุปกรณ์คอมพิวเตอร์</option>
                <option value="เฟอร์นิเจอร์">เฟอร์นิเจอร์</option>
                <option value="อาคาร">อาคาร</option>
                <option value="ยานพาหนะ">ยานพาหนะ</option>
                <option value="เครื่องจักร">เครื่องจักร</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">ผู้จำหน่าย</label>
              <input type="text" id="createSupplier" class="form-control" placeholder="ชื่อผู้จำหน่าย">
            </div>
            <div class="form-group">
              <label class="form-label">จำนวน <span class="text-danger">*</span></label>
              <input type="number" id="createQuantity" class="form-control" value="1" min="1" required>
            </div>
            <div class="form-group">
              <label class="form-label">ราคาต่อหน่วย <span class="text-danger">*</span></label>
              <input type="number" id="createUnitPrice" class="form-control" placeholder="0.00" step="0.01" min="0" required>
            </div>
            <div class="form-group">
              <label class="form-label">เอกสารอ้างอิง</label>
              <input type="text" id="createReference" class="form-control" placeholder="เลขที่ PO, ใบเสนอราคา">
            </div>
            <div class="form-group" style="grid-column: 1 / -1;">
              <label class="form-label">หมายเหตุ</label>
              <textarea id="createNotes" class="form-control" rows="3" placeholder="รายละเอียดเพิ่มเติม"></textarea>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" onclick="closeCreateModal()">ยกเลิก</button>
        <button type="button" class="btn btn-primary" onclick="createAsset()">
          <i class="bi bi-save mr-1"></i>บันทึก
        </button>
      </div>
    </div>
  </div>

  <!-- Edit Asset Modal -->
  <div id="editAssetModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">แก้ไขสินทรัพย์</h3>
        <button class="close-modal" onclick="closeEditModal()">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
      <div class="modal-body">
        <form id="editAssetForm" onsubmit="event.preventDefault(); updateAsset();">
          <input type="hidden" id="editAssetId">
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
            <div class="form-group">
              <label class="form-label">เลขที่เอกสาร</label>
              <input type="text" id="editDocumentNumber" class="form-control" readonly>
            </div>
            <div class="form-group">
              <label class="form-label">สถานะ</label>
              <select id="editStatus" class="form-control">
                <option value="active">ใช้งาน</option>
                <option value="inactive">ไม่ใช้งาน</option>
                <option value="disposed">จำหน่าย</option>
                <option value="sold">ขาย</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">ชื่อสินทรัพย์</label>
              <input type="text" id="editAssetName" class="form-control">
            </div>
            <div class="form-group">
              <label class="form-label">หมวดหมู่</label>
              <select id="editCategory" class="form-control">
                <option value="">เลือกหมวดหมู่</option>
                <option value="อุปกรณ์คอมพิวเตอร์">อุปกรณ์คอมพิวเตอร์</option>
                <option value="เฟอร์นิเจอร์">เฟอร์นิเจอร์</option>
                <option value="อาคาร">อาคาร</option>
                <option value="ยานพาหนะ">ยานพาหนะ</option>
                <option value="เครื่องจักร">เครื่องจักร</option>
              </select>
            </div>
            <div class="form-group" style="grid-column: 1 / -1;">
              <label class="form-label">หมายเหตุ</label>
              <textarea id="editNotes" class="form-control" rows="3"></textarea>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" onclick="closeEditModal()">ยกเลิก</button>
        <button type="button" class="btn btn-primary" onclick="updateAsset()">
          <i class="bi bi-save mr-1"></i>บันทึก
        </button>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS 5.3.2 -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

  <script>
    // Initialize Lottie Animation for Loading
    const lottieContainer = document.getElementById('lottieContainer');
    const loadingOverlay = document.getElementById('loadingOverlay');
    let lottieAnimation;

    // Function to show page loading overlay
    window.showPageLoading = function() {
      if (loadingOverlay) {
        loadingOverlay.style.display = 'flex';
        loadingOverlay.classList.remove('animate__fadeOut');
        loadingOverlay.classList.add('animate__fadeIn');
      }
    };

    // Function to hide page loading overlay
    window.hidePageLoading = function() {
      if (loadingOverlay) {
        loadingOverlay.classList.remove('animate__fadeIn');
        loadingOverlay.classList.add('animate__fadeOut');
        setTimeout(function() {
          loadingOverlay.style.display = 'none';
        }, 500);
      }
    };

    if (lottieContainer && typeof lottie !== 'undefined') {
      try {
        // Load Lottie animation
        lottieAnimation = lottie.loadAnimation({
          container: lottieContainer,
          renderer: 'svg',
          loop: true,
          autoplay: true,
          path: '/Loading/Loading.json'
        });

        // Show loading overlay initially
        showPageLoading();

        // Hide loading after page loads
        window.addEventListener('load', function() {
          setTimeout(function() {
            hidePageLoading();
          }, 800);
        });

        // Fetch user profile
        fetchUserProfile();
      } catch (error) {
        console.error('Error loading Lottie animation:', error);
        loadingOverlay.style.display = 'none';
      }
    } else {
      if (loadingOverlay) loadingOverlay.style.display = 'none';
      fetchUserProfile();
    }

    // Show loading before page navigation
    window.addEventListener('beforeunload', function() {
      showPageLoading();
    });

    // Intercept internal links to show loading
    document.addEventListener('click', function(e) {
      const link = e.target.closest('a[href]');
      if (link && !link.hasAttribute('target') && !link.getAttribute('href').startsWith('#')) {
        const href = link.getAttribute('href');
        if (href && !href.startsWith('http://') && !href.startsWith('https://') && !href.startsWith('mailto:') && !href.startsWith('tel:')) {
          showPageLoading();
        }
      }
    });

    // API Configuration
    const API_ENDPOINT = '/api/assets';

    // State Management
    let currentAssets = [];
    let filteredAssets = [];
    let currentPage = 1;
    let pageSize = 10;
    let searchQuery = '';
    let categoryFilter = '';
    let statusFilter = '';
    let isCreateModalOpen = false;

    // Toast Notification Function
    function showToast(type, title, message, duration = 3000) {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type} animate__animated animate__fadeInRight`;

      const icons = {
        success: 'bi-check-circle-fill',
        error: 'bi-x-circle-fill',
        warning: 'bi-exclamation-triangle-fill',
        info: 'bi-info-circle-fill'
      };

      toast.innerHTML = `
        <i class="bi ${icons[type]} toast-icon"></i>
        <div class="toast-content">
          <div class="toast-title">${title}</div>
          <div class="toast-message">${message}</div>
        </div>
        <button class="toast-close" onclick="this.parentElement.remove()">
          <i class="bi bi-x"></i>
        </button>
      `;

      container.appendChild(toast);

      setTimeout(() => {
        toast.classList.remove('animate__fadeInRight');
        toast.classList.add('animate__fadeOutRight');
        setTimeout(() => toast.remove(), 300);
      }, duration);
    }

    // Format Currency
    function formatCurrency(amount) {
      return new Intl.NumberFormat('th-TH', {
        style: 'currency',
        currency: 'THB',
        minimumFractionDigits: 2
      }).format(amount || 0);
    }

    // Format Date Thai
    function formatDateThai(dateString) {
      if (!dateString) return '-';
      const date = new Date(dateString);
      return date.toLocaleDateString('th-TH', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });
    }

    // Get Status Badge
    function getStatusBadge(status) {
      const statusMap = {
        active: { class: 'badge-active', text: 'ใช้งาน' },
        inactive: { class: 'badge-inactive', text: 'ไม่ใช้งาน' },
        disposed: { class: 'badge-disposed', text: 'จำหน่าย' },
        sold: { class: 'badge-sold', text: 'ขาย' }
      };
      const badge = statusMap[status] || { class: 'badge-active', text: status };
      return `<span class="badge ${badge.class}">${badge.text}</span>`;
    }

    // Fetch Assets
    async function fetchAssets() {
      try {
        const token = getAuthToken();
        if (!token) {
          showToast('error', 'ข้อผิดพลาด', 'ไม่พบ Token การยืนยันตัวตน');
          return;
        }

        const response = await fetch(API_ENDPOINT, {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const result = await response.json();

        if (result.success && result.data) {
          currentAssets = result.data;
          applyFilters();
          renderAssetsTable();
        } else {
          showToast('warning', 'แจ้งเตือน', 'ไม่พบข้อมูลสินทรัพย์');
          currentAssets = [];
          renderAssetsTable();
        }
      } catch (error) {
        console.error('Error fetching assets:', error);
        showToast('error', 'ข้อผิดพลาด', 'ไม่สามารถโหลดข้อมูลได้: ' + error.message);
      }
    }

    // Apply Filters
    function applyFilters() {
      filteredAssets = currentAssets.filter(asset => {
        const matchSearch = !searchQuery ||
          (asset.documentNumber && asset.documentNumber.toLowerCase().includes(searchQuery.toLowerCase())) ||
          (asset.assetName && asset.assetName.toLowerCase().includes(searchQuery.toLowerCase())) ||
          (asset.supplier && asset.supplier.toLowerCase().includes(searchQuery.toLowerCase()));

        const matchCategory = !categoryFilter || asset.category === categoryFilter;
        const matchStatus = !statusFilter || asset.status === statusFilter;

        return matchSearch && matchCategory && matchStatus;
      });

      currentPage = 1;
    }

    // Handle Search
    function handleSearch() {
      searchQuery = document.getElementById('searchInput').value;
      applyFilters();
      renderAssetsTable();
    }

    // Handle Filter Change
    function handleFilterChange() {
      categoryFilter = document.getElementById('categoryFilter').value;
      statusFilter = document.getElementById('statusFilter').value;
      applyFilters();
      renderAssetsTable();
    }

    // Change Page Size
    function changePageSize() {
      pageSize = parseInt(document.getElementById('pageSizeSelect').value);
      currentPage = 1;
      renderAssetsTable();
    }

    // Render Assets Table
    function renderAssetsTable() {
      const tbody = document.getElementById('assetTableBody');

      if (!filteredAssets || filteredAssets.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="10" class="text-center" style="padding: 40px;">
              <i class="bi bi-inbox" style="font-size: 3rem; color: #d1d5db;"></i>
              <p style="color: #6b7280; margin-top: 12px;">ไม่พบข้อมูลสินทรัพย์</p>
            </td>
          </tr>
        `;
        document.getElementById('recordCount').textContent = '0';
        document.getElementById('paginationContainer').innerHTML = '';
        return;
      }

      const startIndex = (currentPage - 1) * pageSize;
      const endIndex = startIndex + pageSize;
      const paginatedAssets = filteredAssets.slice(startIndex, endIndex);

      tbody.innerHTML = paginatedAssets.map(asset => `
        <tr>
          <td><input type="checkbox" value="${asset._id}"></td>
          <td><span class="font-medium text-primary-600">${asset.documentNumber || '-'}</span></td>
          <td>${asset.assetName || '-'}</td>
          <td>${asset.category || '-'}</td>
          <td>${formatDateThai(asset.purchaseDate)}</td>
          <td>${asset.supplier || '-'}</td>
          <td class="text-right">${asset.quantity || 0}</td>
          <td class="text-right font-medium">${formatCurrency(asset.totalValue)}</td>
          <td style="text-align: center;">${getStatusBadge(asset.status)}</td>
          <td style="text-align: center;">
            <div class="flex justify-center gap-1">
              <button onclick="viewAsset('${asset._id}')" class="btn btn-sm btn-outline text-blue-600" title="ดูรายละเอียด">
                <i class="bi bi-eye"></i>
              </button>
              ${asset.status !== 'sold' && asset.status !== 'disposed' ? `
                <button onclick="openEditAssetModal('${asset._id}')" class="btn btn-sm btn-outline text-yellow-600" title="แก้ไข">
                  <i class="bi bi-pencil-square"></i>
                </button>
                <button onclick="deleteAsset('${asset._id}')" class="btn btn-sm btn-outline text-red-600" title="ลบ">
                  <i class="bi bi-trash"></i>
                </button>
              ` : ''}
            </div>
          </td>
        </tr>
      `).join('');

      document.getElementById('recordCount').textContent = filteredAssets.length;
      renderPagination();
    }

    // Render Pagination
    function renderPagination() {
      const container = document.getElementById('paginationContainer');
      const totalPages = Math.ceil(filteredAssets.length / pageSize);

      if (totalPages <= 1) {
        container.innerHTML = '';
        return;
      }

      let paginationHTML = `
        <button class="page-btn" onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
          <i class="bi bi-chevron-left"></i>
        </button>
      `;

      for (let i = 1; i <= totalPages; i++) {
        if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
          paginationHTML += `
            <button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">
              ${i}
            </button>
          `;
        } else if (i === currentPage - 3 || i === currentPage + 3) {
          paginationHTML += `<span style="padding: 0 8px;">...</span>`;
        }
      }

      paginationHTML += `
        <button class="page-btn" onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
          <i class="bi bi-chevron-right"></i>
        </button>
      `;

      container.innerHTML = paginationHTML;
    }

    // Change Page
    function changePage(page) {
      const totalPages = Math.ceil(filteredAssets.length / pageSize);
      if (page < 1 || page > totalPages) return;
      currentPage = page;
      renderAssetsTable();
    }

    // Toggle Select All
    function toggleSelectAll() {
      const selectAll = document.getElementById('selectAll');
      const checkboxes = document.querySelectorAll('#assetTableBody input[type="checkbox"]');
      checkboxes.forEach(cb => cb.checked = selectAll.checked);
    }

    // View Asset
    async function viewAsset(id) {
      try {
        const token = getAuthToken();
        const response = await fetch(`${API_ENDPOINT}/${id}`, {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });

        if (!response.ok) throw new Error('Failed to fetch asset');

        const result = await response.json();
        if (result.success && result.data) {
          const asset = result.data;
          document.getElementById('viewDocumentNumber').value = asset.documentNumber || '-';
          document.getElementById('viewPurchaseDate').value = formatDateThai(asset.purchaseDate);
          document.getElementById('viewAssetName').value = asset.assetName || '-';
          document.getElementById('viewCategory').value = asset.category || '-';
          document.getElementById('viewSupplier').value = asset.supplier || '-';
          document.getElementById('viewQuantity').value = asset.quantity || 0;
          document.getElementById('viewUnitPrice').value = formatCurrency(asset.unitPrice);
          document.getElementById('viewTotalValue').value = formatCurrency(asset.totalValue);
          document.getElementById('viewStatus').value = asset.status || '-';
          document.getElementById('viewReference').value = asset.referenceDocument || '-';
          document.getElementById('viewNotes').value = asset.notes || '-';

          const modal = document.getElementById('viewAssetModal');
          modal.style.display = 'flex';
          modal.classList.remove('hidden');
        }
      } catch (error) {
        console.error('Error viewing asset:', error);
        showToast('error', 'ข้อผิดพลาด', 'ไม่สามารถโหลดข้อมูลได้');
      }
    }

    // Close View Modal
    function closeViewModal() {
      const modal = document.getElementById('viewAssetModal');
      modal.style.display = 'none';
      modal.classList.add('hidden');
    }

    // Open Create Asset Modal
    async function openCreateAssetModal() {
      if (isCreateModalOpen) {
        console.log('Modal is already open');
        return;
      }
      isCreateModalOpen = true;

      try {
        const token = getAuthToken();
        const today = new Date().toISOString().split('T')[0];
        const dateCode = today.replace(/-/g, '').slice(2);

        const response = await fetch(`${API_ENDPOINT}/last-document-number?date=${dateCode}`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });

        if (response.ok) {
          const result = await response.json();
          let newNumber = 'AP-' + dateCode + '-001';

          if (result.success && result.lastNumber) {
            const lastNum = parseInt(result.lastNumber.split('-')[2]);
            newNumber = 'AP-' + dateCode + '-' + String(lastNum + 1).padStart(3, '0');
          }

          document.getElementById('createDocumentNumber').value = newNumber;
        } else {
          const today = new Date().toISOString().split('T')[0];
          document.getElementById('createDocumentNumber').value = 'AP-AUTO-' + today;
        }

        document.getElementById('createPurchaseDate').value = today;
        document.getElementById('createAssetName').value = '';
        document.getElementById('createCategory').value = '';
        document.getElementById('createSupplier').value = '';
        document.getElementById('createQuantity').value = '1';
        document.getElementById('createUnitPrice').value = '';
        document.getElementById('createReference').value = '';
        document.getElementById('createNotes').value = '';

        const modal = document.getElementById('createAssetModal');
        modal.style.display = 'flex';
        modal.classList.remove('hidden');
      } catch (error) {
        console.error('Error opening create modal:', error);
        isCreateModalOpen = false;
        showToast('error', 'ข้อผิดพลาด', 'ไม่สามารถเปิดฟอร์มได้');
      }
    }

    // Close Create Modal
    function closeCreateModal() {
      const modal = document.getElementById('createAssetModal');
      modal.style.display = 'none';
      modal.classList.add('hidden');
      isCreateModalOpen = false;
    }

    // Create Asset
    async function createAsset() {
      try {
        const assetName = document.getElementById('createAssetName').value.trim();
        const purchaseDate = document.getElementById('createPurchaseDate').value;
        const quantity = parseInt(document.getElementById('createQuantity').value);
        const unitPrice = parseFloat(document.getElementById('createUnitPrice').value);

        if (!assetName || !purchaseDate || !quantity || !unitPrice) {
          showToast('warning', 'แจ้งเตือน', 'กรุณากรอกข้อมูลที่จำเป็นให้ครบถ้วน');
          return;
        }

        const data = {
          documentNumber: document.getElementById('createDocumentNumber').value,
          purchaseDate: purchaseDate,
          assetName: assetName,
          category: document.getElementById('createCategory').value,
          supplier: document.getElementById('createSupplier').value,
          quantity: quantity,
          unitPrice: unitPrice,
          totalValue: quantity * unitPrice,
          referenceDocument: document.getElementById('createReference').value,
          notes: document.getElementById('createNotes').value,
          status: 'active'
        };

        const token = getAuthToken();
        const response = await fetch(API_ENDPOINT, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        });

        const result = await response.json();

        if (response.ok && result.success) {
          showToast('success', 'สำเร็จ', 'เพิ่มสินทรัพย์เรียบร้อยแล้ว');
          closeCreateModal();
          fetchAssets();
        } else {
          showToast('error', 'ข้อผิดพลาด', result.message || 'ไม่สามารถเพิ่มสินทรัพย์ได้');
        }
      } catch (error) {
        console.error('Error creating asset:', error);
        showToast('error', 'ข้อผิดพลาด', 'เกิดข้อผิดพลาดในการบันทึกข้อมูล');
      }
    }

    // Open Edit Asset Modal
    async function openEditAssetModal(id) {
      try {
        const token = getAuthToken();
        const response = await fetch(`${API_ENDPOINT}/${id}`, {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });

        if (!response.ok) throw new Error('Failed to fetch asset');

        const result = await response.json();
        if (result.success && result.data) {
          const asset = result.data;
          document.getElementById('editAssetId').value = asset._id;
          document.getElementById('editDocumentNumber').value = asset.documentNumber || '-';
          document.getElementById('editAssetName').value = asset.assetName || '';
          document.getElementById('editCategory').value = asset.category || '';
          document.getElementById('editStatus').value = asset.status || 'active';
          document.getElementById('editNotes').value = asset.notes || '';

          const modal = document.getElementById('editAssetModal');
          modal.style.display = 'flex';
          modal.classList.remove('hidden');
        }
      } catch (error) {
        console.error('Error opening edit modal:', error);
        showToast('error', 'ข้อผิดพลาด', 'ไม่สามารถโหลดข้อมูลได้');
      }
    }

    // Close Edit Modal
    function closeEditModal() {
      const modal = document.getElementById('editAssetModal');
      modal.style.display = 'none';
      modal.classList.add('hidden');
    }

    // Update Asset
    async function updateAsset() {
      try {
        const id = document.getElementById('editAssetId').value;
        const data = {
          assetName: document.getElementById('editAssetName').value,
          category: document.getElementById('editCategory').value,
          status: document.getElementById('editStatus').value,
          notes: document.getElementById('editNotes').value
        };

        const token = getAuthToken();
        const response = await fetch(`${API_ENDPOINT}/${id}`, {
          method: 'PUT',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        });

        const result = await response.json();

        if (response.ok && result.success) {
          showToast('success', 'สำเร็จ', 'แก้ไขสินทรัพย์เรียบร้อยแล้ว');
          closeEditModal();
          fetchAssets();
        } else {
          showToast('error', 'ข้อผิดพลาด', result.message || 'ไม่สามารถแก้ไขสินทรัพย์ได้');
        }
      } catch (error) {
        console.error('Error updating asset:', error);
        showToast('error', 'ข้อผิดพลาด', 'เกิดข้อผิดพลาดในการบันทึกข้อมูล');
      }
    }

    // Delete Asset
    async function deleteAsset(id) {
      if (!confirm('คุณต้องการลบสินทรัพย์นี้หรือไม่?')) return;

      try {
        const token = getAuthToken();
        const response = await fetch(`${API_ENDPOINT}/${id}`, {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });

        const result = await response.json();

        if (response.ok && result.success) {
          showToast('success', 'สำเร็จ', 'ลบสินทรัพย์เรียบร้อยแล้ว');
          fetchAssets();
        } else {
          showToast('error', 'ข้อผิดพลาด', result.message || 'ไม่สามารถลบสินทรัพย์ได้');
        }
      } catch (error) {
        console.error('Error deleting asset:', error);
        showToast('error', 'ข้อผิดพลาด', 'เกิดข้อผิดพลาดในการลบข้อมูล');
      }
    }

    // Logout
    document.getElementById('btnLogout').addEventListener('click', function() {
      if (confirm('คุณต้องการออกจากระบบหรือไม่?')) {
        localStorage.removeItem('authToken');
        showLoadingAndRedirect('/login.html');
      }
    });

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      fetchAssets();
    });
  </script>

  <!-- Account Menu Script -->
  <script src="/js/account-menu.js?v=light-v2"></script>
</body>
</html>
