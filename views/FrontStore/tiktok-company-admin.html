<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ TikTok ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó | 2 ‡∏û‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏á ‡πÇ‡∏°‡∏ö‡∏≤‡∏¢</title>
    <link rel="stylesheet" href="/views/FrontStore/styles.css?v=19">
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        .admin-container {
            max-width: 800px;
            margin: 40px auto;
            padding: 40px;
            background: white;
            border-radius: 24px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        .admin-header {
            text-align: center;
            margin-bottom: 40px;
        }
        .admin-header h1 {
            font-size: 32px;
            margin: 0 0 16px;
            color: #1a1a1a;
        }
        .admin-header p {
            font-size: 18px;
            color: #6b7280;
        }
        .status-card {
            background: #f3f4f6;
            padding: 24px;
            border-radius: 12px;
            margin: 20px 0;
        }
        .status-card.connected {
            background: #d1fae5;
            border: 1px solid #10b981;
        }
        .status-card.disconnected {
            background: #fee;
            border: 1px solid #ef4444;
        }
        .status-card h3 {
            font-size: 20px;
            margin: 0 0 16px;
            color: #1a1a1a;
        }
        .channel-info {
            display: flex;
            align-items: center;
            gap: 16px;
            margin: 20px 0;
            background: #f3f4f6;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            transition: all 0.3s;
        }
        .channel-info:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border-color: #d1d5db;
        }
        .channel-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #fff;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .channel-details {
            flex: 1;
        }
        .channel-details h4 {
            font-size: 20px;
            margin: 0 0 8px;
            color: #1a1a1a;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .channel-details p {
            margin: 0;
            color: #6b7280;
            font-size: 14px;
        }
        .channel-stats {
            display: flex;
            gap: 20px;
            margin-top: 12px;
        }
        .channel-stat {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            color: #4b5563;
        }
        .channel-stat i {
            color: #ff0050;
        }
        .verified-badge {
            background: linear-gradient(45deg, #ff0050, #00f2ea);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .tiktok-btn {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            background: #000;
            color: white;
            padding: 16px 32px;
            border-radius: 12px;
            text-decoration: none;
            font-size: 18px;
            font-weight: 600;
            transition: all 0.2s;
            margin: 20px 0;
        }
        .tiktok-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            color: white;
        }
        .tiktok-btn svg {
            width: 24px;
            height: 24px;
        }
        .disconnect-btn {
            background: #dc2626;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }
        .disconnect-btn:hover {
            background: #b91c1c;
        }
        .warning-box {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            padding: 16px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .warning-box h4 {
            font-size: 16px;
            margin: 0 0 8px;
            color: #92400e;
        }
        .warning-box p {
            margin: 0;
            color: #92400e;
            font-size: 14px;
        }
        .video-preview {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid #e5e7eb;
        }
        .video-preview h3 {
            font-size: 20px;
            margin: 0 0 20px;
        }
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }
        .video-thumb {
            position: relative;
            padding-bottom: 177.78%; /* 9:16 aspect ratio */
            background: #f3f4f6;
            border-radius: 8px;
            overflow: hidden;
        }
        .video-thumb img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .video-thumb .video-title {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 8px;
            background: rgba(0,0,0,0.8);
            color: white;
            font-size: 12px;
            font-weight: 500;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
        .error-msg {
            background: #fee;
            color: #dc2626;
            padding: 16px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .channels-grid {
            display: grid;
            gap: 20px;
        }
        .add-channel-section {
            text-align: center;
            margin-top: 40px;
            padding-top: 40px;
            border-top: 1px solid #e5e7eb;
            background: #f9fafb;
            padding: 40px;
            border-radius: 16px;
        }
        .add-channel-section h3 {
            margin-bottom: 20px;
            font-size: 24px;
            color: #1a1a1a;
        }
        .add-channel-section p {
            color: #6b7280;
            margin-bottom: 24px;
            font-size: 16px;
        }
        .tiktok-btn i {
            font-size: 20px;
        }
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f4f6;
            border-top-color: #ff0050;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-container">
            <div class="nav-links">
                <a href="Promotions" class="nav-link">‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</a>
                <a href="Product" class="nav-link">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
                <div class="nav-brand">
                    <a href="/" class="brand-link" title="‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å">
                        <img src="/views/FrontStore/Logo2png.png" alt="2‡∏û‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏á ‡πÇ‡∏°‡∏ö‡∏≤‡∏¢" class="brand-logo">
                    </a>
                </div>
                <a href="JoinUs" class="nav-link">‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</a>
                <a href="Contact" class="nav-link">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</a>
            </div>
        </div>
    </nav>

    <div class="admin-container">
        <div class="admin-header">
            <h1>üéµ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≠‡∏á TikTok ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</h1>
            <p>‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ TikTok ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</p>
        </div>

        <!-- Loading State -->
        <div id="loading" class="loading">
            <div class="loading-spinner"></div>
            <p style="margin-top: 20px; font-size: 16px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</p>
        </div>

        <!-- Not Connected State -->
        <div id="not-connected" style="display: none;">
            <div class="status-card disconnected">
                <h3>‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ TikTok</h3>
                <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ TikTok ‡∏Ç‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</p>
            </div>

            <div class="warning-box">
                <h4>‚ö†Ô∏è ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</h4>
                <p>‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ TikTok ‡∏Ç‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á‡πÑ‡∏î‡πâ</p>
            </div>

            <div style="text-align: center;">
                <a href="/api/tiktok/company/login" class="tiktok-btn">
                    <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M34.145 0H25.084V32.57C25.084 36.84 21.638 40.286 17.367 40.286C13.097 40.286 9.65 36.84 9.65 32.57C9.65 28.299 13.097 24.853 17.367 24.853V15.792C8.095 15.792 0.59 23.297 0.59 32.57C0.59 41.842 8.095 49.347 17.367 49.347C26.64 49.347 34.145 41.842 34.145 32.57V15.903C37.358 18.193 41.288 19.5 45.511 19.5V10.44C40.298 10.44 35.844 7.273 34.145 2.846V0Z" fill="white"/>
                    </svg>
                    ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ TikTok ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
                </a>
            </div>
        </div>

        <!-- Connected State -->
        <div id="connected" style="display: none;">
            <div class="status-card connected">
                <h3>‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ TikTok ‡πÅ‡∏•‡πâ‡∏ß</h3>
                <p>‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
            </div>

            <div class="channel-info" id="channel-info">
                <img id="channel-avatar" class="channel-avatar" src="" alt="Channel Avatar" style="display: none;">
                <div class="channel-details">
                    <h4 id="channel-name">-</h4>
                    <p>Open ID: <span id="channel-openid">-</span></p>
                    <p>‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠: <span id="connected-date">-</span></p>
                </div>
            </div>

            <div class="video-preview">
                <h3>‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (6 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</h3>
                <div id="video-grid" class="video-grid">
                    <!-- Videos will be loaded here -->
                </div>
            </div>

            <div style="text-align: center; margin-top: 40px; padding-top: 40px; border-top: 1px solid #e5e7eb;">
                <button class="disconnect-btn" onclick="disconnectAccount()">
                    ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                </button>
            </div>
        </div>

        <!-- Error State -->
        <div id="error" class="error-msg" style="display: none;"></div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-main">
                <div class="footer-section">
                    <div class="footer-brand">
                        <img src="/views/FrontStore/Logo2png.png" alt="2‡∏û‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏á ‡πÇ‡∏°‡∏ö‡∏≤‡∏¢" class="footer-logo">
                        <h2 class="footer-title">2 ‡∏û‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏á ‡πÇ‡∏°‡∏ö‡∏≤‡∏¢</h2>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3 class="footer-contact-title">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</h3>
                    <div class="footer-contact">
                        <p class="company-name">‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó 2 ‡∏û‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏á ‡πÇ‡∏°‡∏ö‡∏≤‡∏¢ ‡∏à‡∏≥‡∏Å‡∏±‡∏î</p>
                        <p class="company-address">148/91 ‡∏ï‡∏≥‡∏ö‡∏• ‡∏£‡∏π‡∏™‡∏∞‡∏°‡∏¥‡πÅ‡∏• ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ 94000</p>
                        <p class="company-phone">üìû 092 427 0769</p>
                        <p class="company-email">‚úâÔ∏è support@2pheenong.com</p>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3 class="footer-menu-title">2 ‡∏û‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏á ‡πÇ‡∏°‡∏ö‡∏≤‡∏¢</h3>
                    <div class="footer-menu">
                        <a href="/Promotions" class="footer-link">‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</a>
                        <a href="/Contact" class="footer-link">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</a>
                        <a href="/terms" class="footer-link">‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</a>
                        <a href="/privacy" class="footer-link">‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</a>
                        <a href="#" onclick="if(cookieConsent) cookieConsent.showSettings(); return false;" class="footer-link">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ</a>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 2 ‡∏û‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏á ‡πÇ‡∏°‡∏ö‡∏≤‡∏¢. ‡∏™‡∏á‡∏ß‡∏ô‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏£</p>
            </div>
        </div>
    </footer>

    <script>
        let companyTokens = null;

        async function checkConnectionStatus() {
            try {
                // Check all channels
                const channelsResponse = await fetch('/api/tiktok/channels');
        
                if (channelsResponse.ok) {
                    const channelsData = await channelsResponse.json();
                    if (channelsData.channels && channelsData.channels.length > 0) {
                        showMultiChannelState(channelsData.channels);
                    } else {
                        showNotConnectedState();
                    }
                } else {
                    showNotConnectedState();
                }
            } catch (error) {
                console.error('Error checking connection:', error);
                showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞');
            }
        }
        
        async function showMultiChannelState(channels) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('not-connected').style.display = 'none';
            document.getElementById('error').style.display = 'none';
        
            // Update connected state content to show multiple channels
            const connectedDiv = document.getElementById('connected');
            connectedDiv.style.display = 'block';
        
            // Create channels list HTML
            let channelsHTML = `
                <div class="status-card connected">
                    <h3>‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ ${channels.length} ‡∏ä‡πà‡∏≠‡∏á TikTok ‡πÅ‡∏•‡πâ‡∏ß</h3>
                    <p>‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</p>
                </div>
                
                <h3 style="margin: 30px 0 20px; display: flex; align-items: center; gap: 10px;">
                    <i class="fab fa-tiktok" style="font-size: 24px;"></i>
                    ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß:
                </h3>
                <div style="display: grid; gap: 20px;">
            `;
        
            for (const channel of channels) {
                let videoStats = '';
                try {
                    // Try to get video stats for this channel
                    const videoResponse = await fetch(`/api/tiktok/videos?channel=${encodeURIComponent(channel.username)}&limit=1`);
                    if (videoResponse.ok) {
                        const videoData = await videoResponse.json();
                        if (videoData.success && videoData.count > 0) {
                            videoStats = `
                                <div class="channel-stats">
                                    <div class="channel-stat">
                                        <i class="fas fa-video"></i>
                                        <span>${videoData.count} ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</span>
                                    </div>
                                </div>
                            `;
                        }
                    }
                } catch (error) {
                    console.error(`Error loading stats for ${channel.username}:`, error);
                }
        
                const avatarHTML = channel.avatar_url ?
                    `<img src="${channel.avatar_url}" class="channel-avatar" alt="${channel.username}">` :
                    `<div class="channel-avatar" style="background: linear-gradient(45deg, #ff0050, #00f2ea); 
                        display: flex; align-items: center; justify-content: center;">
                        <i class="fab fa-tiktok" style="color: white; font-size: 32px;"></i>
                    </div>`;
        
                channelsHTML += `
                    <div class="channel-info">
                        ${avatarHTML}
                        <div class="channel-details">
                            <h4>
                                ${channel.username}
                                <span class="verified-badge">
                                    <i class="fas fa-check-circle"></i> ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß
                                </span>
                            </h4>
                            <p>Open ID: ${channel.open_id || '-'}</p>
                            ${videoStats}
                        </div>
                        <div style="margin-left: auto;">
                            <button class="disconnect-btn" style="padding: 10px 20px; font-size: 14px;" 
                                    onclick="disconnectChannel('${channel.username}')">
                                <i class="fas fa-unlink"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                            </button>
                        </div>
                    </div>
                `;
            }
        
            channelsHTML += `
                </div>
                
                <div class="add-channel-section">
                    <h3><i class="fas fa-plus-circle" style="color: #ff0050;"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á TikTok ‡πÉ‡∏´‡∏°‡πà</h3>
                    <p>
                        ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ä‡πà‡∏≠‡∏á TikTok ‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å<br>
                        ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡∏π‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏ô‡πÉ‡∏à ‡∏´‡∏£‡∏∑‡∏≠‡∏î‡∏π‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
                    </p>
                    <a href="/api/tiktok/company/login" class="tiktok-btn" style="display: inline-flex;">
                        <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M34.145 0H25.084V32.57C25.084 36.84 21.638 40.286 17.367 40.286C13.097 40.286 9.65 36.84 9.65 32.57C9.65 28.299 13.097 24.853 17.367 24.853V15.792C8.095 15.792 0.59 23.297 0.59 32.57C0.59 41.842 8.095 49.347 17.367 49.347C26.64 49.347 34.145 41.842 34.145 32.57V15.903C37.358 18.193 41.288 19.5 45.511 19.5V10.44C40.298 10.44 35.844 7.273 34.145 2.846V0Z" fill="white"/>
                        </svg>
                        <span>‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ä‡πà‡∏≠‡∏á TikTok</span>
                    </a>
                    
                    <div style="margin-top: 30px; padding: 20px; background: white; border-radius: 12px; text-align: left;">
                        <h4 style="margin: 0 0 16px; color: #1a1a1a;">
                            <i class="fas fa-info-circle" style="color: #3b82f6;"></i> ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
                        </h4>
                        <ul style="list-style: none; padding: 0; margin: 0; color: #4b5563;">
                            <li style="margin-bottom: 10px;">
                                <i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i>
                                ‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ TikTok ‡∏Ç‡∏≠‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                            </li>
                            <li style="margin-bottom: 10px;">
                                <i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i>
                                ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
                            </li>
                            <li style="margin-bottom: 10px;">
                                <i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i>
                                ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏ö‡∏ä‡πà‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤
                            </li>
                            <li>
                                <i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i>
                                ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏à‡∏∞‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ
                            </li>
                        </ul>
                    </div>
                </div>
            `;
        
            connectedDiv.innerHTML = channelsHTML;
        }

        function showConnectedState(user) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('not-connected').style.display = 'none';
            document.getElementById('connected').style.display = 'block';
            document.getElementById('error').style.display = 'none';

            // Update channel info
            document.getElementById('channel-name').textContent = user.display_name || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏ä‡∏∑‡πà‡∏≠';
            document.getElementById('channel-openid').textContent = user.open_id || '-';
        
            if (user.avatar_url) {
                const avatar = document.getElementById('channel-avatar');
                avatar.src = user.avatar_url;
                avatar.style.display = 'block';
            }

            // Connected date would need to be stored and retrieved
            document.getElementById('connected-date').textContent = new Date().toLocaleDateString('th-TH');
        }

        function showNotConnectedState() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('not-connected').style.display = 'block';
            document.getElementById('connected').style.display = 'none';
            document.getElementById('error').style.display = 'none';
        }

        function showError(message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').textContent = message;
            document.getElementById('error').style.display = 'block';
        }

        async function loadVideos() {
            try {
                const response = await fetch('/api/tiktok/company/videos?limit=6');
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.videos) {
                        renderVideoGrid(data.videos);
                    }
                }
            } catch (error) {
                console.error('Error loading videos:', error);
            }
        }

        function renderVideoGrid(videos) {
            const grid = document.getElementById('video-grid');
            grid.innerHTML = '';

            videos.forEach(video => {
                const thumb = document.createElement('div');
                thumb.className = 'video-thumb';
        
                if (video.cover_image_url) {
                    thumb.innerHTML = `
                        <img src="${video.cover_image_url}" alt="${video.title || 'Video thumbnail'}">
                        <div class="video-title">${video.title || '‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏à‡∏≤‡∏Å TikTok'}</div>
                    `;
                } else {
                    thumb.innerHTML = `
                        <div class="video-title">${video.title || '‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏à‡∏≤‡∏Å TikTok'}</div>
                    `;
                }
        
                grid.appendChild(thumb);
            });
        }

        async function disconnectChannel(username) {
            if (!confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ä‡πà‡∏≠‡∏á ${username} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡∏≠‡∏µ‡∏Å‡∏ï‡πà‡∏≠‡πÑ‡∏õ`)) {
                return;
            }

            try {
                const response = await fetch(`/api/tiktok/channels/${encodeURIComponent(username)}`, {
                    method: 'DELETE'
                });
        
                if (response.ok) {
                    alert(`‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ä‡πà‡∏≠‡∏á ${username} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
                    checkConnectionStatus(); // Reload channels
                } else {
                    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠');
                }
            } catch (error) {
                console.error('Error disconnecting channel:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠');
            }
        }
        
        async function disconnectAccount() {
            // Legacy function for backward compatibility
            const channelsResponse = await fetch('/api/tiktok/channels');
            if (channelsResponse.ok) {
                const channelsData = await channelsResponse.json();
                if (channelsData.channels && channelsData.channels.length > 0) {
                    disconnectChannel(channelsData.channels[0].username);
                }
            }
        }

        // Check status on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkConnectionStatus();
        });
    </script>
    <script src="/views/FrontStore/cookieConsent.js"></script>
</body>
</html>
