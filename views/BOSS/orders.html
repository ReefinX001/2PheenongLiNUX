<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ระบบหลัก - Main Home</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png" />
  <link rel="shortcut icon" href="/favicon/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon/android-chrome-192x192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="/favicon/android-chrome-512x512.png" />
  
  <!-- Google Fonts - Prompt (Thai) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- ตรวจสอบการล็อกอิน: หากไม่มี authToken ให้รีไดเร็กไปที่ login -->
  <script>
    if (!localStorage.getItem('authToken')) {
      window.location.href = '/login';
    }
  </script>

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

  <!-- 1) โหลด Tailwind CSS CDN ก่อน -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- 2) ค่อยกำหนดค่า Tailwind -->
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Prompt', 'sans-serif'],
          },
          colors: {
            primary: {
              50: '#f0f9ff',
              100: '#e0f2fe',
              200: '#bae6fd',
              300: '#7dd3fc',
              400: '#38bdf8',
              500: '#0ea5e9',
              600: '#0284c7',
              700: '#0369a1',
              800: '#075985',
              900: '#0c4a6e',
            },
            secondary: {
              50: '#f8fafc',
              100: '#f1f5f9',
              200: '#e2e8f0',
              300: '#cbd5e1',
              400: '#94a3b8',
              500: '#64748b',
              600: '#475569',
              700: '#334155',
              800: '#1e293b',
              900: '#0f172a',
            },
          },
          boxShadow: {
            'card': '0 10px 15px -3px rgba(0, 0, 0, 0.08), 0 4px 6px -4px rgba(0, 0, 0, 0.05)',
            'hover': '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.05)',
          },
        },
      },
      daisyui: {
        themes: ['light', 'dark', 'corporate'],
      },
    };
  </script>

  <!-- animate.css สำหรับเอฟเฟกต์ Toast + Dot -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

  <style>
    /* Custom styles */
    body {
      font-family: 'Prompt', sans-serif;
    }
    
    .menu-card {
      transition: all 0.3s ease;
      border-radius: 12px;
      overflow: hidden;
    }
    
    .menu-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--tw-shadow-hover);
    }
    
    .badge-dot {
      transition: all 0.2s ease-in-out;
    }
    
    .activity-dot {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }
    
    .sidebar-transition {
      transition: transform 0.3s ease-in-out, width 0.3s ease-in-out;
    }
    
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.5;
      }
    }
    
    .animate-pulse-slow {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
    
    .dark ::-webkit-scrollbar-track {
      background: #1e1e1e;
    }
    
    .dark ::-webkit-scrollbar-thumb {
      background: #555;
    }
    
    .dark ::-webkit-scrollbar-thumb:hover {
      background: #777;
    }

    /* Toggle Switch Styles */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 46px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .toggle-slider {
      background-color: #3B82F6;
    }

    input:focus + .toggle-slider {
      box-shadow: 0 0 1px #3B82F6;
    }

    input:checked + .toggle-slider:before {
      transform: translateX(22px);
    }

    /* Tooltip Styles */
    .tooltip {
      position: relative;
      display: inline-block;
    }

    .tooltip .tooltip-text {
      visibility: hidden;
      width: 120px;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 5px 0;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -60px;
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 12px;
    }

    .tooltip .tooltip-text::after {
      content: "";
      position: absolute;
      top: 100%;
      left: 50%;
      margin-left: -5px;
      border-width: 5px;
      border-style: solid;
      border-color: #333 transparent transparent transparent;
    }

    .tooltip:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }

    /* Form Input Styles */
    .form-input {
      width: 100%;
      padding: 0.375rem 0.75rem;
      font-size: 0.875rem;
      line-height: 1.5;
      color: #495057;
      background-color: #fff;
      background-clip: padding-box;
      border: 1px solid #ced4da;
      border-radius: 0.25rem;
      transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    }

    .dark .form-input {
      color: #e2e8f0;
      background-color: #2d3748;
      border-color: #4a5568;
    }

    .form-input:focus {
      color: #495057;
      background-color: #fff;
      border-color: #80bdff;
      outline: 0;
      box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }

    .dark .form-input:focus {
      color: #e2e8f0;
      background-color: #2d3748;
      border-color: #4299e1;
      box-shadow: 0 0 0 0.2rem rgba(66, 153, 225, 0.25);
    }

    /* Additional CSS for customer page */
    .form-group {
      margin-bottom: 1rem;
    }
    
    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    
    .customer-card {
      transition: all 0.2s ease;
    }
    
    .customer-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }
    
    .required-field::after {
      content: "*";
      color: #ef4444;
      margin-left: 4px;
    }
    
    .pagination-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 2rem;
      height: 2rem;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      transition: all 0.2s;
    }

    /* Orders Management Styles */
    #ordersTableBody tr {
      transition: background-color 0.3s;
    }

    #ordersTableBody tr:hover {
      background-color: #f9fafb;
    }

    /* Badge styles */
    .status-pending {
      @apply inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300;
    }

    .status-confirmed {
      @apply inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300;
    }

    /* Print styles */
    @media print {
      body {
        -webkit-print-color-adjust: exact;
      }
      
      .no-print {
        display: none !important;
      }
      
      /* Table styles */
      table {
        width: 100%;
        border-collapse: collapse;
      }
      
      th, td {
        padding: 8px;
        text-align: left;
        border: 1px solid #ddd;
      }
      
      th {
        background-color: #f2f2f2;
        font-weight: bold;
      }
      
      /* Hide elements */
      .sidebar, .top-bar, .no-print {
        display: none;
      }
      
      /* Footer */
      .footer {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: 50px;
        background-color: #f9f9f9;
        text-align: center;
        padding: 10px;
        border-top: 1px solid #ddd;
      }
    }
  </style>

  <!-- Firebase SDK -->
  <script type="module">
    // Import Firebase SDK
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
    import { getDatabase, ref, onValue, set, push, serverTimestamp }
      from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js';
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCv4EBbKN8Kr4IMRqszJGBWTSoMihtYLo0",  // Fixed the truncated API key
      authDomain: "pheenongacc.firebaseapp.com",
      databaseURL: "https://pheenongacc-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "pheenongacc",
      storageBucket: "pheenongacc.appspot.com",
      messagingSenderId: "158417807357",
      appId: "1:158417807357:web:4a9c78f7aea793dc7d64494",
      measurementId: "G-F7DPQ7XG9K"
    };
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    // expose to window
    window.firebaseDB = database;
    window.firebaseRef = ref;
    window.firebaseOnValue = onValue;
    window.firebaseSet = set;
    window.firebasePush = push;
    window.firebaseServerTimestamp = serverTimestamp;
  </script>
  <!-- Socket.IO Client -->
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>

  <!-- Cart Badge Styles -->
  <style>
    .cart-badge {
      position: absolute; top: -4px; right: -4px;
      background-color: #ef4444; color: white;
      font-size: 10px; font-weight: bold;
      padding: 2px 5px; border-radius: 9999px;
      min-width: 18px; text-align: center;
    }
    .notification-badge {
      position: absolute; top: -2px; right: -2px;
      background-color: #ef4444; color: white;
      font-size: 10px; font-weight: bold;
      padding: 1px 4px; border-radius: 9999px;
      min-width: 16px; text-align: center;
    }
  </style>
</head>
<body class="bg-gray-50 font-sans dark:bg-gray-900 dark:text-white min-h-screen flex flex-col">

  <!-- Container สำหรับ Toast แจ้งเตือน -->
  <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

  <!-- Sidebar Menu -->
  <div id="sidebar" class="fixed left-0 top-0 w-64 h-full bg-white dark:bg-gray-800 shadow-lg transform -translate-x-full transition-all duration-300 z-40 sidebar-transition overflow-y-auto">
    <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img src="/favicon/favicon-32x32.png" alt="Logo" class="h-8 w-8">
        <span class="text-xl font-bold text-primary-600 dark:text-primary-400">ระบบจัดการ</span>
      </div>
      <button onclick="toggleMenu()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
    
    <!-- User Info in Sidebar -->
    <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-700">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-primary-100 dark:bg-primary-900 rounded-full flex items-center justify-center text-primary-600 dark:text-primary-300">
          <i class="bi bi-person-fill"></i>
        </div>
        <div>
          <div id="sidebarUserName" class="font-medium">Loading...</div>
          <div class="text-xs text-gray-500 dark:text-gray-400">พนักงาน</div>
        </div>
      </div>
    </div>
    
  <!-- Sidebar Menu Items -->
    <div class="py-4">
      <div class="px-4 mb-2 text-xs uppercase tracking-wider text-gray-500 dark:text-gray-400">เมนูหลัก</div>
      <ul>
        <li>
          <a href="home" class="flex items-center space-x-3 px-4 py-2.5 text-gray-700 dark:text-gray-300 hover:bg-primary-50 dark:hover:bg-primary-900/30 rounded-lg mx-2 transition-colors">
            <i class="bi bi-house-fill text-primary-500"></i>
            <span>หน้าแรก</span>
          </a>
        </li>
        <li>
          <a href="Login_Management" class="flex items-center space-x-3 px-4 py-2.5 text-gray-700 dark:text-gray-300 hover:bg-primary-50 dark:hover:bg-primary-900/30 rounded-lg mx-2 transition-colors">
            <i class="bi bi-shield-lock-fill text-orange-500"></i>
            <span>อนุมัติคำขอ</span>
          </a>
        </li>
        <li>
          <a href="online-blocked-users" class="flex items-center space-x-3 px-4 py-2.5 text-gray-700 dark:text-gray-300 hover:bg-primary-50 dark:hover:bg-primary-900/30 rounded-lg mx-2 transition-colors">
            <i class="bi bi-people-fill text-green-500"></i>
            <span>ผู้ใช้ออนไลน์</span>
          </a>
        </li>
        <li>
          <a href="price_adjustment" class="flex items-center space-x-3 px-4 py-2.5 text-gray-700 dark:text-gray-300 hover:bg-primary-50 dark:hover:bg-primary-900/30 rounded-lg mx-2 transition-colors">
            <i class="bi bi-tag-fill text-orange-500"></i>
            <span>ปรับราคาสินค้า</span>
          </a>
        </li>
      </ul>
      
      <div class="px-4 pt-4 pb-2 mt-4 text-xs uppercase tracking-wider text-gray-500 dark:text-gray-400 border-t border-gray-200 dark:border-gray-700">ระบบงาน</div>
      <ul>
        <li>
          <a href="accounting_dashboard" class="flex items-center justify-between px-4 py-2.5 text-gray-700 dark:text-gray-300 hover:bg-primary-50 dark:hover:bg-primary-900/30 rounded-lg mx-2 transition-colors">
            <div class="flex items-center space-x-3">
              <i class="bi bi-journal-text text-blue-500"></i>
              <span>งานบัญชี</span>
            </div>
            <span id="sidebar-dot-accounting" class="h-2 w-2 bg-red-500 rounded-full hidden"></span>
          </a>
        </li>
        <li>
          <a href="HR_Dashboard" class="flex items-center justify-between px-4 py-2.5 text-gray-700 dark:text-gray-300 hover:bg-primary-50 dark:hover:bg-primary-900/30 rounded-lg mx-2 transition-colors">
            <div class="flex items-center space-x-3">
              <i class="bi bi-people-fill text-green-500"></i>
              <span>ฝ่ายบุคคล</span>
            </div>
            <span id="sidebar-dot-hr" class="h-2 w-2 bg-red-500 rounded-full hidden"></span>
          </a>
        </li>
        <li>
          <a href="StockManagehome" class="flex items-center justify-between px-4 py-2.5 text-gray-700 dark:text-gray-300 hover:bg-primary-50 dark:hover:bg-primary-900/30 rounded-lg mx-2 transition-colors">
            <div class="flex items-center space-x-3">
              <i class="bi bi-box-fill text-yellow-500"></i>
              <span>คลังสินค้า</span>
            </div>
            <span id="sidebar-dot-stock" class="h-2 w-2 bg-red-500 rounded-full hidden"></span>
          </a>
        </li>
        <li>
          <a href="financial_dashboard" class="flex items-center justify-between px-4 py-2.5 text-gray-700 dark:text-gray-300 hover:bg-primary-50 dark:hover:bg-primary-900/30 rounded-lg mx-2 transition-colors">
            <div class="flex items-center space-x-3">
              <i class="bi bi-bar-chart-fill text-red-500"></i>
              <span>รายงาน</span>
            </div>
            <span id="sidebar-dot-report" class="h-2 w-2 bg-red-500 rounded-full hidden"></span>
          </a>
        </li>
        <li>
          <a href="loan_dashboard" class="flex items-center justify-between px-4 py-2.5 text-gray-700 dark:text-gray-300 hover:bg-primary-50 dark:hover:bg-primary-900/30 rounded-lg mx-2 transition-colors">
            <div class="flex items-center space-x-3">
              <i class="bi bi-credit-card-fill text-gray-500"></i>
              <span>สินเชื่อ</span>
            </div>
            <span id="sidebar-dot-loan" class="h-2 w-2 bg-red-500 rounded-full hidden"></span>
          </a>
        </li>
        <li>
          <a href="frontstore_index" class="flex items-center justify-between px-4 py-2.5 text-gray-700 dark:text-gray-300 hover:bg-primary-50 dark:hover:bg-primary-900/30 rounded-lg mx-2 transition-colors">
            <div class="flex items-center space-x-3">
              <i class="bi bi-shop-window text-blue-400"></i>
              <span>POS - ขายหน้าร้าน</span>
            </div>
            <span id="sidebar-dot-pos" class="h-2 w-2 bg-red-500 rounded-full hidden"></span>
          </a>
        </li>
        <li>
          <a href="gifts_dashboard" class="flex items-center justify-between px-4 py-2.5 text-gray-700 dark:text-gray-300 hover:bg-primary-50 dark:hover:bg-primary-900/30 rounded-lg mx-2 transition-colors">
            <div class="flex items-center space-x-3">
              <i class="bi bi-gift-fill text-pink-500"></i>
              <span>ของแถม</span>
            </div>
            <span id="sidebar-dot-gifts" class="h-2 w-2 bg-red-500 rounded-full hidden"></span>
          </a>
        </li>
      </ul>
    </div>

    <!-- Logout Button -->
    <div class="px-4 py-3 border-t border-gray-200 dark:border-gray-700">
      <button id="btnLogout" class="w-full py-2 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-lg flex items-center justify-center gap-2 hover:bg-red-200 dark:hover:bg-red-900/50 transition-colors">
        <i class="bi bi-box-arrow-right"></i>
        <span>ออกจากระบบ</span>
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <main class="flex-grow p-4 sm:p-6 lg:p-8 pt-20">
    <!-- Top Bar with Menu Toggle and Page Title -->
    <div class="mb-6 flex items-center justify-between">
      <div class="flex items-center">
        <button onclick="toggleMenu()" class="p-2 mr-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300">
          <i class="bi bi-list text-xl"></i>
        </button>
        <h1 class="text-2xl font-bold">ระบบจัดการลูกค้า</h1>
      </div>
      
      <!-- User menu dropdown -->
      <div class="relative">
        <button id="userMenuBtn" class="flex items-center space-x-2 focus:outline-none">
          <div class="w-8 h-8 bg-primary-100 dark:bg-primary-900 rounded-full flex items-center justify-center text-primary-600 dark:text-primary-300">
            <i class="bi bi-person-fill"></i>
          </div>
          <span id="currentUserName" class="hidden sm:inline-block">Loading...</span>
          <i class="bi bi-chevron-down text-xs"></i>
        </button>
        
        <!-- User dropdown menu -->
        <div id="userDropdown" class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg py-1 z-50 hidden">
          <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
            <i class="bi bi-person-circle mr-2"></i> โปรไฟล์
          </a>
          <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
            <i class="bi bi-gear-fill mr-2"></i> ตั้งค่า
          </a>
          <div class="border-t border-gray-200 dark:border-gray-700 my-1"></div>
          <a href="#" id="darkModeToggle" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
            <i class="bi bi-moon-fill mr-2"></i> <span id="darkModeText">โหมดกลางคืน</span>
          </a>
          <div class="border-t border-gray-200 dark:border-gray-700 my-1"></div>
          <a href="#" id="logoutBtn" class="block px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700">
            <i class="bi bi-box-arrow-right mr-2"></i> ออกจากระบบ
          </a>
        </div>
      </div>
    </div>

    <!-- Main Content Section for Orders -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
      <!-- Title and Statistics -->
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
        <h2 class="text-xl font-bold text-gray-800 dark:text-white mb-4 md:mb-0">
          คำสั่งซื้อรอส่ง <span class="text-primary-600 dark:text-primary-400">iPhone & iPad</span>
        </h2>
        <div class="flex flex-wrap gap-4">
          <div class="bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-lg p-3 text-center min-w-[120px]">
            <div class="text-2xl font-bold" id="totalOrdersCount">0</div>
            <div class="text-xs">คำสั่งซื้อทั้งหมด</div>
          </div>
          <div class="bg-amber-50 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 rounded-lg p-3 text-center min-w-[120px]">
            <div class="text-2xl font-bold" id="iphoneOrdersCount">0</div>
            <div class="text-xs">รายการ iPhone</div>
          </div>
          <div class="bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded-lg p-3 text-center min-w-[120px]">
            <div class="text-2xl font-bold" id="ipadOrdersCount">0</div>
            <div class="text-xs">รายการ iPad</div>
          </div>
        </div>
      </div>

      <!-- Filter Section -->
      <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <!-- Search Input -->
          <div class="form-group">
            <label for="searchOrder" class="form-label text-gray-700 dark:text-gray-300">ค้นหาคำสั่งซื้อ</label>
            <div class="relative">
              <input type="text" id="searchOrder" class="form-input pl-9" placeholder="ค้นหาตามชื่อลูกค้า, เบอร์โทร, หรือรหัสสินค้า">
              <i class="bi bi-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
            </div>
          </div>

          <!-- Product Type Filter -->
          <div class="form-group">
            <label for="productTypeFilter" class="form-label text-gray-700 dark:text-gray-300">ประเภทสินค้า</label>
            <select id="productTypeFilter" class="form-input">
              <option value="all">ทั้งหมด</option>
              <option value="iphone">iPhone</option>
              <option value="ipad">iPad</option>
            </select>
          </div>

          <!-- Branch Filter -->
          <div class="form-group">
            <label for="branchFilter" class="form-label text-gray-700 dark:text-gray-300">สาขา</label>
            <select id="branchFilter" class="form-input">
              <option value="all">ทุกสาขา</option>
              <option value="central">สาขากลาง</option>
              <option value="north">สาขาเหนือ</option>
              <option value="northeast">สาขาอีสาน</option>
              <option value="east">สาขาตะวันออก</option>
              <option value="south">สาขาใต้</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Orders Table -->
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white dark:bg-gray-800 rounded-lg overflow-hidden">
          <thead class="bg-gray-100 dark:bg-gray-700">
            <tr>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">รหัสคำสั่งซื้อ</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">วันที่สั่ง</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">ลูกค้า</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">สาขา</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">สินค้า</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">รุ่น</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">จำนวน</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">สถานะ</th>
              <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">จัดการ</th>
            </tr>
          </thead>
          <tbody id="ordersTableBody" class="divide-y divide-gray-200 dark:divide-gray-700">
            <!-- Order data will be inserted here -->
            <tr class="animate-pulse">
              <td colspan="9" class="px-4 py-10 text-center text-gray-500 dark:text-gray-400">
                <i class="bi bi-arrow-repeat text-2xl block mb-2 animate-spin"></i>
                กำลังโหลดข้อมูลคำสั่งซื้อ...
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="flex justify-between items-center mt-6">
        <div class="text-sm text-gray-500 dark:text-gray-400">
          แสดง <span id="currentDisplayRange">0-0</span> จากทั้งหมด <span id="totalOrders">0</span> รายการ
        </div>
        <div class="flex space-x-1">
          <button id="prevPageBtn" class="pagination-btn bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 disabled:opacity-50">
            <i class="bi bi-chevron-left"></i>
          </button>
          <div id="paginationNumbers" class="flex space-x-1">
            <!-- Page numbers will be generated here -->
          </div>
          <button id="nextPageBtn" class="pagination-btn bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 disabled:opacity-50">
            <i class="bi bi-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Order Detail Modal -->
    <div id="orderDetailModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center border-b border-gray-200 dark:border-gray-700 p-4">
          <h3 class="text-lg font-bold text-gray-800 dark:text-white">รายละเอียดคำสั่งซื้อ <span id="modalOrderId" class="text-primary-600 dark:text-primary-400">#12345</span></h3>
          <button class="close-modal text-gray-400 hover:text-gray-500 dark:text-gray-500 dark:hover:text-gray-400">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
        <div class="p-4">
          <!-- Customer Information -->
          <div class="mb-4">
            <h4 class="text-sm font-bold uppercase text-gray-500 dark:text-gray-400 mb-2">ข้อมูลลูกค้า</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">ชื่อลูกค้า</p>
                <p id="modalCustomerName" class="font-medium">-</p>
              </div>
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">เบอร์โทรศัพท์</p>
                <p id="modalCustomerPhone" class="font-medium">-</p>
              </div>
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">อีเมล</p>
                <p id="modalCustomerEmail" class="font-medium">-</p>
              </div>
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">วันที่สั่งซื้อ</p>
                <p id="modalOrderDate" class="font-medium">-</p>
              </div>
            </div>
          </div>

          <!-- Product Information -->
          <div class="mb-4">
            <h4 class="text-sm font-bold uppercase text-gray-500 dark:text-gray-400 mb-2">ข้อมูลสินค้า</h4>
            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3">
              <div class="flex items-center">
                <div id="modalProductIcon" class="w-10 h-10 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center text-primary-600 dark:text-primary-300 mr-3">
                  <i class="bi bi-phone"></i>
                </div>
                <div>
                  <h5 id="modalProductName" class="font-medium">iPhone 13 Pro Max</h5>
                  <p id="modalProductDetails" class="text-sm text-gray-500 dark:text-gray-400">128GB / สีเขียว</p>
                </div>
                <div class="ml-auto text-right">
                  <p id="modalProductQuantity" class="font-medium">1 เครื่อง</p>
                  <p id="modalProductPrice" class="text-sm text-gray-500 dark:text-gray-400">฿39,900</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Branch and Status -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <h4 class="text-sm font-bold uppercase text-gray-500 dark:text-gray-400 mb-2">สาขา</h4>
              <p id="modalBranchName" class="font-medium">-</p>
            </div>
            <div>
              <h4 class="text-sm font-bold uppercase text-gray-500 dark:text-gray-400 mb-2">สถานะคำสั่งซื้อ</h4>
              <div id="modalOrderStatusBadge" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300">
                รอจัดส่ง
              </div>
            </div>
          </div>

          <!-- Notes -->
          <div class="mb-4">
            <h4 class="text-sm font-bold uppercase text-gray-500 dark:text-gray-400 mb-2">หมายเหตุ</h4>
            <p id="modalOrderNotes" class="text-gray-600 dark:text-gray-300 text-sm">-</p>
          </div>
        </div>

        <!-- Modal Footer Actions -->
        <div class="border-t border-gray-200 dark:border-gray-700 p-4 flex justify-end space-x-2">
          <button class="close-modal py-2 px-4 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-lg transition-colors">
            ปิด
          </button>
          <button id="printOrderBtn" class="py-2 px-4 bg-primary-100 hover:bg-primary-200 dark:bg-primary-900/50 dark:hover:bg-primary-900 text-primary-700 dark:text-primary-300 rounded-lg transition-colors flex items-center">
            <i class="bi bi-printer mr-2"></i> พิมพ์รายละเอียด
          </button>
        </div>
      </div>
    </div>

  </main>

  <!-- JavaScript for core functionality -->
  <script>
    // Dark mode toggle
    const darkModeToggle = document.getElementById('darkModeToggle');
    const darkModeText = document.getElementById('darkModeText');

    // Check for saved theme preference or prefer-color-scheme
    const darkModePreference = localStorage.getItem('darkMode') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    
    // Apply the dark mode if it's set to 'dark'
    if (darkModePreference === 'dark') {
      document.documentElement.classList.add('dark');
      darkModeText.textContent = 'โหมดสว่าง';
    } else {
      document.documentElement.classList.remove('dark');
      darkModeText.textContent = 'โหมดมืด';
    }

    // Toggle dark mode
    darkModeToggle.addEventListener('click', function(e) {
      e.preventDefault();
      if (document.documentElement.classList.contains('dark')) {
        document.documentElement.classList.remove('dark');
        localStorage.setItem('darkMode', 'light');
        darkModeText.textContent = 'โหมดมืด';
      } else {
        document.documentElement.classList.add('dark');
        localStorage.setItem('darkMode', 'dark');
        darkModeText.textContent = 'โหมดสว่าง';
      }
    });

    // Sidebar Toggle
    function toggleMenu() {
      const sidebar = document.getElementById('sidebar');
      if (sidebar.classList.contains('-translate-x-full')) {
        sidebar.classList.remove('-translate-x-full');
      } else {
        sidebar.classList.add('-translate-x-full');
      }
    }

    // User dropdown toggle
    const userMenuBtn = document.getElementById('userMenuBtn');
    const userDropdown = document.getElementById('userDropdown');
    userMenuBtn.addEventListener('click', function() {
      userDropdown.classList.toggle('hidden');
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
      if (!userMenuBtn.contains(event.target) && !userDropdown.contains(event.target)) {
        userDropdown.classList.add('hidden');
      }
    });

    // Logout functionality
    const logoutBtn = document.getElementById('logoutBtn');
    const btnLogout = document.getElementById('btnLogout');
    
    function handleLogout() {
      // Clear authentication token
      localStorage.removeItem('authToken');
      // Redirect to login page
      window.location.href = '/login';
    }
    
    logoutBtn.addEventListener('click', function(e) {
      e.preventDefault();
      handleLogout();
    });
    
    btnLogout.addEventListener('click', handleLogout);
    
    // Get current user information
    document.addEventListener('DOMContentLoaded', function() {
      // Display the current user from localStorage
      const authUser = JSON.parse(localStorage.getItem('authUser') || '{"name": "ผู้ใช้งาน"}');
      document.getElementById('currentUserName').textContent = authUser.name;
      document.getElementById('sidebarUserName').textContent = authUser.name;
    
      // Load orders data
      loadOrders();
    
      // Setup event listeners
      setupOrdersEventListeners();
    });
    
    // Sample orders data - in a real app, this would come from Firebase
    const sampleOrders = [
      {
        id: 'ORD12345',
        date: '2023-12-01',
        customer: {
          name: 'นิมะ มะยี',
          phone: '081-234-5678',
          email: 'somchai@example.com'
        },
        branch: 'central',
        branchName: 'สาขากลาง',
        product: {
          type: 'iphone',
          name: 'iPhone 15 Pro',
          model: '256GB สีไทเทเนียม',
          quantity: 1,
          price: 42900
        },
        status: 'pending',
        notes: 'ลูกค้าต้องการรับสินค้าวันเสาร์'
      },
      {
        id: 'ORD12346',
        date: '2023-12-02',
        customer: {
          name: 'แบตั่ม วอลเลย์',
          phone: '089-876-5432',
          email: 'wipa@example.com'
        },
        branch: 'north',
        branchName: 'สาขาเหนือ',
        product: {
          type: 'ipad',
          name: 'iPad Air',
          model: '64GB สีเงิน Wi-Fi',
          quantity: 2,
          price: 23900
        },
        status: 'pending',
        notes: ''
      },
      {
        id: 'ORD12347',
        date: '2023-12-02',
        customer: {
          name: 'บอส 2พี่น้อง',
          phone: '062-345-6789',
          email: 'mana@example.com'
        },
        branch: 'south',
        branchName: 'สาขาใต้',
        product: {
          type: 'iphone',
          name: 'iPhone 15',
          model: '128GB สีชมพู',
          quantity: 1,
          price: 32900
        },
        status: 'confirmed',
        notes: 'ลูกค้าจ่ายเงินมัดจำแล้ว 5,000 บาท'
      },
      {
        id: 'ORD12348',
        date: '2023-12-03',
        customer: {
          name: 'กะไอนี ยาเงาะ',
          phone: '095-678-1234',
          email: 'piya@example.com'
        },
        branch: 'northeast',
        branchName: 'สาขาอีสาน',
        product: {
          type: 'ipad',
          name: 'iPad Pro 11"',
          model: '256GB สีเทาสเปซเกรย์ Wi-Fi+Cellular',
          quantity: 1,
          price: 36900
        },
        status: 'pending',
        notes: ''
      },
      {
        id: 'ORD12349',
        date: '2023-12-03',
        customer: {
          name: 'ยัสมีน บัญชี',
          phone: '084-234-5678',
          email: 'somsri@example.com'
        },
        branch: 'east',
        branchName: 'สาขาตะวันออก',
        product: {
          type: 'iphone',
          name: 'iPhone 15 Pro Max',
          model: '512GB สีทอง',
          quantity: 1,
          price: 56900
        },
        status: 'pending',
        notes: 'ต้องการฟิล์มกันรอย'
      },
      {
        id: 'ORD12350',
        date: '2023-12-04',
        customer: {
          name: 'แบฟิต เครียด',
          phone: '091-876-5432',
          email: 'wichai@example.com'
        },
        branch: 'central',
        branchName: 'สาขากลาง',
        product: {
          type: 'ipad',
          name: 'iPad mini',
          model: '64GB สีม่วง Wi-Fi',
          quantity: 3,
          price: 17900
        },
        status: 'pending',
        notes: 'สั่งซื้อให้บริษัท ต้องการใบกำกับภาษี'
      }
    ];

    let currentOrders = [];
    let currentPage = 1;
    const ordersPerPage = 5;

    function loadOrders() {
      // In a real app, you would fetch this from Firebase
      // For this example, we'll use the sample data
      currentOrders = [...sampleOrders];
    
      // Update counts
      updateOrdersCount();
    
      // Display orders
      displayOrders();
    }

    function updateOrdersCount() {
      const totalOrders = currentOrders.length;
      const iphoneOrders = currentOrders.filter(order => order.product.type === 'iphone').length;
      const ipadOrders = currentOrders.filter(order => order.product.type === 'ipad').length;
    
      document.getElementById('totalOrdersCount').textContent = totalOrders;
      document.getElementById('iphoneOrdersCount').textContent = iphoneOrders;
      document.getElementById('ipadOrdersCount').textContent = ipadOrders;
      document.getElementById('totalOrders').textContent = totalOrders;
    }

    function displayOrders() {
      const tableBody = document.getElementById('ordersTableBody');
      const filteredOrders = filterOrders();
    
      // Calculate pagination
      const totalPages = Math.ceil(filteredOrders.length / ordersPerPage);
      const startIndex = (currentPage - 1) * ordersPerPage;
      const endIndex = Math.min(startIndex + ordersPerPage, filteredOrders.length);
      const displayedOrders = filteredOrders.slice(startIndex, endIndex);
    
      // Update display range info
      document.getElementById('currentDisplayRange').textContent = filteredOrders.length > 0 ? `${startIndex + 1}-${endIndex}` : '0-0';
      document.getElementById('totalOrders').textContent = filteredOrders.length;
    
      // Generate pagination controls
      generatePagination(totalPages);
    
      // Clear table
      tableBody.innerHTML = '';
    
      // If no orders, show message
      if (displayedOrders.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="9" class="px-4 py-10 text-center text-gray-500 dark:text-gray-400">
              <i class="bi bi-inbox text-3xl block mb-2"></i>
              ไม่พบข้อมูลคำสั่งซื้อที่ตรงตามเงื่อนไข
            </td>
          </tr>
        `;
        return;
      }
    
      // Display orders
      displayedOrders.forEach(order => {
        const row = document.createElement('tr');
        row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors';
    
        // Format date
        const orderDate = new Date(order.date);
        const formattedDate = `${orderDate.getDate()}/${orderDate.getMonth() + 1}/${orderDate.getFullYear()}`;
    
        // Status badge style
        let statusBadge = '';
        switch(order.status) {
          case 'pending':
            statusBadge = '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300">รอจัดส่ง</span>';
            break;
          case 'confirmed':
            statusBadge = '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300">ยืนยันแล้ว</span>';
            break;
          default:
            statusBadge = '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300">ไม่ระบุ</span>';
        }
    
        // Product type icon
        const productIcon = order.product.type === 'iphone' ?
          '<i class="bi bi-phone text-blue-500 mr-1"></i>' :
          '<i class="bi bi-tablet text-purple-500 mr-1"></i>';
    
        row.innerHTML = `
          <td class="px-4 py-3 whitespace-nowrap">
            <div class="text-sm font-medium text-blue-600 dark:text-blue-400">${order.id}</div>
          </td>
          <td class="px-4 py-3 whitespace-nowrap">
            <div class="text-sm text-gray-600 dark:text-gray-300">${formattedDate}</div>
          </td>
          <td class="px-4 py-3">
            <div class="text-sm font-medium text-gray-900 dark:text-white">${order.customer.name}</div>
            <div class="text-xs text-gray-500 dark:text-gray-400">${order.customer.phone}</div>
          </td>
          <td class="px-4 py-3">
            <div class="text-sm text-gray-600 dark:text-gray-300">${order.branchName}</div>
          </td>
          <td class="px-4 py-3">
            <div class="flex items-center text-sm text-gray-600 dark:text-gray-300">
              ${productIcon}${order.product.type === 'iphone' ? 'iPhone' : 'iPad'}
            </div>
          </td>
          <td class="px-4 py-3">
            <div class="text-sm text-gray-600 dark:text-gray-300">${order.product.name}</div>
            <div class="text-xs text-gray-500 dark:text-gray-400">${order.product.model}</div>
          </td>
          <td class="px-4 py-3 whitespace-nowrap">
            <div class="text-sm text-gray-600 dark:text-gray-300">${order.product.quantity} เครื่อง</div>
          </td>
          <td class="px-4 py-3 whitespace-nowrap">
            ${statusBadge}
          </td>
          <td class="px-4 py-3 whitespace-nowrap text-center">
            <button class="view-order-btn text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 mr-2" data-order-id="${order.id}">
              <i class="bi bi-eye"></i>
            </button>
            <button class="print-order-btn text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-300" data-order-id="${order.id}">
              <i class="bi bi-printer"></i>
            </button>
          </td>
        `;
        tableBody.appendChild(row);
      });
    
      // Add event listeners to buttons
      document.querySelectorAll('.view-order-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const orderId = this.getAttribute('data-order-id');
          openOrderDetail(orderId);
        });
      });
    
      document.querySelectorAll('.print-order-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const orderId = this.getAttribute('data-order-id');
          printOrderDetail(orderId);
        });
      });
    }

    function filterOrders() {
      const searchTerm = document.getElementById('searchOrder').value.toLowerCase();
      const productType = document.getElementById('productTypeFilter').value;
      const branch = document.getElementById('branchFilter').value;
    
      return currentOrders.filter(order => {
        // Search filter
        const matchesSearch =
          order.id.toLowerCase().includes(searchTerm) ||
          order.customer.name.toLowerCase().includes(searchTerm) ||
          order.customer.phone.toLowerCase().includes(searchTerm) ||
          order.product.name.toLowerCase().includes(searchTerm) ||
          order.product.model.toLowerCase().includes(searchTerm);
    
        // Product type filter
        const matchesProductType =
          productType === 'all' ||
          order.product.type === productType;
    
        // Branch filter
        const matchesBranch =
          branch === 'all' ||
          order.branch === branch;
    
        return matchesSearch && matchesProductType && matchesBranch;
      });
    }

    function generatePagination(totalPages) {
      const paginationElement = document.getElementById('paginationNumbers');
      paginationElement.innerHTML = '';
    
      // Previous button
      const prevBtn = document.getElementById('prevPageBtn');
      prevBtn.disabled = currentPage === 1;
      prevBtn.classList.toggle('opacity-50', currentPage === 1);
    
      // Next button
      const nextBtn = document.getElementById('nextPageBtn');
      nextBtn.disabled = currentPage === totalPages || totalPages === 0;
      nextBtn.classList.toggle('opacity-50', currentPage === totalPages || totalPages === 0);
    
      // Generate page numbers
      for (let i = 1; i <= totalPages; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.className = `pagination-btn ${i === currentPage ? 'bg-primary-500 text-white' : 'bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600'}`;
        pageBtn.textContent = i;
        pageBtn.addEventListener('click', () => {
          currentPage = i;
          displayOrders();
        });
        paginationElement.appendChild(pageBtn);
      }
    }

    function openOrderDetail(orderId) {
      const order = currentOrders.find(o => o.id === orderId);
      if (!order) return;
    
      // Fill modal with order details
      document.getElementById('modalOrderId').textContent = order.id;
      document.getElementById('modalCustomerName').textContent = order.customer.name;
      document.getElementById('modalCustomerPhone').textContent = order.customer.phone;
      document.getElementById('modalCustomerEmail').textContent = order.customer.email;
    
      const orderDate = new Date(order.date);
      document.getElementById('modalOrderDate').textContent =
        `${orderDate.getDate()}/${orderDate.getMonth() + 1}/${orderDate.getFullYear()}`;
    
      document.getElementById('modalProductName').textContent = order.product.name;
      document.getElementById('modalProductDetails').textContent = order.product.model;
      document.getElementById('modalProductQuantity').textContent = `${order.product.quantity} เครื่อง`;
      document.getElementById('modalProductPrice').textContent = `฿${order.product.price.toLocaleString()}`;
    
      // Set the product icon
      const productIconElement = document.getElementById('modalProductIcon');
      if (order.product.type === 'iphone') {
        productIconElement.innerHTML = '<i class="bi bi-phone"></i>';
      } else {
        productIconElement.innerHTML = '<i class="bi bi-tablet"></i>';
      }
    
      document.getElementById('modalBranchName').textContent = order.branchName;
    
      // Set status badge
      const statusBadge = document.getElementById('modalOrderStatusBadge');
      statusBadge.className = 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium';
    
      switch(order.status) {
        case 'pending':
          statusBadge.classList.add('bg-yellow-100', 'text-yellow-800', 'dark:bg-yellow-900', 'dark:text-yellow-300');
          statusBadge.textContent = 'รอจัดส่ง';
          break;
        case 'confirmed':
          statusBadge.classList.add('bg-green-100', 'text-green-800', 'dark:bg-green-900', 'dark:text-green-300');
          statusBadge.textContent = 'ยืนยันแล้ว';
          break;
        default:
          statusBadge.classList.add('bg-gray-100', 'text-gray-800', 'dark:bg-gray-800', 'dark:text-gray-300');
          statusBadge.textContent = 'ไม่ระบุ';
      }
    
      document.getElementById('modalOrderNotes').textContent = order.notes || '-';
    
      // Show modal
      const modal = document.getElementById('orderDetailModal');
      modal.classList.remove('hidden');
    }

    function printOrderDetail(orderId) {
      const order = currentOrders.find(o => o.id === orderId);
      if (!order) return;
    
      // Create print window content
      const printContent = `
        <html>
          <head>
            <title>Order Detail - ${order.id}</title>
            <style>
              body { font-family: Arial, sans-serif; line-height: 1.6; padding: 20px; }
              h1 { font-size: 18px; margin-bottom: 10px; }
              h2 { font-size: 16px; margin-top: 20px; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
              .info-group { margin-bottom: 20px; }
              .info-row { display: flex; margin-bottom: 5px; }
              .info-label { font-weight: bold; width: 150px; }
              .info-value { flex: 1; }
              .product-box { border: 1px solid #eee; padding: 10px; margin-bottom: 10px; }
              .footer { margin-top: 30px; font-size: 12px; text-align: center; color: #666; }
            </style>
          </head>
          <body>
            <h1>รายละเอียดคำสั่งซื้อ #${order.id}</h1>
            
            <h2>ข้อมูลลูกค้า</h2>
            <div class="info-group">
              <div class="info-row">
                <div class="info-label">ชื่อลูกค้า:</div>
                <div class="info-value">${order.customer.name}</div>
              </div>
              <div class="info-row">
                <div class="info-label">เบอร์โทรศัพท์:</div>
                <div class="info-value">${order.customer.phone}</div>
              </div>
              <div class="info-row">
                <div class="info-label">อีเมล:</div>
                <div class="info-value">${order.customer.email}</div>
              </div>
              <div class="info-row">
                <div class="info-label">วันที่สั่งซื้อ:</div>
                <div class="info-value">${new Date(order.date).toLocaleDateString('th-TH')}</div>
              </div>
            </div>
            
            <h2>ข้อมูลสินค้า</h2>
            <div class="product-box">
              <div class="info-row">
                <div class="info-label">ชื่อสินค้า:</div>
                <div class="info-value">${order.product.name}</div>
              </div>
              <div class="info-row">
                <div class="info-label">รายละเอียด:</div>
                <div class="info-value">${order.product.model}</div>
              </div>
              <div class="info-row">
                <div class="info-label">จำนวน:</div>
                <div class="info-value">${order.product.quantity} เครื่อง</div>
              </div>
              <div class="info-row">
                <div class="info-label">ราคา:</div>
                <div class="info-value">฿${order.product.price.toLocaleString()}</div>
              </div>
              <div class="info-row">
                <div class="info-label">ราคารวม:</div>
                <div class="info-value">฿${(order.product.price * order.product.quantity).toLocaleString()}</div>
              </div>
            </div>
            
            <h2>ข้อมูลการจัดส่ง</h2>
            <div class="info-group">
              <div class="info-row">
                <div class="info-label">สาขา:</div>
                <div class="info-value">${order.branchName}</div>
              </div>
              <div class="info-row">
                <div class="info-label">สถานะ:</div>
                <div class="info-value">${order.status === 'pending' ? 'รอจัดส่ง' : order.status === 'confirmed' ? 'ยืนยันแล้ว' : 'ไม่ระบุ'}</div>
              </div>
              <div class="info-row">
                <div class="info-label">หมายเหตุ:</div>
                <div class="info-value">${order.notes || '-'}</div>
              </div>
            </div>
            
            <div class="footer">
              พิมพ์เมื่อ: ${new Date().toLocaleString('th-TH')}
            </div>
          </body>
        </html>
      `;
    
      // Open print window
      const printWindow = window.open('', '_blank');
      printWindow.document.write(printContent);
      printWindow.document.close();
    
      // Trigger print dialog
      setTimeout(() => {
        printWindow.print();
      }, 500);
    }

    function setupOrdersEventListeners() {
      // Filter change events
      document.getElementById('searchOrder').addEventListener('input', function() {
        currentPage = 1;
        displayOrders();
      });
    
      document.getElementById('productTypeFilter').addEventListener('change', function() {
        currentPage = 1;
        displayOrders();
      });
    
      document.getElementById('branchFilter').addEventListener('change', function() {
        currentPage = 1;
        displayOrders();
      });
    
      // Pagination controls
      document.getElementById('prevPageBtn').addEventListener('click', function() {
        if (currentPage > 1) {
          currentPage--;
          displayOrders();
        }
      });
    
      document.getElementById('nextPageBtn').addEventListener('click', function() {
        const filteredOrders = filterOrders();
        const totalPages = Math.ceil(filteredOrders.length / ordersPerPage);
        if (currentPage < totalPages) {
          currentPage++;
          displayOrders();
        }
      });
    
      // Modal close buttons
      document.querySelectorAll('.close-modal').forEach(btn => {
        btn.addEventListener('click', function() {
          document.getElementById('orderDetailModal').classList.add('hidden');
        });
      });
    
      // Print button in modal
      document.getElementById('printOrderBtn').addEventListener('click', function() {
        const orderId = document.getElementById('modalOrderId').textContent;
        printOrderDetail(orderId.replace('#', ''));
      });
    }
    
    // Show toast notification
    function showToast(message, type = 'info') {
      const toastContainer = document.getElementById('toastContainer');
    
      // Create toast element
      const toast = document.createElement('div');
      toast.className = `animate__animated animate__fadeInRight flex items-center p-4 mb-3 rounded-lg shadow-lg max-w-xs`;
    
      // Set background color based on type
      switch (type) {
        case 'success':
          toast.classList.add('bg-green-500', 'text-white');
          break;
        case 'error':
          toast.classList.add('bg-red-500', 'text-white');
          break;
        case 'warning':
          toast.classList.add('bg-yellow-500', 'text-white');
          break;
        default:
          toast.classList.add('bg-blue-500', 'text-white');
      }
    
      // Set icon based on type
      let icon;
      switch (type) {
        case 'success':
          icon = 'bi-check-circle-fill';
          break;
        case 'error':
          icon = 'bi-exclamation-circle-fill';
          break;
        case 'warning':
          icon = 'bi-exclamation-triangle-fill';
          break;
        default:
          icon = 'bi-info-circle-fill';
      }
    
      // Add content
      toast.innerHTML = `
        <i class="bi ${icon} mr-2"></i>
        <span>${message}</span>
        <button class="ml-auto text-white hover:text-gray-200 focus:outline-none">
          <i class="bi bi-x"></i>
        </button>
      `;
    
      // Add to container
      toastContainer.appendChild(toast);
    
      // Add close functionality
      toast.querySelector('button').addEventListener('click', function() {
        toast.classList.replace('animate__fadeInRight', 'animate__fadeOutRight');
        setTimeout(() => {
          toastContainer.removeChild(toast);
        }, 500);
      });
    
      // Auto remove after 5 seconds
      setTimeout(() => {
        if (toastContainer.contains(toast)) {
          toast.classList.replace('animate__fadeInRight', 'animate__fadeOutRight');
          setTimeout(() => {
            if (toastContainer.contains(toast)) {
              toastContainer.removeChild(toast);
            }
          }, 500);
        }
      }, 5000);
    }
  </script>
</body>
</html>