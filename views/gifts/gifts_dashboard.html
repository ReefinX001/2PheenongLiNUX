<!DOCTYPE html>
<html lang="th" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <title>dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind CSS & DaisyUI -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Fix Tailwind config
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Prompt', 'sans-serif']
          }
        }
      },
      daisyui: {
        themes: ['light', 'dark', 'corporate']
      }
    };
  </script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@2.51.5/dist/full.css" rel="stylesheet" />

  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- jQuery & Day.js (locale ไทย) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <!-- Socket.IO client -->
  <script src="https://cdn.socket.io/4.7.1/socket.io.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs/dayjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs/locale/th.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    // โหลดธีมที่บันทึกไว้
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      const isDark = savedTheme === 'dark';
      document.documentElement.classList.toggle('dark', isDark);
      document.documentElement.setAttribute('data-theme', savedTheme);
    }
  </script>

  <style>
    html { scroll-behavior: smooth; }
    body { font-family: 'Prompt', sans-serif; }
    @keyframes fadeIn { from {opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }
    .animate-fadeIn { animation: fadeIn 0.5s ease-out; }
    aside.collapsed { width: 5rem; }
    aside.collapsed .ml-3 { display: none; }
    @keyframes spin {0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
    .spinner { border:4px solid #f3f3f3;border-top:4px solid #3498db;border-radius:50%;width:24px;height:24px;animation:spin 1s linear infinite; }
    .Logo { max-width:100%;height:auto; }
    .status-paid { color: #16a34a; }
    .status-pending { color: #ca8a04; }
    .status-late { color: #dc2626; }
  </style>
</head>

<body class="bg-white text-gray-700 dark:bg-gray-900 dark:text-gray-200">

  <!-- Toggle Menu -->
  <button id="btnToggleMenu" title="Toggle Menu" aria-label="Toggle Menu"
    class="fixed left-0 top-1/2 transform -translate-y-1/2 bg-blue-600 text-white p-2 rounded-r-full shadow-lg z-50 hover:bg-blue-700 transition">
    <i class="bi bi-chevron-left"></i>
  </button>

  <div class="min-h-screen flex">
    <aside id="sidebar"
           class="w-64 bg-white dark:bg-gray-800 flex flex-col transition-transform duration-300 transform">
      <a href="gifts_dashboard" class="p-4 border-b border-gray-200 dark:border-gray-700">
        <img src="/uploads/Logo2.png" alt="Logo" class="Logo animate-float shadow-soft w-full h-full object-cover"
        />
      </a>
      <nav class="flex-1 p-4 overflow-y-auto">
        <ul class="space-y-1">
          <li><a href="gifts_dashboard" class="flex items-center px-4 h-12 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
            <i class="bi bi-house-door text-xl text-blue-500"></i><span class="ml-3">หน้าแรก</span>
          </a></li>

          <!-- เริ่มเมนูใหม่ -->
          <li class="my-px">
            <a href="inventory"
               class="flex flex-row items-center h-12 px-4 rounded-lg text-gray-600 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all">
              <span class="flex items-center justify-center text-lg text-indigo-500 dark:text-indigo-400">
                <i class="bi bi-boxes text-xl"></i>
              </span>
              <span class="ml-3">คลังสินค้า</span>
            </a>
          </li>
          <li class="my-px">
            <a href="order_history"
               class="flex flex-row items-center h-12 px-4 rounded-lg text-gray-600 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all">
              <span class="flex items-center justify-center text-lg text-amber-500 dark:text-amber-400">
                <i class="bi bi-clock-history text-xl"></i>
              </span>
              <span class="ml-3">ประวัติการสั่งซื้อ</span>
            </a>
          </li>
          <li class="my-px">
            <a href="costs"
               class="flex flex-row items-center h-12 px-4 rounded-lg text-gray-600 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all">
              <span class="flex items-center justify-center text-lg text-cyan-500 dark:text-cyan-400">
                <i class="bi bi-currency-dollar text-xl"></i>
              </span>
              <span class="ml-3">ต้นทุน</span>
            </a>
          </li>
          <li class="mt-6"><button id="btnToggleDark" class="flex items-center w-full px-4 h-12 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
            <i class="bi bi-moon text-xl text-indigo-500"></i><span class="ml-3" id="darkModeLabel">Dark Mode</span>
          </button></li>
          <li><button id="btnLogout" class="flex items-center w-full px-4 h-12 rounded-lg text-red-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
            <i class="bi bi-box-arrow-right text-xl text-red-500"></i><span class="ml-3">ออกจากระบบ</span>
          </button></li>
          <li class="mt-auto">
            <div id="profile" class="flex items-center px-4 h-12 bg-white dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <!-- Update profile image path -->
              <img id="employeePhoto" class="w-10 h-10 rounded-full mr-3" src="/static/images/avatar-default.png" alt="Emp"/>
              <span id="employeeName">Loading...</span>
            </div>
          </li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 dark:bg-gray-900 p-4 animate-fadeIn">
      <div class="container mx-auto">
        
        <!-- Page Header -->
        <div class="flex justify-between items-center mb-6">
          <h1 class="text-2xl font-semibold text-gray-800 dark:text-white">
            <i class="bi bi-gift text-purple-500 me-2"></i>จัดการสินค้าของแถม
          </h1>
          <button id="btnAddGift" class="btn btn-primary btn-sm">
            <i class="bi bi-plus"></i> เพิ่มสินค้าของแถม
          </button>
        </div>

        <!-- Statistics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
          <div class="bg-white dark:bg-gray-800 shadow-md rounded-lg p-4 border-l-4 border-blue-500">
            <div class="flex items-center">
              <div class="p-3 rounded-full bg-blue-100 dark:bg-blue-900 mr-4">
                <i class="bi bi-box-seam text-xl text-blue-500"></i>
              </div>
              <div>
                <p class="text-gray-500 dark:text-gray-400 text-sm">จำนวนสินค้าของแถมทั้งหมด</p>
                <p class="text-xl font-bold text-gray-800 dark:text-white" id="totalGiftItems">0 รายการ</p>
              </div>
            </div>
          </div>
          
          <div class="bg-white dark:bg-gray-800 shadow-md rounded-lg p-4 border-l-4 border-green-500">
            <div class="flex items-center">
              <div class="p-3 rounded-full bg-green-100 dark:bg-green-900 mr-4">
                <i class="bi bi-box2-heart text-xl text-green-500"></i>
              </div>
              <div>
                <p class="text-gray-500 dark:text-gray-400 text-sm">ของแถมที่แจกแล้ว</p>
                <p class="text-xl font-bold text-gray-800 dark:text-white" id="givenAwayItems">0 ชิ้น</p>
              </div>
            </div>
          </div>
          
          <div class="bg-white dark:bg-gray-800 shadow-md rounded-lg p-4 border-l-4 border-yellow-500">
            <div class="flex items-center">
              <div class="p-3 rounded-full bg-yellow-100 dark:bg-yellow-900 mr-4">
                <i class="bi bi-currency-exchange text-xl text-yellow-500"></i>
              </div>
              <div>
                <p class="text-gray-500 dark:text-gray-400 text-sm">มูลค่าสินค้าของแถมคงเหลือ</p>
                <p class="text-xl font-bold text-gray-800 dark:text-white" id="remainingValue">0.00 บาท</p>
              </div>
            </div>
          </div>
          
          <div class="bg-white dark:bg-gray-800 shadow-md rounded-lg p-4 border-l-4 border-purple-500">
            <div class="flex items-center">
              <div class="p-3 rounded-full bg-purple-100 dark:bg-purple-900 mr-4">
                <i class="bi bi-cart-plus text-xl text-purple-500"></i>
              </div>
              <div>
                <p class="text-gray-500 dark:text-gray-400 text-sm">การสั่งซื้อครั้งล่าสุด</p>
                <p class="text-xl font-bold text-gray-800 dark:text-white" id="lastOrderDate">-</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Main Content Sections -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <!-- Current Inventory Section -->
          <div class="lg:col-span-2 bg-white dark:bg-gray-800 shadow-md rounded-lg overflow-hidden">
            <div class="p-4 bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600 flex justify-between items-center">
              <h2 class="font-semibold text-lg text-gray-800 dark:text-white">คลังสินค้าของแถม</h2>
              <div class="flex">
                <div class="relative">
                  <input type="text" id="giftSearch" placeholder="ค้นหาสินค้า..." class="input input-sm input-bordered dark:bg-gray-800">
                  <i class="bi bi-search absolute right-3 top-2 text-gray-400"></i>
                </div>
                <select id="filterStatus" class="select select-sm select-bordered ml-2 dark:bg-gray-800">
                  <option value="all">ทั้งหมด</option>
                  <option value="instock">มีสินค้า</option>
                  <option value="lowstock">ใกล้หมด</option>
                  <option value="outofstock">หมด</option>
                </select>
              </div>
            </div>
            <div class="overflow-x-auto">
              <table class="table table-compact w-full">
                <thead>
                  <tr class="bg-gray-50 dark:bg-gray-700">
                    <th class="px-4 py-2">รูปภาพ</th>
                    <th class="px-4 py-2">ชื่อสินค้า</th>
                    <th class="px-4 py-2">ประเภท</th>
                    <th class="px-4 py-2">คงเหลือ</th>
                    <th class="px-4 py-2">ราคาทุน</th>
                    <th class="px-4 py-2">การดำเนินการ</th>
                  </tr>
                </thead>
                <tbody id="giftItemsList">
                  <!-- Sample gift items will be loaded dynamically -->
                  <tr class="hover:bg-gray-100 dark:hover:bg-gray-700">
                    <td class="px-4 py-2">
                      <img src="/uploads/placeholder.jpg" alt="หวีผม" class="w-10 h-10 object-cover rounded" />
                    </td>
                    <td class="px-4 py-2">หวีผมพกพา</td>
                    <td class="px-4 py-2"><span class="badge badge-info">เครื่องใช้ส่วนตัว</span></td>
                    <td class="px-4 py-2"><span class="badge badge-success">45 ชิ้น</span></td>
                    <td class="px-4 py-2">12.50 บาท</td>
                    <td class="px-4 py-2">
                      <button class="btn btn-xs btn-outline btn-info mr-1" title="แก้ไข"><i class="bi bi-pencil"></i></button>
                      <button class="btn btn-xs btn-outline btn-error" title="ลบ"><i class="bi bi-trash"></i></button>
                    </td>
                  </tr>
                  <tr class="hover:bg-gray-100 dark:hover:bg-gray-700">
                    <td class="px-4 py-2">
                      <img src="/uploads/placeholder.jpg" alt="กระจกพกพา" class="w-10 h-10 object-cover rounded" />
                    </td>
                    <td class="px-4 py-2">กระจกพกพา</td>
                    <td class="px-4 py-2"><span class="badge badge-info">เครื่องใช้ส่วนตัว</span></td>
                    <td class="px-4 py-2"><span class="badge badge-warning">8 ชิ้น</span></td>
                    <td class="px-4 py-2">18.75 บาท</td>
                    <td class="px-4 py-2">
                      <button class="btn btn-xs btn-outline btn-info mr-1" title="แก้ไข"><i class="bi bi-pencil"></i></button>
                      <button class="btn btn-xs btn-outline btn-error" title="ลบ"><i class="bi bi-trash"></i></button>
                    </td>
                  </tr>
                  <tr class="hover:bg-gray-100 dark:hover:bg-gray-700">
                    <td class="px-4 py-2">
                      <img src="/uploads/placeholder.jpg" alt="พวงกุญแจ" class="w-10 h-10 object-cover rounded" />
                    </td>
                    <td class="px-4 py-2">พวงกุญแจ</td>
                    <td class="px-4 py-2"><span class="badge badge-info">ของใช้</span></td>
                    <td class="px-4 py-2"><span class="badge badge-error">0 ชิ้น</span></td>
                    <td class="px-4 py-2">15.00 บาท</td>
                    <td class="px-4 py-2">
                      <button class="btn btn-xs btn-outline btn-info mr-1" title="แก้ไข"><i class="bi bi-pencil"></i></button>
                      <button class="btn btn-xs btn-outline btn-error" title="ลบ"><i class="bi bi-trash"></i></button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="p-3 bg-gray-50 dark:bg-gray-700 border-t dark:border-gray-600">
              <div class="flex justify-between items-center">
                <span class="text-sm text-gray-600 dark:text-gray-300">แสดง 1-3 จาก 3 รายการ</span>
                <div class="btn-group">
                  <button class="btn btn-xs btn-outline">«</button>
                  <button class="btn btn-xs bg-primary text-white">1</button>
                  <button class="btn btn-xs btn-outline">»</button>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Right Side Widgets -->
          <div class="space-y-6">
            <!-- Popular Gifts Chart -->
            <div class="bg-white dark:bg-gray-800 shadow-md rounded-lg overflow-hidden">
              <div class="p-4 bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600">
                <h2 class="font-semibold text-lg text-gray-800 dark:text-white">ของแถมยอดนิยม</h2>
              </div>
              <div class="p-4">
                <canvas id="popularGiftsChart" height="250"></canvas>
              </div>
            </div>
            
            <!-- Recent Gift Orders -->
            <div class="bg-white dark:bg-gray-800 shadow-md rounded-lg overflow-hidden">
              <div class="p-4 bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600">
                <h2 class="font-semibold text-lg text-gray-800 dark:text-white">รายการสั่งซื้อล่าสุด</h2>
              </div>
              <div class="p-4">
                <ul class="divide-y dark:divide-gray-700">
                  <li class="py-3">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="font-medium dark:text-white">หวีผมพกพา</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400">จำนวน: 50 ชิ้น</p>
                      </div>
                      <div class="text-right">
                        <p class="text-sm font-medium text-gray-900 dark:text-white">625.00 บาท</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400">10 มิ.ย. 2566</p>
                      </div>
                    </div>
                  </li>
                  <li class="py-3">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="font-medium dark:text-white">กระจกพกพา</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400">จำนวน: 30 ชิ้น</p>
                      </div>
                      <div class="text-right">
                        <p class="text-sm font-medium text-gray-900 dark:text-white">562.50 บาท</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400">28 พ.ค. 2566</p>
                      </div>
                    </div>
                  </li>
                  <li class="py-3">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="font-medium dark:text-white">พวงกุญแจ</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400">จำนวน: 40 ชิ้น</p>
                      </div>
                      <div class="text-right">
                        <p class="text-sm font-medium text-gray-900 dark:text-white">600.00 บาท</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400">15 พ.ค. 2566</p>
                      </div>
                    </div>
                  </li>
                </ul>
                <button class="btn btn-outline btn-sm w-full mt-3">ดูรายการทั้งหมด</button>
              </div>
            </div>
            
            <!-- Supplier Info -->
            <div class="bg-white dark:bg-gray-800 shadow-md rounded-lg overflow-hidden">
              <div class="p-4 bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600">
                <h2 class="font-semibold text-lg text-gray-800 dark:text-white">ข้อมูลซัพพลายเออร์</h2>
              </div>
              <div class="p-4">
                <div class="flex items-center mb-3">
                  <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center mr-3">
                    <i class="bi bi-person-circle text-2xl text-blue-500"></i>
                  </div>
                  <div>
                    <h3 class="font-medium text-lg dark:text-white">หมอชินะ</h3>
                    <p class="text-sm text-gray-500 dark:text-gray-400">ซัพพลายเออร์หลัก</p>
                  </div>
                </div>
                <div class="space-y-2 mt-2">
                  <div class="flex items-center text-sm">
                    <i class="bi bi-telephone mr-2 text-gray-500"></i>
                    <span class="dark:text-gray-300">085-123-4567</span>
                  </div>
                  <div class="flex items-center text-sm">
                    <i class="bi bi-envelope mr-2 text-gray-500"></i>
                    <span class="dark:text-gray-300">china_supply@email.com</span>
                  </div>
                  <div class="flex items-center text-sm">
                    <i class="bi bi-geo-alt mr-2 text-gray-500"></i>
                    <span class="dark:text-gray-300">123 ถ.สุขุมวิท กรุงเทพฯ 10110</span>
                  </div>
                </div>
                <button class="btn btn-outline btn-sm w-full mt-4">ติดต่อซัพพลายเออร์</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Add Gift Modal -->
      <div id="addGiftModal" class="modal">
        <div class="modal-box">
          <h3 class="font-bold text-lg mb-4">เพิ่มสินค้าของแถมใหม่</h3>
          <form id="addGiftForm">
            <div class="form-control mb-3">
              <label class="label">
                <span class="label-text">ชื่อสินค้า</span>
              </label>
              <input type="text" id="giftName" class="input input-bordered w-full" required>
            </div>
            <div class="form-control mb-3">
              <label class="label">
                <span class="label-text">ประเภท</span>
              </label>
              <select id="giftCategory" class="select select-bordered w-full" required>
                <option value="" disabled selected>เลือกประเภท</option>
                <option value="เครื่องใช้ส่วนตัว">เครื่องใช้ส่วนตัว</option>
                <option value="ของใช้">ของใช้</option>
                <option value="เครื่องเขียน">เครื่องเขียน</option>
                <option value="อื่นๆ">อื่นๆ</option>
              </select>
            </div>
            <div class="form-control mb-3">
              <label class="label">
                <span class="label-text">จำนวน</span>
              </label>
              <input type="number" id="giftQuantity" class="input input-bordered w-full" min="0" required>
            </div>
            <div class="form-control mb-3">
              <label class="label">
                <span class="label-text">ราคาทุน (บาท)</span>
              </label>
              <input type="number" id="giftCost" class="input input-bordered w-full" min="0" step="0.01" required>
            </div>
            <div class="form-control mb-3">
              <label class="label">
                <span class="label-text">รูปภาพ</span>
              </label>
              <input type="file" id="giftImage" class="file-input file-input-bordered w-full">
            </div>
            <div class="modal-action">
              <button type="button" class="btn btn-outline" onclick="closeModal()">ยกเลิก</button>
              <button type="submit" class="btn btn-primary">บันทึก</button>
            </div>
          </form>
        </div>
      </div>
    </main>
  </div>
  
  <script>
    // Toggle sidebar
    document.getElementById('btnToggleMenu').addEventListener('click', function() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('collapsed');
      this.querySelector('i').classList.toggle('bi-chevron-left');
      this.querySelector('i').classList.toggle('bi-chevron-right');
    });
    
    // Toggle dark mode
    document.getElementById('btnToggleDark').addEventListener('click', function() {
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      const newTheme = isDark ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', newTheme);
      document.documentElement.classList.toggle('dark', !isDark);
      localStorage.setItem('theme', newTheme);
      document.getElementById('darkModeLabel').textContent = isDark ? 'Dark Mode' : 'Light Mode';
    });
    
    // Logout button
    document.getElementById('btnLogout').addEventListener('click', function() {
      if (confirm('คุณต้องการออกจากระบบใช่หรือไม่?')) {
        window.location.href = '/logout';
      }
    });
    
    // Modal handling
    function openModal() {
      document.getElementById('addGiftModal').classList.add('modal-open');
    }
    
    function closeModal() {
      document.getElementById('addGiftModal').classList.remove('modal-open');'
    }
    
    document.getElementById('btnAddGift').addEventListener('click', openModal);'
    
    // Gift form submission
    document.getElementById('addGiftForm').addEventListener('submit', function(e) {'
      e.preventDefault();
      // Here you would typically send the data to the server
      alert('บันทึกสินค้าใหม่เรียบร้อย');'
      closeModal();
    });
    
    // Search functionality
    document.getElementById('giftSearch').addEventListener('input', function() {'
      const searchTerm = this.value.toLowerCase();
      const rows = document.querySelectorAll('#giftItemsList tr');'
      
      rows.forEach(row => {
        const name = row.querySelector('td:nth-child(2)').textContent.toLowerCase();'
        if (name.includes(searchTerm)) {
          row.style.display = ';
        } else {
          row.style.display = 'none;
        }
      });
    });
    
    // Filter functionality
    document.getElementById('filterStatus').addEventListener('change', function() {'
      const filter = this.value;
      const rows = document.querySelectorAll('#giftItemsList tr');'
      
      rows.forEach(row => {
        const stockElement = row.querySelector('td:nth-child(4) .badge');'
        const stockText = stockElement.textContent;
        const stockCount = parseInt(stockText);
        
        if (filter === 'all' || '
            (filter === 'instock' && stockCount > 10) || '
            (filter === 'lowstock' && stockCount > 0 && stockCount <= 10) || '
            (filter === 'outofstock' && stockCount === 0)) {'
          row.style.display = ';
        } else {
          row.style.display = 'none;
        }
      });
    });
    
    // Update dashboard stats
    function updateDashboardStats() {
      document.getElementById('totalGiftItems').textContent = '3 รายการ';
      document.getElementById('givenAwayItems').textContent = '67 ชิ้น';
      document.getElementById('remainingValue').textContent = '735.00 บาท';
      document.getElementById('lastOrderDate').textContent = '10 มิ.ย. 2566';
    }
    
    // Initialize socket connection
    const socket = io();
    
    // Load employee data from API
    async function loadEmployeeData() {
      try {
        const token = localStorage.getItem('authToken') || localStorage.getItem('token');
        if (!token) {
          document.getElementById('employeeName').textContent = 'คุณ พนักงาน';
          return;
        }

        const response = await fetch('/api/users/me', {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });

        if (response.ok) {
          const result = await response.json();
          const userData = result.data;
          
          document.getElementById('employeeName').textContent = userData.name || 'คุณ พนักงาน';
          if (userData.photoUrl) {
            document.getElementById('employeePhoto').src = userData.photoUrl;
          }
        } else {
          document.getElementById('employeeName').textContent = 'คุณ พนักงาน';
        }
      } catch (error) {
        console.error('Error loading employee data:', error);
        document.getElementById('employeeName').textContent = 'คุณ พนักงาน';
      }
    }
    
    // Initialize charts
    function initCharts() {
      const ctx = document.getElementById('popularGiftsChart').getContext('2d');
      new Chart(ctx, {
        type: 'pie','
        data: {
          labels: ['หวีผม', 'กระจกพกพา', 'พวงกุญแจ'],'
          datasets: [{
            data: [45, 30, 25],
            backgroundColor: [
              'rgba(54, 162, 235, 0.8)','
              'rgba(255, 206, 86, 0.8)','
              'rgba(75, 192, 192, 0.8)''
            ],
            borderColor: [
              'rgba(54, 162, 235, 1)','
              'rgba(255, 206, 86, 1)','
              'rgba(75, 192, 192, 1)''
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom','
              labels: {
                padding: 20,
                boxWidth: 10,
                font: {
                  size: 11
                }
              }
            },
            title: {
              display: true,
              text: 'ความนิยมของสินค้าของแถม','
              font: {
                size: 14
              }
            }
          }
        }
      });
    }
    
    // Initialize everything on document ready
    document.addEventListener('DOMContentLoaded', function() {
      loadEmployeeData();
      updateDashboardStats();
      initCharts();
      
      // Update the dark mode label correctly on page load
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      document.getElementById('darkModeLabel').textContent = isDark ? 'Light Mode' : 'Dark Mode';
    });
    
    // WebSocket for real-time updates
    socket.on('gift_inventory_update', function(data) {
      console.log('Received inventory update:', data);
      // Update inventory counts in real-time
    });
  </script>
</body>
</html>