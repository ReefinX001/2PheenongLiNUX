<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="Content-Language" content="th">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <title>‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥</title>

    <!-- Force UTF-8 encoding for all text content -->
    <script>
        document.documentElement.setAttribute('lang', 'th');
        if (document.characterSet !== 'UTF-8') {
            console.warn('Document charset is not UTF-8:', document.characterSet);
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Sarabun', 'Noto Sans Thai', 'TH Sarabun New', 'THSarabun', sans-serif;
            background: #FFFFFF;
            padding: 40px;
            color: #000000;
            line-height: 1.4;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .a4-page {
            width: 210mm;
            min-height: 297mm;
            background: #FFFFFF;
            margin: 0 auto;
            padding: 0;
            box-shadow: none;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
            padding-bottom: 20px;
            position: relative;
        }

        .logo {
            width: 145px;
            height: auto;
        }

        .company-info {
            flex: 1;
            text-align: left;
            padding: 0 20px;
        }

        .company-name {
            font-size: 14px;
            font-weight: bold;
            color: #222222;
            margin-bottom: 8px;
        }

        .company-details {
            font-size: 10px;
            color: #222222;
            line-height: 1.4;
        }

        .document-title {
            position: absolute;
            top: 30px;
            right: 0;
            text-align: right;
            color: #3498DB;
        }

        .document-title h1 {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .info-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
            padding: 15px 0;
        }

        .info-column label {
            display: block;
            font-size: 10px;
            color: #555555;
            margin-bottom: 5px;
        }

        .info-column .value {
            font-size: 10px;
            color: #000000;
            font-weight: 500;
        }

        .items-table {
            width: 100%;
            margin: 20px 0;
            border-collapse: collapse;
        }

        .items-table thead {
            background: #3498DB;
            color: #FFFFFF;
        }

        .items-table th {
            padding: 8px;
            text-align: left;
            font-size: 10px;
            font-weight: 600;
            border-bottom: 1px solid #CCCCCC;
        }

        .items-table td {
            padding: 8px;
            border-bottom: 1px solid #E0E0E0;
            font-size: 10px;
            color: #000000;
        }

        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .summary-box {
            width: 200px;
            margin-left: auto;
            margin-top: 20px;
            border: 1px solid #E0E0E0;
            padding: 15px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 10px;
            color: #000000;
        }

        .summary-row.total {
            font-weight: bold;
            font-size: 10px;
            padding-top: 8px;
            border-top: 1px solid #CCCCCC;
        }

        .amount-words {
            border: 1px solid #E0E0E0;
            padding: 10px;
            margin: 20px 0;
            font-size: 10px;
            color: #000000;
        }

        .signatures {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 40px 0 20px 0;
        }

        .signature-box {
            text-align: center;
        }

        .signature-area {
            height: 70px;
            position: relative;
            margin: 0 20px;
            border-bottom: 1px solid #888888;
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }

        .signature-on-line {
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            border: none !important;
            background: transparent;
        }

        .signature-placeholder-on-line {
            font-size: 12px;
            color: #666;
            font-style: italic;
            text-align: center;
            padding: 5px;
            background-color: rgba(249, 249, 249, 0.8);
            border: 1px dashed #ccc;
            border-radius: 4px;
            margin-bottom: 5px;
            cursor: pointer;
        }

        .signature-placeholder-on-line:hover {
            background-color: rgba(240, 240, 240, 0.9);
        }

        .signature-line {
            margin: 10px 20px;
            padding-top: 8px;
            position: relative;
            text-align: center;
        }

        .authorized-stamp {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: auto;
            z-index: 10;
        }

        .signature-label {
            font-size: 10px;
            font-weight: 600;
            color: #555555;
        }

        .signature-sublabel {
            font-size: 10px;
            color: #555555;
            margin-top: 3px;
        }

        .terms {
            font-size: 10px;
            color: #555555;
            line-height: 1.4;
            margin-top: 20px;
            padding: 10px;
            background: #FFFFFF;
            border: 1px solid #E0E0E0;
        }

        @media print {
            body {
                background: #FFFFFF;
                padding: 40px;
                -webkit-font-smoothing: auto;
                -moz-osx-font-smoothing: auto;
            }
            .a4-page {
                box-shadow: none;
                margin: 0;
            }
            .no-print {
                display: none;
            }

            /* Print-specific font settings for Thai */
            * {
                font-family: 'Sarabun', 'Noto Sans Thai', 'TH Sarabun New', 'THSarabun', 'Arial Unicode MS', sans-serif !important;
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
            }
        }

        /* Font fallback for Thai characters */
        h1, h2, h3, h4, h5, h6, p, div, span, label, td, th {
            font-family: 'Sarabun', 'Noto Sans Thai', 'TH Sarabun New', 'THSarabun', 'Arial Unicode MS', sans-serif !important;
        }

        /* Ensure proper Thai text rendering */
        .thai-text {
            font-family: 'Sarabun', 'Noto Sans Thai', 'TH Sarabun New', 'THSarabun', 'Arial Unicode MS', sans-serif;
            text-rendering: optimizeLegibility;
            -webkit-font-feature-settings: "liga";
            font-feature-settings: "liga";
        }

        .no-print {
            margin-top: 20px;
            text-align: center;
        }

        .btn {
            padding: 10px 20px;
            margin: 0 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-family: 'Sarabun', sans-serif;
        }

        .btn-primary {
            background: #3498DB;
            color: #FFFFFF;
        }

        .btn-primary:hover {
            background: #2980B9;
        }

        .btn-secondary {
            background: #555555;
            color: #FFFFFF;
        }

        .btn-secondary:hover {
            background: #333333;
        }
    </style>
</head>
<body>
    <div class="a4-page" id="receiptDocument">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <img src="../../uploads/Logo2.png" alt="Company Logo" style="width: 100%;">
            </div>

            <div class="company-info">
                <div class="company-name thai-text">‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó 2 ‡∏û‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏á ‡πÇ‡∏°‡∏ö‡∏≤‡∏¢ ‡∏à‡∏≥‡∏Å‡∏±‡∏î</div>
                <div class="company-details thai-text">
                    ‡∏™‡∏≤‡∏Ç‡∏≤: ‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤ 00000<br>
                    148/91 ‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 6 ‡∏ï‡∏≥‡∏ö‡∏•‡∏£‡∏π‡∏™‡∏∞‡∏°‡∏¥‡πÅ‡∏• ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ 94000<br>
                    ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ‡∏≠‡∏≤‡∏Å‡∏£ 0945566000616<br>
                    ‡πÇ‡∏ó‡∏£: 09-2427-0769
                </div>
            </div>

            <div class="document-title">
                <h1 id="docType" class="thai-text">‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥ / DEPOSIT RECEIPT</h1>
            </div>
        </div>

        <!-- Customer & Deposit Info -->
        <div class="info-section">
            <div class="info-column">
                <div style="margin-bottom: 15px;">
                    <label class="thai-text">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥ Deposit Receipt No.</label>
                    <div class="value thai-text" id="receiptNumber">-</div>
                </div>
                <div style="margin-bottom: 15px;">
                    <label class="thai-text">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô Receipt Date</label>
                    <div class="value thai-text" id="depositDate">-</div>
                </div>
                <div style="margin-bottom: 15px;">
                    <label class="thai-text">‡πÄ‡∏ß‡∏•‡∏≤ Time</label>
                    <div class="value thai-text" id="depositTime">-</div>
                </div>
                <div style="margin-bottom: 15px;">
                    <label class="thai-text">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ Sale Type</label>
                    <div class="value thai-text" id="saleType">-</div>
                </div>
                <div>
                    <label class="thai-text">‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô Payment Method</label>
                    <div class="value thai-text" id="paymentMethod">-</div>
                </div>
                <!-- ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏ö‡∏ö‡∏ú‡∏™‡∏° -->
                <div id="mixedPaymentDetails" class="thai-text" style="display: none; margin-top: 10px; padding: 8px; background-color: #f8f9fa; border-radius: 4px; border-left: 3px solid #3498DB;">
                    <div class="thai-text" style="font-size: 9px; font-weight: 600; color: #3498DB; margin-bottom: 5px;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞:</div>
                    <div style="font-size: 8px; margin-bottom: 2px;">
                        <span class="thai-text" style="color: #27ae60;">üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î:</span>
                        <span id="mixedCashAmount" class="thai-text">‡∏ø0</span>
                    </div>
                    <div style="font-size: 8px;">
                        <span class="thai-text" style="color: #2980b9;">üè¶ ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô:</span>
                        <span id="mixedTransferAmount" class="thai-text">‡∏ø0</span>
                    </div>
                </div>
            </div>

            <div class="info-column">
                <div style="margin-bottom: 15px;">
                    <label class="thai-text">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô Customer Name</label>
                    <div class="value thai-text" id="customerName">-</div>
                </div>
                <div style="margin-bottom: 15px;">
                    <label class="thai-text">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå Phone Number</label>
                    <div class="value thai-text" id="customerPhone">-</div>
                </div>
                <div style="margin-bottom: 15px;">
                    <label class="thai-text">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà Address</label>
                    <div class="value thai-text" id="customerAddress">-</div>
                </div>
                <div style="margin-bottom: 15px;">
                    <label class="thai-text">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏°‡∏±‡∏î‡∏à‡∏≥ Deposit Type</label>
                    <div class="value thai-text" id="depositType">-</div>
                </div>
                <div>
                    <label class="thai-text">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô Cashier</label>
                    <div class="value thai-text" id="salespersonName">-</div>
                </div>
            </div>
        </div>

        <!-- Items Table -->
        <table class="items-table">
            <thead>
                <tr>
                    <th style="width: 50px;" class="thai-text">‡∏•‡∏≥‡∏î‡∏±‡∏ö<br><small>No</small></th>
                    <th class="thai-text">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤<br><small>Product Details</small></th>
                    <th style="width: 100px;" class="text-right thai-text">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ï‡πá‡∏°<br><small>Full Price</small></th>
                    <th style="width: 100px;" class="text-right thai-text">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥<br><small>Deposit Amount</small></th>
                </tr>
            </thead>
            <tbody id="itemsBody">
                <tr>
                    <td class="text-center thai-text">1</td>
                    <td id="productName" class="thai-text">-</td>
                    <td class="text-right thai-text" id="productPriceInTable">0.00</td>
                    <td class="text-right thai-text" id="depositAmountDisplay">0.00</td>
                </tr>
            </tbody>
        </table>

        <!-- Installment Info (for installment sales) -->
        <div id="installmentInfo" class="thai-text" style="background: #FFFFFF; border: 1px solid #3498DB; border-left: 3px solid #3498DB; padding: 12px; margin: 15px 0; font-size: 10px; color: #000000; display: none;">
            <strong>üìÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞:</strong><br>
            <div style="margin-top: 8px;">
                <div style="margin-bottom: 5px;">‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥: <strong id="downAmount" class="thai-text">-</strong></div>
                <div style="margin-bottom: 5px;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏á‡∏ß‡∏î: <strong id="installmentCount" class="thai-text">-</strong> ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                <div>‡∏ú‡πà‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: <strong id="monthlyPayment" class="thai-text">-</strong></div>
            </div>
        </div>

        <!-- Deposit Note -->
        <div class="thai-text" style="background: #FFFFFF; border: 1px solid #E0E0E0; padding: 12px; margin: 15px 0; font-size: 10px; color: #555555;">
            <strong>üìå ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏´‡∏±‡∏Å‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ï‡πá‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
        </div>

        <!-- Summary -->
        <div class="summary-box">
            <div class="thai-text" style="font-weight: 600; margin-bottom: 10px; border-bottom: 1px solid #E0E0E0; padding-bottom: 5px; font-size: 10px; color: #000000;">
                ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥
            </div>
            <div class="summary-row">
                <span class="thai-text">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ï‡πá‡∏° (‡∏Å‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ):</span>
                <span id="productPrice" class="thai-text">0.00</span>
            </div>
            <div class="summary-row" id="taxRow" style="display: none;">
                <span class="thai-text">‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° (<span id="taxRateDisplay">7</span>%):</span>
                <span id="taxAmount" class="thai-text">0.00</span>
            </div>
            <div class="summary-row" id="taxTypeDescRow" style="display: none; font-size: 8px; color: #666;">
                <span class="thai-text" id="taxTypeDescription">‡πÅ‡∏¢‡∏Å‡∏†‡∏≤‡∏©‡∏µ</span>
                <span></span>
            </div>
            <div class="summary-row">
                <span class="thai-text">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                <span id="totalAmount" class="thai-text">0.00</span>
            </div>
            <div class="summary-row total" style="color: #3498DB; border-top: 1px solid #E0E0E0; padding-top: 8px; margin-top: 8px;">
                <span class="thai-text">‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥:</span>
                <span id="depositAmount" class="thai-text">0.00</span>
            </div>
            <div class="summary-row" style="color: #000000;">
                <span class="thai-text">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞:</span>
                <span id="remainingAmount" class="thai-text">0.00</span>
            </div>
        </div>

        <!-- Amount in Words -->
        <div class="amount-words thai-text">
            <strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥ (‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠):</strong> <span id="amountWords" class="thai-text">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó‡∏ñ‡πâ‡∏ß‡∏ô</span>
        </div>

        <!-- Signatures -->
        <div class="signatures">
            <div class="signature-box" onclick="openSignatureModal('customer')" style="cursor: pointer;">
                <div class="signature-area">
                    <canvas id="customerSignatureDisplay" width="200" height="60" style="display: none;" class="signature-on-line"></canvas>
                    <div id="customerSignaturePlaceholder" class="signature-placeholder-on-line">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠</div>
                </div>
                <div class="signature-line">
                    <div class="signature-label thai-text">‡∏ú‡∏π‡πâ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</div>
                    <div class="signature-sublabel">Customer Signature</div>
                </div>
            </div>
            <div class="signature-box" onclick="openSignatureModal('cashier')" style="cursor: pointer;">
                <div class="signature-area">
                    <canvas id="cashierSignatureDisplay" width="200" height="60" style="display: none;" class="signature-on-line"></canvas>
                    <div id="cashierSignaturePlaceholder" class="signature-placeholder-on-line">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠</div>
                </div>
                <div class="signature-line">
                    <div class="signature-label thai-text">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</div>
                    <div class="signature-sublabel">Cashier Signature</div>
                </div>
            </div>
            <div class="signature-box">
                <div class="signature-line">
                    <img src="../../uploads/S__15892486-Photoroom.png" alt="‡∏ï‡∏£‡∏≤‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö" class="authorized-stamp">
                    <div class="signature-label thai-text">‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>
                    <div class="signature-sublabel">Authorized Signature</div>
                </div>
            </div>
        </div>

        <!-- Terms -->
        <div class="terms thai-text">
            <strong>‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥:</strong><br>
            1. ‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏´‡∏±‡∏Å‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢<br>
            2. ‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ç‡∏≠‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ ‡∏´‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠/‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ ‡πÄ‡∏ß‡πâ‡∏ô‡πÅ‡∏ï‡πà‡∏à‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏Å‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏≠‡∏∑‡πà‡∏ô<br>
            3. ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠<br>
            4. ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ø ‡∏Ç‡∏≠‡∏™‡∏á‡∏ß‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÉ‡∏´‡πâ‡∏ó‡∏£‡∏≤‡∏ö‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="no-print">
        <button class="btn btn-primary thai-text" onclick="window.print()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥</button>
        <button class="btn btn-secondary thai-text" onclick="fillSampleData()">üìù ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</button>
        <button class="btn btn-secondary thai-text" onclick="loadDepositReceiptData()">üîÑ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà</button>
        <button class="btn btn-secondary" onclick="fixAllThaiEncoding()" style="background: #e74c3c; color: white;">üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</button>
        <button class="btn btn-secondary" onclick="debugEncoding()" style="background: #9b59b6; color: white;">üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Encoding</button>
    </div>

    <script>
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á HTML entities ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤ encoding
        function decodeHTMLEntities(text) {
            if (!text) return '';
            try {
                const textArea = document.createElement('textarea');
                textArea.innerHTML = text;
                let decoded = textArea.value;

                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏á encoding ‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏≠‡∏ö‡∏´‡∏≤‡∏Å‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
                if (decoded.includes('&') || decoded.includes('&#')) {
                    textArea.innerHTML = decoded;
                    decoded = textArea.value;
                }

                return decoded;
            } catch (e) {
                console.error('Error decoding text:', e);
                return text;
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ text ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
        function setThaiText(element, text) {
            if (element && text !== undefined && text !== null) {
                try {
                    // ‡πÅ‡∏õ‡∏•‡∏á text ‡πÄ‡∏õ‡πá‡∏ô string ‡∏Å‡πà‡∏≠‡∏ô
                    let textStr = String(text);

                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏á encoding
                    let decodedText = decodeHTMLEntities(textStr);

                    // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡∏°‡∏µ ??? ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡∏≠‡∏∑‡πà‡∏ô
                    if (decodedText.includes('???') || decodedText.includes('????')) {
                        // ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ escape sequences
                        decodedText = textStr.replace(/\\u([0-9a-fA-F]{4})/g, (match, hex) => {
                            return String.fromCharCode(parseInt(hex, 16));
                        });
                    }

                    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ text
                    element.textContent = decodedText;

                    // ‡πÄ‡∏û‡∏¥‡πà‡∏° class ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Thai text rendering
                    if (!element.classList.contains('thai-text')) {
                        element.classList.add('thai-text');
                    }

                    // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ browser ‡∏£‡∏µ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå
                    element.style.fontFamily = 'Sarabun, "Noto Sans Thai", "TH Sarabun New", "THSarabun", "Arial Unicode MS", sans-serif';

                    console.log('Set Thai text:', decodedText, 'for element:', element.id || element.className);
                } catch (e) {
                    console.error('Error setting Thai text:', e);
                    element.textContent = text;
                }
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏≠‡πà‡∏≤‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
        function numberToThaiWords(number) {
            const ones = ['', '‡∏´‡∏ô‡∏∂‡πà‡∏á', '‡∏™‡∏≠‡∏á', '‡∏™‡∏≤‡∏°', '‡∏™‡∏µ‡πà', '‡∏´‡πâ‡∏≤', '‡∏´‡∏Å', '‡πÄ‡∏à‡πá‡∏î', '‡πÅ‡∏õ‡∏î', '‡πÄ‡∏Å‡πâ‡∏≤'];
            const places = ['', '‡∏™‡∏¥‡∏ö', '‡∏£‡πâ‡∏≠‡∏¢', '‡∏û‡∏±‡∏ô', '‡∏´‡∏°‡∏∑‡πà‡∏ô', '‡πÅ‡∏™‡∏ô', '‡∏•‡πâ‡∏≤‡∏ô'];
        
            if (number === 0) return '‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó‡∏ñ‡πâ‡∏ß‡∏ô';
            if (number < 0) return '‡∏•‡∏ö' + numberToThaiWords(-number);
        
            const [intPart, decPart] = number.toString().split('.');
            let result = '';
        
            if (intPart && parseInt(intPart) > 0) {
                result += convertIntegerToThaiWords(parseInt(intPart)) + '‡∏ö‡∏≤‡∏ó';
            }
        
            if (decPart && parseInt(decPart) > 0) {
                const satang = parseInt(decPart.padEnd(2, '0').substr(0, 2));
                result += convertIntegerToThaiWords(satang) + '‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå';
            } else {
                result += '‡∏ñ‡πâ‡∏ß‡∏ô';
            }
        
            return result;
        }

        function convertIntegerToThaiWords(number) {
            if (number === 0) return '';
        
            const ones = ['', '‡∏´‡∏ô‡∏∂‡πà‡∏á', '‡∏™‡∏≠‡∏á', '‡∏™‡∏≤‡∏°', '‡∏™‡∏µ‡πà', '‡∏´‡πâ‡∏≤', '‡∏´‡∏Å', '‡πÄ‡∏à‡πá‡∏î', '‡πÅ‡∏õ‡∏î', '‡πÄ‡∏Å‡πâ‡∏≤'];
            let result = '';
            const digits = number.toString().split('').reverse();
        
            for (let i = 0; i < digits.length; i++) {
                const digit = parseInt(digits[i]);
                if (digit === 0) continue;
        
                if (i === 1) {
                    if (digit === 1) result = '‡∏™‡∏¥‡∏ö' + result;
                    else if (digit === 2) result = '‡∏¢‡∏µ‡πà‡∏™‡∏¥‡∏ö' + result;
                    else result = ones[digit] + '‡∏™‡∏¥‡∏ö' + result;
                } else if (i === 0) {
                    if (digits[1] && parseInt(digits[1]) > 0 && digit === 1) {
                        result = '‡πÄ‡∏≠‡πá‡∏î' + result;
                    } else {
                        result = ones[digit] + result;
                    }
                } else {
                    const places = ['', '‡∏™‡∏¥‡∏ö', '‡∏£‡πâ‡∏≠‡∏¢', '‡∏û‡∏±‡∏ô', '‡∏´‡∏°‡∏∑‡πà‡∏ô', '‡πÅ‡∏™‡∏ô', '‡∏•‡πâ‡∏≤‡∏ô'];
                    result = ones[digit] + places[i] + result;
                }
            }
        
            return result;
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏à‡∏≤‡∏Å URL parameter ‡∏´‡∏£‡∏∑‡∏≠ localStorage
        function loadDepositReceiptData() {
            try {
                console.log('üîç Loading deposit receipt data...');

                const urlParams = new URLSearchParams(window.location.search);
                const receiptId = urlParams.get('id');

                console.log('üìã URL receipt ID:', receiptId);

                // ‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å URL parameter ‡∏Å‡πà‡∏≠‡∏ô
                if (receiptId) {
                    console.log('üåê Loading from URL parameter...');
                    const found = loadDepositReceiptFromStorage(receiptId);
                    if (!found) {
                        console.log('‚ö†Ô∏è Receipt not found by ID, checking currentDepositReceipt...');
                        const storedData = localStorage.getItem('currentDepositReceipt');
                        if (storedData) {
                            const receiptData = JSON.parse(storedData);
                            populateReceiptData(receiptData);

                            // ‡πÇ‡∏´‡∏•‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                            setTimeout(() => loadSignaturesFromDatabase(), 1000);
                        } else {
                            fillSampleData();
                        }
                    }
                } else {
                    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ ID ‡πÉ‡∏ô URL ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å localStorage
                    console.log('üíæ Checking localStorage...');
                    const storedData = localStorage.getItem('currentDepositReceipt');

                    if (storedData) {
                        console.log('‚úÖ Found data in localStorage');
                        const receiptData = JSON.parse(storedData);
                        console.log('üìÑ Receipt data:', receiptData);
                        populateReceiptData(receiptData);

                        // ‡πÇ‡∏´‡∏•‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        setTimeout(() => loadSignaturesFromDatabase(), 1000);
                    } else {
                        console.log('‚ö†Ô∏è No data found, loading sample data');
                        fillSampleData();
                    }
                }
            } catch (error) {
                console.error('‚ùå Error loading deposit receipt data:', error);
                fillSampleData();
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å localStorage ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API)
        function loadDepositReceiptFromStorage(receiptId) {
            try {
                console.log('üîç Searching for receipt ID:', receiptId);

                // ‡∏•‡∏≠‡∏á‡∏´‡∏≤‡∏à‡∏≤‡∏Å localStorage ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
                const localReceipts = JSON.parse(localStorage.getItem('depositReceipts') || '[]');
                console.log('üì¶ Available receipts in localStorage:', localReceipts.length);

                const receipt = localReceipts.find(r =>
                    r._id === receiptId ||
                    r.id === receiptId ||
                    r.receiptNumber === receiptId
                );

                if (receipt) {
                    console.log('‚úÖ Found receipt in localStorage:', receipt.receiptNumber || 'No receipt number');
                    populateReceiptData(receipt);

                    // ‡πÇ‡∏´‡∏•‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    setTimeout(() => loadSignaturesFromDatabase(), 1000);
                    return true;
                }

                console.log('‚ùå Receipt not found in localStorage');
                console.log('Available IDs:', localReceipts.map(r => r._id || r.id));

                // ‡∏•‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏ó‡∏ô
                console.log('üìù Loading sample data instead...');
                fillSampleData();
                return false;

            } catch (error) {
                console.error('‚ùå Error loading receipt from storage:', error);
                fillSampleData();
                return false;
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á DepositReceipt.html
        function populateReceiptData(receiptData) {
            // ‡πÄ‡∏Å‡πá‡∏ö receipt ID ‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î/‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô
            if (receiptData._id) {
                window.currentReceiptId = receiptData._id;
                console.log('üíæ Stored receipt ID:', receiptData._id);
            }
            // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô
            setThaiText(document.getElementById('receiptNumber'), receiptData.receiptNumber || '-');
            setThaiText(document.getElementById('depositDate'), receiptData.depositDate ?
                new Date(receiptData.depositDate).toLocaleDateString('th-TH') : '-');
            setThaiText(document.getElementById('depositTime'), receiptData.depositTime || '-');

            // ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
            setThaiText(document.getElementById('saleType'),
                receiptData.saleType === 'cash' ? '‡∏Ç‡∏≤‡∏¢‡∏™‡∏î' : '‡∏Ç‡∏≤‡∏¢‡∏ú‡πà‡∏≠‡∏ô');
            // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
            let paymentMethodText = '';
            if (receiptData.paymentMethod === 'cash') {
                paymentMethodText = '‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î';
            } else if (receiptData.paymentMethod === 'transfer') {
                paymentMethodText = '‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô';
            } else if (receiptData.paymentMethod === 'mixed') {
                paymentMethodText = '‡∏ú‡∏™‡∏° (‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î + ‡πÇ‡∏≠‡∏ô)';
            } else {
                paymentMethodText = receiptData.paymentMethod || '-';
            }
            setThaiText(document.getElementById('paymentMethod'), paymentMethodText);

            // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏ö‡∏ö‡∏ú‡∏™‡∏°
            const mixedPaymentDetails = document.getElementById('mixedPaymentDetails');
            if (receiptData.paymentMethod === 'mixed' && receiptData.paymentDetails) {
                mixedPaymentDetails.style.display = 'block';

                const cashAmount = parseFloat(receiptData.paymentDetails.cash) || 0;
                const transferAmount = parseFloat(receiptData.paymentDetails.transfer) || 0;

                setThaiText(document.getElementById('mixedCashAmount'), `‡∏ø${cashAmount.toLocaleString()}`);
                setThaiText(document.getElementById('mixedTransferAmount'), `‡∏ø${transferAmount.toLocaleString()}`);
            } else {
                mixedPaymentDetails.style.display = 'none';
            }
            setThaiText(document.getElementById('depositType'),
                receiptData.depositType === 'online' ? '‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå' : 'Pre-order');

            // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
            if (receiptData.customer) {
                setThaiText(document.getElementById('customerName'), receiptData.customer.name || '-');
                setThaiText(document.getElementById('customerPhone'), receiptData.customer.phone || '-');
                setThaiText(document.getElementById('customerAddress'),
                    receiptData.customer.address?.fullAddress || '-');
            }

            // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
            if (receiptData.salesperson) {
                setThaiText(document.getElementById('salespersonName'), receiptData.salesperson.name || '-');
            }

            // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
            if (receiptData.product) {
                setThaiText(document.getElementById('productName'), receiptData.product.name || '-');
                // ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡∏à‡∏∞‡∏ñ‡∏π‡∏Å override ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏†‡∏≤‡∏©‡∏µ‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á)
                setThaiText(document.getElementById('productPriceInTable'),
                    (receiptData.product.price || 0).toLocaleString('th-TH', {minimumFractionDigits: 2}));

                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏≤‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≤‡∏¢‡∏ú‡πà‡∏≠‡∏ô
                if (receiptData.saleType === 'installment' && receiptData.product.downAmount) {
                    const installmentInfo = document.getElementById('installmentInfo');
                    installmentInfo.style.display = 'block';

                    setThaiText(document.getElementById('downAmount'),
                        `‡∏ø${(receiptData.product.downAmount || 0).toLocaleString('th-TH')}`);
                    setThaiText(document.getElementById('installmentCount'),
                        receiptData.product.downInstallmentCount || '-');
                    setThaiText(document.getElementById('monthlyPayment'),
                        `‡∏ø${(receiptData.product.downInstallment || 0).toLocaleString('th-TH')}`);
                }
            }

            // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô
            if (receiptData.amounts) {
                const amounts = receiptData.amounts;
                const taxInfo = receiptData.tax || {};
                const taxType = taxInfo.taxType || 'exclusive';
                const taxRate = taxInfo.taxRate || 7;

                let productPrice, taxAmount, totalAmount;
                const depositAmount = amounts.depositAmount || 0;

                if (taxType === 'none') {
                    // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏†‡∏≤‡∏©‡∏µ
                    productPrice = amounts.totalAmount || 0;
                    taxAmount = 0;
                    totalAmount = productPrice;
                    document.getElementById('taxRow').style.display = 'none';
                    document.getElementById('taxTypeDescRow').style.display = 'none';
                } else if (taxType === 'inclusive') {
                    // ‡∏£‡∏ß‡∏°‡∏†‡∏≤‡∏©‡∏µ
                    totalAmount = amounts.totalAmount || 0;
                    productPrice = Math.round(totalAmount / (1 + taxRate / 100) * 100) / 100;
                    taxAmount = totalAmount - productPrice;
                    document.getElementById('taxRow').style.display = 'flex';
                    document.getElementById('taxTypeDescRow').style.display = 'flex';
                    document.getElementById('taxTypeDescription').textContent = '‡∏£‡∏ß‡∏°‡∏†‡∏≤‡∏©‡∏µ‡πÅ‡∏•‡πâ‡∏ß';
                    document.getElementById('taxRateDisplay').textContent = taxRate;
                } else {
                    // ‡πÅ‡∏¢‡∏Å‡∏†‡∏≤‡∏©‡∏µ (exclusive)
                    productPrice = amounts.totalAmount || 0;
                    taxAmount = Math.round(productPrice * (taxRate / 100) * 100) / 100;
                    totalAmount = productPrice + taxAmount;
                    document.getElementById('taxRow').style.display = 'flex';
                    document.getElementById('taxTypeDescRow').style.display = 'flex';
                    document.getElementById('taxTypeDescription').textContent = '‡πÅ‡∏¢‡∏Å‡∏†‡∏≤‡∏©‡∏µ';
                    document.getElementById('taxRateDisplay').textContent = taxRate;
                }

                const remainingAmount = totalAmount - depositAmount;

                // ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏™‡∏£‡∏∏‡∏õ
                setThaiText(document.getElementById('productPriceInTable'),
                    productPrice.toLocaleString('th-TH', {minimumFractionDigits: 2}));
                setThaiText(document.getElementById('productPrice'),
                    productPrice.toLocaleString('th-TH', {minimumFractionDigits: 2}));
                setThaiText(document.getElementById('taxAmount'),
                    taxAmount.toLocaleString('th-TH', {minimumFractionDigits: 2}));
                setThaiText(document.getElementById('totalAmount'),
                    totalAmount.toLocaleString('th-TH', {minimumFractionDigits: 2}));
                setThaiText(document.getElementById('depositAmount'),
                    depositAmount.toLocaleString('th-TH', {minimumFractionDigits: 2}));
                setThaiText(document.getElementById('depositAmountDisplay'),
                    depositAmount.toLocaleString('th-TH', {minimumFractionDigits: 2}));
                setThaiText(document.getElementById('remainingAmount'),
                    remainingAmount.toLocaleString('th-TH', {minimumFractionDigits: 2}));
                setThaiText(document.getElementById('amountWords'), numberToThaiWords(depositAmount));

                console.log('üí∞ Tax calculation (DepositReceipt):', {taxType, taxRate, productPrice, taxAmount, totalAmount, depositAmount, remainingAmount});
            }

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
            updateBranchAndCompanyInfo(receiptData);
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
        function updateBranchAndCompanyInfo(receiptData) {
            try {
                console.log('üè¢ Updating branch and company info...');

                // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤‡∏à‡∏≤‡∏Å receiptData
                const branchInfo = receiptData.branch;
                const companyInfo = receiptData.company;

                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô receiptData ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å localStorage (‡∏à‡∏≤‡∏Å DepositReceipt.html)
                const branchCode = branchInfo?.code ||
                                  localStorage.getItem('activeBranch') ||
                                  window.BRANCH_CODE || '00000';

                const branchName = branchInfo?.name ||
                                  localStorage.getItem('activeBranchName') ||
                                  '‡∏™‡∏≤‡∏Ç‡∏≤‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö';

                console.log('üè¢ Branch Code:', branchCode);
                console.log('üè¢ Branch Name:', branchName);

                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï HTML ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤
                const companyDetailsElement = document.querySelector('.company-details');
                if (companyDetailsElement) {
                    // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏™‡∏≤‡∏Ç‡∏≤‡πÑ‡∏ß‡πâ
                    const companyName = companyInfo?.name || '‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó 2 ‡∏û‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏á ‡πÇ‡∏°‡∏ö‡∏≤‡∏¢ ‡∏à‡∏≥‡∏Å‡∏±‡∏î';
                    const taxId = companyInfo?.taxId || '0945566000616';
                    const phone = companyInfo?.phone || '09-2427-0769';

                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏≤‡∏° branch code
                    let address = '';
                    if (branchCode === '00000') {
                        address = '148/91 ‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 6 ‡∏ï‡∏≥‡∏ö‡∏•‡∏£‡∏π‡∏™‡∏∞‡∏°‡∏¥‡πÅ‡∏• ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ 94000';
                    } else if (branchCode === '00001') {
                        address = branchInfo?.address || '‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏™‡∏≤‡∏Ç‡∏≤‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà';
                    } else {
                        address = branchInfo?.address || `‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏™‡∏≤‡∏Ç‡∏≤ ${branchName}`;
                    }

                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï company name
                    const companyNameElement = document.querySelector('.company-name');
                    if (companyNameElement) {
                        setThaiText(companyNameElement, companyName);
                    }

                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï company details ‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                    const companyDetailsHTML = `
                        ‡∏™‡∏≤‡∏Ç‡∏≤: ${branchName} ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤ ${branchCode}<br>
                        ${address}<br>
                        ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ‡∏≠‡∏≤‡∏Å‡∏£ ${taxId}<br>
                        ‡πÇ‡∏ó‡∏£: ${phone}
                    `;
                    companyDetailsElement.innerHTML = companyDetailsHTML;
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏° thai-text class ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö element ‡∏ô‡∏µ‡πâ
                    companyDetailsElement.classList.add('thai-text');

                    console.log('‚úÖ Updated company details with branch info');
                }

                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï title ‡∏Ç‡∏≠‡∏á PDF ‡∏î‡πâ‡∏ß‡∏¢
                document.title = `‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥ - ${branchName}`;

            } catch (error) {
                console.error('‚ùå Error updating branch info:', error);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
        function fillSampleData() {
            // ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            const currentBranchCode = window.BRANCH_CODE || '00000';
            const currentBranchName = localStorage.getItem('activeBranchName') || '‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà';

            const sampleData = {
                receiptNumber: 'DEP-670101001',
                depositDate: new Date().toISOString(),
                depositTime: '14:30',
                saleType: 'installment',
                paymentMethod: 'cash',
                depositType: 'online',
                customer: {
                    name: '‡∏ô‡∏≤‡∏¢ ‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ',
                    phone: '098-765-4321',
                    address: {
                        fullAddress: '123 ‡∏´‡∏°‡∏π‡πà 1 ‡∏ï‡∏≥‡∏ö‡∏•‡∏Ñ‡∏ß‡∏ô‡∏•‡∏±‡∏á ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏™‡∏á‡∏Ç‡∏•‡∏≤ 90110'
                    }
                },
                salesperson: {
                    name: '‡∏ô‡∏≤‡∏¢ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡∏£‡∏∞‡∏ö‡∏ö'
                },
                product: {
                    name: 'iPhone 15 Pro Max 256GB',
                    brand: 'Apple',
                    model: 'Natural Titanium',
                    price: 45900
                },
                amounts: {
                    totalAmount: 45900,
                    depositAmount: 5000,
                    remainingAmount: 40900
                },
                // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
                branch: {
                    code: currentBranchCode,
                    name: currentBranchName,
                    address: currentBranchCode === '00000' ?
                            '148/91 ‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 6 ‡∏ï‡∏≥‡∏ö‡∏•‡∏£‡∏π‡∏™‡∏∞‡∏°‡∏¥‡πÅ‡∏• ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ 94000' :
                            `‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏™‡∏≤‡∏Ç‡∏≤ ${currentBranchName}`
                },
                company: {
                    name: '‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó 2 ‡∏û‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏á ‡πÇ‡∏°‡∏ö‡∏≤‡∏¢ ‡∏à‡∏≥‡∏Å‡∏±‡∏î',
                    taxId: '0945566000616',
                    phone: '09-2427-0769'
                }
            };

            console.log('üìù Sample data with branch info:', sampleData.branch);
            populateReceiptData(sampleData);

            // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö sample data
            console.log('üìã Sample data loaded - ‡∏Ç‡πâ‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô');
        }

        // Prevent most API calls by overriding fetch, BUT allow signature-related APIs
        const originalFetch = window.fetch;
        window.fetch = function(url, options) {
            // Allow signature-related API calls
            if (typeof url === 'string' && (url.includes('/signature') || url.includes('/signatures'))) {
                console.log('‚úÖ Allowing signature API call to:', url);
                return originalFetch.apply(this, arguments);
            }

            // Block other API calls to deposit-receipts endpoint
            if (typeof url === 'string' && url.includes('/api/deposit-receipts/')) {
                console.log('üö´ Blocked API call to:', url);
                return Promise.reject(new Error('API calls blocked - using localStorage only'));
            }
            return originalFetch.apply(this, arguments);
        };

        // Dictionary ‡∏Ç‡∏≠‡∏á text ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö fallback
        const thaiTextFallbacks = {
            'docType': '‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥ / DEPOSIT RECEIPT',
            'company-name': '‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó 2 ‡∏û‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏á ‡πÇ‡∏°‡∏ö‡∏≤‡∏¢ ‡∏à‡∏≥‡∏Å‡∏±‡∏î',
            'company-details': '‡∏™‡∏≤‡∏Ç‡∏≤: ‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤ 00000<br>148/91 ‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 6 ‡∏ï‡∏≥‡∏ö‡∏•‡∏£‡∏π‡∏™‡∏∞‡∏°‡∏¥‡πÅ‡∏• ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ 94000<br>‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ‡∏≠‡∏≤‡∏Å‡∏£ 0945566000616<br>‡πÇ‡∏ó‡∏£: 09-2427-0769'
        };

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ UTF-8 encoding
        function forceUTF8Encoding() {
            if (document.characterSet !== 'UTF-8') {
                console.warn('‚ö†Ô∏è Document charset is not UTF-8:', document.characterSet);

                // ‡∏•‡∏≠‡∏á‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö encoding
                const metaCharset = document.querySelector('meta[charset]');
                if (metaCharset) {
                    metaCharset.setAttribute('charset', 'UTF-8');
                }
            }

            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ document encoding properties
            document.documentElement.lang = 'th';
            document.documentElement.setAttribute('data-encoding', 'UTF-8');
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç encoding ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤
        function fixAllThaiEncoding() {
            console.log('üîß Fixing all Thai encoding...');

            // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö UTF-8 ‡∏Å‡πà‡∏≠‡∏ô
            forceUTF8Encoding();

            // ‡∏´‡∏≤ elements ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ class thai-text ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤
            const thaiElements = document.querySelectorAll('.thai-text, label, th, td, .signature-label, .terms');

            thaiElements.forEach(element => {
                const currentText = element.textContent || element.innerText;
                if (currentText && (currentText.includes('???') || currentText.includes('????') || currentText.includes('ÔøΩ'))) {
                    console.log('üîç Found broken encoding in:', element.id || element.className || element.tagName, 'text:', currentText);

                    // ‡∏•‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£ re-encode
                    let fixedText = currentText;
                    let fixed = false;

                    // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡πÉ‡∏ä‡πâ fallback text ‡∏´‡∏≤‡∏Å‡∏°‡∏µ
                    if (element.id && thaiTextFallbacks[element.id]) {
                        fixedText = thaiTextFallbacks[element.id];
                        fixed = true;
                        console.log('üîß Using fallback text for:', element.id);
                    } else if (element.className.includes('company-name') && thaiTextFallbacks['company-name']) {
                        fixedText = thaiTextFallbacks['company-name'];
                        fixed = true;
                        console.log('üîß Using fallback text for company name');
                    }

                    // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡∏•‡∏≠‡∏á decode URLs
                    if (!fixed) {
                        try {
                            fixedText = decodeURIComponent(escape(currentText));
                            if (!fixedText.includes('???') && !fixedText.includes('????')) {
                                fixed = true;
                                console.log('üîß Fixed using decodeURIComponent for:', element.id);
                            }
                        } catch (e) {
                            console.log('Method 1 failed for:', element.id || element.className);
                        }
                    }

                    // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 3: ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ TextDecoder
                    if (!fixed && window.TextDecoder) {
                        try {
                            const encoder = new TextEncoder();
                            const decoder = new TextDecoder('utf-8');
                            const encoded = encoder.encode(currentText);
                            fixedText = decoder.decode(encoded);
                            if (!fixedText.includes('???') && !fixedText.includes('????')) {
                                fixed = true;
                                console.log('üîß Fixed using TextDecoder for:', element.id);
                            }
                        } catch (e) {
                            console.log('Method 2 failed for:', element.id || element.className);
                        }
                    }

                    // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 4: ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£ rewrite HTML
                    if (!fixed) {
                        if (element.innerHTML.includes('???') || element.innerHTML.includes('????')) {
                            console.log('üîß Attempting innerHTML fix for:', element.id || element.className);
                            // ‡∏•‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á element ‡πÉ‡∏´‡∏°‡πà
                            const newElement = document.createElement(element.tagName);
                            newElement.className = element.className;
                            newElement.id = element.id;

                            // ‡πÉ‡∏™‡πà text ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡πÅ‡∏ó‡∏ô
                            if (element.id === 'docType') {
                                newElement.textContent = '‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥ / DEPOSIT RECEIPT';
                            } else if (element.className.includes('company-name')) {
                                newElement.textContent = '‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó 2 ‡∏û‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏á ‡πÇ‡∏°‡∏ö‡∏≤‡∏¢ ‡∏à‡∏≥‡∏Å‡∏±‡∏î';
                            }

                            if (newElement.textContent && !newElement.textContent.includes('???')) {
                                element.parentNode.replaceChild(newElement, element);
                                fixed = true;
                                console.log('‚úÖ Replaced element for:', element.id || element.className);
                            }
                        }
                    }

                    // ‡∏ñ‡πâ‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó
                    if (fixed && fixedText !== currentText && !fixedText.includes('???')) {
                        if (element.innerHTML.includes('<br>') && fixedText.includes('<br>')) {
                            element.innerHTML = fixedText;
                        } else {
                            element.textContent = fixedText;
                        }

                        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥ font
                        element.style.fontFamily = 'Sarabun, "Noto Sans Thai", "TH Sarabun New", "THSarabun", "Arial Unicode MS", sans-serif';
                        element.style.fontDisplay = 'swap';

                        console.log('‚úÖ Fixed encoding for:', element.id || element.className, 'new text:', fixedText.substring(0, 50));
                    }
                }
            });

            // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç static labels ‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤
            const labelMappings = [
                { selector: 'label', patterns: ['‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà', '‡πÄ‡∏ß‡∏•‡∏≤', '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó', '‡∏ß‡∏¥‡∏ò‡∏µ', '‡∏ä‡∏∑‡πà‡∏≠', '‡πÄ‡∏ö‡∏≠‡∏£‡πå', '‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà', '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô'] },
                { selector: 'th', patterns: ['‡∏•‡∏≥‡∏î‡∏±‡∏ö', '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£', '‡∏£‡∏≤‡∏Ñ‡∏≤', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô'] }
            ];

            labelMappings.forEach(mapping => {
                const elements = document.querySelectorAll(mapping.selector);
                elements.forEach(element => {
                    const text = element.textContent;
                    if (text && (text.includes('???') || text.includes('????'))) {
                        console.log('üîß Trying to fix label:', text);
                        // ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ original HTML text
                        const originalText = element.getAttribute('data-original') || element.innerHTML;
                        if (originalText && !originalText.includes('???')) {
                            element.innerHTML = originalText;
                            console.log('‚úÖ Fixed label using original HTML');
                        }
                    }
                });
            });
        }

        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
        window.onload = function() {
            console.log('üöÄ Deposit Receipt PDF Template loaded');
            console.log('üì¶ Current localStorage keys:', Object.keys(localStorage));

            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ branch code ‡∏à‡∏≤‡∏Å localStorage (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô DepositReceipt.html)
            const storedBranchCode = localStorage.getItem('activeBranch');
            const storedBranchName = localStorage.getItem('activeBranchName');

            if (storedBranchCode) {
                window.BRANCH_CODE = storedBranchCode;
                console.log('üè¢ Branch Code from localStorage:', storedBranchCode);
                console.log('üè¢ Branch Name from localStorage:', storedBranchName);
            } else {
                window.BRANCH_CODE = '00000'; // default
                console.log('üè¢ Using default branch code: 00000');
            }

            const currentReceipt = localStorage.getItem('currentDepositReceipt');
            const allReceipts = localStorage.getItem('depositReceipts');

            console.log('üìÑ currentDepositReceipt data:', currentReceipt ? 'Found' : 'Not found');
            console.log('üìä depositReceipts count:', allReceipts ? JSON.parse(allReceipts).length : 0);

            if (currentReceipt) {
                try {
                    const parsed = JSON.parse(currentReceipt);
                    console.log('‚úÖ Current receipt:', parsed.receiptNumber || 'No receipt number');
                    console.log('üè¢ Receipt branch info:', parsed.branch || 'No branch info');
                } catch (e) {
                    console.error('‚ùå Error parsing currentDepositReceipt:', e);
                }
            }

            loadDepositReceiptData();

            // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç encoding ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à
            setTimeout(() => {
                fixAllThaiEncoding();
            }, 500);
        };

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• encoding
        function debugEncoding() {
            console.log('üîç =================================');
            console.log('üîç ENCODING DEBUG INFORMATION');
            console.log('üîç =================================');
            console.log('üìÑ Document charset:', document.characterSet);
            console.log('üìÑ Document encoding:', document.inputEncoding);
            console.log('üåê Page language:', document.documentElement.lang);

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö elements ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤
            const problemElements = [];
            const allElements = document.querySelectorAll('*');

            allElements.forEach(element => {
                const text = element.textContent || element.innerText;
                if (text && (text.includes('???') || text.includes('????') || text.includes('ÔøΩ'))) {
                    problemElements.push({
                        element: element,
                        id: element.id || 'no-id',
                        className: element.className || 'no-class',
                        tagName: element.tagName,
                        text: text.substring(0, 100),
                        innerHTML: element.innerHTML.substring(0, 100)
                    });
                }
            });

            console.log('üî¥ Found', problemElements.length, 'elements with encoding issues:');
            problemElements.forEach((item, index) => {
                console.log(`${index + 1}. ${item.tagName}#${item.id}.${item.className}`);
                console.log(`   Text: "${item.text}"`);
                console.log(`   HTML: "${item.innerHTML}"`);
                console.log('   ---');
            });

            // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ fonts ‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î
            if (document.fonts) {
                document.fonts.ready.then(() => {
                    console.log('‚úÖ Loaded fonts:');
                    for (let font of document.fonts) {
                        console.log(`   - ${font.family} (${font.style}, ${font.weight})`);
                    }
                });
            }

            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ô UI ‡∏î‡πâ‡∏ß‡∏¢
            alert(`Encoding Debug Info:
Document Charset: ${document.characterSet}
Document Language: ${document.documentElement.lang}
Elements with encoding issues: ${problemElements.length}

${problemElements.length > 0 ? 'Check console for detailed information.' : 'No encoding issues found!'}`);

            return problemElements;
        }

        // ===== SIGNATURE MANAGEMENT =====
        let currentSignatureType = null;
        let isDrawing = false;
        let signatureCanvas = null;
        let signatureCtx = null;
        let signatures = {
            customer: null,
            cashier: null
        };

        function openSignatureModal(type) {
            currentSignatureType = type;
            const modal = document.getElementById('signatureModal');
            const title = document.getElementById('signatureModalTitle');

            if (type === 'customer') {
                title.textContent = '‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô';
            } else if (type === 'cashier') {
                title.textContent = '‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô';
            }

            modal.style.display = 'flex';
            initSignatureCanvas();
        }

        function closeSignatureModal() {
            const modal = document.getElementById('signatureModal');
            modal.style.display = 'none';
            currentSignatureType = null;
        }

        function initSignatureCanvas() {
            signatureCanvas = document.getElementById('signatureCanvas');
            signatureCtx = signatureCanvas.getContext('2d');

            // Set canvas background to white
            signatureCtx.fillStyle = '#ffffff';
            signatureCtx.fillRect(0, 0, signatureCanvas.width, signatureCanvas.height);

            // Set drawing style
            signatureCtx.strokeStyle = '#000000';
            signatureCtx.lineWidth = 2;
            signatureCtx.lineCap = 'round';
            signatureCtx.lineJoin = 'round';

            // Add event listeners
            signatureCanvas.addEventListener('mousedown', startDrawing);
            signatureCanvas.addEventListener('mousemove', draw);
            signatureCanvas.addEventListener('mouseup', stopDrawing);
            signatureCanvas.addEventListener('mouseout', stopDrawing);

            // Touch events for mobile
            signatureCanvas.addEventListener('touchstart', handleTouch);
            signatureCanvas.addEventListener('touchmove', handleTouch);
            signatureCanvas.addEventListener('touchend', stopDrawing);
        }

        function startDrawing(e) {
            isDrawing = true;
            const rect = signatureCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            signatureCtx.beginPath();
            signatureCtx.moveTo(x, y);
        }

        function draw(e) {
            if (!isDrawing) return;

            const rect = signatureCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            signatureCtx.lineTo(x, y);
            signatureCtx.stroke();
        }

        function stopDrawing() {
            if (isDrawing) {
                signatureCtx.beginPath();
                isDrawing = false;
            }
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' :
                                            e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            signatureCanvas.dispatchEvent(mouseEvent);
        }

        function clearSignature() {
            signatureCtx.fillStyle = '#ffffff';
            signatureCtx.fillRect(0, 0, signatureCanvas.width, signatureCanvas.height);
        }

        async function saveSignature() {
            if (!currentSignatureType) return;

            try {
                // Get signature as base64 data URL
                const signatureDataURL = signatureCanvas.toDataURL('image/png');

                // Store signature locally
                signatures[currentSignatureType] = signatureDataURL;

                // Update display canvas
                updateSignatureDisplay(currentSignatureType, signatureDataURL);

                // Save to backend
                await saveSignatureToBackend(currentSignatureType, signatureDataURL);

                closeSignatureModal();

                console.log(`‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô ${currentSignatureType} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);
            } catch (error) {
                console.error('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
            }
        }

        function updateSignatureDisplay(type, dataURL) {
            const displayCanvas = document.getElementById(`${type}SignatureDisplay`);
            const placeholder = document.getElementById(`${type}SignaturePlaceholder`);

            if (displayCanvas && placeholder) {
                const ctx = displayCanvas.getContext('2d');
                const img = new Image();

                img.onload = function() {
                    // Clear canvas with transparent background for on-line signature
                    ctx.clearRect(0, 0, displayCanvas.width, displayCanvas.height);

                    // Draw signature on transparent background
                    ctx.drawImage(img, 0, 0, displayCanvas.width, displayCanvas.height);

                    // Show canvas, hide placeholder
                    displayCanvas.style.display = 'block';
                    placeholder.style.display = 'none';
                };

                img.src = dataURL;
            }
        }

        async function saveSignatureToBackend(type, signatureData) {
            const receiptId = getCurrentReceiptId();
            if (!receiptId) {
                console.warn('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö Receipt ID ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô');
                return;
            }

            const response = await fetch(`/api/deposit-receipts/${receiptId}/signature`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                },
                body: JSON.stringify({
                    signatureType: type,
                    signatureData: signatureData
                })
            });

            if (!response.ok) {
                throw new Error(`Failed to save signature: ${response.statusText}`);
            }

            const result = await response.json();
            console.log('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á backend ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', result);
        }

        function getCurrentReceiptId() {
            // Extract receipt ID from URL parameters or global variable
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id') || window.currentReceiptId;
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
        async function loadSignaturesFromDatabase() {
            const receiptId = getCurrentReceiptId();
            if (!receiptId) {
                console.log('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö Receipt ID ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô');
                return;
            }

            try {
                console.log('üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');

                const response = await fetch(`/api/deposit-receipts/${receiptId}/signatures`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    }
                });

                if (!response.ok) {
                    if (response.status === 404) {
                        console.log('üìÑ ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏µ‡πâ');
                        return;
                    }
                    throw new Error(`Failed to load signatures: ${response.statusText}`);
                }

                const result = await response.json();
                const signaturesData = result.data.signatures;

                if (signaturesData) {
                    // ‡πÇ‡∏´‡∏•‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
                    if (signaturesData.customerSignature && signaturesData.customerSignature.data) {
                        signatures.customer = signaturesData.customerSignature.data;
                        updateSignatureDisplay('customer', signaturesData.customerSignature.data);
                        console.log('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    }

                    // ‡πÇ‡∏´‡∏•‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
                    if (signaturesData.cashierSignature && signaturesData.cashierSignature.data) {
                        signatures.cashier = signaturesData.cashierSignature.data;
                        updateSignatureDisplay('cashier', signaturesData.cashierSignature.data);
                        console.log('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    }

                    if (!signaturesData.customerSignature && !signaturesData.cashierSignature) {
                        console.log('üìã ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö');
                    }
                } else {
                    console.log('üìã ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö');
                }

            } catch (error) {
                console.error('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô:', error);
                // ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á alert ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô
            }
        }
    </script>

    <!-- Signature Modal -->
    <div id="signatureModal" class="signature-modal" style="display: none;">
        <div class="signature-modal-content">
            <div class="signature-modal-header">
                <h3 id="signatureModalTitle" class="thai-text">‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠</h3>
                <button onclick="closeSignatureModal()" class="modal-close">&times;</button>
            </div>
            <div class="signature-modal-body">
                <canvas id="signatureCanvas" width="400" height="200"></canvas>
                <div class="signature-controls">
                    <button onclick="clearSignature()" class="btn-clear thai-text">‡∏•‡πâ‡∏≤‡∏á</button>
                    <button onclick="saveSignature()" class="btn-save thai-text">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button onclick="closeSignatureModal()" class="btn-cancel thai-text">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </div>
        </div>
    </div>

    <style>
        .signature-placeholder {
            font-size: 12px;
            color: #666;
            font-style: italic;
            margin-top: 5px;
            text-align: center;
            padding: 10px;
            border: 1px dashed #ccc;
            background-color: #f9f9f9;
        }

        .signature-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .signature-modal-content {
            background: white;
            border-radius: 8px;
            padding: 20px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .signature-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .signature-modal-header h3 {
            margin: 0;
            font-size: 18px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .modal-close:hover {
            color: #000;
        }

        #signatureCanvas {
            border: 2px solid #ddd;
            border-radius: 4px;
            background-color: white;
            cursor: crosshair;
            display: block;
            margin: 0 auto;
        }

        .signature-controls {
            margin-top: 15px;
            text-align: center;
        }

        .signature-controls button {
            margin: 0 5px;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-clear {
            background-color: #f0f0f0;
            color: #333;
        }

        .btn-clear:hover {
            background-color: #e0e0e0;
        }

        .btn-save {
            background-color: #28a745;
            color: white;
        }

        .btn-save:hover {
            background-color: #218838;
        }

        .btn-cancel {
            background-color: #dc3545;
            color: white;
        }

        .btn-cancel:hover {
            background-color: #c82333;
        }
    </style>
</body>
</html>