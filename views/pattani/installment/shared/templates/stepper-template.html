<!-- Stepper Template - Used across all installment steps -->
<div class="stepper" role="navigation" aria-label="ขั้นตอนการทำงาน">
  <div class="step" data-step="1" role="tab" aria-label="ขั้นตอนที่ 1 เลือกสินค้า">
    <div class="step-icon">1</div>
    <div class="step-text">เลือกสินค้า</div>
  </div>
  
  <div class="step" data-step="2" role="tab" aria-label="ขั้นตอนที่ 2 ข้อมูลลูกค้า">
    <div class="step-icon">2</div>
    <div class="step-text">ข้อมูลลูกค้า</div>
  </div>
  
  <div class="step" data-step="3" role="tab" aria-label="ขั้นตอนที่ 3 รายละเอียดผ่อน">
    <div class="step-icon">3</div>
    <div class="step-text">รายละเอียดผ่อน</div>
  </div>
  
  <div class="step" data-step="4" role="tab" aria-label="ขั้นตอนที่ 4 ยืนยันและพิมพ์">
    <div class="step-icon">4</div>
    <div class="step-text">ยืนยันและพิมพ์</div>
  </div>
</div>

<script>
// Stepper navigation function
function goToStep(stepNumber) {
  if (typeof window.GlobalDataManager !== 'undefined') {
    window.GlobalDataManager.navigateToStep(stepNumber);
  } else {
    // Fallback navigation
    const stepFiles = ['step1.html', 'step2.html', 'step3.html', 'step4.html'];
    if (stepNumber >= 1 && stepNumber <= 4) {
      window.location.href = stepFiles[stepNumber - 1];
    }
  }
}

// Initialize stepper
function initializeStepper(currentStep) {
  const steps = document.querySelectorAll('.step');

  steps.forEach((step, index) => {
    const stepNum = index + 1;
    const stepIcon = step.querySelector('.step-icon');

    // Reset step classes
    step.classList.remove('completed', 'active');

    if (stepNum < currentStep) {
      step.classList.add('completed');
      if (stepIcon) stepIcon.innerHTML = '✓';
    } else if (stepNum === currentStep) {
      step.classList.add('active');
      if (stepIcon) stepIcon.innerHTML = stepNum;
    } else {
      step.classList.remove('completed', 'active');
      if (stepIcon) stepIcon.innerHTML = stepNum;
    }
  });

  // Force update connecting lines by triggering a reflow
  setTimeout(() => {
    steps.forEach(step => {
      step.style.display = 'none';
      step.offsetHeight; // Trigger reflow
      step.style.display = 'flex';
    });
  }, 10);
}

// Auto-initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
  // Try to get current step from various sources
  const currentStep =
    window.CURRENT_STEP ||
    parseInt(document.body.dataset.currentStep) ||
    parseInt(new URLSearchParams(window.location.search).get('step')) ||
    1;

  initializeStepper(currentStep);
});
</script> 