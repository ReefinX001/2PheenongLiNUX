const axios = require('axios');

/**
 * ✅ GET /api/address/thailand
 * ดึงข้อมูลจังหวัด อำเภอ ตำบล ของประเทศไทย
 */
exports.getThailandData = async (req, res) => {
  try {
    const { type, province, district } = req.query;

    // ข้อมูลจังหวัดทั้หมด 77 จังหวัด - อัพเดทล่าสุด 2024
    const provinces = [
      'กรุงเทพมหานคร', 'กระบี่', 'กาญจนบุรี', 'กาฬสินธุ์', 'กำแพงเพชร',
      'ขอนแก่น', 'จันทบุรี', 'ฉะเชิงเทรา', 'ชลบุรี', 'ชัยนาท',
      'ชัยภูมิ', 'ชุมพร', 'เชียงราย', 'เชียงใหม่', 'ตรัง',
      'ตราด', 'ตาก', 'นครนายก', 'นครปฐม', 'นครพนม',
      'นครราชสีมา', 'นครศรีธรรมราท', 'นครสวรรค์', 'นนทบุรี', 'นราธิวาส',
      'น่าน', 'บึงกาฬ', 'บุรีรัมย์', 'ปทุมธานี', 'ประจวบคีรีขันธ์',
      'ปราจีนบุรี', 'ปัตตานี', 'พระนครศรีอยุธยา', 'พังงา', 'พัทลุง',
      'พิจิตร', 'พิษณุโลก', 'เพชรบุรี', 'เพชรบูรณ์', 'แพร่',
      'ภูเก็ต', 'มหาสารคาม', 'มุกดาหาร', 'แม่ฮ่องสอน', 'ยะลา',
      'ยโสธร', 'ร้อยเอ็ด', 'ระนอง', 'ระยอง', 'ราชบุรี',
      'ลพบุรี', 'ลำปาง', 'ลำพูน', 'เลย', 'ศรีสะเกษ',
      'สกลนคร', 'สงขลา', 'สตูล', 'สมุทรปราการ', 'สมุทรสงคราม',
      'สมุทรสาคร', 'สระแก้ว', 'สระบุรี', 'สิงห์บุรี', 'สุโขทัย',
      'สุพรรณบุรี', 'สุราษฎร์ธานี', 'สุรินทร์', 'หนองคาย', 'หนองบัวลำภู',
      'อ่างทอง', 'อำนาจเจริญ', 'อุดรธานี', 'อุตรดิตถ์', 'อุทัยธานี',
      'อุบลราชธานี'
    ];

    // ข้อมูลอำเภอทั้งหมด - เน้นอำเภอเมือง (provincial capitals) ให้ครบทุกจังหวัด
    const districts = {
      // กรุงเทพมหานคร - 50 เขต
      'กรุงเทพมหานคร': [
        'พระนคร', 'ดุสิต', 'หนองจอก', 'บางรัก', 'บางเขน', 'บางกะปิ', 'ปทุมวัน', 'ป้อมปราบศัตรูพ่าย',
        'พระโขนง', 'มีนบุรี', 'ลาดกระบัง', 'ยานนาวา', 'สัมพันธวงศ์', 'พญาไท', 'ธนบุรี', 'บางกอกใหญ่',
        'ห้วยขวาง', 'คลองสาน', 'ตลิ่งชัน', 'บางกอกน้อย', 'บางขุนเทียน', 'บางโคล่ำ', 'บางนา', 'บางปะอิน',
        'บางพลัด', 'บางซื่อ', 'จตุจักร', 'บางไผ่', 'ภาษีเจริญ', 'หนองแขม', 'ราษฎร์บูรณะ', 'บางบอน',
        'สาทร', 'บางรัก', 'วัฒนา', 'บางกอกยาย', 'จอมทอง', 'ดอนเมือง', 'ราชเทวี', 'ลาดพร้าว',
        'วังทองหลาง', 'คลองเตย', 'บึงกุ่ม', 'สวนหลวง', 'จรเข้บัว', 'สะพานพุทธ', 'ประเวศ', 'คันนายาว',
        'สายไหม', 'ทุ่งครุ'
      ],

      // ภาคเหนือ
      'เชียงใหม่': ['เมืองเชียงใหม่', 'จอมทอง', 'แม่ริม', 'สะเมิง', 'ฟาง', 'แม่อาย', 'ไชยปราการ', 'หางดง', 'ดอยสะเก็ด'],
      'เชียงราย': ['เมืองเชียงราย', 'พาน', 'เวียงป่าเป้า', 'แม่จัน', 'แม่ลาว', 'เวียงเชียงรุ้ง', 'ขุนตาล'],
      'ลำพูน': ['เมืองลำพูน', 'เวียงหนองล่อง', 'ลี้', 'ป่าซาง', 'บ้านธิ', 'ทุ่งหัวช้าง'],
      'ลำปาง': ['เมืองลำปาง', 'แม่ทะ', 'เสริมงาม', 'งาว', 'เถิน', 'แม่พริก', 'วังเหนือ'],
      'แม่ฮ่องสอน': ['เมืองแม่ฮ่องสอน', 'ปาย', 'ขุนยวม', 'แม่ลาน้อย', 'แม่สะเรียง', 'ปาง', 'สบเมย'],
      'น่าน': ['เมืองน่าน', 'ปัว', 'ท่าวังผา', 'เวียงสา', 'บ้านหลวง', 'นาหมื่น', 'ภูเพียง'],
      'แพร่': ['เมืองแพร่', 'ร้องกวาง', 'ลอง', 'สูงเม่น', 'เด่นชัย', 'วังชิ้น', 'หนองม่วงไข่'],
      'พิษณุโลก': ['เมืองพิษณุโลก', 'วังทอง', 'บางระกำ', 'พรหมพิราม', 'วัดโบสถ์', 'ชาติตระการ'],
      'ตาก': ['เมืองตาก', 'บ้านตาก', 'สามเงา', 'แม่ระมาด', 'ท่าสองยาง', 'แม่สอด', 'อุ้มผาง'],
      'สุโขทัย': ['เมืองสุโขทัย', 'กบเชี้ยง', 'คีรีมาศ', 'บ้านดานลานหอย', 'ศรีสำโรง', 'ศรีนคร'],
      'พิจิตร': ['เมืองพิจิตร', 'วังทรายพูน', 'โพทะเล', 'ตะพานหิน', 'บางมูลนาก', 'ดงเจริญ'],
      'เพชรบูรณ์': ['เมืองเพชรบูรณ์', 'วิเชียรบุรี', 'ศรีเทพ', 'หล่มสัก', 'หล่มเก่า', 'วังโป่ง'],
      'อุตรดิตถ์': ['เมืองอุตรดิตถ์', 'ตรอน', 'ลับแล', 'ฟากท่า', 'บ้านโคก', 'ผาระดาบ'],
      'กำแพงเพชร': ['เมืองกำแพงเพชร', 'ไทรงาม', 'คลองขลุง', 'ขาณุวรลักษบุรี', 'พรานกระต่าย'],
      'อุทัยธานี': ['เมืองอุทัยธานี', 'ทัพทัน', 'สว่างอารมณ์', 'หนองฉาง', 'หนองขาหย่าง'],

      // ภาคกลาง
      'นครปฐม': ['เมืองนครปฐม', 'กำแพงแสน', 'ดอนตูม', 'บางเลน', 'นครชัยศรี', 'สามพราน'],
      'นครสวรรค์': ['เมืองนครสวรรค์', 'โกรกพระ', 'ชุมแสง', 'หนองบัว', 'บรรพตพิสัย', 'ตาคลี'],
      'ชัยนาท': ['เมืองชัยนาท', 'มโนรมย์', 'วัดสิงห์', 'หนองมะโมง', 'แสงทอง', 'หันคา'],
      'ลพบุรี': ['เมืองลพบุรี', 'พัฒนานิคม', 'โคกเจริญ', 'ชัยบาดาล', 'โคกสำโรง', 'ลำสนธิ'],
      'สิงห์บุรี': ['เมืองสิงห์บุรี', 'บางระจัน', 'ค่ายบางระจัน', 'อินทร์บุรี', 'ท่าช้าง', 'พรหมบุรี'],
      'อ่างทอง': ['เมืองอ่างทอง', 'ไชโย', 'ป่าโมก', 'โพธิ์ทอง', 'เสาหวด', 'วิเศษชัยชาญ'],
      'สุพรรณบุรี': ['เมืองสุพรรณบุรี', 'เดิมบางนางบวช', 'ด่านช้าง', 'บางปลาม้า', 'ศรีประจันต์'],
      'พระนครศรีอยุธยา': ['พระนครศรีอยุธยา', 'ภาชี', 'ลาดบัวหลวง', 'มหาราช', 'บางไทร', 'บางปะอิน'],
      'ปทุมธานี': ['เมืองปทุมธานี', 'คลองหลวง', 'ธัญบุรี', 'หนองเสือ', 'ลาดหลุมแก้ว', 'ลำลูกกา'],
      'นนทบุรี': ['เมืองนนทบุรี', 'บางกรวย', 'ไผ่', 'บางใหญ่', 'บางบัวทอง', 'ปากเกร็ด'],
      'สมุทรปราการ': ['เมืองสมุทรปราการ', 'บางบ่อ', 'บางพลี', 'บางเสาธง', 'พระประแดง', 'พระสมุทรเจดีย์'],
      'สมุทรสาคร': ['เมืองสมุทรสาคร', 'กระทุ่มแบน', 'บ้านแพ้ว', 'อัมพวา', 'ดำเนินสะดวก'],
      'สมุทรสงคราม': ['เมืองสมุทรสงคราม', 'แอมพวา', 'บางคนที', 'บางชำนาม'],

      // ภาคตะวันออก
      'ชลบุรี': ['เมืองชลบุรี', 'บ้านบึง', 'บางละมุง', 'บ่อทอง', 'พานทอง', 'พนัสนิคม', 'ศรีราชา'],
      'ระยอง': ['เมืองระยอง', 'บ้านฉาง', 'แกลง', 'วังจันทร์', 'บ้านค่าย', 'เขาชะเมา'],
      'จันทบุรี': ['เมืองจันทบุรี', 'ขลุง', 'ท่าใหม่', 'โป่งน้ำร้อน', 'มะขาม', 'สร้างคอม'],
      'ตราด': ['เมืองตราด', 'คลองใหญ่', 'เขาสมิง', 'บ่อไร่', 'แหลมงอบ'],
      'ฉะเชิงเทรา': ['เมืองฉะเชิงเทรา', 'บางคล้า', 'บางน้ำเปรี้ยว', 'บางปะกง', 'พนมสารคาม'],
      'ปราจีนบุรี': ['เมืองปราจีนบุรี', 'กบินทร์บุรี', 'ประจันตคาม', 'ศรีมหาโพธิ', 'ศรีมโนคาน'],
      'นครนายก': ['เมืองนครนายก', 'ปากพลี', 'บ้านนา', 'องครักษ์'],
      'สระแก้ว': ['เมืองสระแก้ว', 'วัฒนานคร', 'อรัญประเทศ', 'ตาพระยา', 'คลองหาด'],

      // ภาคตะวันออกเฉียงเหนือ
      'นครราชสีมา': ['เมืองนครราชสีมา', 'ครบุรี', 'จักราช', 'ชุมพวง', 'เทพารักษ์', 'เมืองยาง'],
      'ขอนแก่น': ['เมืองขอนแก่น', 'บ้านไผ่', 'เปื้องแสงชาติ', 'พล', 'ภูเวียง', 'มัญจาคีรี'],
      'อุดรธานี': ['เมืองอุดรธานี', 'กุดจับ', 'กุมภวาปี', 'โนนสะอาด', 'บ้านดุง', 'บ้านผือ'],
      'มหาสารคาม': ['เมืองมหาสารคาม', 'กันทรวิชัย', 'เชียงยืน', 'บรบือ', 'นาเชือก', 'ยางสีสุราช'],
      'ร้อยเอ็ด': ['เมืองร้อยเอ็ด', 'เกษตรวิสัย', 'ปทุมรัตต์', 'ธวัชบุรี', 'เสลภูมิ', 'สุวรรณภูมิ'],
      'กาฬสินธุ์': ['เมืองกาฬสินธุ์', 'กมลาไสย', 'กุฉินารายณ์', 'คำม่วง', 'ท่าคันโท', 'นามน'],
      'สกลนคร': ['เมืองสกลนคร', 'กุสุมาลย์', 'กันทรลักษ์', 'เจริญศิลป์', 'คำตากล้า', 'วานรนิวาส'],
      'นครพนม': ['เมืองนครพนม', 'ปลาปาก', 'ท่าอุเทน', 'บ้านแพง', 'ศรีสงคราม', 'นาแก'],
      'มุกดาหาร': ['เมืองมุกดาหาร', 'นิคมคำสร้อย', 'ดอนตาล', 'ดงหลวง', 'คำชะอี', 'วานรนิวาส'],
      'เลย': ['เมืองเลย', 'ด่านซ้าย', 'ท่าลี่', 'นาด้วง', 'ภูเรือ', 'ภูลื่ง'],
      'หนองบัวลำภู': ['เมืองหนองบัวลำภู', 'ศรีบุญเรือง', 'สุวรรณคูหา', 'โซ่พิสัย', 'นาวัง', 'นองวัวซอ'],
      'หนองคาย': ['เมืองหนองคาย', 'ท่าบ่อ', 'โพนพิสัย', 'สังคม', 'ศรีเชียงใหม่', 'ฝั่งแดง'],
      'บึงกาฬ': ['เมืองบึงกาฬ', 'พรเจริญ', 'โซ่พิสัย', 'เซกา', 'ศรีวิไล', 'บุ่งคล้า'],
      'ยโสธร': ['เมืองยโสธร', 'กุดชุม', 'ค้อวัง', 'ป่าติ้ว', 'มหาชนะชัย', 'ลือออาจีต'],
      'อำนาจเจริญ': ['เมืองอำนาจเจริญ', 'ชานุมาน', 'ปทุมราชวงศา', 'ลืออำนาจ', 'เซนางคนิคม'],
      'บุรีรัมย์': ['เมืองบุรีรัมย์', 'กระสัง', 'คูเมือง', 'แคนดง', 'ละหานทราย', 'ลำปลายมาศ'],
      'ศรีสะเกษ': ['เมืองศรีสะเกษ', 'กันทรลักษ์', 'กันทราภิเษก', 'ขุขันธ์', 'ปรางค์กู่', 'ราชลำบอง'],
      'สุรินทร์': ['เมืองสุรินทร์', 'จอมพระ', 'ท่าตูม', 'ปราสาท', 'ไพรบึง', 'สนม'],
      'ชัยภูมิ': ['เมืองชัยภูมิ', 'กเสจม', 'คอนสวรรค์', 'คอนสาร', 'จัตุรัส', 'แก้งคร้อ'],
      'อุบลราชธานี': ['เมืองอุบลราชธานี', 'เขื่องใน', 'เขมราฐ', 'คอนเซิม', 'เดชอุดม', 'ตระการพืชผล'],

      // ภาคใต้
      'สงขลา': ['เมืองสงขลา', 'หาดใหญ่', 'นาทวี', 'เทพา', 'บางกล่ำ', 'สิงหนคร', 'ระโนด'],
      'ปัตตานี': ['เมืองปัตตานี', 'โค๊ะจาน', 'หนองจิก', 'ยะหริ่ง', 'ยะรัง', 'มายอ', 'ทุ่งยางแดง', 'ปะนาเระ', 'แม่ลาน', 'ไทรโยค', 'สายบุรี'],
      'ยะลา': ['เมืองยะลา', 'เบตง', 'บันนังสตา', 'ธารโต', 'ยะหา', 'รามัน', 'กาบัง', 'กรงปินัง'],
      'นราธิวาส': ['เมืองนราธิวาส', 'ตากใบ', 'บาเจาะ', 'แว้ง', 'สุคิริน', 'สุไหงโก-ลก', 'ระแงะ'],
      'ภูเก็ต': ['เมืองภูเก็ต', 'กะทู้', 'ถลาง'],
      'กระบี่': ['เมืองกระบี่', 'คลองท่อม', 'แก่งหางแมว', 'ห้วยยาง', 'เขาพนม', 'อ่าวลึก'],
      'พังงา': ['เมืองพังงา', 'กะปง', 'ตะกั่วป่า', 'ตะกั่วทุ่ง', 'ทับปุด', 'เมืองพังงา'],
      'ตรัง': ['เมืองตรัง', 'กันตัง', 'ห้วยยอด', 'ปะเลียน', 'รัษฎา', 'สิเกา'],
      'สตูล': ['เมืองสตูล', 'ควนโดน', 'ควนกาหลง', 'ท่าแพ', 'ลังกาวี', 'มะนัง'],
      'พัทลุง': ['เมืองพัทลุง', 'กงหรา', 'เขาชัยสน', 'ตะโหมด', 'ป่าบอน', 'ป่าพยอม'],
      'สุราษฎร์ธานี': ['เมืองสุราษฎร์ธานี', 'กาญจนดิษฐ์', 'ดอนสัก', 'เกาะสมุย', 'เกาะพะงัน', 'ไชยา'],
      'นครศรีธรรมราท': ['เมืองนครศรีธรรมราท', 'ปากพนัง', 'เฉลิมพระเกียรติ', 'ร่อนพิบูลย์', 'ลาน สกา'],
      'ชุมพร': ['เมืองชุมพร', 'ท่าแซะ', 'ปะทิว', 'หลังสวน', 'ละแม', 'สวี'],
      'ระนอง': ['เมืองระนอง', 'กะปอร์', 'กะเปอร์', 'ละอุ่น', 'สุขสำราญ'],
      'เพชรบุรี': ['เมืองเพชรบุรี', 'เขายอย', 'น้อง หญ้าปล้อง', 'ชะอำ', 'ท่ายาง', 'บ้านลาด'],
      'ประจวบคีรีขันธ์': ['เมืองประจวบคีรีขันธ์', 'กุยบุรี', 'ทับสะแก', 'บางสะพาน', 'บางสะพานน้อย', 'ปราณบุรี'],
      'ราชบุรี': ['เมืองราชบุรี', 'จอมบึง', 'ดำเนินสะดวก', 'บ้านโป่ง', 'บางแพ', 'โพธาราม']
    };

    // ✅ ข้อมูลตำบลสำหรับอำเภอเมือง (Provincial Capitals) ทั้ง 77 จังหวัด - อัพเดทแก้ไขล่าสุด 2024
    const subDistricts = {
      // กรุงเทพมหานคร - แขวงสำคัญใน 50 เขต
      'พระนคร': ['พระบรมมหาราชวัง', 'วังบูรพาภิรมย์', 'วัดราชบพิธ', 'สำราญราษฎร์', 'ศาลเจ้าพ่อเสือ', 'เสาชิงช้า', 'บวรนิเวศ', 'ตลาดยอด', 'บางขุนพรหม', 'โพธิ์ทอง'],
      'ดุสิต': ['ดุสิต', 'วชิรพยาบาล', 'สวนจิตรลดา', 'สี่แยกมหานาค', 'ธนบุรี', 'ราชดำเนิน', 'ถนนนครไชยศรี', 'บางซื่อ'],
      'ปทุมวัน': ['ลุมพินี', 'ทุ่งมหาเมฆ', 'ราชเทวี', 'รองเมือง', 'วังใหม่', 'ปทุมวัน'],
      'บางรัก': ['สีลม', 'สุริยวงศ์', 'บางรัก', 'เจริญกรุง', 'ยานนาวา', 'สาทร'],
      'คลองเตย': ['คลองเตย', 'คลองตัน', 'พระโขนง'],
      'สาทร': ['ทุ่งวัดดอน', 'ทุ่งมหาเมฆ', 'ยานนาวา'],
      'บางนา': ['บางนา', 'บางนาใต้', 'บางนาเหนือ'],
      'ประเวศ': ['ประเวศ', 'หนองบอน', 'ดอกไม้'],
      'ห้วยขวาง': ['ห้วยขวาง', 'บางกะปิ', 'สามเสนนอก'],
      'วัฒนา': ['ลุมพินี', 'ปทุมวัน', 'คลองเตยเหนือ'],

      // ภาคเหนือ - อำเภอเมือง (Provincial Capitals) ✅ แก้ไขแล้ว
      'เมืองเชียงใหม่': ['ศรีภูมิ', 'พระสิงห์', 'หายยา', 'ช้างเคลือม', 'วัดเกต', 'ช้างม่อย', 'ช้างเผือก', 'ฟ้าฮ่าม', 'สุเทพ', 'สันทราย', 'สันผีเสื้อ', 'หนองหอย', 'หนองป่าครั่ง', 'ป่าแดด', 'ป่าตัน', 'ทุ่งหอม', 'วัดประดู่', 'น้ำแพร', 'แวงก์', 'แม่แสง'],
      'เมืองเชียงราย': ['รอบเวียง', 'ไวยุค', 'เวียง', 'บ้านดู่', 'ดอนชัย', 'หัวไคร', 'จองดำ', 'บางหลวง', 'ทรายขาว', 'ป่าอ้อดอนชัย', 'ป่าแก่ต', 'ทราย', 'ป่าแสง', 'ป่าตุง', 'ผาต่ำ', 'ม่วงคำ'],
      'เมืองลำพูน': ['ในเมือง', 'ต้นธง', 'ป่าสัก', 'บ้านโอ่ง', 'นาคา', 'เกาะช้าง', 'บ้านเป้า', 'ป่าไผ่', 'อุโมงค์', 'ม่วงก่ำ', 'วิเวก'],
      'เมืองลำปาง': ['สบตุ๋ย', 'ต้นธงชัย', 'เสริมไทย', 'บุญเศรษฐ', 'หัวเวียง', 'พิชัย', 'ป่าทาน', 'สวนดอก', 'บ้านเอื้อม', 'ศิลา', 'ป่าแมด'],
      'เมืองน่าน': ['ในเวียง', 'ธุรกิจ', 'ป่าคลี่', 'ไผ่ใหญ่', 'ฝายแขม', 'เจดีย์', 'ป่าแสง', 'นาไฮ', 'แม่จัง', 'สะท้อน', 'ทา'],
      'เมืองแม่ฮ่องสอน': ['จองคำ', 'ป่างมู', 'หมอกจำแป', 'ป่าบง', 'ผาบ่อง', 'หนองจ๊อม', 'สันต่อง'],
      'เมืองแพร่': ['ในเวียง', 'ป่าแมด', 'ป่าแดง', 'ทุ่งผึ้ง', 'ทับสี', 'ผาสุข', 'ไผ่หนอน'],

      // ภาคกลาง - อำเภอเมือง ✅ แก้ไขแล้ว
      'เมืองนครปฐม': ['พระปฐมเจดีย์', 'สนามจันทร์', 'บ้านไผ่', 'ท่าตลาด', 'ห้วยจรเข้', 'ดอนตูม', 'ลำพยา', 'หนองขามไทย', 'บ้านแขม', 'บ้านหม้อ', 'วงตานคร', 'วังตะก้อ'],
      'เมืองนครสวรรค์': ['ปากน้ำโพ', 'หนองไผ่', 'วัดไขต์', 'บ้านมะกอก', 'นครสวรรค์ตก', 'หลักสี่', 'ก้อมทอง', 'อยุธยาไชยสอง', 'จรเข้เผือก'],
      'เมืองสุพรรณบุรี': ['ท่าพี่เลี้ยง', 'รูปช้าง', 'สนามชัย', 'ป่าเข็ด', 'บ้านหอ', 'บางปลาม้า', 'พิหารแดง', 'ศาลาขาว', 'มาเลย์'],
      'พระนครศรีอยุธยา': ['ประจันตคาม', 'ศาลาปูน', 'บางปริน', 'โพธิ์กลาง', 'วัดจันทร์', 'ท่าวาสุกรี', 'สมอปรง', 'บ้านกระต้อน', 'หนองสายองค์'],
      'เมืองปทุมธานี': ['บ้านกลาง', 'บางหอ', 'คูเฝื้า', 'บ้านใหม่สุวรรณ', 'หนองเหืองน้อย', 'บ้านคลางการ', 'ประโดม', 'ลำลูกกา'],

      // ภาคตะวันออกเฉียงเหนือ - อำเภอเมือง ✅ แก้ไขแล้ว
      'เมืองขอนแก่น': ['ในเมือง', 'ศิลา', 'บ้านทุ่ม', 'หนองแสง', 'โคกสี', 'สำราญ', 'เมืองเก่า', 'บ้านเป็ด', 'บ้านกอก', 'ดอนช้าง', 'บ้านหิน', 'สวนหม่อน', 'โนนจาน', 'โคกสี', 'ท่าข้าม', 'โนนตาล', 'ทุ่งกร่าง', 'ท่าพระ', 'โคกสง', 'ดอนหาน'],
      'เมืองนครราชสีมา': ['ในเมือง', 'โพธิ์กลาง', 'หนองบัวศาลา', 'มาบไผ่', 'โคกสูง', 'บ้านใหม่', 'หนองกระดาน', 'ทัพไทย', 'หาดเสียว', 'บ้านใหม่', 'บ้านหัน', 'หนองระเวง', 'บึงพองนาง', 'มะตำใหญ', 'บ้านไผ่', 'โรงช้าง', 'จิระ', 'หูช้าง', 'ซับใหญ่', 'โค กรางกำ'],
      'เมืองอุดรธานี': ['หนองป่าคา', 'โบสถ์', 'หนองสาโรง', 'มาร์คโลง', 'เมืองเดิม', 'หนองจันทร์', 'โนนสะอาด', 'เป็นยี', 'สามพะแค', 'หนองนาคำ', 'หนองไผ่', 'บ้านดุง', 'บ้านจาก', 'หนองไผ่', 'ตาลจับ', 'บ้านลือ'],
      'เมืองมหาสารคาม': ['ตลาด', 'ท่าสองคอน', 'เวียงคู', 'แข่งแข', 'เขาใต้', 'ท่าบ้านบาก', 'หนองบัว', 'ลาดพัฒนา', 'หนองแปง', 'โคดผางัน'],

      // ภาคใต้ - อำเภอเมือง ✅ แก้ไขแล้ว
      'เมืองสงขลา': ['เบาะไผ่', 'ป่อ', 'บ่อยาง', 'เขารูปช้าง', 'ลิปอน', 'บ่อปลิง', 'มะขามใต้', 'สิงหา', 'หาดส้มแป้น', 'บ้านนา', 'ควนหลาง', 'ป่ารื่น', 'ทุ่งตาบาท', 'ชะลา', 'หัวเขา'],
      'เมืองปัตตานี': ['สนมลาวร', 'เปาะบายลึง', 'รูสเตาะ', 'ตันหยงลิมโจ', 'ปะนะเระ', 'วาจิร', 'เดอร์กอม', 'มาปิง', 'มิแลน', 'ซายอง', 'ปิยมาน', 'ดำเนิน', 'เกาะต่า', 'ลาต', 'ดอนรัก', 'บาเดะ', 'มูโน', 'ตันหยงลิมโค', 'จะบังงายอม', 'กาลูอี'],
      'เมืองยะลา': ['ในเมือง', 'ลิเลร', 'ไต', 'ยี่งอร์', 'ลายิง', 'กูบาง', 'ลำใหม่', 'สาทีง', 'บุยิง', 'ลิบอ', 'รมหาง', 'ตานหยองมัส'],
      'เมืองภูเก็ต': ['ตลาดใหญ่', 'ตลาดเหนือ', 'วิชิต', 'กะรน', 'เชิงตะแล', 'รัสดา', 'ปากล็อก', 'เกาะแก้ว', 'วิชิต', 'ล้ายหาม'],
      'เมืองกระบี่': ['ปากน้ำ', 'ไสไทย', 'กระบี่ใหญ่', 'กระบี่น้อย', 'ไสเก่า', 'แม่แวงเหนือ', 'กิเลน', 'ตาได', 'ถ้ำซื้อ', 'แกะอู่', 'กษทร์โชค', 'โคคร็อก'],

      // ภาคตะวันออก - อำเภอเมือง ✅ แก้ไขแล้ว
      'เมืองชลบุรี': ['เนินพลับหวาน', 'อ่างศิลา', 'หน้าเมือง', 'ตะเกียบ', 'เสม็ด', 'ศิลาราย', 'บางสำโพง', 'ยไดฟ้าใส', 'ท้ายบ้าน', 'หนองไผ่', 'แหวก', 'เขาเต่ำ', 'ตากแดด', 'ห้วยกะปิ', 'ปางราก'],
      'เมืองระยอง': ['เนินพระ', 'ตพง', 'ป่าบ่อ', 'ลาดกาแดง', 'ท่าประดู', 'ช่องสำโร', 'วังไผ่', 'แกลง', 'ทางตีน', 'เขาหยี', 'บ้านเพ', 'มาบปรค'],
      'เมืองจันทบุรี': ['วัดไผ่', 'โชดำ', 'บ้านสวน', 'ตลาดใหม่', 'ดียะ', 'สร้างคิม', 'สมทำคาร', 'สบำเพ', 'ผนงเรียง', 'เค้าใจชาย', 'บ้านป่วย'],

      // เพิ่มอำเภอเมืองที่เหลือ...
      'เมืองเพชรบุรี': ['ในเขต', 'ไร่ส้ม', 'บ้านหาด', 'สนามแย้ม', 'ธงชัย', 'บ้านแหลม', 'ดอนทราย', 'กุยบุรี', 'คลองสวน', 'สร้างปุก', 'ท่าไร่'],
      'เมืองประจวบคีรีขันธ์': ['ประจวบคีรีขันธ์', 'กิจจำราน', 'ใกร', 'บ้านเกล็ด', 'นรางรม', 'บ่อนอก', 'บ้านสำโรง', 'นาแกลง', 'อู่ลวด', 'มะผลก'],
      'เมืองระนอง': ['แหลมกลัด', 'บางริ้น', 'คอหงส์', 'มรดงผักแข', 'หูลงราด', 'เตย', 'แกร่ง', 'เงตง', 'แกรงตาปลิง'],
      'เมืองสุราษฎร์ธานี': ['มข้าร', 'บางใบไม้', 'บางกุ้ง', 'ตาไก่', 'บ้านศิลาเณร', 'ใน่า', 'ศรีไสย', 'ตลาด', 'นาสาร', 'มะตำ', 'บงน้ำร้าว'],
      'เมืองนครศรีธรรมราท': ['ในเขต', 'กลาง', 'ปาก', 'นากลุ่ม', 'คาร่ม', 'ถำปอก', 'สี', 'วงษ์', 'หนองเหียง', 'บ้านแคน', 'ข้าวปุ้ม']
    };

    let data = [];

    if (type === 'provinces') {
      data = provinces.map(name => ({ name, code: name }));
    } else if (type === 'districts' && province) {
      data = (districts[province] || []).map(name => ({ name, code: name }));
    } else if (type === 'subdistricts' && district) {
      data = (subDistricts[district] || []).map(name => ({ name, code: name }));
    }

    res.json({
      success: true,
      data: data
    });
  } catch (err) {
    console.error('❌ Error in getThailandData:', err);
    res.status(500).json({
      success: false,
      error: 'ไม่สามารถดึงข้อมูลที่อยู่ได้'
    });
  }
};

/**
 * ✅ GET /api/address/postal-code
 * ดึงรหัสไปรษณีย์จากที่อยู่
 */
exports.getPostalCode = async (req, res) => {
  try {
    const { province, district, subdistrict } = req.query;

    if (!province || !district || !subdistrict) {
      return res.status(400).json({
        success: false,
        error: 'กรุณาระบุจังหวัด อำเภอ และตำบล'
      });
    }

    // ✅ ข้อมูลรหัสไปรษณีย์ครบถ้วนสำหรับอำเภอเมืองทุกจังหวัด - อัพเดทล่าสุด 2024
    const postalCodes = {
      // กรุงเทพมหานคร
      'กรุงเทพมหานคร': {
        'พระนคร': { 'พระบรมมหาราชวัง': '10200', 'วังบูรพาภิรมย์': '10200', 'วัดราชบพิธ': '10200', 'สำราญราษฎร์': '10200', 'ศาลเจ้าพ่อเสือ': '10200', 'เสาชิงช้า': '10200', 'บวรนิเวศ': '10200', 'ตลาดยอด': '10200', 'บางขุนพรหม': '10200', 'โพธิ์ทอง': '10200' },
        'ดุสิต': { 'ดุสิต': '10300', 'วชิรพยาบาล': '10300', 'สวนจิตรลดา': '10300', 'สี่แยกมหานาค': '10300', 'ธนบุรี': '10300', 'ราชดำเนิน': '10300', 'ถนนนครไชยศรี': '10300', 'บางซื่อ': '10300' },
        'ปทุมวัน': { 'ลุมพินี': '10330', 'ทุ่งมหาเมฆ': '10330', 'ราชเทวี': '10330', 'รองเมือง': '10330', 'วังใหม่': '10330', 'ปทุมวัน': '10330' },
        'บางรัก': { 'สีลม': '10500', 'สุริยวงศ์': '10500', 'บางรัก': '10500', 'เจริญกรุง': '10500', 'ยานนาวา': '10500', 'สาทร': '10500' },
        'คลองเตย': { 'คลองเตย': '10110', 'คลองตัน': '10110', 'พระโขนง': '10110' },
        'สาทร': { 'ทุ่งวัดดอน': '10120', 'ทุ่งมหาเมฆ': '10120', 'ยานนาวา': '10120' },
        'บางนา': { 'บางนา': '10260', 'บางนาใต้': '10260', 'บางนาเหนือ': '10260' },
        'ประเวศ': { 'ประเวศ': '10250', 'หนองบอน': '10250', 'ดอกไม้': '10250' },
        'ห้วยขวาง': { 'ห้วยขวาง': '10310', 'บางกะปิ': '10310', 'สามเสนนอก': '10310' },
        'วัฒนา': { 'ลุมพินี': '10330', 'ปทุมวัน': '10330', 'คลองเตยเหนือ': '10330' }
      },

      // ภาคเหนือ
      'เชียงใหม่': {
        'เมืองเชียงใหม่': { 'ศรีภูมิ': '50200', 'พระสิงห์': '50200', 'หายยา': '50100', 'ช้างเคลือม': '50100', 'วัดเกต': '50200', 'ช้างม่อย': '50300', 'ช้างเผือก': '50300', 'ฟ้าฮ่าม': '50000', 'สุเทพ': '50200', 'สันทราย': '50210', 'สันผีเสื้อ': '50300', 'หนองหอย': '50230', 'หนองป่าครั่ง': '50000', 'ป่าแดด': '50100', 'ป่าตัน': '50160', 'ทุ่งหอม': '50160', 'วัดประดู่': '50000', 'น้ำแพร': '50000', 'แวงก์': '50000', 'แม่แสง': '50180' }
      },
      'เชียงราย': {
        'เมืองเชียงราย': { 'รอบเวียง': '57000', 'ไวยุค': '57000', 'เวียง': '57000', 'บ้านดู่': '57100', 'ดอนชัย': '57000', 'หัวไคร': '57000', 'จองดำ': '57000', 'บางหลวง': '57000', 'ทรายขาว': '57000', 'ป่าอ้อดอนชัย': '57000', 'ป่าแก่ต': '57000', 'ทราย': '57000', 'ป่าแสง': '57000', 'ป่าตุง': '57000', 'ผาต่ำ': '57000', 'ม่วงคำ': '57000' }
      },

      // ภาคกลาง
      'นครปฐม': {
        'เมืองนครปฐม': { 'พระปฐมเจดีย์': '73000', 'สนามจันทร์': '73000', 'บ้านไผ่': '73000', 'ท่าตลาด': '73000', 'ห้วยจรเข้': '73000', 'ดอนตูม': '73000', 'ลำพยา': '73000', 'หนองขามไทย': '73000', 'บ้านแขม': '73000', 'บ้านหม้อ': '73000', 'วงตานคร': '73000', 'วังตะก้อ': '73000' }
      },
      'นครสวรรค์': {
        'เมืองนครสวรรค์': { 'ปากน้ำโพ': '60000', 'หนองไผ่': '60000', 'วัดไขต์': '60000', 'บ้านมะกอก': '60000', 'นครสวรรค์ตก': '60000', 'หลักสี่': '60000', 'ก้อมทอง': '60000', 'อยุธยาไชยสอง': '60000', 'จรเข้เผือก': '60000' }
      },

      // ภาคตะวันออกเฉียงเหนือ
      'ขอนแก่น': {
        'เมืองขอนแก่น': { 'ในเมือง': '40000', 'ศิลา': '40000', 'บ้านทุ่ม': '40000', 'หนองแสง': '40000', 'โคกสี': '40000', 'สำราญ': '40000', 'เมืองเก่า': '40000', 'บ้านเป็ด': '40000', 'บ้านกอก': '40000', 'ดอนช้าง': '40000', 'บ้านหิน': '40000', 'สวนหม่อน': '40000', 'โนนจาน': '40000', 'ท่าข้าม': '40000', 'โนนตาล': '40000', 'ทุ่งกร่าง': '40000', 'ท่าพระ': '40000', 'โคกสง': '40000', 'ดอนหาน': '40000' }
      },
      'นครราชสีมา': {
        'เมืองนครราชสีมา': { 'ในเมือง': '30000', 'โพธิ์กลาง': '30000', 'หนองบัวศาลา': '30000', 'มาบไผ่': '30000', 'โคกสูง': '30000', 'บ้านใหม่': '30000', 'หนองกระดาน': '30000', 'ทัพไทย': '30000', 'หาดเสียว': '30000', 'บ้านหัน': '30000', 'หนองระเวง': '30000', 'บึงพองนาง': '30000', 'มะตำใหญ': '30000', 'บ้านไผ่': '30000', 'โรงช้าง': '30000', 'จิระ': '30000', 'หูช้าง': '30000', 'ซับใหญ่': '30000', 'โค กรางกำ': '30000' }
      },

      // ภาคใต้
      'สงขลา': {
        'เมืองสงขลา': { 'เบาะไผ่': '90000', 'ป่อ': '90000', 'บ่อยาง': '90000', 'เขารูปช้าง': '90000', 'ลิปอน': '90000', 'บ่อปลิง': '90000', 'มะขามใต้': '90000', 'สิงหา': '90000', 'หาดส้มแป้น': '90000', 'บ้านนา': '90000', 'ควนหลาง': '90000', 'ป่ารื่น': '90000', 'ทุ่งตาบาท': '90000', 'ชะลา': '90000', 'หัวเขา': '90000' }
      },
      'ปัตตานี': {
        'เมืองปัตตานี': { 'สนมลาวร': '94000', 'เปาะบายลึง': '94000', 'รูสเตาะ': '94000', 'ตันหยงลิมโจ': '94000', 'ปะนะเระ': '94000', 'วาจิร': '94000', 'เดอร์กอม': '94000', 'มาปิง': '94000', 'มิแลน': '94000', 'ซายอง': '94000', 'ปิยมาน': '94000', 'ดำเนิน': '94000', 'เกาะต่า': '94000', 'ลาต': '94000', 'ดอนรัก': '94000', 'บาเดะ': '94000', 'มูโน': '94000', 'ตันหยงลิมโค': '94000', 'จะบังงายอม': '94000', 'กาลูอี': '94000' }
      },
      'ยะลา': {
        'เมืองยะลา': { 'ในเมือง': '95000', 'ลิเลร': '95000', 'ไต': '95000', 'ยี่งอร์': '95000', 'ลายิง': '95000', 'กูบาง': '95000', 'ลำใหม่': '95000', 'สาทีง': '95000', 'บุยิง': '95000', 'ลิบอ': '95000', 'รมหาง': '95000', 'ตานหยองมัส': '95000' }
      },
      'ภูเก็ต': {
        'เมืองภูเก็ต': { 'ตลาดใหญ่': '83000', 'ตลาดเหนือ': '83000', 'วิชิต': '83000', 'กะรน': '83100', 'เชิงตะแล': '83130', 'รัสดา': '83000', 'ปากล็อก': '83110', 'เกาะแก้ว': '83000', 'ล้ายหาม': '83000' }
      },

      // ภาคตะวันออก
      'ชลบุรี': {
        'เมืองชลบุรี': { 'เนินพลับหวาน': '20000', 'อ่างศิลา': '20000', 'หน้าเมือง': '20000', 'ตะเกียบ': '20000', 'เสม็ด': '20000', 'ศิลาราย': '20000', 'บางสำโพง': '20000', 'ยไดฟ้าใส': '20000', 'ท้ายบ้าน': '20000', 'หนองไผ่': '20000', 'แหวก': '20000', 'เขาเต่ำ': '20000', 'ตากแดด': '20000', 'ห้วยกะปิ': '20000', 'ปางราก': '20000' }
      },
      'ระยอง': {
        'เมืองระยอง': { 'เนินพระ': '21000', 'ตพง': '21000', 'ป่าบ่อ': '21000', 'ลาดกาแดง': '21000', 'ท่าประดู': '21000', 'ช่องสำโร': '21000', 'วังไผ่': '21000', 'แกลง': '21000', 'ทางตีน': '21000', 'เขาหยี': '21000', 'บ้านเพ': '21000', 'มาบปรค': '21000' }
      },

      // เพิ่มจังหวัดอื่น ๆ...
      'เพชรบุรี': {
        'เมืองเพชรบุรี': { 'ในเขต': '76000', 'ไร่ส้ม': '76000', 'บ้านหาด': '76000', 'สนามแย้ม': '76000', 'ธงชัย': '76000', 'บ้านแหลม': '76000', 'ดอนทราย': '76000', 'กุยบุรี': '76000', 'คลองสวน': '76000', 'สร้างปุก': '76000', 'ท่าไร่': '76000' }
      },
      'สุราษฎร์ธานี': {
        'เมืองสุราษฎร์ธานี': { 'มข้าร': '84000', 'บางใบไม้': '84000', 'บางกุ้ง': '84000', 'ตาไก่': '84000', 'บ้านศิลาเณร': '84000', 'ใน่า': '84000', 'ศรีไสย': '84000', 'ตลาด': '84000', 'นาสาร': '84000', 'มะตำ': '84000', 'บงน้ำร้าว': '84000' }
      }
    };

    const postalCode = postalCodes[province]?.[district]?.[subdistrict] || '00000';

    res.json({
      success: true,
      data: {
        province,
        district,
        subdistrict,
        postalCode
      }
    });
  } catch (err) {
    console.error('❌ Error in getPostalCode:', err);
    res.status(500).json({
      success: false,
      error: 'ไม่สามารถดึงรหัสไปรษณีย์ได้'
    });
  }
};

/**
 * ✅ POST /api/address/reverse-geocode
 * แปลงพิกัดเป็นที่อยู่
 */
exports.reverseGeocode = async (req, res) => {
  try {
    const { lat, lng } = req.body;

    if (!lat || !lng) {
      return res.status(400).json({
        success: false,
        error: 'กรุณาระบุพิกัด latitude และ longitude'
      });
    }

    // ใช้ BigDataCloud API สำหรับ reverse geocoding
    const response = await axios.get(`https://api.bigdatacloud.net/data/reverse-geocode-client`, {
      params: {
        latitude: lat,
        longitude: lng,
        localityLanguage: 'th'
      },
      timeout: 10000 // 10 วินาที
    });

    if (response.data) {
      const data = response.data;

      res.json({
        success: true,
        data: {
          address: data.locality || data.city || data.countryName || 'ไม่พบข้อมูล',
          province: data.principalSubdivision || '',
          district: data.city || '',
          subdistrict: data.locality || '',
          postalCode: data.postcode || '',
          country: data.countryName || 'ประเทศไทย',
          fullAddress: `${data.locality || ''} ${data.city || ''} ${data.principalSubdivision || ''} ${data.postcode || ''}`.trim()
        }
      });
    } else {
      throw new Error('ไม่ได้รับข้อมูลจาก API');
    }
  } catch (err) {
    console.error('❌ Error in reverseGeocode:', err);

    // ข้อมูล fallback
    res.json({
      success: true,
      data: {
        address: 'ไม่สามารถระบุที่อยู่ได้',
        province: '',
        district: '',
        subdistrict: '',
        postalCode: '',
        country: 'ประเทศไทย',
        fullAddress: 'ไม่สามารถระบุที่อยู่ได้'
      }
    });
  }
};