/**
 * Scroll Fix CSS
 * แก้ปัญหาการ scroll กระตุกและซ้ำ
 */

/* ============================================
   Reset Problematic Scroll Behaviors
   ============================================ */
* {
  /* ปิด smooth scroll ที่ทำให้กระตุก */
  scroll-behavior: auto !important;
  
  /* ป้องกัน scroll chaining */
  overscroll-behavior: none !important;
}

html {
  /* Stable scroll */
  overflow-y: scroll !important;
  scroll-behavior: auto !important;
  
  /* ป้องกัน elastic scroll บน iOS */
  -webkit-overflow-scrolling: auto !important;
}

body {
  /* ป้องกัน scroll bounce */
  overscroll-behavior-y: contain !important;
  overflow-anchor: none !important;
  
  /* Stable positioning */
  position: relative !important;
  min-height: 100vh !important;
}

/* ============================================
   Fix Double Scrollbars
   ============================================ */
.modal-open {
  overflow: hidden !important;
  position: fixed !important;
  width: 100% !important;
}

/* Hide duplicate scrollbars */
::-webkit-scrollbar-track-piece:start {
  margin-top: 0;
}

::-webkit-scrollbar-track-piece:end {
  margin-bottom: 0;
}

/* ============================================
   Optimize Scrollable Containers
   ============================================ */
.product-grid,
#cartTable,
#imeiResultGrid,
#level1Grid,
#level2Grid,
#level3Grid {
  /* Use native scroll */
  overflow-y: auto !important;
  overflow-x: hidden !important;
  
  /* Max height to prevent infinite scroll */
  max-height: 80vh !important;
  
  /* Smooth but not too smooth */
  scroll-behavior: auto !important;
  
  /* GPU acceleration */
  transform: translateZ(0);
  backface-visibility: hidden;
  will-change: scroll-position;
  
  /* Contain layout */
  contain: layout style paint;
}

/* ============================================
   Prevent Layout Shift During Scroll
   ============================================ */
img {
  /* Reserve space for images */
  min-height: 100px;
  background: #f0f0f0;
  
  /* Prevent reflow */
  aspect-ratio: 1 / 1;
  object-fit: cover;
}

.card,
.product-card {
  /* Fixed dimensions */
  min-height: 200px;
  
  /* Prevent content jumping */
  contain: layout style;
}

/* ============================================
   Disable Animations During Scroll
   ============================================ */
body.is-scrolling * {
  /* Disable all animations while scrolling */
  animation-play-state: paused !important;
  transition: none !important;
}

body.is-scrolling {
  /* Disable pointer events during scroll */
  pointer-events: none !important;
}

body.is-scrolling .btn,
body.is-scrolling button,
body.is-scrolling a,
body.is-scrolling input {
  /* Keep buttons/links unclickable during scroll */
  pointer-events: none !important;
  cursor: default !important;
}

/* ============================================
   Fix Sticky Elements
   ============================================ */
.sticky,
[data-sticky],
.navbar,
.header {
  /* Use fixed instead of sticky */
  position: fixed !important;
  top: 0;
  z-index: 1000;
  
  /* Prevent jumping */
  transform: translateZ(0);
  backface-visibility: hidden;
}

/* Add padding to compensate for fixed header */
body {
  padding-top: 60px; /* Adjust based on header height */
}

/* ============================================
   Optimize Mobile Scroll
   ============================================ */
@media (max-width: 768px) {
  /* Disable momentum scrolling on mobile */
  * {
    -webkit-overflow-scrolling: auto !important;
  }
  
  /* Smaller scroll containers on mobile */
  .product-grid,
  #imeiResultGrid,
  #level3Grid {
    max-height: 60vh !important;
  }
  
  /* Disable pull-to-refresh */
  body {
    overscroll-behavior-y: contain !important;
  }
}

/* ============================================
   Custom Scrollbar Styling
   ============================================ */
::-webkit-scrollbar {
  width: 12px;
  height: 12px;
}

::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 6px;
}

::-webkit-scrollbar-thumb {
  background: #888;
  border-radius: 6px;
  border: 2px solid #f1f1f1;
}

::-webkit-scrollbar-thumb:hover {
  background: #555;
}

/* Firefox */
* {
  scrollbar-width: thin;
  scrollbar-color: #888 #f1f1f1;
}

/* ============================================
   Loading States
   ============================================ */
.loading {
  /* Prevent scroll during loading */
  overflow: hidden !important;
  pointer-events: none !important;
}

.skeleton-loader {
  /* Stable skeleton height */
  min-height: 200px;
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
}

@keyframes loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

/* ============================================
   Virtual Scroll Removal
   ============================================ */
.virtual-scroll-viewport,
.virtual-scroll-content,
[data-virtual-scroll] {
  /* Remove virtual scroll styling */
  height: auto !important;
  overflow: visible !important;
  position: static !important;
}

.virtual-item {
  /* Remove absolute positioning */
  position: static !important;
  top: auto !important;
  left: auto !important;
}

/* ============================================
   Emergency Fixes
   ============================================ */
/* If still jumping, use this nuclear option */
.no-scroll {
  overflow: hidden !important;
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
}